(this["webpackJsonpprocgen-skill-tree"]=this["webpackJsonpprocgen-skill-tree"]||[]).push([[0],{124:function(e,t,n){},132:function(e,t,n){},133:function(e,t,n){},134:function(e,t,n){},14:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return r}));n(2),n(3),n(48);var i=Math.pow(2,32);function r(e){var t=(e+i)%i;return t=Math.imul(t,3039394381),t^=t>>>8,t+=1759714724,t^=t<<8,t=Math.imul(t,458671337),((t^=t>>>8)+i)%i}}).call(this,n(13).Buffer)},144:function(e,t){},146:function(e,t){},157:function(e,t){},159:function(e,t){},184:function(e,t){},186:function(e,t){},187:function(e,t){},192:function(e,t){},194:function(e,t){},213:function(e,t){},225:function(e,t){},228:function(e,t){},231:function(e,t,n){},232:function(e,t,n){},233:function(e,t,n){},234:function(e,t,n){},235:function(e,t,n){},236:function(e,t,n){"use strict";n.r(t);var i=n(0),r=n(1),a=n.n(r),o=n(125),c=n.n(o),u=(n(132),n(8)),s=(n(133),n(31)),l=n.n(s),d=(n(134),n(2)),h=n(3),p=function(){function e(){Object(d.a)(this,e),this.frameTimestampsInTicks=[],this.frameTimestampsInTime=[],this.frameTimestampsInTicks.push(0)}return Object(h.a)(e,[{key:"tick",value:function(e){var t=this.frameTimestampsInTicks[this.frameTimestampsInTicks.length-1];this.frameTimestampsInTicks.push(t+e),this.frameTimestampsInTicks.length>120&&(this.frameTimestampsInTicks=this.frameTimestampsInTicks.slice(60)),this.frameTimestampsInTime.push((new Date).getTime()),this.frameTimestampsInTime.length>120&&(this.frameTimestampsInTime=this.frameTimestampsInTime.slice(60))}},{key:"getUps",value:function(){var e=this.frameTimestampsInTicks[this.frameTimestampsInTicks.length-1]-this.frameTimestampsInTicks[0],t=(this.frameTimestampsInTicks.length-1)/e;return t?60*t:60}},{key:"getFps",value:function(){var e=this.frameTimestampsInTime[this.frameTimestampsInTime.length-1]-this.frameTimestampsInTime[0],t=(this.frameTimestampsInTime.length-1)/e;return t?1e3*t:60}},{key:"getFpsString",value:function(){return this.getFps().toFixed(1)}},{key:"getUpsString",value:function(){return this.getUps().toFixed(1)}}]),e}();function v(e){var t=Object(r.useRef)(new p);return Object(r.useEffect)((function(){t.current.tick(0)}),[e.tick]),Object(i.jsxs)("div",{className:"text",children:[Object(i.jsxs)("div",{children:[e.windowState.innerWidth,"x",e.windowState.innerHeight]}),Object(i.jsx)(f,{}),Object(i.jsxs)("div",{children:["UPS: ",t.current.getFpsString()]})]})}function f(){var e=Object(r.useState)(0),t=Object(u.a)(e,2),n=t[0],a=t[1],o=Object(r.useRef)(new p);Object(r.useEffect)((function(){var e=setTimeout((function(){a((function(e){return e+1})),o.current.tick(0)}),5);return function(){return clearTimeout(e)}}),[n]);var c=Object(r.useMemo)((function(){return n>=0?o.current.getFpsString():""}),[n]);return Object(i.jsxs)("div",{children:["RPS: ",c]})}var b,O=n(12),j=n(11),y=n(9),g=function(){function e(){Object(d.a)(this,e)}return Object(h.a)(e,null,[{key:"MinBy",value:function(e,t){var n,i=null,r=null,a=Object(y.a)(e);try{for(a.s();!(n=a.n()).done;){var o=n.value,c=t(o);(null===r||c<r)&&(i=o,r=c)}}catch(u){a.e(u)}finally{a.f()}return i}},{key:"MinByAndValue",value:function(e,t){var n,i=null,r=null,a=Object(y.a)(e);try{for(a.s();!(n=a.n()).done;){var o=n.value,c=t(o);(null===r||c<r)&&(i=o,r=c)}}catch(u){a.e(u)}finally{a.f()}return null===i||null===r?null:{obj:i,value:r}}},{key:"MaxBy",value:function(e,t){var n,i=null,r=null,a=Object(y.a)(e);try{for(a.s();!(n=a.n()).done;){var o=n.value,c=t(o);(null===r||c>r)&&(i=o,r=c)}}catch(u){a.e(u)}finally{a.f()}return i}},{key:"RandRange",value:function(e,t){return Math.floor(Math.random()*(t-e)+e)}},{key:"SortByKey",value:function(e,t){return e.sort((function(e,n){return t(e)-t(n)}))}},{key:"ReplaceAll",value:function(e,t){var n=new RegExp(Object.keys(t).join("|"),"gi");return e.replace(n,(function(e){return t[e.toLowerCase()]}))}},{key:"Debounce",value:function(e){var t,n=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{isImmediate:!1},a=function(){for(var a=arguments.length,o=new Array(a),c=0;c<a;c++)o[c]=arguments[c];var u=function(){t=void 0,r.isImmediate||e.apply(n,o)},s=r.isImmediate&&void 0===t;void 0!==t&&clearTimeout(t),t=setTimeout(u,i),s&&e.apply(n,o)};return a}},{key:"FormatDate",value:function(e){var t=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][e.getMonth()];return"".concat(t," ").concat(e.getDate(),", ").concat(("00"+e.getHours()).substr(-2),":").concat(("00"+e.getMinutes()).substr(-2),":").concat(("00"+e.getSeconds()).substr(-2))}},{key:"FlattenByOne",value:function(e){var t,n=[],i=Object(y.a)(e);try{for(i.s();!(t=i.n()).done;){var r=t.value;n=n.concat(r)}}catch(a){i.e(a)}finally{i.f()}return n}},{key:"PadString",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:" ";return e+n+i.repeat(t-e.length)}}]),e}();function x(e,t){var n=[16711680&e,16711680&t],i=[255&e,255&t],r=[65280&e,65280&t],a=65536*Math.round(n[0]/65536*n[1]/16777215);return a+=256*Math.round(r[0]/256*r[1]/65280),a+=Math.round(i[0]*i[1]/255)}function S(e,t){var n=[16711680&e,16711680&t],i=[255&e,255&t],r=[65280&e,65280&t],a=65536*Math.round(Math.min(n[0]/65536+n[1]/65536,255));return a+=256*Math.round(Math.min(r[0]/256+r[1]/256,255)),a+=Math.round(Math.min(i[0]+i[1],255))}function m(e,t,n){if("object"===typeof e){if(e.hasOwnProperty("target"))return k(e);if(e.hasOwnProperty("color")){var i=e;return k({target:i.color,proportion:i.opacity,base:i.background})}throw new Error("missing parameter in interpolateColor: ".concat(e))}if(t)return k({target:e,proportion:t,base:n});throw new Error("missing parameter in interpolateColor: ".concat(e," ").concat(t," ").concat(n))}function k(e){var t=e.target,n=e.base,i=void 0===n?0:n,r=e.proportion,a=void 0===r?1:r,o=[16711680&t,16711680&i],c=[255&t,255&i],u=[65280&t,65280&i],s=65536*Math.round(o[0]/65536*a+o[1]/65536*(1-a));return s+=256*Math.round(u[0]/256*a+u[1]/256*(1-a)),s+=Math.round(c[0]*a+c[1]*(1-a))}function w(e){var t=[[]],n={get:function(e,i,r){var a=e.path.concat([i.toString()]);return t[t.length-1]===e.path?t[t.length-1]=a:t.push(a),new Proxy({path:a},n)}};return e(new Proxy({path:t[0]},n)),t}function E(e){var t=w(e);return function(e){return t.map((function(t){var n,i=e,r=Object(y.a)(t);try{for(r.s();!(n=r.n()).done;){var a,o=n.value;i=null===(a=i)||void 0===a?void 0:a[o]}}catch(c){r.e(c)}finally{r.f()}return i}))}}!function(e){e.NOOP="NOOP",e.PAN_NORTH="PAN_NORTH",e.PAN_SOUTH="PAN_SOUTH",e.PAN_WEST="PAN_WEST",e.PAN_EAST="PAN_EAST",e.TRAVEL_UPSTAIRS="TRAVEL_UPSTAIRS",e.TRAVEL_DOWNSTAIRS="TRAVEL_DOWNSTAIRS",e.TOGGLE_STRATEGIC_VIEW="TOGGLE_STRATEGIC_VIEW",e.TOGGLE_SIDEBAR="TOGGLE_SIDEBAR",e.MOVE_CURSOR_WEST="MOVE_CURSOR_WEST",e.MOVE_CURSOR_EAST="MOVE_CURSOR_EAST",e.MOVE_CURSOR_NORTH="MOVE_CURSOR_NORTH",e.MOVE_CURSOR_SOUTH="MOVE_CURSOR_SOUTH",e.MOVE_CURSOR_NORTHWEST="MOVE_CURSOR_NORTHWEST",e.MOVE_CURSOR_NORTHEAST="MOVE_CURSOR_NORTHEAST",e.MOVE_CURSOR_SOUTHWEST="MOVE_CURSOR_SOUTHWEST",e.MOVE_CURSOR_SOUTHEAST="MOVE_CURSOR_SOUTHEAST",e.INTERACT_WITH_NODE="INTERACT_WITH_NODE"}(b||(b={}));var T,C=(T=b,Object.keys(T)).reduce((function(e,t){return e[t]=!1,e}),{}),_=function(){return{activeIntent:C,newIntent:C,endedIntent:C}},I={w:b.PAN_NORTH,a:b.PAN_WEST,s:b.PAN_SOUTH,d:b.PAN_EAST,k:b.PAN_NORTH,h:b.PAN_WEST,j:b.PAN_SOUTH,l:b.PAN_EAST,m:b.TOGGLE_STRATEGIC_VIEW,i:b.TOGGLE_SIDEBAR,ArrowUp:b.MOVE_CURSOR_NORTH,ArrowLeft:b.MOVE_CURSOR_WEST,ArrowDown:b.MOVE_CURSOR_SOUTH,ArrowRight:b.MOVE_CURSOR_EAST," ":b.INTERACT_WITH_NODE,"<":b.TRAVEL_UPSTAIRS,">":b.TRAVEL_DOWNSTAIRS},N=function(e){Object(O.a)(n,e);var t=Object(j.a)(n);function n(e){var i;return Object(d.a)(this,n),(i=t.call(this,e)).handleKeydown=function(e){var t=i.state.keyIntentConfig[e.key];if(t){if(i.props.isTextBoxFocused)return void console.log("bypassing keyboard event processing because text box is focused");e.preventDefault()}!1===e.repeat&&void 0!==t&&t!==b.NOOP&&(i.props.updaters.newIntent[t].enqueueUpdate((function(){return i.props.updaters.newIntent[t].enqueueUpdate((function(){return!1})),!0})),i.props.updaters.activeIntent[t].enqueueUpdate((function(){return!0})))},i.handleKeyup=function(e){var t=i.state.keyIntentConfig[e.key];void 0!==t&&t!==b.NOOP&&(i.props.updaters.activeIntent[t].enqueueUpdate((function(){return!1})),i.props.updaters.endedIntent[t].enqueueUpdate((function(){return i.props.updaters.endedIntent[t].enqueueUpdate((function(){return!1})),!0})))},i.state={keyIntentConfig:I},i}return Object(h.a)(n,[{key:"componentDidMount",value:function(){console.log("adding event listeners for keyboard component"),document.addEventListener("keydown",this.handleKeydown),document.addEventListener("keyup",this.handleKeyup)}},{key:"componentWillUnmount",value:function(){console.log("removing event listeners for keyboard component"),document.removeEventListener("keydown",this.handleKeydown),document.removeEventListener("keyup",this.handleKeyup)}},{key:"render",value:function(){return Object(i.jsx)(i.Fragment,{children:" "})}}]),n}(a.a.Component),U=a.a.createContext([]),M=n(6),R=1e-7,D=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{x:0,y:0},n=arguments.length>1?arguments[1]:void 0;Object(d.a)(this,e),this._x=void 0,this._y=void 0,"number"===typeof t?(this._x=t,this._y=n):(this._x=t.x,this._y=t.y)}return Object(h.a)(e,[{key:"x",get:function(){return this._x}},{key:"y",get:function(){return this._y}}]),Object(h.a)(e,[{key:"hash",value:function(){return this.toString()}},{key:"toString",value:function(){return"[".concat(this.x,", ").concat(this.y,"]")}},{key:"invert",value:function(){return new e({x:-this.x,y:-this.y})}},{key:"round",value:function(){return new e({x:Math.round(this.x),y:Math.round(this.y)})}},{key:"floor",value:function(){return new e({x:Math.floor(this.x),y:Math.floor(this.y)})}},{key:"taxicabDistance",value:function(e){return Math.abs(e.x-this.x)+Math.abs(e.y-this.y)}},{key:"diagonalDistance",value:function(e){return Math.max(Math.abs(e.x-this.x),Math.abs(e.y-this.y))}},{key:"distance",value:function(e){var t=Math.abs(e.x-this.x),n=Math.abs(e.y-this.y);return Math.sqrt(t*t+n*n)}},{key:"translate",value:function(t){return new e({x:this.x+t.x,y:this.y+t.y})}},{key:"subtract",value:function(t){return new e({x:this.x-t.x,y:this.y-t.y})}},{key:"add",value:function(t){return new e({x:this.x+t.x,y:this.y+t.y})}},{key:"addX",value:function(t){return new e({x:this.x+t,y:this.y})}},{key:"addY",value:function(t){return new e({x:this.x,y:this.y+t})}},{key:"subtractX",value:function(t){return new e({x:this.x-t,y:this.y})}},{key:"subtractY",value:function(t){return new e({x:this.x,y:this.y-t})}},{key:"clampX",value:function(t,n){var i=this.x;return i<t&&(i=t),i>n&&(i=n),new e({x:i,y:this.y})}},{key:"clampY",value:function(t,n){var i=this.y;return i<t&&(i=t),i>n&&(i=n),new e({x:this.x,y:i})}},{key:"scale",value:function(t,n){return new e({x:(this.x-t.x)*n.x+t.x,y:(this.y-t.y)*n.y+t.y})}},{key:"rotate",value:function(t,n){return n/=180/Math.PI,new e({x:Math.cos(n)*(this.x-t.x)-Math.sin(n)*(this.y-t.y)+t.x,y:Math.sin(n)*(this.x-t.x)+Math.cos(n)*(this.y-t.y)+t.y})}},{key:"equals",value:function(e){return void 0!==e&&null!==e&&(Math.abs(this.x-e.x)<R&&Math.abs(this.y-e.y)<R)}},{key:"multiply",value:function(t){return new e("number"===typeof t?{x:this.x*t,y:this.y*t}:{x:this.x*t.x,y:this.y*t.y})}},{key:"divide",value:function(t){return new e("number"===typeof t?{x:this.x/t,y:this.y/t}:{x:this.x/t.x,y:this.y/t.y})}},{key:"toJSON",value:function(){return{__type:"Vector2",x:this.x,y:this.y}}},{key:"transform",value:function(t,n){return new e({x:Math.floor((this.x-t.x)*n),y:Math.floor((this.y-t.y)*n)})}},{key:"normalize",value:function(){if(0===this.x&&0===this.y)return this;var t=Math.sqrt(this.x*this.x+this.y*this.y);return new e({x:this.x/t,y:this.y/t})}},{key:"withX",value:function(t){return new e({x:t,y:this.y})}},{key:"withY",value:function(t){return new e({x:this.x,y:t})}},{key:"invertX",value:function(){return new e({x:-this.x,y:this.y})}},{key:"lerp",value:function(e,t){return(t>1||t<0)&&console.error("Lerp t must be between 0 and 1."),0===t?this:1===t?e:this.scale({x:0,y:0},{x:1-t,y:1-t}).add(e.scale({x:0,y:0},{x:t,y:t}))}},{key:"lerp2D",value:function(e,t,n){return(t>1||t<0||n>1||n<0)&&console.error("Lerp t must be between 0 and 1."),this.scale({x:0,y:0},{x:1-t,y:1-n}).add(e.scale({x:0,y:0},{x:t,y:n}))}},{key:"coserp",value:function(e,t){return t=.5*(1+Math.cos(2*t*Math.PI)),this.lerp(e,t)}},{key:"half",get:function(){return new e({x:this.x/2,y:this.y/2})}}],[{key:"IsVector2",value:function(t){return t instanceof e}},{key:"Random",value:function(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return new e({x:g.RandRange(i,t),y:g.RandRange(r,n)})}},{key:"Deserialize",value:function(t){return t&&t.hasOwnProperty("x")&&t.hasOwnProperty("y")?new e({x:t.x,y:t.y}):(console.error("Failed deserializing point"),null)}},{key:"Serialize",value:function(e){return JSON.stringify(this.SerializeToObject(e))}},{key:"SerializeToObject",value:function(e){return{x:e.x,y:e.y}}}]),e}();D.Zero=new D(0,0),D.One=new D(1,1);var A=n(10),L=n(47),P={backgroundBlue:2236962,nodePink:3355443,nodeLavender:4934475,nodeBlue:4473924,nodeAqua:16755370,gateTint:16777215,selectedTint:12303359,allocatedTint:4473924,nodeBorder:6710886,nullTint:16777215,tooltipBorderBlack:2236962,tooltipFillWhite:15658734,white:16777215,grayBlack:1907997,borderBlack:1118481,borderWhite:6710886,black:0,textWhite:8947848};function G(e){return"#"+e.toString(16)}var z=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];Object(d.a)(this,e),this._values=void 0,this._values=new F;var n,i=Object(y.a)(t);try{for(i.s();!(n=i.n()).done;){var r=n.value;this.put(r)}}catch(a){i.e(a)}finally{i.f()}}return Object(h.a)(e,[{key:"remove",value:function(e){this._values.remove(e)}},{key:"put",value:function(e){this._values.put(e,e)}},{key:"get",value:function(e){return void 0!==this._values.get(e)}},{key:"contains",value:function(e){return this._values.contains(e)}},{key:"values",value:function(){return this._values.values()}},{key:"clone",value:function(){var t=new e;return t._values=this._values.clone(),t}},{key:"size",value:function(){return this._values.size()}},{key:"equals",value:function(e){if(void 0===e||null===e)return!1;if(this.size()!==e.size())return!1;var t,n=Object(y.a)(this.values());try{for(n.s();!(t=n.n()).done;){var i=t.value;if(!e.contains(i))return!1}}catch(r){n.e(r)}finally{n.f()}return!0}}]),e}(),F=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];Object(d.a)(this,e),this._values={};var n,i=Object(y.a)(t);try{for(i.s();!(n=i.n()).done;){var r=Object(u.a)(n.value,2),a=r[0],o=r[1];this.put(a,o)}}catch(c){i.e(c)}finally{i.f()}}return Object(h.a)(e,[{key:"put",value:function(e,t){this._values[e.hash()]=t}},{key:"remove",value:function(e){delete this._values[e.hash()]}},{key:"get",value:function(e){return this._values[e.hash()]}},{key:"contains",value:function(e){return void 0!==this.get(e)&&e.hash()in this._values}},{key:"values",value:function(){return Object.values(this._values)}},{key:"size",value:function(){return Object.keys(this._values).length}},{key:"clone",value:function(){var t=new e;return t._values=Object(A.a)({},this._values),t}}]),e}(),H=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];Object(d.a)(this,e),this._kvalues={};var n,i=Object(y.a)(t);try{for(i.s();!(n=i.n()).done;){var r=Object(u.a)(n.value,2),a=r[0],o=r[1];this.put(a,o)}}catch(c){i.e(c)}finally{i.f()}}return Object(h.a)(e,[{key:"put",value:function(e,t){this._kvalues[e.hash()]=[e,t]}},{key:"remove",value:function(e){delete this._kvalues[e.hash()]}},{key:"get",value:function(e){var t;return null===(t=this._kvalues[e.hash()])||void 0===t?void 0:t[1]}},{key:"contains",value:function(e){return void 0!==this.get(e)&&e.hash()in this._kvalues}},{key:"keys",value:function(){var e=this;return Object.keys(this._kvalues).map((function(t){return e._kvalues[t][0]}))}},{key:"entries",value:function(){var e=this;return Object.keys(this._kvalues).map((function(t){return e._kvalues[t]}))}},{key:"values",value:function(){var e=this;return Object.keys(this._kvalues).map((function(t){return e._kvalues[t][1]}))}},{key:"hashKeyset",value:function(){return Object.keys(this._kvalues).map((function(e){return W(e)})).reduce((function(e,t){return e+t})).toString()}},{key:"clone",value:function(){var t=new e;return t._kvalues=Object(A.a)({},this._kvalues),t}},{key:"size",value:function(){return Object.keys(this._kvalues).length}}]),e}();function W(e){for(var t=0,n=0;n<e.length;n++)t=Math.imul(31,t)+e.charCodeAt(n)|0;return t}function q(e){return new M.d(e.x,e.y)}var V=n(19);function B(e){var t=[];return[function(e){t.push(e)},function(){if(0!==t.length){var n=Object(V.a)(t);t=[],e((function(e){var t,i=e,r=Object(y.a)(n);try{for(r.s();!(t=r.n()).done;){var a=t.value;i="function"===typeof a?a(i):a}}catch(o){r.e(o)}finally{r.f()}return i}))}}]}var X=n(4);function J(e,t){var n={getUpdater:function(){return t}};return n.enqueueUpdate=t,null===e||void 0===e||"object"!==typeof e||Object.keys(e).forEach((function(i){if("enqueueUpdate"===i||"getUpdater"===i||"update"===i)throw Error("Invalid key in updaterGenerator: ".concat(i," conflicts with reserved keywords enqueueUpdate, update, getUpdater."));n[i]=J(e[i],(function(e){t("function"===typeof e?function(t,n){var r=e(t[i],n);return t[i]===r?t:Object(A.a)(Object(A.a)({},t),{},Object(X.a)({},i,r))}:function(t,n){return Object(A.a)(Object(A.a)({},t),{},Object(X.a)({},i,e))})}))})),n}function Z(e,t){return J(e,(function(e){t("function"===typeof e?function(t){return e(t,t)}:e)}))}var K=function(){function e(){Object(d.a)(this,e),this._values=[]}return Object(h.a)(e,[{key:"add",value:function(e){-1===this._values.indexOf(e)||e.instance&&this.contains(e.instance),this._values.push(e)}},{key:"remove",value:function(e){var t=this._values.splice(this._values.findIndex((function(t){return t.instance===e})),1);return 0===t.length?void 0:t[0]}},{key:"contains",value:function(e){return this._values.findIndex((function(t){return t.instance===e}))>-1}},{key:"get",value:function(e){return this._values.find((function(t){return t.instance===e}))}},{key:"clone",value:function(){var t=new e;return t._values=Object(V.a)(this._values),t}},{key:"forEach",value:function(e){this._values.forEach(e)}}]),e}(),Y=function(){function e(t){var n=this;Object(d.a)(this,e),this.container=void 0,this.state=void 0,this._staleProps=void 0,this._children=new K,this._childrenToConstruct=new K,this._childrenToDestruct=new K,this._forceUpdates=new K,this.markForceUpdate=function(e){var t,i;null===(t=n._staleProps.args)||void 0===t||null===(i=t.markForceUpdate)||void 0===i||i.call(t,n);var r=n._children.get(e);if(!r)throw new Error("Error, child ".concat(e," not found in ").concat(n));n._forceUpdates.add(r)},this._staleProps=t}return Object(h.a)(e,[{key:"addChild",value:function(e){this._children.add(e),this._childrenToConstruct.add(e)}},{key:"registerChild",value:function(e){this._children.add(e)}},{key:"removeChild",value:function(e){var t=this._children.remove(e);t&&this._childrenToDestruct.add(t)}},{key:"_didConstruct",value:function(e){var t,n=this;this._childrenToConstruct.forEach((function(t){t.instance||(t.instance=new t.childClass(t.propsFactory(e,n.state))),n.container.addChild(t.instance.container)})),this.renderSelf(e),null===(t=this.didMount)||void 0===t||t.call(this)}},{key:"useState",value:function(e,t){var n=function(t){e.state="function"===typeof t?t(e.state):t},i=B(n),r=Object(u.a)(i,2),a=r[0];return{state:t,setState:n,fireStateUpdaters:r[1],stateUpdaters:Z(t,a)}}},{key:"update",value:function(e){this._update(e)}},{key:"_update",value:function(e){var t,n,i,r=this,a=Object(A.a)({},this.state);if(null===(t=this.fireStateUpdaters)||void 0===t||t.call(this),null===(n=this.updateSelf)||void 0===n||n.call(this,e),this.shouldUpdate&&!this.shouldUpdate(this._staleProps,a,e,this.state)){var o,c=this._forceUpdates.clone();return this._forceUpdates=new K,c.forEach((function(t){var n,i=t.instance,a=t.propsFactory;null===i||void 0===i||i._update(a(e,r.state)),i&&(null===(n=r.didForceUpdateChild)||void 0===n||n.call(r,i))})),void(null===(o=this.didForceUpdate)||void 0===o||o.call(this))}null===(i=this.updateChildren)||void 0===i||i.call(this,e),this._updateChildren(e),this.renderSelf(e),this._staleProps=e,new Promise((function(e){var t;return e(null===(t=r.didUpdate)||void 0===t?void 0:t.call(r))}))}},{key:"_updateChildren",value:function(e){var t=this;this._childrenToDestruct.forEach((function(e){var n,i;e.instance&&(null===(n=(i=e.instance).willUnmount)||void 0===n||n.call(i),t.container.removeChild(e.instance.container))})),this._childrenToDestruct=new K,this._children.forEach((function(n){var i=n.instance,r=n.propsFactory;null===i||void 0===i||i._update(r(e,t.state))})),this._childrenToConstruct.forEach((function(n){n.instance||(n.instance=new n.childClass(n.propsFactory(e,t.state))),t.container.addChild(n.instance.container)})),this._childrenToConstruct=new K}},{key:"willUnmount",value:function(){}},{key:"toString",value:function(){return"lifecyclehandler object"}}]),e}();function Q(e){return new Proxy(e,{construct:function(e,t){var n=new e(t[0]);return n._didConstruct(t[0]),n}})}new Proxy(Y,{construct:function(e,t,n){var i=Reflect.construct(e,t,n);return i._didConstruct.apply(i,Object(V.a)(t)),i}});var $,ee,te,ne=function e(){Object(d.a)(this,e)};ne.CHUNK_HALF_DIM=((ne.CHUNK_DIM=9)-1)/2,ne.DROP_NODES_CHANCE=0,function(e){e.Basic="Basic",e.Nothing="Nothing",e.EfficiencyGate="EfficiencyGate"}($||($={})),function(e){e.Mana0="Mana0",e.Mana1="Mana1",e.Mana2="Mana2"}(ee||(ee={})),function(e){e.Flat="Flat",e.Increased0="% increased",e.AfterIncreased0="added after % increased",e.Increased1="% increased multiplier",e.AfterIncreased1="added after % increased multiplier"}(te||(te={}));var ie=Q(function(e){Object(O.a)(n,e);var t=Object(j.a)(n);function n(e){var i,r,a;Object(d.a)(this,n),(a=t.call(this,e)).container=void 0,a.state=void 0,a.sprite=void 0,a.halfwayCenterSprite=void 0,a.centerSprite=void 0,a.topHalfSprite=void 0,a.hitArea=void 0,a.tooltippableArea=void 0,a.state={numClicks:0,descriptionText:""},a.updateSelf(e),a.container=new M.b;var o=null===(i=e.args.pointNodeTexture.find((function(e){return e.cropFraction>=.99})))||void 0===i?void 0:i.texture;a.container.sortableChildren=!0,a.sprite=new M.g(o),a.sprite.anchor.x=.5,a.sprite.anchor.y=.5,a.sprite.zIndex=-2,a.container.addChild(a.sprite),a.topHalfSprite=new M.g(null===(r=e.args.pointNodeTexture.find((function(e){return e.cropFraction>=.499})))||void 0===r?void 0:r.texture),a.topHalfSprite.anchor.x=.5,a.topHalfSprite.anchor.y=.5,a.topHalfSprite.zIndex=-1,e.pointNodeGen.nodeType===$.EfficiencyGate&&a.container.addChild(a.topHalfSprite);var c=new M.c;return c.beginFill(P.black),c.drawRect(0,0,a.topHalfSprite.width,a.topHalfSprite.height/2),c.pivot.x=a.topHalfSprite.width/2,c.pivot.y=a.topHalfSprite.height/2,c.zIndex=30,a.centerSprite=new M.g(o),a.centerSprite.anchor.x=.5,a.centerSprite.anchor.y=.5,a.centerSprite.scale=q(new D(.5,.5)),a.centerSprite.zIndex=1,a.centerSprite.alpha=0,a.halfwayCenterSprite=new M.g(o),a.halfwayCenterSprite.anchor.x=.5,a.halfwayCenterSprite.anchor.y=.5,a.halfwayCenterSprite.scale=q(new D(.75,.75)),a.halfwayCenterSprite.zIndex=0,a.halfwayCenterSprite.alpha=0,a.container.interactive=!0,a.container.buttonMode=!0,a.hitArea=new M.e(-ae.NODE_HITAREA_PX/2,-ae.NODE_HITAREA_PX/2,ae.NODE_HITAREA_PX,ae.NODE_HITAREA_PX),a.container.hitArea=a.hitArea,a}return Object(h.a)(n,[{key:"updateSelf",value:function(e){var t="Nothing (empty node)";e.pointNodeGen.nodeType===$.EfficiencyGate?t="Unlocks at 300 Mana0 in 14 or fewer allocations":e.pointNodeGen.nodeType!==$.Nothing&&(t="".concat(e.pointNodeGen.resourceAmount," ").concat(e.pointNodeGen.resourceModifier," ").concat(e.pointNodeGen.resourceType)),this.state.descriptionText=t}},{key:"renderSelf",value:function(e){var t,n,i;this.container.position=q(e.args.position),e.isSelected?(n=P.selectedTint,i=P.selectedTint):(n=P.nullTint,i=P.nullTint),e.isAllocated&&(n=P.allocatedTint);var r=0,a=0;e.pointNodeGen.nodeType===$.Nothing?r=P.nodeBlue:e.pointNodeGen.nodeType===$.EfficiencyGate?(r=P.nodeAqua,a=x(P.nodeAqua,P.gateTint)):e.pointNodeGen.resourceType===ee.Mana0&&(e.pointNodeGen.resourceModifier===te.Flat?r=P.nodePink:e.pointNodeGen.resourceModifier===te.Increased0&&(r=P.nodeLavender)),this.sprite.tint=x(r,n),this.centerSprite.tint=x(r,i),this.topHalfSprite.tint=x(a,n);var o=Math.floor(9*Math.random())/8-.001;this.topHalfSprite.texture=null===(t=e.args.pointNodeTexture.find((function(e){return e.cropFraction>=o})))||void 0===t?void 0:t.texture,e.selfPointNodeRef.pointNodeCoord.equals(D.Zero)&&(this.container.scale=q(new D(1.25,1.25)))}},{key:"shouldUpdate",value:function(e,t,n,i){var r,a=Object(y.a)(Object.keys(e));try{for(a.s();!(r=a.n()).done;){var o=r.value;if("delta"!==o&&"args"!==o&&"updaters"!==o){if(e[o]!==n[o])return console.log("node shouldUpdate differed in ".concat(o,", returning true")),!0;var c,u;if("selfPointNodeRef"!==o);else if((null===(c=e[o])||void 0===c?void 0:c.hash())!==(null===(u=n[o])||void 0===u?void 0:u.hash()))return console.log("node shouldUpdate differed in ".concat(o,", returning true")),!0}}}catch(s){a.e(s)}finally{a.f()}return!1}},{key:"didMount",value:function(){var e=this;this.container.addListener("pointerdown",(function(t){e._staleProps.args.markForceUpdate(e),e.state.numClicks++})),this.container.addListener("pointerover",(function(t){var n=t.data.getLocalPosition(e.container),i=new D(e.container.worldTransform.tx,e.container.worldTransform.ty);e._staleProps.tooltipUpdaters.enqueueUpdate((function(t){return Object(A.a)(Object(A.a)({},t),{},{visible:!0,text:e.state.descriptionText,position:i.add(n)})}))})),this.container.addListener("pointerout",(function(t){e._staleProps.tooltipUpdaters.enqueueUpdate((function(e){return Object(A.a)(Object(A.a)({},e),{},{visible:!1,text:""})}))})),this.container.addListener("pointermove",(function(t){var n=t.data.getLocalPosition(e.container),i=new D(e.container.worldTransform.tx,e.container.worldTransform.ty);e._staleProps.tooltipUpdaters.position.enqueueUpdate(i.add(n))}))}},{key:"toString",value:function(){return"PointNodeCompoent "+this._staleProps.selfPointNodeRef.toString()}}]),n}(Y)),re=function(){function e(t){Object(d.a)(this,e),this.z=void 0,this.chunkCoord=void 0,this.pointNodeCoord=void 0,this.pointNodeId=void 0,this.z=t.z,this.chunkCoord=t.chunkCoord,this.pointNodeCoord=t.pointNodeCoord,this.pointNodeId=t.pointNodeId}return Object(h.a)(e,[{key:"hash",value:function(){return this.pointNodeId.toString()+this.z.toString()+this.chunkCoord.toString()+this.pointNodeCoord.toString()}},{key:"toString",value:function(){return this.z+","+this.chunkCoord.toString()+","+this.pointNodeCoord.toString()}}]),e}(),ae=function e(){Object(d.a)(this,e)};ae.SPACING_PX=36,ae.CHUNK_SPACING_PX=(ne.CHUNK_DIM+0)*ae.SPACING_PX,ae.NODE_SIZE_PX=22,ae.NODE_HITAREA_PX=ae.NODE_SIZE_PX+4,ae.NODE_ROUNDED_PX=4;Q(function(e){Object(O.a)(n,e);var t=Object(j.a)(n);function n(e){var i;return Object(d.a)(this,n),(i=t.call(this,e)).container=void 0,i.state=void 0,i.children=void 0,i.state={},i.container=new M.b,i.children=new H,i.resyncChildren(e),i}return Object(h.a)(n,[{key:"renderSelf",value:function(e){this.container.position=q(e.position)}},{key:"shouldUpdate",value:function(e,t,n,i){var r,a=Object(y.a)(Object.keys(e));try{for(a.s();!(r=a.n()).done;){var o=r.value;if("delta"!==o&&"args"!==o&&"updaters"!==o){if("position"===o){if(e[o].equals(n[o]))continue;return console.log("chunk shouldUpdate differed in ".concat(o,", returning true")),!0}var c,u;if("selectedPointNode"!==o)if("selfChunkRef"!==o){if("allocatedPointNodeSubset"===o){if(e[o].equals(n[o]))continue;return console.log("chunk shouldUpdate differed in ".concat(o,", returning true")),!0}if(e[o]!==n[o])return console.log("chunk shouldUpdate differed in ".concat(o,", returning true")),!0}else{var s,l;if((null===(s=e[o])||void 0===s?void 0:s.hash())!==(null===(l=n[o])||void 0===l?void 0:l.hash()))return console.log("chunk shouldUpdate differed in ".concat(o,", returning true")),!0}else if((null===(c=e[o])||void 0===c?void 0:c.hash())!==(null===(u=n[o])||void 0===u?void 0:u.hash()))return console.log("chunk shouldUpdate differed in ".concat(o,", returning true")),!0}}}catch(d){a.e(d)}finally{a.f()}return!1}},{key:"resyncChildren",value:function(e){var t=this,n=this.children.clone();console.log("chunk component upsert children got here");var i,r=Object(y.a)(e.chunkGen.pointNodes.entries());try{var a=function(){var r=Object(u.a)(i.value,2),a=r[0],o=r[1],c=new re({z:e.selfChunkRef.z,chunkCoord:e.selfChunkRef.chunkCoord,pointNodeCoord:a,pointNodeId:o.id}),s=function(e,n){var i;return{delta:e.delta,args:{pointNodeTexture:e.args.pointNodeTexture,markForceUpdate:t.markForceUpdate,position:c.pointNodeCoord.multiply(ae.SPACING_PX)},selfPointNodeRef:c,updaters:e.updaters,tooltipUpdaters:e.tooltipUpdaters,pointNodeGen:o,isSelected:(null===(i=e.selectedPointNode)||void 0===i?void 0:i.pointNodeId)===c.pointNodeId,isAllocated:e.allocatedPointNodeSubset.contains(c)}},l=c,d=t.children.get(l);d?n.remove(l):(d=new ie(s(e,t.state)),t.children.put(c,d),t.addChild({childClass:ie,instance:d,propsFactory:s}))};for(r.s();!(i=r.n()).done;)a()}catch(h){r.e(h)}finally{r.f()}console.log("chunk component to delete has ".concat(n.size()," children"));var o,c=Object(y.a)(n.entries());try{for(c.s();!(o=c.n()).done;){var s=Object(u.a)(o.value,2),l=s[0],d=s[1];this.children.remove(l),this.removeChild(d)}}catch(h){c.e(h)}finally{c.f()}}},{key:"updateChildren",value:function(e){this.resyncChildren(e)}},{key:"didForceUpdateChild",value:function(e){this.container.removeChild(e.container),this.container.addChild(e.container)}}]),n}(Y));var oe=function(){function e(t){Object(d.a)(this,e),this._wasConstructed=!1,this._value=void 0,this._factory=void 0,this._factory=t}return Object(h.a)(e,[{key:"get",value:function(){return void 0!==this._value||!0===this._wasConstructed||(this._value=this._factory(),this._wasConstructed=!0),this._value}},{key:"wasConstructed",value:function(){return this._wasConstructed}}]),e}();var ce,ue,se=function(){function e(t){Object(d.a)(this,e),this._values=void 0,this._factory=void 0,this._values=new H,this._factory=t}return Object(h.a)(e,[{key:"setFactory",value:function(e){return this._factory=e,this}},{key:"put",value:function(e,t){this._values.put(e,t)}},{key:"remove",value:function(e){this._values.remove(e)}},{key:"invalidate",value:function(e){this.remove(e)}},{key:"clear",value:function(){this._values=new H}},{key:"peek",value:function(e){return this._values.get(e)}},{key:"get",value:function(e){if(this._values.contains(e))return this._values.get(e);var t=this._factory(e);return this._values.put(e,t),t}},{key:"precompute",value:function(e){if(!this._values.contains(e)){var t=this._factory(e);this._values.put(e,t)}}},{key:"contains",value:function(e){return this._values.contains(e)}},{key:"values",value:function(){return this._values.values()}},{key:"keys",value:function(){return this._values.keys()}},{key:"entries",value:function(){return this._values.entries()}},{key:"size",value:function(){return this._values.size()}},{key:"clone",value:function(t){var n=new e(t||this._factory);return n._values=this._values.clone(),n}}]),e}(),le=Q(function(e){Object(O.a)(n,e);var t=Object(j.a)(n);function n(e){var i;return Object(d.a)(this,n),(i=t.call(this,e)).container=void 0,i.state=void 0,i.container=new M.b,i.container.sortableChildren=!0,i.state={},i}return Object(h.a)(n,[{key:"renderSelf",value:function(e){}}]),n}(Y));!function(e){e.TAKEN="TAKEN",e.AVAILABLE="AVAILABLE",e.UNREACHABLE="UNREACHABLE",e.HIDDEN="HIDDEN"}(ce||(ce={})),function(e){e.true="true",e.false="false"}(ue||(ue={}));var de,he={true:{taken:!0},false:{taken:!1}},pe={true:{visible:!0},false:{visible:!1}},ve={true:{reachable:!0},false:{reachable:!1}};!function(e){e.CLOSED="CLOSED",e.TICKING="TICKING",e.OPEN="OPEN"}(de||(de={}));var fe=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{x:0,y:0,z:0},n=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0;Object(d.a)(this,e),this._x=void 0,this._y=void 0,this._z=void 0,"number"===typeof t?(this._x=t,this._y=n,this._z=i):(this._x=t.x,this._y=t.y,this._z=t.z)}return Object(h.a)(e,[{key:"x",get:function(){return this._x}},{key:"y",get:function(){return this._y}},{key:"z",get:function(){return this._z}}]),Object(h.a)(e,[{key:"hash",value:function(){return this.toString()}},{key:"toString",value:function(){return"[".concat(this.x,", ").concat(this.y,", ").concat(this.z,"]")}},{key:"subtract",value:function(t){return new e({x:this.x-t.x,y:this.y-t.y,z:this.z-t.z})}},{key:"add",value:function(t,n,i){return new e("number"===typeof t?{x:this.x+t,y:this.y+n,z:this.z+i}:{x:this.x+t.x,y:this.y+t.y,z:this.z+t.z})}},{key:"addX",value:function(t){return new e({x:this.x+t,y:this.y,z:this.z})}},{key:"addY",value:function(t){return new e({x:this.x,y:this.y+t,z:this.z})}},{key:"addZ",value:function(t){return new e({x:this.x,y:this.y,z:this.z+t})}},{key:"subtractX",value:function(t){return new e({x:this.x-t,y:this.y,z:this.z})}},{key:"subtractY",value:function(t){return new e({x:this.x,y:this.y-t,z:this.z})}},{key:"subtractZ",value:function(t){return new e({x:this.x,y:this.y,z:this.z-t})}},{key:"scale",value:function(t,n){return new e({x:(this.x-t.x)*n.x+t.x,y:(this.y-t.y)*n.y+t.y,z:(this.z-t.z)*n.z+t.z})}},{key:"equals",value:function(e){return void 0!==e&&null!==e&&(Math.abs(this.x-e.x)<R&&Math.abs(this.y-e.y)<R&&Math.abs(this.z-e.z)<R)}},{key:"multiply",value:function(t){return new e("number"===typeof t?{x:this.x*t,y:this.y*t,z:this.z*t}:{x:this.x*t.x,y:this.y*t.y,z:this.z*t.z})}},{key:"divide",value:function(t){return new e("number"===typeof t?{x:this.x/t,y:this.y/t,z:this.z/t}:{x:this.x/t.x,y:this.y/t.y,z:this.z/t.z})}},{key:"toJSON",value:function(){return{__type:"Vector3",x:this.x,y:this.y,z:this.z}}},{key:"pairXY",value:function(){return new D({x:this.x,y:this.y})}},{key:"withX",value:function(t){return new e({x:t,y:this.y,z:this.z})}},{key:"withY",value:function(t){return new e({x:this.x,y:t,z:this.z})}},{key:"withZ",value:function(t){return new e({x:this.x,y:this.y,z:t})}}],[{key:"IsVector3",value:function(t){return t instanceof e}},{key:"FromVector2",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new e(t.x,t.y,n)}},{key:"Deserialize",value:function(t){return t&&t.hasOwnProperty("x")&&t.hasOwnProperty("y")&&t.hasOwnProperty("z")?new e({x:t.x,y:t.y,z:t.z}):(console.error("Failed deserializing vector3"),null)}},{key:"Serialize",value:function(e){return JSON.stringify(this.SerializeToObject(e))}},{key:"SerializeToObject",value:function(e){return{x:e.x,y:e.y,z:e.z}}}]),e}();fe.Zero=new fe(0,0,0),fe.One=new fe(1,1,1);var be,Oe,je,ye,ge=n(14);function xe(e){for(var t=e.randInt,n=e.weights,i=e.behaviors,r=t/ge.a,a=Object(ge.b)(t),o=r*Object.values(n).reduce((function(e,t){return e+t})),c=0,s=Object.entries(n);c<s.length;c++){var l=Object(u.a)(s[c],2),d=l[0],h=l[1];if(o<=h)return i[d](a);o-=h}throw Error()}function Se(e){var t,n=e.randInt,i=e.weights,r=n/ge.a*Object.values(i).reduce((function(e,t){return e+t})),a=Object(y.a)(Object.entries(i));try{for(a.s();!(t=a.n()).done;){var o=Object(u.a)(t.value,2),c=o[0],s=o[1];if(r<=s)return c;r-=s}}catch(l){a.e(l)}finally{a.f()}throw Error()}function me(e){var t=e.randInt,n=e.min,i=e.max,r=e.increment,a=void 0===r?1:r,o=e.inclusive,c=void 0===o||o,u=t/ge.a,s=Math.ceil((i-n)/a);return n+a*s===i&&!0===c&&(s+=1),n+Math.floor(u*s)*a}!function(e){e.RED0="RED0",e.RED1="RED1",e.RED2="RED2",e.DEL0="DEL0",e.DEL1="DEL1",e.DEL2="DEL2"}(je||(je={})),function(e){e.FLAT="FLAT",e.INCREASED="INCREASED"}(ye||(ye={}));var ke,we,Ee,Te,Ce={DECISION_0:{EMPTY:800,NO_SPEND:100,SPEND:0},DECISION_1:{SINGLE:500,DOUBLE:0},SINGLE_COLORS:(be={},Object(X.a)(be,je.RED0,100),Object(X.a)(be,je.RED1,100),Object(X.a)(be,je.RED2,100),Object(X.a)(be,je.DEL0,10),Object(X.a)(be,je.DEL1,10),Object(X.a)(be,je.DEL2,10),be),SINGLE_MODIFIERS:(Oe={},Object(X.a)(Oe,ye.FLAT,100),Object(X.a)(Oe,ye.INCREASED,75),Oe)},_e=function(){function e(t){Object(d.a)(this,e),this.config=void 0,this.config=t}return Object(h.a)(e,[{key:"createSingle",value:function(e){var t=Se({randInt:e.randInt,weights:Ce.SINGLE_COLORS}),n=Se({randInt:Object(ge.b)(e.randInt),weights:Ce.SINGLE_MODIFIERS}),i=0;return i=n===ye.FLAT?function(e){for(var t=e.randInt,n=e.formula,i=e.plus,r=void 0===i?0:i,a=parseInt(n.split("d")[0]),o=parseInt(n.split("d")[1]),c=0,u=0;u<a;u++)c+=me({randInt:Object(ge.b)(t+u),min:1,max:o,inclusive:!0});return c+r}({randInt:Object(ge.b)(e.randInt+1),formula:"2d6",plus:8}):me({randInt:Object(ge.b)(e.randInt+2),min:4,max:7,increment:.5,inclusive:!0}),{attribute:je[t],amount:i,modifier:ye[n]}}},{key:"createNoSpend",value:function(e){var t=this;return xe({randInt:e.randInt,weights:Ce.DECISION_1,behaviors:{SINGLE:function(e){return{lines:[t.createSingle({randInt:e})]}},DOUBLE:function(e){return{lines:[t.createSingle({randInt:e}),t.createSingle({randInt:Object(ge.b)(e)})]}}}})}},{key:"create",value:function(e){var t=this,n=e.seed,i=e.location;return i.equals(fe.Zero)?{lines:[]}:xe({randInt:Object(ge.b)(n+i.x+i.y+Object(ge.b)(n+i.x+i.z)),weights:Ce.DECISION_0,behaviors:{EMPTY:function(e){return{lines:[]}},NO_SPEND:function(e){return t.createNoSpend({randInt:e})},SPEND:function(e){var n,i=t.createNoSpend({randInt:e}),r=Se({randInt:e,weights:(n={},Object(X.a)(n,je.RED0,100),Object(X.a)(n,je.RED1,100),Object(X.a)(n,je.RED2,100),Object(X.a)(n,je.DEL0,0),Object(X.a)(n,je.DEL1,0),Object(X.a)(n,je.DEL2,0),n)});return Object(A.a)(Object(A.a)({},i),{},{condition:{type:"SPEND",amount:12,attribute:je[r]}})}}})}}]),e}(),Ie=(ke={},Object(X.a)(ke,je.RED0,"\ud83d\udd34"),Object(X.a)(ke,je.RED1,"\ud83d\udfe2"),Object(X.a)(ke,je.RED2,"\ud83d\udd35"),Object(X.a)(ke,je.DEL0,"\u2694\ufe0f"),Object(X.a)(ke,je.DEL1,"\ud83d\udee1"),Object(X.a)(ke,je.DEL2,"\u2728"),ke),Ne=(we={},Object(X.a)(we,je.RED0,"Red"),Object(X.a)(we,je.RED1,"Green"),Object(X.a)(we,je.RED2,"Blue"),Object(X.a)(we,je.DEL0,"Offense"),Object(X.a)(we,je.DEL1,"Defense"),Object(X.a)(we,je.DEL2,"Magic"),we),Ue={Red:je.RED0,Green:je.RED1,Blue:je.RED2,Offense:je.DEL0,Defense:je.DEL1,Magic:je.DEL2},Me=(Ee={},Object(X.a)(Ee,ye.FLAT,"+"),Object(X.a)(Ee,ye.INCREASED,"%"),Ee),Re=(Te={},Object(X.a)(Te,ye.FLAT,"flat"),Object(X.a)(Te,ye.INCREASED,"increased"),Te),De={flat:ye.FLAT,increased:ye.INCREASED};function Ae(e){return e.modifier===ye.FLAT?"+".concat(e.amount," ").concat(Ne[e.attribute]):"".concat(e.amount,"% increased ").concat(Ne[e.attribute])}function Le(e){return{playerUI:{virtualGridLocation:e.playerUI.virtualGridLocation,cursoredNodeLocation:e.playerUI.cursoredNodeLocation,strategicSearch:e.playerUI.strategicSearch},playerSave:{allocationStatusMap:e.playerSave.allocationStatusMap},computed:{fogOfWarStatusMap:e.computed.fogOfWarStatusMap,reachableStatusMap:e.computed.reachableStatusMap,lockStatusMap:e.computed.lockStatusMap},worldGen:{nodeContentsMap:e.worldGen.nodeContentsMap,lockMap:e.worldGen.lockMap}}}var Pe=E(Le),Ge=Q(function(e){Object(O.a)(n,e);var t=Object(j.a)(n);function n(e){var i;Object(d.a)(this,n),(i=t.call(this,e)).container=void 0,i.state=void 0,i.graphics=void 0,i.hexGrid=new H,i.animations=new H,i.state={numClicks:0,descriptionText:""},i.updateSelf(e),i.container=new M.b,i.graphics=new M.g,i.graphics.texture=e.args.textures.circle,i.graphics.tint=P.borderBlack,i.graphics.visible=!1,i.container.addChild(i.graphics);for(var r=-20;r<=20;r++)for(var a=-35+Math.floor(r/2);a<=35+Math.floor(r/2);a++){var o=new M.g;o.texture=e.args.textures.circle,o.tint=P.nodePink,o.position=q(e.appSize.divide(2).add(new D(30*a-15*r,-26*r))),i.container.addChild(o),i.hexGrid.put(new D(a,r),o)}return i}return Object(h.a)(n,[{key:"updateSelf",value:function(e){var t,n=e.delta,i=Object(y.a)(this.hexGrid.entries());try{for(i.s();!(t=i.n()).done;){var r=Object(u.a)(t.value,2),a=r[0],o=r[1],c=this.animations.get(a);if(c){var s=((c.phase||0)+n*(1/60)*1/c.periodSecs)%1,l=1-Math.abs(2*s-1),d=1-(l<.5?l*l*2:1-2*(1-l)*(1-l));o.tint=m({target:c.max,base:c.min,proportion:d}),c.phase=s}}}catch(h){i.e(h)}finally{i.f()}}},{key:"renderSelf",value:function(e){this.container.position=q(e.args.position),this.graphics.position=q(e.appSize.divide(2));var t,n=e.gameState,i=Object(y.a)(this.hexGrid.entries());try{for(i.s();!(t=i.n()).done;){var r,a,o,c=Object(u.a)(t.value,2),s=c[0],l=c[1],d=e.appSize.divide(2).add(new D(30*s.x-15*s.y,-26*s.y));l.position=q(d);var h=n.playerUI.virtualGridLocation.add(fe.FromVector2(s)),p=(null===(r=n.computed.fogOfWarStatusMap)||void 0===r?void 0:r.get(h))||pe.false,v=n.playerSave.allocationStatusMap.get(h)||he.false,f=(null===(a=n.computed.reachableStatusMap)||void 0===a?void 0:a.get(h))||ve.false,b=n.worldGen.lockMap.get(h),O=null===(o=n.computed.lockStatusMap)||void 0===o?void 0:o.get(h);v.taken?(l.visible=!0,l.tint=P.borderBlack):f.reachable?b&&O!==de.OPEN?(l.visible=!0,l.tint=P.nodePink):(l.visible=!0,l.tint=P.nodeLavender):p.visible?(l.visible=!0,l.tint=P.nodePink):l.visible=!1,b&&O!==de.OPEN?(l.texture=e.args.textures.rect,l.position=q(d),l.position.x-=e.args.textures.rect.width/2,l.position.y-=e.args.textures.rect.height/2):(l.texture=e.args.textures.circle,l.position=q(d),l.position.x-=e.args.textures.circle.width/2,l.position.y-=e.args.textures.circle.height/2),ze({nodeContents:n.worldGen.nodeContentsMap.get(h),query:n.playerUI.strategicSearch})?this.animations.put(s,{max:S(P.nodeBlue,l.tint),min:l.tint,periodSecs:2,mode:"start-min ease-in-out",phase:0}):this.animations.put(s,null)}}catch(j){i.e(j)}finally{i.f()}}},{key:"shouldUpdate",value:function(e,t,n,i){var r,a=Object(y.a)(Object.keys(e));try{for(a.s();!(r=a.n()).done;){var o=r.value;if("args"!==o&&"delta"!==o)if("gameState"!==o){if(e[o]!==n[o])return console.log("hexgrid shouldUpdate differed in ".concat(o,", returning true")),!0}else for(var c=e[o],u=n[o],s=Pe(c),l=Pe(u),d=0;d<s.length;d++)if(l[d]!==s[d])return console.log("hexgrid substate differed in ".concat(d," : ").concat(w(Le)[d].join("."),", returning true for shouldupdate")),!0}}catch(h){a.e(h)}finally{a.f()}return!1}}]),n}(Y));function ze(e){var t=e.nodeContents,n=e.query;if(!n)return!1;var i=n.highlight1.value.split(" ").filter((function(e){return!!e})).map((function(e){return e.slice(1,e.length-1)}));if(0===i.length)return!1;var r=null;console.log({terms:i});var a,o=Object(y.a)(i);try{for(o.s();!(a=o.n()).done;){var c,u,s,l,d=a.value,h=Ue[d],p=De[d];if(h){if((null===(c=t.lines)||void 0===c||null===(u=c[0])||void 0===u?void 0:u.attribute)!==h&&(null===(s=t.lines)||void 0===s||null===(l=s[1])||void 0===l?void 0:l.attribute)!==h){r=h;break}}else if(p){var v,f,b,O;if((null===(v=t.lines)||void 0===v||null===(f=v[0])||void 0===f?void 0:f.modifier)!==p&&(null===(b=t.lines)||void 0===b||null===(O=b[1])||void 0===O?void 0:O.modifier)!==p){r=p;break}}else{if("*"!==d)return console.error("unparsed term: ",d),!1;var j,g,x,S;if(!(null===(j=t.lines)||void 0===j||null===(g=j[0])||void 0===g?void 0:g.attribute)&&!(null===(x=t.lines)||void 0===x||null===(S=x[1])||void 0===S?void 0:S.attribute)){r=d;break}}}}catch(m){o.e(m)}finally{o.f()}return!r}var Fe=Q(function(e){Object(O.a)(n,e);var t=Object(j.a)(n);function n(e){var i;Object(d.a)(this,n),(i=t.call(this,e)).container=void 0,i.state=void 0,i.stateUpdaters=void 0,i.fireStateUpdaters=void 0,i.fixedCameraStage=void 0,i.actionStage=void 0,i.backdropStage=void 0,i.strategicHexGrid=void 0,i.backdrop=void 0,i.container=new M.b,i.container.sortableChildren=!0;var r=i.useState(Object(L.a)(i),{pointNodeTexture:new oe((function(){return function(e){for(var t=[],n=0;n<=8;n++){var i=n/8,r=new M.c;r.beginFill(P.white),r.drawRoundedRect(-ae.NODE_SIZE_PX/2,-ae.NODE_SIZE_PX/2,ae.NODE_SIZE_PX,ae.NODE_SIZE_PX,ae.NODE_ROUNDED_PX);var a=new M.c;a.beginFill(P.black),a.drawRect(-ae.NODE_SIZE_PX/2,-ae.NODE_SIZE_PX/2,ae.NODE_SIZE_PX,ae.NODE_SIZE_PX*i),r.mask=a;var o=e.generateTexture(r,M.f.LINEAR,1);t.push({cropFraction:i,texture:o})}return t}(e.args.renderer)})),simpleTexture:new oe((function(){return function(e){var t=new M.c;t.beginFill(P.white),t.drawCircle(0,0,8);var n=new M.c;n.beginFill(P.white),n.drawRect(0,0,4,20);var i=new M.c;return i.beginFill(P.white),i.drawRect(0,0,16,16),{circle:e.generateTexture(t,M.f.LINEAR,1),rect:e.generateTexture(n,M.f.LINEAR,1),square:e.generateTexture(i,M.f.LINEAR,1)}}(e.args.renderer)})),tick:0,playerCurrentZ:0,tooltip:{visible:!1,position:void 0,text:""}});i.state=r.state,i.stateUpdaters=r.stateUpdaters,i.fireStateUpdaters=r.fireStateUpdaters;var a=function(e,t){return{args:{renderer:e.args.renderer,markForceUpdate:i.markForceUpdate},delta:e.delta,gameState:e.gameState,appSize:e.appSize,tick:t.tick,tooltip:Object(A.a)({},t.tooltip)}};i.fixedCameraStage=new le(a(e,i.state)),i.addChild({childClass:le,instance:i.fixedCameraStage,propsFactory:a}),i.actionStage=new M.g,i.actionStage.zIndex=0,i.actionStage.sortableChildren=!0,i.container.addChild(i.actionStage);var o=function(e,t){var n=e.gameState;return{delta:e.delta,args:{position:D.Zero,textures:t.simpleTexture.get()},appSize:e.appSize,gameState:Le(n)}};return i.strategicHexGrid=new Ge(o(e,i.state)),i.addChild({childClass:Ge,instance:i.strategicHexGrid,propsFactory:o}),i.backdropStage=new M.g,i.backdropStage.zIndex=-1,i.backdropStage.sortableChildren=!0,i.container.addChild(i.backdropStage),i.backdrop=new M.c,i.backdropStage.addChild(i.backdrop),i.backdrop.beginFill(P.backgroundBlue,1),i.backdrop.interactive=!0,i.backdrop.drawRect(0,0,e.appSize.x,e.appSize.y),i}return Object(h.a)(n,[{key:"updateSelf",value:function(e){this.state.tick++}},{key:"renderSelf",value:function(e){this.backdrop.width=e.appSize.x,this.backdrop.height=e.appSize.y}},{key:"didMount",value:function(){}},{key:"didUpdate",value:function(){}}]),n}(Y)),He=function(){return{orientation:"original",innerWidth:window.innerWidth,innerHeight:window.innerHeight}};function We(e){return new D({x:Math.min(1920,((null===e||void 0===e?void 0:e.x)||1/0)-24),y:Math.min(1080,((null===e||void 0===e?void 0:e.y)||1/0)-24)})}var qe=function(){function e(t){var n;Object(d.a)(this,e),this.app=void 0,this.state=void 0,this.props=void 0,this.staleProps=void 0,this.rootComponent=void 0,this.onTick=void 0,null===t||void 0===t||null===(n=t.args)||void 0===n||n.isSecondConstructorCall;var i=new D(800,600);this.state={appSize:i,originalAppSize:i},this.app=new M.a({width:this.state.appSize.x,height:this.state.appSize.y,antialias:!0,transparent:!0,resolution:window.devicePixelRatio||1,autoDensity:!0,powerPreference:"low-power",backgroundColor:P.white})}return Object(h.a)(e,[{key:"pause",value:function(){this.app.ticker.remove(this.onTick)}},{key:"destroy",value:function(){this.app.destroy(!0,{children:!0,texture:!0,baseTexture:!0})}},{key:"didMount",value:function(){var e=this;this.onTick=function(t){return e.baseGameLoop(t)},this.onTick=this.onTick.bind(this),this.app.ticker.add(this.onTick),this.state.appSize=We(new D(this.props.gameState.windowState.innerWidth,this.props.gameState.windowState.innerHeight))}},{key:"register",value:function(e){e.appendChild(this.app.view)}},{key:"updateSelf",value:function(e,t){e!==t?(e.gameState.windowState.innerWidth===(null===t||void 0===t?void 0:t.gameState.windowState.innerWidth)&&e.gameState.windowState.innerHeight===(null===t||void 0===t?void 0:t.gameState.windowState.innerHeight)||(this.state.appSize=We(new D(e.gameState.windowState.innerWidth,e.gameState.windowState.innerHeight))),e.updaters.tick.enqueueUpdate((function(e){return e+1}))):e.updaters.tick.enqueueUpdate((function(e){return e+1}))}},{key:"rerender",value:function(e){this.rootComponent&&this.props===e||(this.props=e,this.rootComponent||(this.rootComponent=new Fe({args:{renderer:this.app.renderer,markForceUpdate:function(){}},updaters:this.props.updaters,delta:0,gameState:this.props.gameState,appSize:this.state.appSize}),this.app.stage.addChild(this.rootComponent.container),this.renderSelf(this.props),this.didMount()))}},{key:"renderSelf",value:function(e){this.app.renderer.resize(this.state.appSize.x,this.state.appSize.y)}},{key:"baseGameLoop",value:function(e){var t;if(this.props.gameState.playerUI.isPixiHidden&&this.props.gameState.tick%10!==0)return this.props.updaters.tick.enqueueUpdate((function(e){return e+1})),void this.props.args.fireBatch();this.updateSelf(this.props,this.staleProps),null===(t=this.rootComponent)||void 0===t||t.update({args:{renderer:this.app.renderer,markForceUpdate:function(){}},updaters:this.props.updaters,delta:e,gameState:this.props.gameState,appSize:this.state.appSize}),this.renderSelf(this.props),this.staleProps=this.props,this.props.args.fireBatch()}}]),e}(),Ve=new oe((function(){return new qe}));function Be(e){var t=Object(r.useState)(Ve.get()),n=Object(u.a)(t,1)[0],a=Object(r.useRef)(null),o=Object(r.useContext)(U),c=Object(u.a)(o,3),s=c[0],l=c[1],d=c[2];return Object(r.useEffect)((function(){for(var e=a.current.childNodes.length-1;e>=0;e--)a.current.removeChild(a.current.childNodes[e]);a.current.appendChild(n.app.view)}),[n]),Object(r.useEffect)((function(){n.rerender({args:{fireBatch:d,isSecondConstructorCall:!1},updaters:l,gameState:s})}),[n,d,l,s]),Object(i.jsx)(i.Fragment,{children:Object(i.jsx)("div",{ref:a,hidden:e.hidden,style:{}})})}var Xe,Je=function(e){Object(O.a)(n,e);var t=Object(j.a)(n);function n(e){var i;return Object(d.a)(this,n),(i=t.call(this,e)).handleWindowResize=function(e){i.props.updaters.enqueueUpdate((function(e){return Object(A.a)(Object(A.a)({},e),{},{innerWidth:window.innerWidth,innerHeight:window.innerHeight})}))},i.state={},window.addEventListener("resize",i.handleWindowResize),i}return Object(h.a)(n,[{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.handleWindowResize)}},{key:"render",value:function(){return Object(i.jsx)(i.Fragment,{children:" "})}}]),n}(a.a.Component),Ze=function(){return{activeQuest:void 0,spSpentThisQuest:void 0,questProgressHistory:[],questInitialAmount:0,score:0,allocationStatusMap:new H([[fe.Zero,he.true]])}};function Ke(e){var t={};return t.EAST=e.addX(1),t.WEST=e.addX(-1),t.NORTHWEST=e.addY(1),t.SOUTHEAST=e.addY(-1),t.NORTHEAST=e.add(1,1,0),t.SOUTHWEST=e.add(-1,-1,0),t}function Ye(e,t,n,i){var r=new z,a=new z;r.put(e);for(var o=[[e]],c=1;c<=t;c++){o.push([]);var u,s=Object(y.a)(o[c-1]);try{for(s.s();!(u=s.n()).done;)for(var l=u.value,d=Object.values(Ke(l)),h=0,p=d;h<p.length;h++){var v=p[h];v&&(r.get(v)||((null===i||void 0===i?void 0:i.contains(v))?a.put(v):(r.put(v),o[c].push(v))))}}catch(O){s.e(O)}finally{s.f()}}for(var f=[],b=n||0;b<=t;b++)f=f.concat(o[b]);return f=f.concat(a.values())}!function(e){e.NORTHWEST="NORTHWEST",e.SOUTHWEST="SOUTHWEST",e.NORTHEAST="NORTHEAST",e.SOUTHEAST="SOUTHEAST",e.EAST="EAST",e.WEST="WEST",e.UP="UP",e.DOWN="DOWN"}(Xe||(Xe={}));var Qe=function(){function e(t){Object(d.a)(this,e),this.config=void 0,this.config=t}return Object(h.a)(e,[{key:"create",value:function(e){var t=Object(ge.b)(e.seed+e.location.x+e.location.y+Object(ge.b)(e.seed+e.location.x+e.location.z))/ge.a,n={shortTextTarget:"\ud83d\udd12",shortTextTimer:"",lockStatus:de.TICKING};if(!e.location.equals(fe.Zero))return t<.37?n:void 0}}]),e}(),$e="WorldGenState",et=function(){function e(t){Object(d.a)(this,e),this.config=void 0,this.config=t}return Object(h.a)(e,[{key:"create",value:function(e){var t=e.seed,n=new Qe({}),i=new se((function(e){return n.create({seed:t,location:e})})),r=new _e({}),a=new se((function(e){return r.create({seed:t,location:e})}));return{seed:t,lockMap:i,nodeContentsMap:a}}},{key:"tryLoad",value:function(e){var t=this.load();return t?this.create(t):this.create(e)}},{key:"store",value:function(e){var t=this.serialize(e);window.localStorage.setItem($e,t)}},{key:"load",value:function(){var e=window.localStorage.getItem($e);return e&&this.deserialize(e)||null}},{key:"deserialize",value:function(e){return this.deserializeFromObject(JSON.parse(e))}},{key:"deserializeFromObject",value:function(e){return e&&e.hasOwnProperty("seed")?Object(A.a)({},e):null}},{key:"serialize",value:function(e){return JSON.stringify(this.serializeToObject(e))}},{key:"serializeToObject",value:function(e){return{seed:e.seed}}},{key:"clear",value:function(){window.localStorage.setItem($e,"")}}]),e}(),tt=function(){function e(t){Object(d.a)(this,e),this.updaters=void 0,this.updaters=t}return Object(h.a)(e,[{key:"enqueueAction",value:function(e){var t,n,i,r=e.nodeLocation,a=e.newStatus;this.updaters.playerSave.allocationStatusMap.enqueueUpdate((function(e){return e.put(r,a),e.clone()})),null===(t=this.updaters.computed.lockStatusMap)||void 0===t||t.enqueueUpdate((function(e,t){if(!e)return e;var n,i=Object(y.a)(t.worldGen.lockMap.entries());try{for(i.s();!(n=i.n()).done;){var r=Object(u.a)(n.value,2),a=r[0];if(r[1]){var o=de.TICKING;e.put(a,o)}}}catch(c){i.e(c)}finally{i.f()}return e.clone()})),null===(n=this.updaters.computed.reachableStatusMap)||void 0===n||n.enqueueUpdate((function(e){return e?(Ye(r,1).forEach((function(t){e.put(t,ve.true)})),e.clone()):e})),null===(i=this.updaters.computed.fogOfWarStatusMap)||void 0===i||i.enqueueUpdate((function(e,t){return e?(e.put(r,pe.true),Ye(r,1).forEach((function(t){e.put(t,pe.true)})),Ye(r,6,0,{contains:function(e){var n,i=null===(n=t.computed.lockStatusMap)||void 0===n?void 0:n.get(e);return!(!i||i===de.OPEN)}}).forEach((function(n){var i;(null===(i=e.get(n))||void 0===i?void 0:i.visible)||(t.worldGen.lockMap.precompute(n),e.put(n,pe.true))})),e.clone()):e}))}}]),e}(),nt=(n(231),"The starting node.");function it(e){var t=e.location,n=e.gameState.computed,r=n.fogOfWarStatusMap,a=n.reachableStatusMap,o=e.gameState.playerSave.allocationStatusMap,c=e.gameState.worldGen,u=c.lockMap,s=c.nodeContentsMap,l=null===r||void 0===r?void 0:r.get(t),d=null===a||void 0===a?void 0:a.get(t),h=o.get(t),p=(null===h||void 0===h?void 0:h.taken)?ce.TAKEN:(null===d||void 0===d?void 0:d.reachable)?ce.AVAILABLE:(null===l||void 0===l?void 0:l.visible)?ce.UNREACHABLE:ce.HIDDEN,v=t.hash(),f=u.get(t),b=s.get(t),O="";b.lines[0]?(O+=Me[b.lines[0].modifier],O+=Ie[b.lines[0].attribute]):O="",b.lines[1]&&b.lines[0].attribute!==b.lines[1].attribute&&(O+=Ie[b.lines[1].attribute]);var j,y="";return b.condition&&(y="-"+Ie[b.condition.attribute]),{nodeLocation:t,shortText:y?Object(i.jsxs)(i.Fragment,{children:[O,Object(i.jsx)("br",{}),y]}):Object(i.jsx)(i.Fragment,{children:O}),toolTipText:Object(i.jsxs)(i.Fragment,{children:[Object(i.jsx)("div",{children:p.toString()}),t.equals(fe.Zero)?Object(i.jsxs)(i.Fragment,{children:[" ",Object(i.jsx)("br",{})," ",Object(i.jsx)("div",{children:nt})]}):Object(i.jsx)(i.Fragment,{children:" "}),b.lines[0]?Object(i.jsx)("br",{}):Object(i.jsx)(i.Fragment,{}),Object(i.jsx)("div",{children:b.lines[0]&&Ae(b.lines[0])}),Object(i.jsx)("div",{children:b.lines[1]&&Ae(b.lines[1])}),Object(i.jsx)("div",{children:b.condition&&(j=b.condition,"SPEND: ".concat(j.amount," ").concat(Ne[j.attribute]))})]}),fullText:Object(i.jsx)(i.Fragment,{children:" "}),status:p,lockData:f,id:v}}function rt(e){var t=e.gameState.tick,n=Object(r.useState)(+new Date),a=Object(u.a)(n,2),o=a[0],c=a[1],s=Object(r.useState)([]),l=Object(u.a)(s,2),d=l[0],h=l[1];Object(r.useEffect)((function(){var e=new Date,n=+e-o;if(n>30){var i="Tick ".concat(t," took ").concat(n,"ms at ").concat(e.toTimeString().split(" ")[0]);console.log(i),h((function(e){return[i].concat(Object(V.a)(e))}))}c(+new Date)}),[t,o,c,h]);var p=Object(r.useCallback)((function(){console.log("tried triggered update from debug tab"),e.updaters.debug.retriggerVirtualGridDims.enqueueUpdate((function(e){return function(){console.log("force triggered update from debug tab")}}))}),[e.updaters]),v=Object(r.useCallback)((function(){var t;null===(t=e.updaters.debug.debugShowScrollbars)||void 0===t||t.enqueueUpdate((function(e){return!e}))}),[e.updaters]),f=Object(r.useCallback)((function(){e.updaters.debug.rerenderGameAreaGrid.enqueueUpdate((function(e){return function(){console.log("force triggered react rerender from debug tab")}}))}),[e.updaters]),b=Object(r.useCallback)((function(){e.updaters.debug.enableScrollJump.enqueueUpdate((function(){return!1}))}),[e.updaters]),O=Object(r.useCallback)((function(){e.updaters.debug.enableScrollJump.enqueueUpdate((function(){return!0}))}),[e.updaters]),j=Object(r.useCallback)((function(){e.updaters.debug.getForceJumpOffset.enqueueUpdate((function(e){return function(){return console.log("force triggered virtual jump only"),new D(1,2)}}))}),[e.updaters]),y=Object(r.useCallback)((function(){e.updaters.debug.getOffsetX.enqueueUpdate((function(e){var t=e()||0;return function(){return t+1}}))}),[e.updaters]),g=Object(r.useCallback)((function(){e.updaters.debug.isFlipCursored.enqueueUpdate((function(e){var t=e()||!1;return function(){return!t}}))}),[e.updaters]),x=Object(r.useCallback)((function(){e.updaters.playerUI.isTextBoxFocused.enqueueUpdate((function(e){var t=!e;return console.log({isTextBoxFocused:t}),t}))}),[e.updaters]),S=Object(r.useCallback)((function(){St.store(e.gameState.playerUI)}),[e.gameState]),m=Object(r.useCallback)((function(){var t=St.load();t&&e.updaters.playerUI.enqueueUpdate((function(){return t}))}),[e.updaters]),k=Object(r.useCallback)((function(){St.clear(),new et({}).clear(),e.updaters.justDisabledSave.enqueueUpdate(!0)}),[e.updaters]);return e.hidden?Object(i.jsx)(i.Fragment,{children:" "}):Object(i.jsxs)(i.Fragment,{children:[Object(i.jsx)("div",{children:" debug tab "}),Object(i.jsxs)("div",{className:"tab-content-body",children:[Object(i.jsx)("br",{}),Object(i.jsx)("div",{children:"Recent slow renders:"}),d.slice(0,5).map((function(e,t){return Object(i.jsx)("div",{children:e},t)})),Object(i.jsx)("br",{})]}),Object(i.jsx)("div",{children:" buttons "}),Object(i.jsxs)("div",{className:"tab-content-body",children:[Object(i.jsx)("br",{}),Object(i.jsx)("div",{children:Object(i.jsx)("button",{onClick:v,children:"Toggle scrollbars"})}),Object(i.jsx)("div",{children:Object(i.jsx)("button",{onClick:p,children:"Trigger virtual grid dims rerender"})}),Object(i.jsx)("div",{children:Object(i.jsx)("button",{onClick:f,children:"Trigger only virtual game area grid react rerender"})}),Object(i.jsx)("div",{children:Object(i.jsx)("button",{onClick:b,children:"Disable scroll jump trigger"})}),Object(i.jsx)("div",{children:Object(i.jsx)("button",{onClick:O,children:"Reenable scroll jump trigger"})}),Object(i.jsx)("div",{children:Object(i.jsx)("button",{onClick:j,children:"Force virtual grid jump only"})}),Object(i.jsx)("div",{children:Object(i.jsx)("button",{onClick:y,children:"add weird x offset to grid"})}),Object(i.jsx)("div",{children:Object(i.jsx)("button",{onClick:g,children:"weird flip cursored state on all nodes"})}),Object(i.jsx)("div",{children:Object(i.jsx)("button",{onClick:x,children:"toggle text box focused"})}),Object(i.jsx)("div",{children:Object(i.jsx)("button",{onClick:S,children:"save state to local storage"})}),Object(i.jsx)("div",{children:Object(i.jsx)("button",{onClick:m,children:"load state from local storage"})}),Object(i.jsx)("div",{children:Object(i.jsx)("button",{onClick:k,children:"clear local storage and disable saving"})})]})]})}var at,ot=a.a.memo(ct);function ct(e){var t=e.gameState,n=e.updaters,a=Object(r.useState)(!1),o=Object(u.a)(a,2),c=o[0],s=o[1],l=Object(r.useState)(""),d=Object(u.a)(l,2),h=d[0],p=d[1],v=Object(r.useCallback)((function(){n.playerUI.isTextBoxFocused.enqueueUpdate(!0)}),[n]),f=Object(r.useCallback)((function(){n.playerUI.isTextBoxFocused.enqueueUpdate(!1)}),[n]),b=Object(r.useCallback)((function(){n.playerUI.strategicSearch.highlight1.enqueueUpdate((function(){return{value:h}}))}),[n,h]),O=Object(r.useCallback)((function(){p(""),n.playerUI.strategicSearch.highlight1.enqueueUpdate((function(){return{value:""}}))}),[n]);return t.playerUI.isPixiHidden?Object(i.jsxs)(i.Fragment,{children:[Object(i.jsx)("div",{children:"Strategic view is not open!"}),Object(i.jsx)("br",{}),Object(i.jsx)("div",{children:"Click [m] to toggle strategic view."})]}):Object(i.jsxs)(i.Fragment,{children:[Object(i.jsxs)("div",{children:[c?"Custom":"Basic"," search"]}),Object(i.jsx)("br",{}),Object(i.jsxs)("div",{className:"tab-content-body",children:[Object(i.jsx)("br",{}),Object(i.jsxs)("div",{children:["Symbols: ",Object(i.jsx)(ut,{updateTextInputValue:p,attribute:je.RED0}),Object(i.jsx)(ut,{updateTextInputValue:p,attribute:je.RED1}),Object(i.jsx)(ut,{updateTextInputValue:p,attribute:je.RED2}),Object(i.jsx)(ut,{updateTextInputValue:p,attribute:je.DEL0}),Object(i.jsx)(ut,{updateTextInputValue:p,attribute:je.DEL1}),Object(i.jsx)(ut,{updateTextInputValue:p,attribute:je.DEL2}),Object(i.jsx)(st,{updateTextInputValue:p,icon:"*",insertedText:"[*] "}),Object(i.jsx)("br",{}),Object(i.jsx)(st,{updateTextInputValue:p,id:ye.FLAT,icon:Me[ye.FLAT],insertedText:"["+Re[ye.FLAT]+"] "}),Object(i.jsx)(st,{updateTextInputValue:p,id:ye.INCREASED,icon:Me[ye.INCREASED],insertedText:"["+Re[ye.INCREASED]+"] "})]}),Object(i.jsx)("br",{}),Object(i.jsxs)("div",{children:["Highlight:"," ",Object(i.jsx)("input",{type:"text",onFocus:v,onChange:function(e){p(e.target.value)},onBlur:f,value:h}),Object(i.jsx)("button",{onClick:b,children:"\ud83d\udd0e"}),Object(i.jsx)("button",{onClick:O,children:"\ud83d\udeab"})]}),c?Object(i.jsxs)(i.Fragment,{children:[Object(i.jsxs)("div",{children:["Highlight 2: ",Object(i.jsx)("input",{type:"text"}),Object(i.jsx)("button",{children:"Apply"}),Object(i.jsx)("button",{children:"Cancel"})]}),Object(i.jsx)("br",{}),Object(i.jsx)("div",{children:"Filter:"}),Object(i.jsx)("br",{}),Object(i.jsxs)("div",{children:["Show if: ",Object(i.jsx)("input",{type:"text"}),Object(i.jsx)("button",{children:"Apply"}),Object(i.jsx)("button",{children:"Cancel"})]}),Object(i.jsx)("br",{}),Object(i.jsx)("div",{children:"Color:"}),Object(i.jsx)("br",{}),Object(i.jsxs)("div",{children:["Grayscale by: ",Object(i.jsx)("input",{type:"text"}),Object(i.jsx)("button",{children:"Apply"}),Object(i.jsx)("button",{children:"Cancel"})]}),Object(i.jsxs)("div",{children:["Color by: ",Object(i.jsx)("input",{type:"text"}),Object(i.jsx)("button",{children:"Apply"}),Object(i.jsx)("button",{children:"Cancel"})]}),Object(i.jsx)("br",{}),Object(i.jsx)("div",{children:"Shape:"}),Object(i.jsx)("br",{}),Object(i.jsxs)("div",{children:["Shape = | if: ",Object(i.jsx)("input",{type:"text"}),Object(i.jsx)("button",{children:"Apply"}),Object(i.jsx)("button",{children:"Cancel"})]}),Object(i.jsx)("br",{}),Object(i.jsx)("br",{}),Object(i.jsxs)("div",{children:[Object(i.jsx)("input",{type:"text"}),Object(i.jsx)("button",{children:"Save config"})]}),Object(i.jsxs)("div",{children:[Object(i.jsx)("input",{type:"text"}),Object(i.jsx)("button",{children:"Load config"})]}),Object(i.jsx)("div",{children:Object(i.jsx)("button",{children:"Reset to defaults"})}),Object(i.jsx)("br",{}),Object(i.jsx)("div",{children:Object(i.jsx)("button",{onClick:function(){s(!1)},children:"Use basic search"})})]}):Object(i.jsxs)(i.Fragment,{children:[Object(i.jsx)("br",{}),Object(i.jsx)("div",{children:Object(i.jsx)("button",{onClick:function(){s(!0)},children:"Use custom search"})})]})]})]})}function ut(e){return Object(i.jsx)(st,{updateTextInputValue:e.updateTextInputValue,insertedText:"["+Ne[e.attribute]+"] ",icon:Ie[e.attribute]})}function st(e){return Object(i.jsx)("button",{onMouseDown:function(e){e.preventDefault()},onPointerDown:function(e){e.preventDefault()},onClick:function(t){t.preventDefault(),e.updateTextInputValue((function(t){return t+e.insertedText}))},children:e.icon})}function lt(e){var t,n=e.tabName,r=(t={},Object(X.a)(t,at.EMPTY,Object(i.jsx)(ht,{})),Object(X.a)(t,at.SELECTED_NODE,Object(i.jsx)(vt,{gameState:e.gameState})),Object(X.a)(t,at.STATS,Object(i.jsx)(i.Fragment,{children:"stats info???"})),Object(X.a)(t,at.QUESTS,Object(i.jsx)(i.Fragment,{children:"quests info???"})),Object(X.a)(t,at.STRATEGIC_VIEW,Object(i.jsx)(ot,{gameState:e.gameState,updaters:e.updaters})),Object(X.a)(t,at.DEBUG,Object(i.jsx)(rt,{gameState:e.gameState,updaters:e.updaters,hidden:n!==at.DEBUG})),Object(X.a)(t,at.HELP,Object(i.jsx)(i.Fragment,{children:"How to play the game"})),t);return Object(i.jsx)(dt,{tabComponents:r,tabName:n})}function dt(e){var t=e.tabName,n=Object.keys(at);return Object(i.jsx)(i.Fragment,{children:n.map((function(n){return Object(i.jsx)("div",{hidden:n!==t,children:e.tabComponents[n]},n)}))})}!function(e){e.EMPTY="EMPTY",e.SELECTED_NODE="SELECTED_NODE",e.STATS="STATS",e.QUESTS="QUESTS",e.DEBUG="DEBUG",e.HELP="HELP",e.STRATEGIC_VIEW="STRATEGIC_VIEW"}(at||(at={}));var ht=a.a.memo(pt);function pt(e){return console.log("got here empty tab content"),Object(i.jsx)("div",{children:"Nothing here!"})}var vt=a.a.memo(ft);function ft(e){var t,n,r,a,o,c,u,s=e.gameState,l=s.playerUI.cursoredNodeLocation;if(null===l)return Object(i.jsxs)(i.Fragment,{children:[Object(i.jsx)("div",{children:"Nothing selected!"}),Object(i.jsx)("div",{children:Object(i.jsx)("br",{})}),Object(i.jsx)("div",{children:"Hover and click the question mark tooltip to select a node."})]});var d="";d=l.equals(fe.Zero)?nt:void 0!==(null===(t=s.worldGen.lockMap)||void 0===t?void 0:t.get(l))?"A locked node.":"An allocatable node.";var h=new D(l.x-l.y/2,l.y*Math.sqrt(3)/2);h=new D(Math.round(100*h.x)/100,Math.round(100*h.y)/100);var p=((null===(n=s.playerSave.allocationStatusMap)||void 0===n||null===(r=n.get(l))||void 0===r?void 0:r.taken)||!1).toString(),v=((null===(a=s.computed.reachableStatusMap)||void 0===a||null===(o=a.get(l))||void 0===o?void 0:o.reachable)||!1).toString(),f=((null===(c=s.computed.fogOfWarStatusMap)||void 0===c||null===(u=c.get(l))||void 0===u?void 0:u.visible)||!1).toString();return Object(i.jsx)(i.Fragment,{children:Object(i.jsxs)("div",{className:"tab-content-body",children:[Object(i.jsxs)("div",{children:["Location: ( ",h.x," , ",h.y," ) , z-layer = ",l.z]}),Object(i.jsx)("br",{}),Object(i.jsxs)("div",{children:["Description: ",d]}),Object(i.jsx)("br",{}),Object(i.jsxs)("div",{children:["Taken?: ",p]}),Object(i.jsxs)("div",{children:["Reachable?: ",v]}),Object(i.jsxs)("div",{children:["Visible?: ",f]}),Object(i.jsxs)("div",{children:["Locked?: ","???"]}),Object(i.jsx)("br",{}),Object(i.jsxs)("div",{children:["Contents: ","???"]})]})})}var bt={left:[],right:[at.SELECTED_NODE,at.STATS,at.QUESTS,at.DEBUG,at.HELP,at.STRATEGIC_VIEW]},Ot=function(){return{tabs:{left:{tabs:bt.left,activeIndex:0},right:{tabs:bt.right,activeIndex:0}},strategicSearch:{highlight1:{value:""}},isPixiHidden:!0,virtualGridLocation:fe.Zero,cursoredNodeLocation:null,isSidebarOpen:!1,isTextBoxFocused:!1}},jt=function(e){return JSON.stringify(function(e){return Object(A.a)(Object(A.a)({},e),{},{virtualGridLocation:fe.SerializeToObject(e.virtualGridLocation)})}(e))},yt=function(e){return function(e){if(!e||!e.hasOwnProperty("isPixiHidden")||!e.hasOwnProperty("virtualGridLocation")||!e.hasOwnProperty("cursoredNodeLocation")||!e.hasOwnProperty("isSidebarOpen")||!e.hasOwnProperty("isTextBoxFocused")||!e.hasOwnProperty("tabs")||!e.hasOwnProperty("strategicSearch"))return console.error("Failed deserializing PlayerUIState: ",e),null;var t=fe.Deserialize(e.virtualGridLocation);if(!t)return null;var n=fe.Deserialize(e.cursoredNodeLocation);return Object(A.a)(Object(A.a)({},e),{},{virtualGridLocation:t,cursoredNodeLocation:n})}(JSON.parse(e))},gt="PlayerUIState",xt=function(){var e=window.localStorage.getItem(gt);return e&&yt(e)||null},St={new:Ot,serialize:jt,deserialize:yt,tryLoad:function(){var e=xt();return e||(console.log("Failed to load PlayerUIState"),Ot())},load:xt,store:function(e){var t=jt(e);window.localStorage.setItem(gt,t)},clear:function(){window.localStorage.setItem(gt,"")}},mt=103043,kt=function(){function e(t){Object(d.a)(this,e),this.config=void 0,this.config=t}return Object(h.a)(e,[{key:"loadOrCreate",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,t=e||mt,n=new et({}),i={tick:0,worldGen:n.tryLoad({seed:t}),playerSave:Ze(),playerUI:St.tryLoad(),computed:{},intent:_(),windowState:He(),debug:{retriggerVirtualGridDims:function(){},debugShowScrollbars:!1,rerenderGameAreaGrid:function(){},enableScrollJump:!0,getForceJumpOffset:function(){},getOffsetX:function(){},isFlipCursored:function(){}},justDisabledSave:!1};return wt(i),i}},{key:"create",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,t=e||mt,n=new et({}),i={tick:0,worldGen:n.create({seed:t}),playerSave:Ze(),playerUI:St.new(),computed:{},intent:_(),windowState:He(),debug:{retriggerVirtualGridDims:function(){},debugShowScrollbars:!1,rerenderGameAreaGrid:function(){},enableScrollJump:!0,getForceJumpOffset:function(){},getOffsetX:function(){},isFlipCursored:function(){}},justDisabledSave:!1};return wt(i),i}}]),e}();function wt(e){e.computed.lockStatusMap=new F,e.computed.fogOfWarStatusMap=new F,e.computed.reachableStatusMap=new F,Ye(fe.Zero,6).forEach((function(t){e.worldGen.lockMap.precompute(t)}));var t,n=e.computed.lockStatusMap,i=e,r=Object(y.a)(i.worldGen.lockMap.entries());try{for(r.s();!(t=r.n()).done;){var a=Object(u.a)(t.value,2),o=a[0];if(a[1]){var c=de.TICKING;n.put(o,c)}}}catch(p){r.e(p)}finally{r.f()}var s=e.computed.fogOfWarStatusMap,l=e.computed.reachableStatusMap,d=fe.Zero,h=e;return s.put(d,pe.true),Ye(d,1).forEach((function(e){s.put(e,pe.true),l.put(e,ve.true)})),Ye(d,6,0,{contains:function(e){var t,n=null===(t=h.computed.lockStatusMap)||void 0===t?void 0:t.get(e);return!(!n||n===de.OPEN)}}).forEach((function(e){var t;(null===(t=s.get(e))||void 0===t?void 0:t.visible)||(h.worldGen.lockMap.precompute(e),s.put(e,pe.true))})),e}var Et=a.a.memo(Tt);function Tt(e){var t=e.hexGridPx,n=e.borderWidth,a=e.hexCenterRadius,o=e.appSize,c=e.COLORS;return Object(r.useEffect)((function(){document.documentElement.style.setProperty("--grid-width"," ".concat(t.x,"px")),document.documentElement.style.setProperty("--grid-height"," ".concat(t.y,"px")),document.documentElement.style.setProperty("--hex-center-radius"," ".concat(a,"px")),document.documentElement.style.setProperty("--border-width"," ".concat(n,"px"))}),[t,a,n]),Object(r.useEffect)((function(){document.documentElement.style.setProperty("--background-black",G(c.backgroundBlue)),document.documentElement.style.setProperty("--deemphasized-black",G(c.grayBlack)),document.documentElement.style.setProperty("--active-purple",G(c.nodePink)),document.documentElement.style.setProperty("--border-unimportant-black",G(c.borderBlack)),document.documentElement.style.setProperty("--border-important-white",G(c.borderWhite)),document.documentElement.style.setProperty("--text-readable-white",G(c.textWhite))}),[c]),Object(r.useEffect)((function(){document.documentElement.style.setProperty("--app-size-width"," ".concat(o.x,"px")),document.documentElement.style.setProperty("--app-size-height"," ".concat(o.y,"px"))}),[o]),Object(i.jsx)(i.Fragment,{children:e.children})}n(124),n(70),n(232);var Ct=a.a.memo(_t);function _t(e){var t=e.id,n=e.onUpdateStatus,a=e.nodeData,o=e.isCursored,c=e.onUpdateCursored,u=(e.debugIsCursored,a.nodeLocation),s=Object(r.useCallback)((function(e){e.stopPropagation(),e.preventDefault(),n({nodeLocation:u,newStatus:ce.TAKEN})}),[n,u]),l=Object(r.useCallback)((function(e){e.stopPropagation(),e.preventDefault(),c(o?null:u)}),[o,c,u]);return Object(i.jsx)(It,{id:t,onClickCenter:s,nodeData:a,onClickQuestionMark:l,isCursored:o},t)}var It=a.a.memo(Nt);function Nt(e){var t,n,a=e.id,o=e.onClickCenter,c=e.onClickQuestionMark,s=e.nodeData,d=e.isCursored,h=(e.debugIsCursored,s.status),p=!!s.lockData,v=Object(r.useState)(!1),f=Object(u.a)(v,2),b=f[0],O=f[1],j=function(e){console.log("got pointer enter on ".concat(a)),O(!0)},y=function(e){console.log("got pointer leave on ".concat(a)),O(!1)};return Object(i.jsxs)("div",{className:"hex-block hex-full-block",id:a,children:[Object(i.jsx)("div",{className:l()("hex-center",h===ce.TAKEN?"node-allocated":"node-unallocated",h===ce.TAKEN||h===ce.UNREACHABLE?"border-unimportant":"border-important"),onClick:o,onPointerEnter:j,onPointerLeave:y,hidden:h===ce.HIDDEN,children:Object(i.jsx)("div",{className:"hex-center-text-wrapper",children:Object(i.jsx)("div",{className:"tiny-text",children:s.shortText})})}),p?Object(i.jsxs)("div",{className:"hex-center-lock",hidden:h===ce.HIDDEN,onPointerEnter:j,onPointerLeave:y,children:[Object(i.jsx)("div",{className:"hex-center-lock-left",children:Object(i.jsx)("div",{className:"tiny-text",children:null===(t=s.lockData)||void 0===t?void 0:t.shortTextTarget})}),Object(i.jsx)("div",{className:"hex-center-lock-right",children:Object(i.jsx)("div",{className:"tiny-text",children:null===(n=s.lockData)||void 0===n?void 0:n.shortTextTimer})})]}):null,Object(i.jsx)("div",{className:"empty-positioned node-tooltip-wrapper",children:Object(i.jsx)("div",{className:"absolute-positioned node-tooltip",hidden:!b,children:s.toolTipText})}),Object(i.jsx)("div",{className:"empty-positioned",children:Object(i.jsx)("div",{className:"hover-only-2 absolute-positioned",children:Object(i.jsx)("div",{className:"question",hidden:h===ce.HIDDEN,onClick:c,children:"?"})})}),Object(i.jsx)("div",{className:"empty-positioned selection-cursor-wrapper",children:Object(i.jsx)("div",{className:"absolute-positioned selection-cursor",hidden:!d})})]},a)}function Ut(e){return{playerUI:{cursoredNodeLocation:e.playerUI.cursoredNodeLocation},playerSave:{allocationStatusMap:e.playerSave.allocationStatusMap},worldGen:{nodeContentsMap:e.worldGen.nodeContentsMap,lockMap:e.worldGen.lockMap},computed:{fogOfWarStatusMap:e.computed.fogOfWarStatusMap,reachableStatusMap:e.computed.reachableStatusMap,lockStatusMap:e.computed.lockStatusMap}}}var Mt=E(Ut),Rt=a.a.memo(Dt);function Dt(e){var t,n=e.gameState,a=e.virtualGridDims,o=e.virtualCoordsToLocation,c=e.updateNodeStatusByLocationCb,u=e.cursoredVirtualNode,s=e.setCursoredLocation,l=e.debug,d=+new Date;null===l||void 0===l||l.rerenderGameAreaGrid();var h=(null===l||void 0===l||null===(t=l.isFlipCursored)||void 0===t?void 0:t.call(l))||!1,p=Object(r.useMemo)((function(){return new se((function(e){return it({location:e,gameState:n})}))}),[n]),v=Object(i.jsx)(i.Fragment,{children:Array(a.y).fill(0).map((function(e,t){return Object(i.jsx)(At,{rowIdx:t,children:Array(a.x).fill(0).map((function(e,n){var r=new D(n,t),a=o(r),l=p.get(a),d=!!u&&u.equals(r),v=l.id||"loading".concat(n);return Object(i.jsx)(Ct,{id:v,nodeData:l,onUpdateStatus:c,isCursored:d,debugIsCursored:h?!d:d,onUpdateCursored:s},v)}))},o(new D(0,t)).y.toString())}))}),f=+new Date,b=f-d;return console.log("Game area grid elapsed ".concat(b,"ms at ").concat(f)),v}var At=a.a.memo(Lt);function Lt(e){var t=e.rowIdx,n=e.children,r=!!(t%2);return Object(i.jsxs)("div",{className:"hex-block-row",children:[r&&Object(i.jsx)("div",{className:"hex-block hex-half-block"}),n,!r&&Object(i.jsx)("div",{className:"hex-block hex-half-block"})]})}var Pt=a.a.memo(Gt);function Gt(e){var t=e.hexGridPx,n=e.virtualGridDims,a=e.appSize,o=e.updaters,c=e.keyboardScrollDirection,s=e.debug,d=Object(r.useRef)(null),h=Object(r.useRef)(null),p=Object(r.useState)(new D(0,0)),v=Object(u.a)(p,2),f=v[0],b=v[1];Object(r.useEffect)((function(){null!=d.current&&d.current!==h.current&&(d.current.scrollTop=(n.y*t.y-a.y)/2,d.current.scrollLeft=((n.x+.5)*t.x-a.x)/2),h.current=d.current}),[a,n,t]),Object(r.useEffect)((function(){if(f){var e=d.current;e&&e.scrollTo(e.scrollLeft-f.x*t.x,e.scrollTop-f.y*t.y)}}),[f,t]);var O=Object(r.useCallback)((function(e){var t=new D(e.direction.x,-1*e.direction.y);e.direction.x===e.direction.y&&(t=new D(0,-1*e.direction.y));var n=new D(t.x,0).add(new D(-.5,-1).multiply(t.y));o.playerUI.virtualGridLocation.enqueueUpdate((function(e){return e.add(fe.FromVector2(t,0))})),b(n)}),[o]),j=s.getForceJumpOffset;Object(r.useEffect)((function(){var e=null===j||void 0===j?void 0:j();e&&o.playerUI.virtualGridLocation.enqueueUpdate((function(t){return t.addX(e.x).add(new fe(-1,-2,0).multiply(e.y/2))}))}),[o,j]);var y=s.enableScrollJump,g=Object(r.useCallback)((function(e){if(y){var i={x:0,y:0},r=e.target,o=r.scrollTop,c=r.scrollLeft;r.scrollTop<.9*t.y&&(o+=2*t.y,i.y-=1),r.scrollTop>(n.y-.9)*t.y-a.y&&(o-=2*t.y,i.y+=1),r.scrollLeft<.9*t.x&&(c+=2*t.x,i.x-=1),r.scrollLeft>(n.x-.9)*t.x-a.x&&(c-=2*t.x,i.x+=1),r.scrollTop===o&&r.scrollLeft===c||O({direction:new D(i.x,i.y)})}}),[a,O,t,n,y]);return Object(r.useEffect)((function(){if(!c.equals(D.Zero)){var e=null,t=function(){var t=d.current;if(t){var n=D.Zero;if(null===e)n=c.multiply(8),e=+new Date;else{var i=+new Date-e;i>40&&console.log("WAS SLOW - "+i.toString()),n=c.multiply(i),e=+new Date}n=n.multiply(.75),t.scrollTo(t.scrollLeft+n.x,t.scrollTop-n.y)}},n=setInterval(t,8);return t(),function(){return clearInterval(n)}}}),[c]),Object(i.jsx)("div",{ref:d,className:l()({"game-area":!0,"hidden-scrollbars":!(null===s||void 0===s?void 0:s.debugShowScrollbars)}),hidden:e.hidden,onScroll:g,children:Object(i.jsx)("div",{className:"virtual-game-area",children:e.children})})}var zt=a.a.memo(Ft);function Ft(e){var t=e.gameState,n=e.appSize,a=e.virtualGridDims,o=Object(r.useCallback)((function(e){return function(e){var t=e.virtualCoords,n=e.virtualGridLocation,i=e.virtualGridDims.divide(2).floor(),r=t.subtract(i),a=D.Zero;return a=(a=r.y%2===0?new D(-1,-2).multiply(r.y/2):i.y%2===0?new D(0,-1).add(new D(-1,-2).multiply((r.y-1)/2)):new D(-1,-1).add(new D(-1,-2).multiply((r.y-1)/2))).addX(r.x),n.add(fe.FromVector2(a,0))}({virtualCoords:e,virtualGridDims:a,virtualGridLocation:t.playerUI.virtualGridLocation})}),[t.playerUI.virtualGridLocation,a]),c=Object(r.useCallback)((function(e){return function(e){var t=e.location,n=e.virtualGridLocation,i=e.virtualGridDims.divide(2).floor(),r=t.subtract(n),a=D.Zero;return 0!==r.z?null:(a=(a=r.y%2===0?new D(-1,-2).multiply(r.y/2):i.y%2===0?new D(-1,-1).add(new D(-1,-2).multiply((r.y-1)/2)):new D(0,-1).add(new D(-1,-2).multiply((r.y-1)/2))).addX(r.x),i.add(a))}({location:e,virtualGridDims:a,virtualGridLocation:t.playerUI.virtualGridLocation})}),[t.playerUI.virtualGridLocation,a]),u=Object(r.useCallback)((function(n){var i,r,a=n.nodeLocation,o=n.newStatus,c=(null===(i=t.computed.reachableStatusMap)||void 0===i?void 0:i.get(a))||ve.false;if(o===ce.TAKEN){if(c!==ve.true)return void console.log("cant do that, not reachable:",c);var u=t.worldGen.lockMap.get(a);if(u)return void console.log("is locked",u)}(null===(r=t.playerSave.allocationStatusMap.get(a))||void 0===r?void 0:r.taken)||e.actions.allocateNode.enqueueAction({nodeLocation:a,newStatus:he.true})}),[e.actions,t.playerSave.allocationStatusMap,t.computed.reachableStatusMap,t.worldGen.lockMap]),s=Object(r.useCallback)((function(e){var t=e.virtualCoords,n=e.newStatus,i=o(t);u({nodeLocation:i,newStatus:n})}),[o,u]),l=Object(r.useCallback)((function(t){e.updaters.playerUI.cursoredNodeLocation.enqueueUpdate((function(e){return t})),t&&e.updaters.playerUI.isSidebarOpen.enqueueUpdate((function(){return!0}))}),[e.updaters]),d=Object(r.useMemo)((function(){return t.playerUI.cursoredNodeLocation?c(t.playerUI.cursoredNodeLocation):null}),[t.playerUI.cursoredNodeLocation,c]);Object(r.useEffect)((function(){var t=o(a.divide(2).floor());e.gameState.intent.newIntent.MOVE_CURSOR_EAST&&e.updaters.playerUI.cursoredNodeLocation.enqueueUpdate((function(e){return(null===e||void 0===e?void 0:e.addX(1))||t})),e.gameState.intent.newIntent.MOVE_CURSOR_WEST&&e.updaters.playerUI.cursoredNodeLocation.enqueueUpdate((function(e){return(null===e||void 0===e?void 0:e.addX(-1))||t})),e.gameState.intent.newIntent.MOVE_CURSOR_NORTHEAST&&e.updaters.playerUI.cursoredNodeLocation.enqueueUpdate((function(e){return(null===e||void 0===e?void 0:e.add({x:1,y:1,z:0}))||t})),e.gameState.intent.newIntent.MOVE_CURSOR_NORTHWEST&&e.updaters.playerUI.cursoredNodeLocation.enqueueUpdate((function(e){return(null===e||void 0===e?void 0:e.addY(1))||t})),e.gameState.intent.newIntent.MOVE_CURSOR_SOUTHEAST&&e.updaters.playerUI.cursoredNodeLocation.enqueueUpdate((function(e){return(null===e||void 0===e?void 0:e.addY(-1))||t})),e.gameState.intent.newIntent.MOVE_CURSOR_SOUTHWEST&&e.updaters.playerUI.cursoredNodeLocation.enqueueUpdate((function(e){return(null===e||void 0===e?void 0:e.add({x:-1,y:-1,z:0}))||t})),e.gameState.intent.newIntent.MOVE_CURSOR_SOUTH&&e.updaters.playerUI.cursoredNodeLocation.enqueueUpdate((function(e){return e&&e.y%2===0?null===e||void 0===e?void 0:e.add({x:0,y:-1,z:0}):e&&e.y%2!==0?null===e||void 0===e?void 0:e.add({x:-1,y:-1,z:0}):t})),e.gameState.intent.newIntent.MOVE_CURSOR_NORTH&&e.updaters.playerUI.cursoredNodeLocation.enqueueUpdate((function(e){return e&&e.y%2===0?null===e||void 0===e?void 0:e.add({x:1,y:1,z:0}):e&&e.y%2!==0?null===e||void 0===e?void 0:e.add({x:0,y:1,z:0}):t})),e.gameState.intent.newIntent.INTERACT_WITH_NODE&&d&&s({virtualCoords:d,newStatus:ce.TAKEN})}),[e.gameState.intent.newIntent.INTERACT_WITH_NODE,e.gameState.intent.newIntent.MOVE_CURSOR_EAST,e.gameState.intent.newIntent.MOVE_CURSOR_NORTH,e.gameState.intent.newIntent.MOVE_CURSOR_NORTHEAST,e.gameState.intent.newIntent.MOVE_CURSOR_NORTHWEST,e.gameState.intent.newIntent.MOVE_CURSOR_SOUTH,e.gameState.intent.newIntent.MOVE_CURSOR_SOUTHEAST,e.gameState.intent.newIntent.MOVE_CURSOR_SOUTHWEST,e.gameState.intent.newIntent.MOVE_CURSOR_WEST,e.updaters,o,a,d,s]);var h=Object(r.useMemo)((function(){var t=D.Zero;return e.gameState.intent.activeIntent.PAN_EAST&&(t=t.addX(1)),e.gameState.intent.activeIntent.PAN_WEST&&(t=t.addX(-1)),e.gameState.intent.activeIntent.PAN_NORTH&&(t=t.addY(1)),e.gameState.intent.activeIntent.PAN_SOUTH&&(t=t.addY(-1)),t}),[e.gameState.intent.activeIntent.PAN_EAST,e.gameState.intent.activeIntent.PAN_WEST,e.gameState.intent.activeIntent.PAN_NORTH,e.gameState.intent.activeIntent.PAN_SOUTH]),p=Object(r.useMemo)((function(){return{debugShowScrollbars:t.debug.debugShowScrollbars,enableScrollJump:t.debug.enableScrollJump,getForceJumpOffset:t.debug.getForceJumpOffset}}),[t.debug.debugShowScrollbars,t.debug.enableScrollJump,t.debug.getForceJumpOffset]),v=Object(r.useMemo)((function(){return{rerenderGameAreaGrid:t.debug.rerenderGameAreaGrid,getOffsetX:t.debug.getOffsetX,isFlipCursored:t.debug.isFlipCursored}}),[t.debug.rerenderGameAreaGrid,t.debug.getOffsetX,t.debug.isFlipCursored]),f=Object(r.useMemo)((function(){return Ut(t)}),Mt(t));return Object(i.jsx)(i.Fragment,{children:Object(i.jsx)(Pt,{hidden:!t.playerUI.isPixiHidden,appSize:n,updaters:e.updaters,hexGridPx:Ht,virtualGridDims:a,keyboardScrollDirection:h,debug:p,children:Object(i.jsx)(Rt,{gameState:f,virtualGridDims:a,virtualCoordsToLocation:o,updateNodeStatusByLocationCb:u,cursoredVirtualNode:d,setCursoredLocation:l,debug:v})})})}var Ht=new D(268,232);function Wt(e){return{playerUI:{virtualGridLocation:e.playerUI.virtualGridLocation,cursoredNodeLocation:e.playerUI.cursoredNodeLocation,isPixiHidden:e.playerUI.isPixiHidden},playerSave:{allocationStatusMap:e.playerSave.allocationStatusMap},worldGen:{nodeContentsMap:e.worldGen.nodeContentsMap,lockMap:e.worldGen.lockMap},computed:{fogOfWarStatusMap:e.computed.fogOfWarStatusMap,reachableStatusMap:e.computed.reachableStatusMap,lockStatusMap:e.computed.lockStatusMap},intent:e.intent,debug:{debugShowScrollbars:e.debug.debugShowScrollbars,rerenderGameAreaGrid:e.debug.rerenderGameAreaGrid,enableScrollJump:e.debug.enableScrollJump,getForceJumpOffset:e.debug.getForceJumpOffset,getOffsetX:e.debug.getOffsetX,isFlipCursored:e.debug.isFlipCursored}}}var qt=E(Wt);function Vt(e){var t=e.gameState,n=Object(r.useMemo)((function(){return We(new D(t.windowState.innerWidth,t.windowState.innerHeight))}),[t.windowState.innerWidth,t.windowState.innerHeight]),a=t.debug.retriggerVirtualGridDims,o=Object(r.useMemo)((function(){a();var e=Math.floor(2*n.x/Ht.x-.5),t=Math.floor(2*n.y/Ht.y);return new D(e,t)}),[n,a]),c=Object(r.useMemo)((function(){return Wt(t)}),qt(t)),u=Object(r.useMemo)((function(){return{allocateNode:new tt(e.updaters)}}),[e.updaters]);return Object(i.jsxs)(i.Fragment,{children:[Object(i.jsx)(Et,{appSize:n,hexCenterRadius:48,hexGridPx:Ht,borderWidth:2,COLORS:P}),Object(i.jsx)(zt,{appSize:n,virtualGridDims:o,gameState:c,updaters:e.updaters,actions:u})]})}n(233),n(234);function Bt(e){var t=e.children,n=e.hidden,r=e.placement;return Object(i.jsx)("div",{className:"left"===r?"layout left-sidebar":"layout right-sidebar",hidden:n,children:Object(i.jsx)(i.Fragment,{children:t})})}n(235);var Xt=a.a.memo(Jt);function Jt(e){var t=e.value,n=e.labels,r=e.onChange;return Object(i.jsx)("div",{className:"tab-label-container",children:n.map((function(e,n){return Object(i.jsx)(Zt,{onClick:r,value:n,active:t===n,children:e},n)}))})}var Zt=a.a.memo(Kt);function Kt(e){var t=e.onClick,n=e.value,a=e.active,o=e.children,c=Object(r.useCallback)((function(){t(n)}),[t,n]);return Object(i.jsx)("div",{className:a?"tab-label active":"tab-label inactive",children:Object(i.jsx)("div",{onClick:c,children:o})})}var Yt=[at.EMPTY];at.SELECTED_NODE,at.STATS,at.QUESTS,at.DEBUG,at.HELP,at.STRATEGIC_VIEW;function Qt(e){var t=e.gameState,n=e.updaters,a=Object(r.useCallback)((function(){n.playerUI.isSidebarOpen.enqueueUpdate((function(){return!1}))}),[n]),o=Object(r.useCallback)((function(){n.playerUI.isSidebarOpen.enqueueUpdate((function(){return!0}))}),[n]),c=Object(r.useCallback)((function(){n.playerUI.isSidebarOpen.enqueueUpdate((function(){return!1}))}),[n]),u=Object(r.useCallback)((function(){n.playerUI.isSidebarOpen.enqueueUpdate((function(){return!0}))}),[n]),s=t.playerUI.tabs,l=n.playerUI.tabs,d=s.left.tabs,h=s.right.tabs,p=s.left.activeIndex,v=s.right.activeIndex,f=l.left.tabs.enqueueUpdate,b=l.right.tabs.enqueueUpdate,O=l.left.activeIndex.enqueueUpdate,j=l.right.activeIndex.enqueueUpdate,y=Object(r.useCallback)((function(){if(0!==h.length){var e=h[v];if(void 0!==e){var t=h.slice(0,v).concat(h.slice(v+1));b(t),j(Math.max(0,Math.min(v,t.length-1)));var n=[].concat(Object(V.a)(d),[e]);f(n),O(n.length-1),o()}}}),[d,f,h,b,O,v,j,o]),g=Object(r.useCallback)((function(){if(0!==d.length){var e=d[p];if(void 0!==e){var t=d.slice(0,p).concat(d.slice(p+1));f(t),O(Math.max(Math.min(p,t.length-1),0));var n=[].concat(Object(V.a)(h),[e]);b(n),j(n.length-1),u()}}}),[d,f,h,b,p,O,j,u]),x=Object(r.useMemo)((function(){return 0===d.length?at.EMPTY:d[p]}),[d,p]),S=Object(r.useMemo)((function(){return 0===h.length?at.EMPTY:h[v]}),[h,v]);return Object(i.jsxs)(i.Fragment,{children:[Object(i.jsxs)(Bt,{hidden:!t.playerUI.isSidebarOpen,placement:"left",children:[Object(i.jsxs)("div",{className:"sidebar-header",children:[Object(i.jsx)("div",{className:"sidebar-header-button",onClick:g,children:"\u27a1\ufe0f\ufe0f Send right"}),Object(i.jsx)("div",{className:"sidebar-header-gap"}),Object(i.jsx)("div",{className:"sidebar-header-button",onClick:function(){a()},children:"\u274e Close"})]}),Object(i.jsx)(Xt,{value:p||0,labels:d.length?d:Yt,onChange:O}),Object(i.jsx)(lt,{gameState:t,updaters:n,tabName:x})]}),Object(i.jsxs)(Bt,{hidden:!t.playerUI.isSidebarOpen,placement:"right",children:[Object(i.jsxs)("div",{className:"sidebar-header",children:[Object(i.jsx)("div",{className:"sidebar-header-button",onClick:y,children:"\u2b05\ufe0f Send left"}),Object(i.jsx)("div",{className:"sidebar-header-gap"}),Object(i.jsx)("div",{className:"sidebar-header-button",onClick:function(){c()},children:"\u274e Close"})]}),Object(i.jsx)(Xt,{value:v||0,labels:h.length?h:Yt,onChange:j}),Object(i.jsx)(lt,{gameState:t,updaters:n,tabName:S})]})]})}function $t(e){var t=e.gameState,n=Object(r.useCallback)((function(){t.justDisabledSave?console.log("skipping save because it was just disabled!"):(St.store(t.playerUI),new et({}).store(t.worldGen))}),[t.playerUI,t.justDisabledSave,t.worldGen]);return Object(r.useEffect)((function(){return window.onbeforeunload=n,function(){window.onbeforeunload=null}})),Object(i.jsx)(i.Fragment,{children:" "})}var en=new oe((function(){return new kt({}).loadOrCreate(+new Date)}));var tn=function(){var e=Object(r.useState)((function(){return en.get()})),t=Object(u.a)(e,2),n=t[0],a=t[1],o=Object(r.useMemo)((function(){return B(a)}),[a]),c=Object(u.a)(o,2),s=c[0],d=c[1],h=Object(r.useMemo)((function(){return Z(en.get(),s)}),[s]),p=Object(r.useMemo)((function(){return[n,h,d]}),[n,h,d]);return Object(r.useEffect)((function(){console.log("maybe toggling strategic view"),n.intent.newIntent.TOGGLE_STRATEGIC_VIEW&&h.playerUI.isPixiHidden.enqueueUpdate((function(e){return!e}))}),[n.intent.newIntent.TOGGLE_STRATEGIC_VIEW,h]),Object(r.useEffect)((function(){console.log("maybe toggling sidebar"),n.intent.newIntent.TOGGLE_SIDEBAR&&h.playerUI.isSidebarOpen.enqueueUpdate((function(e){return!e}))}),[n.intent.newIntent.TOGGLE_SIDEBAR,h]),Object(i.jsxs)("div",{className:l()({App:!0}),children:[Object(i.jsxs)("div",{className:"entire-area",children:[Object(i.jsx)(U.Provider,{value:p,children:Object(i.jsx)(Be,{hidden:n.playerUI.isPixiHidden})}),Object(i.jsx)(Vt,{gameState:n,updaters:h})]}),Object(i.jsx)("div",{className:"debug-overlay",children:Object(i.jsx)(v,{tick:n.tick,windowState:n.windowState})}),Object(i.jsxs)("div",{className:"button-zone",children:[Object(i.jsx)("button",{className:"button-pixi-toggle",style:{},onClick:function(){h.playerUI.isPixiHidden.enqueueUpdate((function(e){return!e}))},children:"Toggle strategic view (hotkey: m)"}),Object(i.jsx)("span",{children:" "}),Object(i.jsx)("button",{onClick:function(){h.playerUI.isSidebarOpen.enqueueUpdate((function(e){return!e}))},children:"Toggle sidebar (hotkey: i)"})]}),Object(i.jsx)(Qt,{gameState:n,updaters:h}),Object(i.jsx)(N,{isTextBoxFocused:n.playerUI.isTextBoxFocused,updaters:h.intent}),Object(i.jsx)(Je,{updaters:h.windowState}),Object(i.jsx)($t,{gameState:n})]})};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(Object(i.jsx)(a.a.StrictMode,{children:Object(i.jsx)(tn,{})}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},70:function(e,t,n){}},[[236,1,2]]]);
//# sourceMappingURL=main.7a93371d.chunk.js.map