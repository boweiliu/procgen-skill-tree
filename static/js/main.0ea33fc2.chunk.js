(this["webpackJsonpprocgen-skill-tree"]=this["webpackJsonpprocgen-skill-tree"]||[]).push([[0],{131:function(e,t,n){},132:function(e,t,n){},133:function(e,t,n){},134:function(e,t,n){},144:function(e,t){},146:function(e,t){},157:function(e,t){},159:function(e,t){},184:function(e,t){},186:function(e,t){},187:function(e,t){},192:function(e,t){},194:function(e,t){},213:function(e,t){},225:function(e,t){},228:function(e,t){},231:function(e,t,n){"use strict";n.r(t);var i=n(0),r=n(3),o=n.n(r),a=n(122),c=n.n(a),u=(n(131),n(10)),s=(n(132),n(123)),l=n.n(s),d=(n(133),n(1)),h=n(2),f=function(){function e(){Object(d.a)(this,e),this.frameTimestampsInTicks=[],this.frameTimestampsInTime=[],this.frameTimestampsInTicks.push(0)}return Object(h.a)(e,[{key:"tick",value:function(e){var t=this.frameTimestampsInTicks[this.frameTimestampsInTicks.length-1];this.frameTimestampsInTicks.push(t+e),this.frameTimestampsInTicks.length>120&&(this.frameTimestampsInTicks=this.frameTimestampsInTicks.slice(60)),this.frameTimestampsInTime.push((new Date).getTime()),this.frameTimestampsInTime.length>120&&(this.frameTimestampsInTime=this.frameTimestampsInTime.slice(60))}},{key:"getUps",value:function(){var e=this.frameTimestampsInTicks[this.frameTimestampsInTicks.length-1]-this.frameTimestampsInTicks[0],t=(this.frameTimestampsInTicks.length-1)/e;return t?60*t:60}},{key:"getFps",value:function(){var e=this.frameTimestampsInTime[this.frameTimestampsInTime.length-1]-this.frameTimestampsInTime[0],t=(this.frameTimestampsInTime.length-1)/e;return t?1e3*t:60}},{key:"getFpsString",value:function(){return this.getFps().toFixed(1)}},{key:"getUpsString",value:function(){return this.getUps().toFixed(1)}}]),e}();function v(e){var t=Object(r.useRef)(new f);return Object(r.useEffect)((function(){t.current.tick(0)}),[e.tick]),Object(i.jsxs)("div",{className:"text",children:[Object(i.jsxs)("div",{children:[e.windowState.innerWidth,"x",e.windowState.innerHeight]}),Object(i.jsx)(p,{}),Object(i.jsxs)("div",{children:["UPS: ",t.current.getFpsString()]})]})}function p(){var e=Object(r.useState)(0),t=Object(u.a)(e,2),n=t[0],o=t[1],a=Object(r.useRef)(new f);Object(r.useEffect)((function(){var e=setTimeout((function(){o((function(e){return e+1})),a.current.tick(0)}),5);return function(){return clearTimeout(e)}}),[n]);var c=Object(r.useMemo)((function(){return a.current.getFpsString()}),[n]);return Object(i.jsxs)("div",{children:["RPS: ",c]})}var y=1e-7,k=n(9),x=function(){function e(){Object(d.a)(this,e)}return Object(h.a)(e,null,[{key:"MinBy",value:function(e,t){var n,i=null,r=null,o=Object(k.a)(e);try{for(o.s();!(n=o.n()).done;){var a=n.value,c=t(a);(null===r||c<r)&&(i=a,r=c)}}catch(u){o.e(u)}finally{o.f()}return i}},{key:"MinByAndValue",value:function(e,t){var n,i=null,r=null,o=Object(k.a)(e);try{for(o.s();!(n=o.n()).done;){var a=n.value,c=t(a);(null===r||c<r)&&(i=a,r=c)}}catch(u){o.e(u)}finally{o.f()}return null===i||null===r?null:{obj:i,value:r}}},{key:"MaxBy",value:function(e,t){var n,i=null,r=null,o=Object(k.a)(e);try{for(o.s();!(n=o.n()).done;){var a=n.value,c=t(a);(null===r||c>r)&&(i=a,r=c)}}catch(u){o.e(u)}finally{o.f()}return i}},{key:"RandRange",value:function(e,t){return Math.floor(Math.random()*(t-e)+e)}},{key:"SortByKey",value:function(e,t){return e.sort((function(e,n){return t(e)-t(n)}))}},{key:"ReplaceAll",value:function(e,t){var n=new RegExp(Object.keys(t).join("|"),"gi");return e.replace(n,(function(e){return t[e.toLowerCase()]}))}},{key:"Debounce",value:function(e){var t,n=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{isImmediate:!1},o=function(){for(var o=arguments.length,a=new Array(o),c=0;c<o;c++)a[c]=arguments[c];var u=function(){t=void 0,r.isImmediate||e.apply(n,a)},s=r.isImmediate&&void 0===t;void 0!==t&&clearTimeout(t),t=setTimeout(u,i),s&&e.apply(n,a)};return o}},{key:"FormatDate",value:function(e){var t=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][e.getMonth()];return"".concat(t," ").concat(e.getDate(),", ").concat(("00"+e.getHours()).substr(-2),":").concat(("00"+e.getMinutes()).substr(-2),":").concat(("00"+e.getSeconds()).substr(-2))}},{key:"FlattenByOne",value:function(e){var t,n=[],i=Object(k.a)(e);try{for(i.s();!(t=i.n()).done;){var r=t.value;n=n.concat(r)}}catch(o){i.e(o)}finally{i.f()}return n}},{key:"PadString",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:" ";return e+n+i.repeat(t-e.length)}}]),e}();function b(e,t){var n=[16711680&e,16711680&t],i=[255&e,255&t],r=[65280&e,65280&t],o=65536*Math.round(n[0]/65536*n[1]/16777215);return o+=256*Math.round(r[0]/256*r[1]/65280),o+=Math.round(i[0]*i[1]/255)}function g(e){return Object.keys(e)}var w=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{x:0,y:0},n=arguments.length>1?arguments[1]:void 0;Object(d.a)(this,e),this._x=void 0,this._y=void 0,"number"===typeof t?(this._x=t,this._y=n):(this._x=t.x,this._y=t.y)}return Object(h.a)(e,[{key:"x",get:function(){return this._x}},{key:"y",get:function(){return this._y}}]),Object(h.a)(e,[{key:"hash",value:function(){return this.toString()}},{key:"toString",value:function(){return"[".concat(this.x,", ").concat(this.y,"]")}},{key:"invert",value:function(){return new e({x:-this.x,y:-this.y})}},{key:"round",value:function(){return new e({x:Math.round(this.x),y:Math.round(this.y)})}},{key:"floor",value:function(){return new e({x:Math.floor(this.x),y:Math.floor(this.y)})}},{key:"taxicabDistance",value:function(e){return Math.abs(e.x-this.x)+Math.abs(e.y-this.y)}},{key:"diagonalDistance",value:function(e){return Math.max(Math.abs(e.x-this.x),Math.abs(e.y-this.y))}},{key:"distance",value:function(e){var t=Math.abs(e.x-this.x),n=Math.abs(e.y-this.y);return Math.sqrt(t*t+n*n)}},{key:"translate",value:function(t){return new e({x:this.x+t.x,y:this.y+t.y})}},{key:"subtract",value:function(t){return new e({x:this.x-t.x,y:this.y-t.y})}},{key:"add",value:function(t){return new e({x:this.x+t.x,y:this.y+t.y})}},{key:"addX",value:function(t){return new e({x:this.x+t,y:this.y})}},{key:"addY",value:function(t){return new e({x:this.x,y:this.y+t})}},{key:"subtractX",value:function(t){return new e({x:this.x-t,y:this.y})}},{key:"subtractY",value:function(t){return new e({x:this.x,y:this.y-t})}},{key:"clampX",value:function(t,n){var i=this.x;return i<t&&(i=t),i>n&&(i=n),new e({x:i,y:this.y})}},{key:"clampY",value:function(t,n){var i=this.y;return i<t&&(i=t),i>n&&(i=n),new e({x:this.x,y:i})}},{key:"scale",value:function(t,n){return new e({x:(this.x-t.x)*n.x+t.x,y:(this.y-t.y)*n.y+t.y})}},{key:"rotate",value:function(t,n){return n/=180/Math.PI,new e({x:Math.cos(n)*(this.x-t.x)-Math.sin(n)*(this.y-t.y)+t.x,y:Math.sin(n)*(this.x-t.x)+Math.cos(n)*(this.y-t.y)+t.y})}},{key:"equals",value:function(e){return void 0!==e&&(Math.abs(this.x-e.x)<y&&Math.abs(this.y-e.y)<y)}},{key:"multiply",value:function(t){return new e("number"===typeof t?{x:this.x*t,y:this.y*t}:{x:this.x*t.x,y:this.y*t.y})}},{key:"divide",value:function(t){return new e("number"===typeof t?{x:this.x/t,y:this.y/t}:{x:this.x/t.x,y:this.y/t.y})}},{key:"toJSON",value:function(){return{__type:"Vector2",x:this.x,y:this.y}}},{key:"transform",value:function(t,n){return new e({x:Math.floor((this.x-t.x)*n),y:Math.floor((this.y-t.y)*n)})}},{key:"normalize",value:function(){if(0===this.x&&0===this.y)return this;var t=Math.sqrt(this.x*this.x+this.y*this.y);return new e({x:this.x/t,y:this.y/t})}},{key:"withX",value:function(t){return new e({x:t,y:this.y})}},{key:"withY",value:function(t){return new e({x:this.x,y:t})}},{key:"invertX",value:function(){return new e({x:-this.x,y:this.y})}},{key:"lerp",value:function(e,t){return(t>1||t<0)&&console.error("Lerp t must be between 0 and 1."),0===t?this:1===t?e:this.scale({x:0,y:0},{x:1-t,y:1-t}).add(e.scale({x:0,y:0},{x:t,y:t}))}},{key:"lerp2D",value:function(e,t,n){return(t>1||t<0||n>1||n<0)&&console.error("Lerp t must be between 0 and 1."),this.scale({x:0,y:0},{x:1-t,y:1-n}).add(e.scale({x:0,y:0},{x:t,y:n}))}},{key:"coserp",value:function(e,t){return t=.5*(1+Math.cos(2*t*Math.PI)),this.lerp(e,t)}},{key:"half",get:function(){return new e({x:this.x/2,y:this.y/2})}}],[{key:"IsVector2",value:function(t){return t instanceof e}},{key:"Random",value:function(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return new e({x:x.RandRange(i,t),y:x.RandRange(r,n)})}},{key:"Deserialize",value:function(t){return t.hasOwnProperty("x")&&t.hasOwnProperty("y")||console.error("Failed deserializing point"),new e({x:t.x,y:t.y})}},{key:"Serialize",value:function(e){return JSON.stringify({x:e.x,y:e.y})}}]),e}();w.Zero=new w(0,0),w.One=new w(1,1);var O,m,S,j,N=function(){function e(t){Object(d.a)(this,e),this.z=void 0,this.chunkCoord=void 0,this.pointNodeCoord=void 0,this.pointNodeId=void 0,this.z=t.z,this.chunkCoord=t.chunkCoord,this.pointNodeCoord=t.pointNodeCoord,this.pointNodeId=t.pointNodeId}return Object(h.a)(e,[{key:"hash",value:function(){return this.pointNodeId.toString()+this.z.toString()+this.chunkCoord.toString()+this.pointNodeCoord.toString()}},{key:"toString",value:function(){return this.z+","+this.chunkCoord.toString()+","+this.pointNodeCoord.toString()}}]),e}(),_=function e(){Object(d.a)(this,e)};_.CHUNK_HALF_DIM=((_.CHUNK_DIM=9)-1)/2,_.DROP_NODES_CHANCE=0,function(e){e.Basic="Basic",e.Nothing="Nothing",e.EfficiencyGate="EfficiencyGate"}(O||(O={})),function(e){e.Mana0="Mana0",e.Mana1="Mana1",e.Mana2="Mana2"}(m||(m={})),function(e){e.Flat="Flat",e.Increased0="% increased",e.AfterIncreased0="added after % increased",e.Increased1="% increased multiplier",e.AfterIncreased1="added after % increased multiplier"}(S||(S={})),function(e){e.NOOP="NOOP",e.PAN_NORTH="PAN_NORTH",e.PAN_SOUTH="PAN_SOUTH",e.PAN_WEST="PAN_WEST",e.PAN_EAST="PAN_EAST",e.TRAVEL_IN="TRAVEL_IN",e.TRAVEL_OUT="TRAVEL_OUT"}(j||(j={}));var T=g(j).reduce((function(e,t){return e[t]=!1,e}),{});function C(e){return new w({x:Math.min(1920,((null===e||void 0===e?void 0:e.x)||1/0)-24),y:Math.min(1080,((null===e||void 0===e?void 0:e.y)||1/0)-24)})}var I=function(){function e(t){Object(d.a)(this,e),this.type=void 0,this.modifier=void 0,this.type=t.type,this.modifier=t.modifier}return Object(h.a)(e,[{key:"hash",value:function(){return this.type.toString()+","+this.modifier.toString()}}]),e}(),E=n(13),A=n(12),z=n(6),U=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];Object(d.a)(this,e),this._values=void 0,this._values=new M;var n,i=Object(k.a)(t);try{for(i.s();!(n=i.n()).done;){var r=n.value;this.put(r)}}catch(o){i.e(o)}finally{i.f()}}return Object(h.a)(e,[{key:"remove",value:function(e){this._values.remove(e)}},{key:"put",value:function(e){this._values.put(e,e)}},{key:"get",value:function(e){return void 0!==this._values.get(e)}},{key:"contains",value:function(e){return this._values.contains(e)}},{key:"values",value:function(){return this._values.values()}},{key:"clone",value:function(){var t=new e;return t._values=this._values.clone(),t}},{key:"size",value:function(){return this._values.size()}},{key:"equals",value:function(e){if(void 0===e||null===e)return!1;if(this.size()!==e.size())return!1;var t,n=Object(k.a)(this.values());try{for(n.s();!(t=n.n()).done;){var i=t.value;if(!e.contains(i))return!1}}catch(r){n.e(r)}finally{n.f()}return!0}}]),e}(),M=function(){function e(){Object(d.a)(this,e),this._values={}}return Object(h.a)(e,[{key:"put",value:function(e,t){this._values[e.hash()]=t}},{key:"remove",value:function(e){delete this._values[e.hash()]}},{key:"get",value:function(e){return this._values[e.hash()]}},{key:"contains",value:function(e){return void 0!==this.get(e)&&e.hash()in this._values}},{key:"values",value:function(){return Object.values(this._values)}},{key:"size",value:function(){return Object.keys(this._values).length}},{key:"clone",value:function(){var t=new e;return t._values=Object(z.a)({},this._values),t}}]),e}(),H=function(){function e(){Object(d.a)(this,e),this._kvalues={}}return Object(h.a)(e,[{key:"put",value:function(e,t){this._kvalues[e.hash()]=[e,t]}},{key:"remove",value:function(e){delete this._kvalues[e.hash()]}},{key:"get",value:function(e){var t;return null===(t=this._kvalues[e.hash()])||void 0===t?void 0:t[1]}},{key:"contains",value:function(e){return void 0!==this.get(e)&&e.hash()in this._kvalues}},{key:"keys",value:function(){var e=this;return Object.keys(this._kvalues).map((function(t){return e._kvalues[t][0]}))}},{key:"entries",value:function(){var e=this;return Object.keys(this._kvalues).map((function(t){return e._kvalues[t]}))}},{key:"values",value:function(){var e=this;return Object.keys(this._kvalues).map((function(t){return e._kvalues[t][1]}))}},{key:"hashKeyset",value:function(){return Object.keys(this._kvalues).map((function(e){return P(e)})).reduce((function(e,t){return e+t})).toString()}},{key:"clone",value:function(){var t=new e;return t._kvalues=Object(z.a)({},this._kvalues),t}},{key:"size",value:function(){return Object.keys(this._kvalues).length}}]),e}();function P(e){for(var t=0,n=0;n<e.length;n++)t=Math.imul(31,t)+e.charCodeAt(n)|0;return t}var D,L=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{x:0,y:0,z:0},n=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0;Object(d.a)(this,e),this._x=void 0,this._y=void 0,this._z=void 0,"number"===typeof t?(this._x=t,this._y=n,this._z=i):(this._x=t.x,this._y=t.y,this._z=t.z)}return Object(h.a)(e,[{key:"x",get:function(){return this._x}},{key:"y",get:function(){return this._y}},{key:"z",get:function(){return this._z}}]),Object(h.a)(e,[{key:"hash",value:function(){return this.toString()}},{key:"toString",value:function(){return"[".concat(this.x,", ").concat(this.y,", ").concat(this.z,"]")}},{key:"subtract",value:function(t){return new e({x:this.x-t.x,y:this.y-t.y,z:this.z-t.z})}},{key:"add",value:function(t,n,i){return new e("number"===typeof t?{x:this.x+t,y:this.y+n,z:this.z+i}:{x:this.x+t.x,y:this.y+t.y,z:this.z+t.z})}},{key:"addX",value:function(t){return new e({x:this.x+t,y:this.y,z:this.z})}},{key:"addY",value:function(t){return new e({x:this.x,y:this.y+t,z:this.z})}},{key:"addZ",value:function(t){return new e({x:this.x,y:this.y,z:this.z+t})}},{key:"subtractX",value:function(t){return new e({x:this.x-t,y:this.y,z:this.z})}},{key:"subtractY",value:function(t){return new e({x:this.x,y:this.y-t,z:this.z})}},{key:"subtractZ",value:function(t){return new e({x:this.x,y:this.y,z:this.z-t})}},{key:"scale",value:function(t,n){return new e({x:(this.x-t.x)*n.x+t.x,y:(this.y-t.y)*n.y+t.y,z:(this.z-t.z)*n.z+t.z})}},{key:"equals",value:function(e){return void 0!==e&&(Math.abs(this.x-e.x)<y&&Math.abs(this.y-e.y)<y&&Math.abs(this.z-e.z)<y)}},{key:"multiply",value:function(t){return new e("number"===typeof t?{x:this.x*t,y:this.y*t,z:this.z*t}:{x:this.x*t.x,y:this.y*t.y,z:this.z*t.z})}},{key:"divide",value:function(t){return new e("number"===typeof t?{x:this.x/t,y:this.y/t,z:this.z/t}:{x:this.x/t.x,y:this.y/t.y,z:this.z/t.z})}},{key:"toJSON",value:function(){return{__type:"Vector3",x:this.x,y:this.y,z:this.z}}},{key:"pairXY",value:function(){return new w({x:this.x,y:this.y})}},{key:"withX",value:function(t){return new e({x:t,y:this.y,z:this.z})}},{key:"withY",value:function(t){return new e({x:this.x,y:t,z:this.z})}},{key:"withZ",value:function(t){return new e({x:this.x,y:this.y,z:t})}}],[{key:"IsVector3",value:function(t){return t instanceof e}},{key:"FromVector2",value:function(t,n){return new e(t.x,t.y,n)}},{key:"Deserialize",value:function(t){return t.hasOwnProperty("x")&&t.hasOwnProperty("y")&&t.hasOwnProperty("z")||console.error("Failed deserializing vector3"),new e({x:t.x,y:t.y,z:t.z})}},{key:"Serialize",value:function(e){return JSON.stringify({x:e.x,y:e.y})}}]),e}();L.Zero=new L(0,0,0),L.One=new L(1,1,1),function(e){e.NORTHWEST="NORTHWEST",e.SOUTHWEST="SOUTHWEST",e.NORTHEAST="NORTHEAST",e.SOUTHEAST="SOUTHEAST",e.EAST="EAST",e.WEST="WEST",e.UP="UP",e.DOWN="DOWN"}(D||(D={}));function R(e){var t={};return t.EAST=e.addX(1),t.WEST=e.addX(-1),t.NORTHWEST=e.addY(1),t.SOUTHEAST=e.addY(-1),t.NORTHEAST=e.add(1,1,0),t.SOUTHWEST=e.add(-1,-1,0),t.DOWN=e.multiply(new L(6,6,1)).addZ(-1),e.x%6===0&&e.y%6===0&&(t.UP=e.divide(new L(6,6,1)).addZ(1)),t}function F(e,t,n){var i=new U;i.put(e);for(var r=[[e]],o=1;o<=t;o++){r.push([]);var a,c=Object(k.a)(r[o-1]);try{for(c.s();!(a=c.n()).done;)for(var u=a.value,s=Object.values(R(u)),l=0,d=s;l<d.length;l++){var h=d[l];h&&(i.get(h)||(i.put(h),r[o].push(h)))}}catch(p){c.e(p)}finally{c.f()}}for(var f=[],v=n||0;v<=t;v++)f=f.concat(r[v]);return f}n(134);var G={backgroundBlue:2236962,nodePink:3351108,nodeLavender:7829367,nodeBlue:14540253,nodeAqua:16755370,gateTint:16777215,selectedTint:12303359,allocatedTint:4473924,nodeBorder:6710886,nullTint:16777215,tooltipBorderBlack:2236962,tooltipFillWhite:15658734,white:16777215,grayBlack:1907997,borderBlack:1118481,borderWhite:6710886,black:0};function B(e){return"#"+e.toString(16)}var W,X,q=o.a.memo(K);function K(e){Object(r.useEffect)((function(){var i=e.jumpOffset;if(console.log({receivedJumpOffset:i}),i){var r=d.current;r&&r.scrollTo(r.scrollLeft-i.x*t,r.scrollTop-i.y*n)}}),[e.jumpOffset]);var t=268,n=232,o={width:t+"px",height:n+"px"},a={width:t/2+"px",height:n+"px"},c={width:"64px",height:"64px"},u={marginLeft:"-".concat(64,"px"),width:"64px",height:"160px"},s={width:"64px",height:"32px",marginTop:"32px",backgroundColor:B(G.nodePink)},l=Object(r.useCallback)((function(i){var r={x:0,y:0},o=i.target,a=o.scrollTop,c=o.scrollLeft;o.scrollTop<n&&(a+=2*n,r.y-=1),o.scrollTop>(e.virtualGridDims.y-1)*n-e.appSize.y&&(a-=2*n,r.y+=1),o.scrollLeft<1.5*t&&(c+=2*t,r.x-=1),o.scrollLeft>(e.virtualGridDims.x-2)*t-e.appSize.x&&(c-=2*t,r.x+=1),o.scrollTop===a&&o.scrollLeft===c||(console.log("jump!"),e.onJump({direction:new w(r.x,r.y)}))}),[e.appSize.x,e.appSize.y]),d=Object(r.useRef)(null),h=Object(r.useRef)(null);return Object(r.useEffect)((function(){null!=d.current&&d.current!==h.current&&(d.current.scrollTop=e.virtualGridDims.y*n/3,d.current.scrollLeft=(e.virtualGridDims.x+.5)*t/3),h.current=d.current}),[d.current]),Object(i.jsx)("div",{ref:d,className:"game-area",hidden:e.hidden,style:{width:e.appSize.x,height:e.appSize.y,backgroundColor:B(G.backgroundBlue)},onScroll:l,children:Object(i.jsx)("div",{className:"virtual-game-area",style:{},onPointerOver:function(e){},onClick:function(e){},children:Array(e.virtualGridDims.y).fill(0).map((function(t,n){return Object(i.jsx)(Z,{rowIdx:n,hexHalfBlockStyle:a,children:Array(e.virtualGridDims.x).fill(0).map((function(t,r){var a,l=e.virtualGridStatusMap.get(new w(r,n));return Object(i.jsx)(Q,{nodeData:l,status:l.status,text:l.shortText,hexBlockStyle:o,idx:r,rowIdx:n,hexCenterStyle:c,hexCenterLockStyle:u,hexCenterLockBlockStyle:s,onUpdateStatus:e.updateNodeStatusCb},null!==(a=null===l||void 0===l?void 0:l.id)&&void 0!==a?a:"loading".concat(r))}))},n)}))})})}!function(e){e.TAKEN="TAKEN",e.HIDDEN="HIDDEN",e.AVAILABLE="AVAILABLE",e.UNREACHABLE="UNREACHABLE"}(W||(W={})),function(e){e.CLOSED="CLOSED",e.TICKING="TICKING",e.OPEN="OPEN"}(X||(X={}));var Z=o.a.memo(V);function V(e){var t=e.rowIdx,n=e.hexHalfBlockStyle,r=e.children,o=!!(t%2);return Object(i.jsxs)("div",{className:"hex-block-row",children:[o&&Object(i.jsx)("div",{className:"hex-block",style:n}),r,!o&&Object(i.jsx)("div",{className:"hex-block",style:n})]})}var J=o.a.memo(Y);function Y(e){var t,n,r=e.idx,o=e.rowIdx,a=e.children,c=e.hexBlockStyle,u=e.hexCenterStyle,s=e.hexCenterLockStyle,l=e.hexCenterLockBlockStyle,d=e.onClick,h=e.status,f=e.text,v=e.nodeData,p=Object(z.a)({},l),y=Object(z.a)({},l),k=12===r&&4===o||!!v.lockData,x=h===W.TAKEN?B(G.grayBlack):B(G.nodePink),b=h===W.TAKEN||h===W.UNREACHABLE?B(G.borderBlack):B(G.borderWhite),g=k?B(G.borderBlack):b;return Object(i.jsxs)("div",{onClick:d,id:"hex-block-".concat(o,"-").concat(r),className:"hex-block",style:c,children:[Object(i.jsxs)("div",{id:"hex-center-".concat(o,"-").concat(r),className:"hex-center",style:Object(z.a)(Object(z.a)({},u),{},{backgroundColor:x,borderColor:b}),hidden:h===W.HIDDEN,children:[Object(i.jsx)("div",{style:{display:"flex",width:u.width,height:u.height,alignItems:"center",justifyContent:"center",marginTop:"-2px",marginLeft:"-2px"},children:Object(i.jsx)("div",{className:"tiny-text",children:f})}),Object(i.jsx)("div",{className:"hover-only",style:{borderStyle:"solid",marginTop:"-16px",marginLeft:"48px",minWidth:"max-content",padding:"3px",background:"rgba(255,255,255,0.3)"},children:a})]}),k?Object(i.jsxs)("div",{id:"hex-lock-".concat(o,"-").concat(r),hidden:h===W.HIDDEN,style:Object(z.a)({},s),children:[Object(i.jsx)("div",{className:"hex-center-lock-left",style:Object(z.a)(Object(z.a)({},p),{},{borderColor:g}),children:Object(i.jsx)("div",{className:"tiny-text",children:null===(t=v.lockData)||void 0===t?void 0:t.shortTextTarget})}),Object(i.jsx)("div",{className:"hex-center-lock-right",style:Object(z.a)(Object(z.a)({},y),{},{borderColor:g}),children:Object(i.jsx)("div",{className:"tiny-text",children:null===(n=v.lockData)||void 0===n?void 0:n.shortTextTimer})})]}):null]})}var Q=o.a.memo($);function $(e){var t=e.idx,n=e.rowIdx,o=(e.children,e.hexBlockStyle),a=e.hexCenterStyle,c=e.hexCenterLockStyle,u=e.hexCenterLockBlockStyle,s=e.status,l=e.text,d=e.onUpdateStatus,h=e.nodeData,f=Object(r.useCallback)((function(e){e.preventDefault(),console.log("clicked"),console.log({idx:t,rowIdx:n,status:s}),d({virtualDims:new w(t,n),newStatus:W.TAKEN})}),[d,s,t,n]);return Object(i.jsx)(J,{onClick:f,hexBlockStyle:o,idx:t,rowIdx:n,hexCenterStyle:a,hexCenterLockStyle:c,hexCenterLockBlockStyle:u,text:l,status:s,nodeData:h,children:s})}var ee=o.a.memo(ne),te=new w(268,232);function ne(e){var t=e.gameState,n=(e.children,Object(r.useMemo)((function(){return C(new w(t.windowState.innerWidth,t.windowState.innerHeight))}),[t.windowState.innerWidth,t.windowState.innerHeight])),o=Object(r.useState)(new w(0,0)),a=Object(u.a)(o,2),c=a[0],s=a[1],l=Object(r.useMemo)((function(){return new w(Math.floor(3*n.x/te.x-.5),Math.floor(3*n.y/te.y))}),[n,3,te]),d=Object(r.useCallback)((function(e){var n=l.divide(2).floor(),i=e.subtract(n),r=new w(0,0);return r=(r=i.y%2===0?new w(-1,-2).multiply(i.y/2):n.y%2==0?new w(0,-1).add(new w(-1,-2).multiply((i.y-1)/2)):new w(-1,-1).add(new w(-1,-2).multiply((i.y-1)/2))).addX(i.x),t.playerUI.virtualGridLocation.add(L.FromVector2(r,0))}),[t.playerUI.virtualGridLocation,l]),h=(Object(r.useCallback)((function(e){}),[t.playerUI.virtualGridLocation,l]),Object(r.useMemo)((function(){for(var e=new H,n=0;n<l.x;n++)for(var i=0;i<l.y;i++){var r=new w(n,i),o=d(r),a=t.playerSave.allocationStatusMap.get(o)||W.HIDDEN,c=o.hash(),u=t.worldGen.lockMap.get(o),s={shortText:c,toolTipText:a.toString(),status:a,lockData:u,id:c};e.put(r,s)}return e}),[t.playerSave.allocationStatusMap,t.worldGen.lockMap,l,d])),f=Object(r.useCallback)((function(t){console.log({direction:t.direction});var n=l.multiply(.45).floor(),i=(n=(n=n.withY(2*Math.floor(n.y/2))).clampX(1,l.x-1).clampY(2,2*Math.floor((l.y-1)/2))).multiply(t.direction);console.log({jumpOffset:i}),e.updaters.playerUI.virtualGridLocation.enqueueUpdate((function(e){return e.addX(i.x).add(new L(-1,-2,0).multiply(i.y/2))})),s(i.multiply(1))}),[l]),v=Object(r.useCallback)((function(n){var i=n.virtualDims,r=n.newStatus,o=d(i),a=t.playerSave.allocationStatusMap.get(o)||W.HIDDEN;if(r===W.TAKEN){if(a!==W.AVAILABLE)return void console.log("cant do that",a);var c=t.worldGen.lockMap.get(o);if(c)return void console.log("is locked",c)}return e.updaters.playerSave.allocationStatusMap.enqueueUpdate((function(e,t){return e.put(o,r),r===W.TAKEN&&(F(o,1).forEach((function(t){e.get(t)===W.UNREACHABLE&&e.put(t,W.AVAILABLE)})),F(o,3).forEach((function(n){(e.get(n)||W.HIDDEN)===W.HIDDEN&&(t.worldGen.lockMap.precompute(n),e.put(n,W.UNREACHABLE))}))),e.clone()}))}),[e.updaters,d,t.playerSave.allocationStatusMap,t.worldGen.lockMap]);return Object(i.jsxs)(i.Fragment,{children:[Object(i.jsx)(q,{hidden:!t.playerUI.isPixiHidden,appSize:n,virtualGridDims:l,jumpOffset:c,virtualGridStatusMap:h,updateNodeStatusCb:v,onJump:f}),e.children]})}var ie={w:j.PAN_NORTH,a:j.PAN_WEST,s:j.PAN_SOUTH,d:j.PAN_EAST,ArrowUp:j.PAN_NORTH,ArrowLeft:j.PAN_WEST,ArrowDown:j.PAN_SOUTH,ArrowRight:j.PAN_EAST,"<":j.TRAVEL_OUT,">":j.TRAVEL_IN},re=function(e){Object(E.a)(n,e);var t=Object(A.a)(n);function n(e){var i;return Object(d.a)(this,n),(i=t.call(this,e)).handleKeydown=function(e){var t=i.state.keyIntentConfig[e.key];!1===e.repeat&&void 0!==t&&t!==j.NOOP&&(i.props.updaters.newIntent[t].enqueueUpdate((function(){return i.props.updaters.newIntent[t].enqueueUpdate((function(){return!1})),!0})),i.props.updaters.activeIntent[t].enqueueUpdate((function(){return!0})))},i.handleKeyup=function(e){var t=i.state.keyIntentConfig[e.key];void 0!==t&&t!==j.NOOP&&(i.props.updaters.activeIntent[t].enqueueUpdate((function(){return!1})),i.props.updaters.endedIntent[t].enqueueUpdate((function(){return i.props.updaters.endedIntent[t].enqueueUpdate((function(){return!1})),!0})))},i.state={keyIntentConfig:ie},document.addEventListener("keydown",i.handleKeydown),document.addEventListener("keyup",i.handleKeyup),i}return Object(h.a)(n,[{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.handleKeydown),document.removeEventListener("keyup",this.handleKeyup)}},{key:"render",value:function(){return Object(i.jsx)(i.Fragment,{children:" "})}}]),n}(o.a.Component),oe=o.a.createContext([]),ae=n(8),ce=n(46);function ue(e){return new ae.d(e.x,e.y)}var se=n(23);function le(e){var t=[];return[function(e){t.push(e)},function(){if(0!==t.length){var n=Object(se.a)(t);t=[],e((function(e){var t,i=e,r=Object(k.a)(n);try{for(r.s();!(t=r.n()).done;){var o=t.value;i="function"===typeof o?o(i):o}}catch(a){r.e(a)}finally{r.f()}return i}))}}]}var de=n(39);function he(e,t){var n={getUpdater:function(){return t}};return n.enqueueUpdate=t,"object"!==typeof e||Object.keys(e).forEach((function(i){if("enqueueUpdate"===i||"getUpdater"===i||"update"===i)throw Error("Invalid key in updaterGenerator: ".concat(i," conflicts with reserved keywords enqueueUpdate, update, getUpdater."));n[i]=he(e[i],(function(e){t("function"===typeof e?function(t,n){var r=e(t[i],n);return t[i]===r?t:Object(z.a)(Object(z.a)({},t),{},Object(de.a)({},i,r))}:function(t,n){return Object(z.a)(Object(z.a)({},t),{},Object(de.a)({},i,e))})}))})),n}function fe(e,t){return he(e,(function(e){t("function"===typeof e?function(t){return e(t,t)}:e)}))}var ve=function(){function e(){Object(d.a)(this,e),this._values=[]}return Object(h.a)(e,[{key:"add",value:function(e){-1===this._values.indexOf(e)||e.instance&&this.contains(e.instance),this._values.push(e)}},{key:"remove",value:function(e){var t=this._values.splice(this._values.findIndex((function(t){return t.instance===e})),1);return 0===t.length?void 0:t[0]}},{key:"contains",value:function(e){return this._values.findIndex((function(t){return t.instance===e}))>-1}},{key:"get",value:function(e){return this._values.find((function(t){return t.instance===e}))}},{key:"clone",value:function(){var t=new e;return t._values=Object(se.a)(this._values),t}},{key:"forEach",value:function(e){this._values.forEach(e)}}]),e}(),pe=function(){function e(t){var n=this;Object(d.a)(this,e),this.container=void 0,this.state=void 0,this._staleProps=void 0,this._children=new ve,this._childrenToConstruct=new ve,this._childrenToDestruct=new ve,this._forceUpdates=new ve,this.markForceUpdate=function(e){var t,i;null===(t=n._staleProps.args)||void 0===t||null===(i=t.markForceUpdate)||void 0===i||i.call(t,n);var r=n._children.get(e);if(!r)throw new Error("Error, child ".concat(e," not found in ").concat(n));n._forceUpdates.add(r)},this._staleProps=t}return Object(h.a)(e,[{key:"addChild",value:function(e){this._children.add(e),this._childrenToConstruct.add(e)}},{key:"registerChild",value:function(e){this._children.add(e)}},{key:"removeChild",value:function(e){var t=this._children.remove(e);t&&this._childrenToDestruct.add(t)}},{key:"_didConstruct",value:function(e){var t,n=this;this._childrenToConstruct.forEach((function(t){t.instance||(t.instance=new t.childClass(t.propsFactory(e,n.state))),n.container.addChild(t.instance.container)})),this.renderSelf(e),null===(t=this.didMount)||void 0===t||t.call(this)}},{key:"useState",value:function(e,t){var n=function(t){e.state="function"===typeof t?t(e.state):t},i=le(n),r=Object(u.a)(i,2),o=r[0];return{state:t,setState:n,fireStateUpdaters:r[1],stateUpdaters:fe(t,o)}}},{key:"update",value:function(e){this._update(e)}},{key:"_update",value:function(e){var t,n,i,r=this,o=Object(z.a)({},this.state);if(null===(t=this.fireStateUpdaters)||void 0===t||t.call(this),null===(n=this.updateSelf)||void 0===n||n.call(this,e),this.shouldUpdate&&!this.shouldUpdate(this._staleProps,o,e,this.state)){var a,c=this._forceUpdates.clone();return this._forceUpdates=new ve,c.forEach((function(t){var n,i=t.instance,o=t.propsFactory;null===i||void 0===i||i._update(o(e,r.state)),i&&(null===(n=r.didForceUpdateChild)||void 0===n||n.call(r,i))})),void(null===(a=this.didForceUpdate)||void 0===a||a.call(this))}null===(i=this.updateChildren)||void 0===i||i.call(this,e),this._updateChildren(e),this.renderSelf(e),this._staleProps=e,new Promise((function(e){var t;return e(null===(t=r.didUpdate)||void 0===t?void 0:t.call(r))}))}},{key:"_updateChildren",value:function(e){var t=this;this._childrenToDestruct.forEach((function(e){var n,i;e.instance&&(null===(n=(i=e.instance).willUnmount)||void 0===n||n.call(i),t.container.removeChild(e.instance.container))})),this._childrenToDestruct=new ve,this._children.forEach((function(n){var i=n.instance,r=n.propsFactory;null===i||void 0===i||i._update(r(e,t.state))})),this._childrenToConstruct.forEach((function(n){n.instance||(n.instance=new n.childClass(n.propsFactory(e,t.state))),t.container.addChild(n.instance.container)})),this._childrenToConstruct=new ve}},{key:"willUnmount",value:function(){}},{key:"toString",value:function(){return"lifecyclehandler object"}}]),e}();function ye(e){return new Proxy(e,{construct:function(e,t){var n=new e(t[0]);return n._didConstruct(t[0]),n}})}var ke;new Proxy(pe,{construct:function(e,t,n){var i=Reflect.construct(e,t,n);return i._didConstruct.apply(i,Object(se.a)(t)),i}});function xe(e){var t,n={},i=function(e){var t,n=new M,i=Object(k.a)(e.playerSave.allocatedPointNodeHistory);try{for(i.s();!(t=i.n()).done;){var r=t.value,o=e.worldGen.zLevels[r.z].chunks.get(r.chunkCoord).pointNodes.get(r.pointNodeCoord);if(o.nodeType!==O.Nothing){var a=new I({type:o.resourceType,modifier:o.resourceModifier});n.put(a,(n.get(a)||0)+o.resourceAmount)}}}catch(c){i.e(c)}finally{i.f()}return n}(e),r=Object(k.a)(g(m));try{for(r.s();!(t=r.n()).done;){var o=t.value,a=i.get(new I({type:o,modifier:S.Flat}))||0;a*=1+.01*(i.get(new I({type:o,modifier:S.Increased0}))||0),a=Math.floor(a),a+=i.get(new I({type:o,modifier:S.AfterIncreased0}))||0,a*=1+.01*(i.get(new I({type:o,modifier:S.Increased1}))||0),a=Math.floor(a),a+=i.get(new I({type:o,modifier:S.AfterIncreased1}))||0,n[o]=a}}catch(c){r.e(c)}finally{r.f()}return{playerResourceAmounts:n,playerResourceNodesAggregated:i}}function be(e,t){var n,i=function(e,t){var n={},i=t.zLevels[e.z],r=i.chunks.get(e.chunkCoord);if(e.pointNodeCoord.x===_.CHUNK_HALF_DIM){var o=e.chunkCoord.addX(1),a=i.chunks.get(o);if(a){var c=e.pointNodeCoord.withX(-_.CHUNK_HALF_DIM),u=a.pointNodes.get(c);u&&(n.EAST=new N({z:e.z,chunkCoord:o,pointNodeCoord:c,pointNodeId:u.id}))}}else{var s=e.pointNodeCoord.addX(1),l=r.pointNodes.get(s);l&&(n.EAST=new N({z:e.z,chunkCoord:e.chunkCoord,pointNodeCoord:s,pointNodeId:l.id}))}if(e.pointNodeCoord.x===-_.CHUNK_HALF_DIM){var d=e.chunkCoord.addX(-1),h=i.chunks.get(d);if(h){var f=e.pointNodeCoord.withX(_.CHUNK_HALF_DIM),v=h.pointNodes.get(f);v&&(n.WEST=new N({z:e.z,chunkCoord:d,pointNodeCoord:f,pointNodeId:v.id}))}}else{var p=e.pointNodeCoord.addX(-1),y=r.pointNodes.get(p);y&&(n.WEST=new N({z:e.z,chunkCoord:e.chunkCoord,pointNodeCoord:p,pointNodeId:y.id}))}if(e.pointNodeCoord.equals(w.Zero)){var k=t.zLevels[e.z+1];if(k){var x=e.chunkCoord,b=Math.round(x.x/_.CHUNK_DIM),g=x.x-_.CHUNK_DIM*b,O=Math.round(x.y/_.CHUNK_DIM),m=x.y-_.CHUNK_DIM*b,S=new w(b,O),j=k.chunks.get(S);if(j){var T=new w(g,m),C=j.pointNodes.get(T);C&&(n.UP=new N({z:e.z+1,chunkCoord:S,pointNodeCoord:T,pointNodeId:C.id}))}}}var I=t.zLevels[e.z-1];if(I){var E=e.chunkCoord.multiply(9).add(e.pointNodeCoord),A=I.chunks.get(E);if(A){var z=A.pointNodes.get(w.Zero);z&&(n.DOWN=new N({z:e.z-1,chunkCoord:E,pointNodeCoord:w.Zero,pointNodeId:z.id}))}}return n}(e,t),r=[],o=Object(k.a)(g(ke));try{for(o.s();!(n=o.n()).done;){var a=i[n.value];a&&r.push(a)}}catch(c){o.e(c)}finally{o.f()}return r}function ge(e,t,n){if("yes"===function(e,t,n,i){if(n.contains(e))return"already allocated";var r,o=be(e,t),a=!1,c=Object(k.a)(o);try{for(c.s();!(r=c.n()).done;){var u=r.value;n.contains(u)&&(a=!0)}}catch(s){c.e(s)}finally{c.f()}return a?"yes":"not connected"}(n,t.worldGen,t.playerSave.allocatedPointNodeSet,t.playerSave.activeQuest)&&function(e,t){var n,i=null===(n=t.worldGen.zLevels[e.z].chunks.get(e.chunkCoord))||void 0===n?void 0:n.pointNodes.get(e.pointNodeCoord);if(i.nodeType!==O.EfficiencyGate)return!0;var r,o=i.efficiencyGateInfo.thresholdResourceType;return((null===(r=t.computed.playerResourceAmounts)||void 0===r?void 0:r[o])||0)>=i.efficiencyGateInfo.thresholdResourceAmount&&t.playerSave.allocatedPointNodeHistory.length<=i.efficiencyGateInfo.timeUntilLocked}(n,t)){var i=e.allocatedPointNodeSet.clone();i.put(n);var r=Object(se.a)(e.allocatedPointNodeHistory);return r.push(n),[Object(z.a)(Object(z.a)({},e),{},{allocatedPointNodeHistory:r,allocatedPointNodeSet:i}),!0]}return[e,!1]}function we(e,t){var n=!1,i=!1,r=!1;e.playerUI.selectedPointNode.enqueueUpdate((function(e,i){return(null===e||void 0===e?void 0:e.pointNodeId)===t.pointNodeId&&(n=!0),t})),e.playerSave.enqueueUpdate((function(e,o){if(n){n=!1;var a=ge(e,o,t),c=Object(u.a)(a,2),s=c[0];return c[1]?(i=!0,s):(r=!0,e)}return e})),e.computed.enqueueUpdate((function(e,t){return i?xe(t):e})),e.playerSave.enqueueUpdate((function(e,t){return i?(i=!1,function(e,t){var n=Object(z.a)({},e);if(void 0!==n.spSpentThisQuest&&(n.spSpentThisQuest+=1),n.activeQuest){var i,r=n.activeQuest.resourceType,o=(null===(i=t.computed.playerResourceAmounts)||void 0===i?void 0:i[r])||0;n.questProgressHistory.push(o)}return n}(e,t)):e})),e.playerUI.activeTab.enqueueUpdate((function(e,t){return r?(r=!1,1):e}))}!function(e){e.NORTHWEST="NORTHWEST",e.SOUTHWEST="SOUTHWEST",e.NORTHEAST="NORTHEAST",e.SOUTHEAST="SOUTHEAST",e.EAST="EAST",e.WEST="WEST",e.UP="UP",e.DOWN="DOWN"}(ke||(ke={}));var Oe=ye(function(e){Object(E.a)(n,e);var t=Object(A.a)(n);function n(e){var i,r,o;Object(d.a)(this,n),(o=t.call(this,e)).container=void 0,o.state=void 0,o.sprite=void 0,o.halfwayCenterSprite=void 0,o.centerSprite=void 0,o.topHalfSprite=void 0,o.hitArea=void 0,o.tooltippableArea=void 0,o.state={numClicks:0,descriptionText:""},o.updateSelf(e),o.container=new ae.b;var a=null===(i=e.args.pointNodeTexture.find((function(e){return e.cropFraction>=.99})))||void 0===i?void 0:i.texture;o.container.sortableChildren=!0,o.sprite=new ae.g(a),o.sprite.anchor.x=.5,o.sprite.anchor.y=.5,o.sprite.zIndex=-2,o.container.addChild(o.sprite),o.topHalfSprite=new ae.g(null===(r=e.args.pointNodeTexture.find((function(e){return e.cropFraction>=.499})))||void 0===r?void 0:r.texture),o.topHalfSprite.anchor.x=.5,o.topHalfSprite.anchor.y=.5,o.topHalfSprite.zIndex=-1,e.pointNodeGen.nodeType===O.EfficiencyGate&&o.container.addChild(o.topHalfSprite);var c=new ae.c;return c.beginFill(G.black),c.drawRect(0,0,o.topHalfSprite.width,o.topHalfSprite.height/2),c.pivot.x=o.topHalfSprite.width/2,c.pivot.y=o.topHalfSprite.height/2,c.zIndex=30,o.centerSprite=new ae.g(a),o.centerSprite.anchor.x=.5,o.centerSprite.anchor.y=.5,o.centerSprite.scale=ue(new w(.5,.5)),o.centerSprite.zIndex=1,o.centerSprite.alpha=0,o.halfwayCenterSprite=new ae.g(a),o.halfwayCenterSprite.anchor.x=.5,o.halfwayCenterSprite.anchor.y=.5,o.halfwayCenterSprite.scale=ue(new w(.75,.75)),o.halfwayCenterSprite.zIndex=0,o.halfwayCenterSprite.alpha=0,o.container.interactive=!0,o.container.buttonMode=!0,o.hitArea=new ae.e(-me.NODE_HITAREA_PX/2,-me.NODE_HITAREA_PX/2,me.NODE_HITAREA_PX,me.NODE_HITAREA_PX),o.container.hitArea=o.hitArea,o}return Object(h.a)(n,[{key:"updateSelf",value:function(e){var t="Nothing (empty node)";e.pointNodeGen.nodeType===O.EfficiencyGate?t="Unlocks at 300 Mana0 in 14 or fewer allocations":e.pointNodeGen.nodeType!==O.Nothing&&(t="".concat(e.pointNodeGen.resourceAmount," ").concat(e.pointNodeGen.resourceModifier," ").concat(e.pointNodeGen.resourceType)),this.state.descriptionText=t}},{key:"renderSelf",value:function(e){var t,n,i;this.container.position=ue(e.args.position),e.isSelected?(n=G.selectedTint,i=G.selectedTint):(n=G.nullTint,i=G.nullTint),e.isAllocated&&(n=G.allocatedTint);var r=0,o=0;e.pointNodeGen.nodeType===O.Nothing?r=G.nodeBlue:e.pointNodeGen.nodeType===O.EfficiencyGate?(r=G.nodeAqua,o=b(G.nodeAqua,G.gateTint)):e.pointNodeGen.resourceType===m.Mana0&&(e.pointNodeGen.resourceModifier===S.Flat?r=G.nodePink:e.pointNodeGen.resourceModifier===S.Increased0&&(r=G.nodeLavender)),this.sprite.tint=b(r,n),this.centerSprite.tint=b(r,i),this.topHalfSprite.tint=b(o,n);var a=Math.floor(9*Math.random())/8-.001;this.topHalfSprite.texture=null===(t=e.args.pointNodeTexture.find((function(e){return e.cropFraction>=a})))||void 0===t?void 0:t.texture,e.selfPointNodeRef.pointNodeCoord.equals(w.Zero)&&(this.container.scale=ue(new w(1.25,1.25)))}},{key:"shouldUpdate",value:function(e,t,n,i){var r,o=Object(k.a)(Object.keys(e));try{for(o.s();!(r=o.n()).done;){var a=r.value;if("delta"!==a&&"args"!==a&&"updaters"!==a){if(e[a]!==n[a])return console.log("node shouldUpdate differed in ".concat(a,", returning true")),!0;var c,u;if("selfPointNodeRef"!==a);else if((null===(c=e[a])||void 0===c?void 0:c.hash())!==(null===(u=n[a])||void 0===u?void 0:u.hash()))return console.log("node shouldUpdate differed in ".concat(a,", returning true")),!0}}}catch(s){o.e(s)}finally{o.f()}return!1}},{key:"didMount",value:function(){var e=this,t=this._staleProps.updaters;this.container.addListener("pointerdown",(function(n){e._staleProps.args.markForceUpdate(e),e.state.numClicks++,we(t,e._staleProps.selfPointNodeRef)})),this.container.addListener("pointerover",(function(t){var n=t.data.getLocalPosition(e.container),i=new w(e.container.worldTransform.tx,e.container.worldTransform.ty);e._staleProps.tooltipUpdaters.enqueueUpdate((function(t){return Object(z.a)(Object(z.a)({},t),{},{visible:!0,text:e.state.descriptionText,position:i.add(n)})}))})),this.container.addListener("pointerout",(function(t){e._staleProps.tooltipUpdaters.enqueueUpdate((function(e){return Object(z.a)(Object(z.a)({},e),{},{visible:!1,text:""})}))})),this.container.addListener("pointermove",(function(t){var n=t.data.getLocalPosition(e.container),i=new w(e.container.worldTransform.tx,e.container.worldTransform.ty);e._staleProps.tooltipUpdaters.position.enqueueUpdate(i.add(n))}))}},{key:"toString",value:function(){return"PointNodeCompoent "+this._staleProps.selfPointNodeRef.toString()}}]),n}(pe)),me=function e(){Object(d.a)(this,e)};me.SPACING_PX=36,me.CHUNK_SPACING_PX=(_.CHUNK_DIM+0)*me.SPACING_PX,me.NODE_SIZE_PX=22,me.NODE_HITAREA_PX=me.NODE_SIZE_PX+4,me.NODE_ROUNDED_PX=4;ye(function(e){Object(E.a)(n,e);var t=Object(A.a)(n);function n(e){var i;return Object(d.a)(this,n),(i=t.call(this,e)).container=void 0,i.state=void 0,i.children=void 0,i.state={},i.container=new ae.b,i.children=new H,i.resyncChildren(e),i}return Object(h.a)(n,[{key:"renderSelf",value:function(e){this.container.position=ue(e.position)}},{key:"shouldUpdate",value:function(e,t,n,i){var r,o=Object(k.a)(Object.keys(e));try{for(o.s();!(r=o.n()).done;){var a=r.value;if("delta"!==a&&"args"!==a&&"updaters"!==a){if("position"===a){if(e[a].equals(n[a]))continue;return console.log("chunk shouldUpdate differed in ".concat(a,", returning true")),!0}var c,u;if("selectedPointNode"!==a)if("selfChunkRef"!==a){if("allocatedPointNodeSubset"===a){if(e[a].equals(n[a]))continue;return console.log("chunk shouldUpdate differed in ".concat(a,", returning true")),!0}if(e[a]!==n[a])return console.log("chunk shouldUpdate differed in ".concat(a,", returning true")),!0}else{var s,l;if((null===(s=e[a])||void 0===s?void 0:s.hash())!==(null===(l=n[a])||void 0===l?void 0:l.hash()))return console.log("chunk shouldUpdate differed in ".concat(a,", returning true")),!0}else if((null===(c=e[a])||void 0===c?void 0:c.hash())!==(null===(u=n[a])||void 0===u?void 0:u.hash()))return console.log("chunk shouldUpdate differed in ".concat(a,", returning true")),!0}}}catch(d){o.e(d)}finally{o.f()}return!1}},{key:"resyncChildren",value:function(e){var t=this,n=this.children.clone();console.log("chunk component upsert children got here");var i,r=Object(k.a)(e.chunkGen.pointNodes.entries());try{var o=function(){var r=Object(u.a)(i.value,2),o=r[0],a=r[1],c=new N({z:e.selfChunkRef.z,chunkCoord:e.selfChunkRef.chunkCoord,pointNodeCoord:o,pointNodeId:a.id}),s=function(e,n){var i;return{delta:e.delta,args:{pointNodeTexture:e.args.pointNodeTexture,markForceUpdate:t.markForceUpdate,position:c.pointNodeCoord.multiply(me.SPACING_PX)},selfPointNodeRef:c,updaters:e.updaters,tooltipUpdaters:e.tooltipUpdaters,pointNodeGen:a,isSelected:(null===(i=e.selectedPointNode)||void 0===i?void 0:i.pointNodeId)===c.pointNodeId,isAllocated:e.allocatedPointNodeSubset.contains(c)}},l=c,d=t.children.get(l);d?n.remove(l):(d=new Oe(s(e,t.state)),t.children.put(c,d),t.addChild({childClass:Oe,instance:d,propsFactory:s}))};for(r.s();!(i=r.n()).done;)o()}catch(h){r.e(h)}finally{r.f()}console.log("chunk component to delete has ".concat(n.size()," children"));var a,c=Object(k.a)(n.entries());try{for(c.s();!(a=c.n()).done;){var s=Object(u.a)(a.value,2),l=s[0],d=s[1];this.children.remove(l),this.removeChild(d)}}catch(h){c.e(h)}finally{c.f()}}},{key:"updateChildren",value:function(e){this.resyncChildren(e)}},{key:"didForceUpdateChild",value:function(e){this.container.removeChild(e.container),this.container.addChild(e.container)}}]),n}(pe));var Se=function(){function e(t){Object(d.a)(this,e),this._wasConstructed=!1,this._value=void 0,this._factory=void 0,this._factory=t}return Object(h.a)(e,[{key:"get",value:function(){return void 0!==this._value||!0===this._wasConstructed||(this._value=this._factory(),this._wasConstructed=!0),this._value}},{key:"wasConstructed",value:function(){return this._wasConstructed}}]),e}();var je=function(){function e(t){Object(d.a)(this,e),this._values=void 0,this._factory=void 0,this._values=new M,this._factory=t}return Object(h.a)(e,[{key:"put",value:function(e,t){this._values.put(e,t)}},{key:"peek",value:function(e){return this._values.get(e)}},{key:"get",value:function(e){if(this._values.contains(e))return this._values.get(e);var t=this._factory(e);return this._values.put(e,t),t}},{key:"precompute",value:function(e){if(!this._values.contains(e)){var t=this._factory(e);this._values.put(e,t)}}},{key:"contains",value:function(e){return this._values.contains(e)}},{key:"values",value:function(){return this._values.values()}},{key:"size",value:function(){return this._values.size()}},{key:"clone",value:function(){var t=new e(this._factory);return t._values=this._values.clone(),t}}]),e}(),Ne=ye(function(e){Object(E.a)(n,e);var t=Object(A.a)(n);function n(e){var i;return Object(d.a)(this,n),(i=t.call(this,e)).container=void 0,i.state=void 0,i.container=new ae.b,i.container.sortableChildren=!0,i.state={},i}return Object(h.a)(n,[{key:"renderSelf",value:function(e){}}]),n}(pe)),_e=ye(function(e){Object(E.a)(n,e);var t=Object(A.a)(n);function n(e){var i;Object(d.a)(this,n),(i=t.call(this,e)).container=void 0,i.state=void 0,i.stateUpdaters=void 0,i.fireStateUpdaters=void 0,i.fixedCameraStage=void 0,i.actionStage=void 0,i.backdropStage=void 0,i.backdrop=void 0,i.container=new ae.b,i.container.sortableChildren=!0;var r=i.useState(Object(ce.a)(i),{pointNodeTexture:new Se((function(){return function(e){for(var t=[],n=0;n<=8;n++){var i=n/8,r=new ae.c;r.beginFill(G.white),r.drawRoundedRect(-me.NODE_SIZE_PX/2,-me.NODE_SIZE_PX/2,me.NODE_SIZE_PX,me.NODE_SIZE_PX,me.NODE_ROUNDED_PX);var o=new ae.c;o.beginFill(G.black),o.drawRect(-me.NODE_SIZE_PX/2,-me.NODE_SIZE_PX/2,me.NODE_SIZE_PX,me.NODE_SIZE_PX*i),r.mask=o;var a=e.generateTexture(r,ae.f.LINEAR,1);t.push({cropFraction:i,texture:a})}return t}(e.args.renderer)})),tick:0,playerCurrentZ:0,tooltip:{visible:!1,position:void 0,text:""}});i.state=r.state,i.stateUpdaters=r.stateUpdaters,i.fireStateUpdaters=r.fireStateUpdaters;var o=function(e,t){return{args:{renderer:e.args.renderer,markForceUpdate:i.markForceUpdate},delta:e.delta,gameState:e.gameState,appSize:e.appSize,tick:t.tick,tooltip:Object(z.a)({},t.tooltip)}};return i.fixedCameraStage=new Ne(o(e,i.state)),i.addChild({childClass:Ne,instance:i.fixedCameraStage,propsFactory:o}),i.actionStage=new ae.g,i.actionStage.zIndex=0,i.actionStage.sortableChildren=!0,i.container.addChild(i.actionStage),i.backdropStage=new ae.g,i.backdropStage.zIndex=-1,i.backdropStage.sortableChildren=!0,i.container.addChild(i.backdropStage),i.backdrop=new ae.c,i.backdropStage.addChild(i.backdrop),i.backdrop.beginFill(G.backgroundBlue,1),i.backdrop.interactive=!0,i.backdrop.drawRect(0,0,e.appSize.x,e.appSize.y),i}return Object(h.a)(n,[{key:"updateSelf",value:function(e){this.state.tick++}},{key:"renderSelf",value:function(e){this.backdrop.width=e.appSize.x,this.backdrop.height=e.appSize.y}},{key:"didMount",value:function(){this._staleProps.updaters}},{key:"didUpdate",value:function(){this._staleProps.updaters}}]),n}(pe));var Te=function(){function e(t){var n;Object(d.a)(this,e),this.app=void 0,this.state=void 0,this.props=void 0,this.rootComponent=void 0,this.onTick=void 0,null===t||void 0===t||null===(n=t.args)||void 0===n||n.isSecondConstructorCall;var i=new w(800,600);this.state={appSize:i,originalAppSize:i},this.app=new ae.a({width:this.state.appSize.x,height:this.state.appSize.y,antialias:!0,transparent:!0,resolution:window.devicePixelRatio||1,autoDensity:!0,powerPreference:"low-power",backgroundColor:G.white})}return Object(h.a)(e,[{key:"pause",value:function(){this.app.ticker.remove(this.onTick)}},{key:"destroy",value:function(){this.app.destroy(!0,{children:!0,texture:!0,baseTexture:!0})}},{key:"didMount",value:function(){var e=this;this.onTick=function(t){return e.baseGameLoop(t)},this.onTick=this.onTick.bind(this),this.app.ticker.add(this.onTick)}},{key:"register",value:function(e){e.appendChild(this.app.view)}},{key:"updateSelf",value:function(e){this.state.appSize=function(e){return new w({x:Math.min(1920,((null===e||void 0===e?void 0:e.x)||1/0)-24),y:Math.min(1080,((null===e||void 0===e?void 0:e.y)||1/0)-24)})}(new w(e.gameState.windowState.innerWidth,e.gameState.windowState.innerHeight)),e.updaters.tick.enqueueUpdate((function(e){return e+1}))}},{key:"rerender",value:function(e){this.props=e,this.rootComponent||(this.rootComponent=new _e({args:{renderer:this.app.renderer,markForceUpdate:function(){}},updaters:this.props.updaters,delta:0,gameState:this.props.gameState,appSize:this.state.appSize}),this.app.stage.addChild(this.rootComponent.container),this.renderSelf(this.props),this.didMount())}},{key:"renderSelf",value:function(e){this.app.renderer.resize(this.state.appSize.x,this.state.appSize.y)}},{key:"baseGameLoop",value:function(e){var t;if(this.props.gameState.playerUI.isPixiHidden)return this.updateSelf(this.props),void this.props.args.fireBatch();this.updateSelf(this.props),null===(t=this.rootComponent)||void 0===t||t.update({args:{renderer:this.app.renderer,markForceUpdate:function(){}},updaters:this.props.updaters,delta:e,gameState:this.props.gameState,appSize:this.state.appSize}),this.renderSelf(this.props),this.props.args.fireBatch()}}]),e}(),Ce=new Se((function(){return new Te}));function Ie(e){var t=Object(r.useState)(Ce.get()),n=Object(u.a)(t,2),o=n[0],a=(n[1],Object(r.useRef)(null)),c=Object(r.useContext)(oe),s=Object(u.a)(c,3),l=s[0],d=s[1],h=s[2];return Object(r.useEffect)((function(){for(var e=a.current.childNodes.length-1;e>=0;e--)a.current.removeChild(a.current.childNodes[e]);a.current.appendChild(o.app.view)}),[o]),o.rerender({args:{fireBatch:h,isSecondConstructorCall:!1},updaters:d,gameState:l}),Object(i.jsx)(i.Fragment,{children:Object(i.jsx)("div",{ref:a,hidden:e.hidden,style:{}})})}var Ee=n(125);"Mobile Safari"===(new(n.n(Ee).a)).getBrowser().name&&(window.innerWidth,window.innerHeight);var Ae=function(e){Object(E.a)(n,e);var t=Object(A.a)(n);function n(e){var i;return Object(d.a)(this,n),(i=t.call(this,e)).handleWindowResize=function(e){i.props.updaters.enqueueUpdate((function(e){return e.innerWidth=window.innerWidth,e.innerHeight=window.innerHeight,Object(z.a)({},e)}))},i.state={},window.addEventListener("resize",i.handleWindowResize),i}return Object(h.a)(n,[{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.handleWindowResize)}},{key:"render",value:function(){return Object(i.jsx)(i.Fragment,{children:" "})}}]),n}(o.a.Component),ze=n(7),Ue=function(){function e(t){Object(d.a)(this,e),this.config=void 0,this.chunkGenFactory=void 0,this.config=t,this.chunkGenFactory=new Me({})}return Object(h.a)(e,[{key:"create",value:function(e){for(var t=Object(ze.b)(e.seed+e.z),n=new H,i=e.startingChunks||3,r=-i;r<=i;r++)for(var o=-i;o<=i;o++){var a=new w(r,o);n.put(a,this.chunkGenFactory.create({seed:t,location:a,z:e.z}))}return{id:t,chunks:n}}}]),e}(),Me=function(){function e(t){Object(d.a)(this,e),this.config=void 0,this.pointNodeGenFactory=void 0,this.config=t,this.pointNodeGenFactory=new He({})}return Object(h.a)(e,[{key:"create",value:function(e){for(var t=Object(ze.b)(e.seed+Object(ze.b)(e.seed+e.location.x)+e.location.y),n=new H,i=new U,r=-_.CHUNK_HALF_DIM;r<=_.CHUNK_HALF_DIM;r++)for(var o=-_.CHUNK_HALF_DIM;o<=_.CHUNK_HALF_DIM;o++)0===r&&0===o||Object(ze.b)(t+r*_.CHUNK_DIM+o)/ze.a<_.DROP_NODES_CHANCE/4&&(i.put(new w(r,o)),i.put(new w(o,-r)),i.put(new w(-r,-o)),i.put(new w(-o,r)));for(var a=-_.CHUNK_HALF_DIM;a<=_.CHUNK_HALF_DIM;a++)for(var c=-_.CHUNK_HALF_DIM;c<=_.CHUNK_HALF_DIM;c++){var u=new w(a,c);i.get(u)||n.put(u,this.pointNodeGenFactory.create({seed:t,location:u,chunk:e.location,z:e.z}))}return{id:t,pointNodes:n}}}]),e}(),He=function(){function e(t){Object(d.a)(this,e),this.config=void 0,this.config=t}return Object(h.a)(e,[{key:"create",value:function(e){var t,n=Object(ze.b)(e.seed+Object(ze.b)(e.seed+e.location.x)+e.location.y),i=Object(ze.b)(n+1)/ze.a,r=m.Mana2,o=O.Nothing;i<0?o=O.Nothing:i<.15?(o=O.Basic,r=m.Mana0):i<.35?(o=O.EfficiencyGate,r=m.Mana0):i<-.35?(o=O.Basic,r=m.Mana1):i<-.6?(o=O.Basic,r=m.Mana2):o=O.Nothing,e.location.equals(w.Zero)&&e.chunk.equals(w.Zero)&&0===e.z&&(o=O.Nothing);var a=0;if((t=(i=Object(ze.b)(n+2)/ze.a)<.55?S.Flat:i<-.7?S.AfterIncreased0:i<-.7?S.AfterIncreased1:i<1.95?S.Increased0:S.Increased1)===S.Flat||t===S.AfterIncreased0||t===S.AfterIncreased1?(i=Math.floor(Object(ze.b)(n+3)/ze.a*4),i+=Math.floor(Object(ze.b)(n+4)/ze.a*4),a=20*(i+=Math.floor(Object(ze.b)(n+5)/ze.a*4))+60):(i=Math.floor(Object(ze.b)(n+3)/ze.a*2),i+=Math.floor(Object(ze.b)(n+4)/ze.a*2),i+=Math.floor(Object(ze.b)(n+5)/ze.a*2),a=(i+=Math.floor(Object(ze.b)(n+6)/ze.a*3))+3),o===O.Nothing)return{id:n,nodeType:o};if(o===O.EfficiencyGate){return{id:n,resourceAmount:a,resourceModifier:t,resourceType:r,nodeType:o,efficiencyGateInfo:{thresholdResourceAmount:300,thresholdResourceType:m.Mana0,timeUntilLocked:14}}}return{id:n,resourceAmount:a,resourceModifier:t,resourceType:r,nodeType:o}}}]),e}(),Pe=function(){function e(t){Object(d.a)(this,e),this.config=void 0,this.config=t}return Object(h.a)(e,[{key:"create",value:function(e){var t=Object(ze.b)(e.seed+e.location.x+e.location.y+Object(ze.b)(e.seed+e.location.x+e.location.z)),n={shortTextTarget:"1\ud83d\udfe2",shortTextTimer:"2\u231b",lockStatus:X.TICKING};if(t%2===0)return n}}]),e}(),De=function(){function e(t){Object(d.a)(this,e),this.config=void 0,this.config=t}return Object(h.a)(e,[{key:"create",value:function(){var e,t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,i=n||103043,r=new Ue({}).create({seed:i,z:0,startingChunks:0}),o=new w(0,0),a=null===(e=r.chunks.get(o))||void 0===e||null===(t=e.pointNodes.get(o))||void 0===t?void 0:t.id,c=new N({z:0,chunkCoord:o,pointNodeId:a,pointNodeCoord:o}),u={orientation:"original",innerWidth:window.innerWidth,innerHeight:window.innerHeight},s=new Pe({}),l=new je((function(e){return s.create({seed:i,location:e})})),d={tick:0,worldGen:{seed:i,zLevels:{0:r},lockMap:l},playerSave:{activeQuest:void 0,spSpentThisQuest:void 0,questProgressHistory:[],questInitialAmount:0,questsCompleted:[],allocatedPointNodeSet:new U([c]),allocatedPointNodeHistory:[c],score:0,allocationStatusMap:function(){var e=new M;return e.put(L.Zero,W.TAKEN),e}()},playerUI:{selectedPointNode:void 0,activeTab:0,isPixiHidden:!0,virtualGridLocation:new L(0,0,0)},computed:{},intent:{activeIntent:T,newIntent:T,endedIntent:T},windowState:u};d.computed=Object(z.a)({},xe(d));var h=d.playerSave.allocationStatusMap,f=L.Zero;return F(f,3).forEach((function(e){(h.get(e)||W.HIDDEN)===W.HIDDEN&&(d.worldGen.lockMap.precompute(e),h.put(e,W.UNREACHABLE))})),F(f,1).forEach((function(e){h.get(e)===W.UNREACHABLE&&h.put(e,W.AVAILABLE)})),d}}]),e}(),Le=new Se((function(){return new De({}).create()}));var Re=function(){var e=Object(r.useState)((function(){return Le.get()})),t=Object(u.a)(e,2),n=t[0],o=t[1],a=Object(r.useMemo)((function(){return le(o)}),[o]),c=Object(u.a)(a,2),s=c[0],d=c[1],h=Object(r.useMemo)((function(){return fe(Le.get(),s)}),[s]),f=(Object(r.useMemo)((function(){return C(new w(n.windowState.innerWidth,n.windowState.innerHeight))}),[n.windowState.innerWidth,n.windowState.innerHeight]),Object(r.useMemo)((function(){return[n,h,d]}),[n,h,d]));return Object(i.jsxs)("div",{className:l()({App:!0}),children:[Object(i.jsxs)("div",{className:"entire-area",children:[Object(i.jsx)(oe.Provider,{value:f,children:Object(i.jsx)(Ie,{hidden:n.playerUI.isPixiHidden})}),Object(i.jsx)(ee,{gameState:n,updaters:h})]}),Object(i.jsx)("div",{className:"debug-overlay",children:Object(i.jsx)(v,{tick:n.tick,windowState:n.windowState})}),Object(i.jsx)("div",{className:"button-zone",children:Object(i.jsx)("button",{className:"button-pixi-toggle",style:{},onClick:function(){h.playerUI.isPixiHidden.enqueueUpdate((function(e){return!e}))},children:"Toggle pixi"})}),Object(i.jsx)(re,{intent:n.intent,updaters:h.intent}),Object(i.jsx)(Ae,{updaters:h.windowState})]})};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(Object(i.jsx)(o.a.StrictMode,{children:Object(i.jsx)(Re,{})}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},7:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return r}));n(1),n(2),n(47);var i=Math.pow(2,32);function r(e){var t=(e+i)%i;return t=Math.imul(t,3039394381),t^=t>>>8,t+=1759714724,t^=t<<8,t=Math.imul(t,458671337),((t^=t>>>8)+i)%i}}).call(this,n(11).Buffer)}},[[231,1,2]]]);
//# sourceMappingURL=main.0ea33fc2.chunk.js.map