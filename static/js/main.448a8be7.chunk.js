(this["webpackJsonpprocgen-skill-tree"]=this["webpackJsonpprocgen-skill-tree"]||[]).push([[0],{21:function(t,e,i){t.exports=i(38)},26:function(t,e,i){},27:function(t,e,i){},28:function(t,e,i){},38:function(t,e,i){"use strict";i.r(e);var n=i(5),s=i.n(n),r=i(17),a=i.n(r),h=(i(26),i(27),i(28),i(1)),o=i(2),c=i(3),l=i(8),u=function(t,e){return t+1e-7-e>0},d=function(t,e){return t-1e-7-e<0},y=i(0),f=0,v=function(){function t(){Object(h.a)(this,t)}return Object(o.a)(t,null,[{key:"MinBy",value:function(t,e){var i,n=void 0,s=void 0,r=Object(y.a)(t);try{for(r.s();!(i=r.n()).done;){var a=i.value,h=e(a);(void 0===s||h<s)&&(n=a,s=h)}}catch(o){r.e(o)}finally{r.f()}return n}},{key:"MaxBy",value:function(t,e){var i,n=void 0,s=void 0,r=Object(y.a)(t);try{for(r.s();!(i=r.n()).done;){var a=i.value,h=e(a);(void 0===s||h>s)&&(n=a,s=h)}}catch(o){r.e(o)}finally{r.f()}return n}},{key:"RandRange",value:function(t,e){return Math.floor(Math.random()*(e-t)+t)}},{key:"SortByKey",value:function(t,e){return t.sort((function(t,i){return e(t)-e(i)}))}},{key:"ReplaceAll",value:function(t,e){var i=new RegExp(Object.keys(e).join("|"),"gi");return t.replace(i,(function(t){return e[t.toLowerCase()]}))}},{key:"Debounce",value:function(t){var e,i=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{isImmediate:!1},r=function(){for(var r=arguments.length,a=new Array(r),h=0;h<r;h++)a[h]=arguments[h];var o=function(){e=void 0,s.isImmediate||t.apply(i,a)},c=s.isImmediate&&void 0===e;void 0!==e&&clearTimeout(e),e=setTimeout(o,n),c&&t.apply(i,a)};return r}},{key:"FormatDate",value:function(t){var e=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][t.getMonth()];return"".concat(e," ").concat(t.getDate(),", ").concat(("00"+t.getHours()).substr(-2),":").concat(("00"+t.getMinutes()).substr(-2),":").concat(("00"+t.getSeconds()).substr(-2))}},{key:"FlattenByOne",value:function(t){var e,i=[],n=Object(y.a)(t);try{for(n.s();!(e=n.n()).done;){var s=e.value;i=i.concat(s)}}catch(r){n.e(r)}finally{n.f()}return i}},{key:"PadString",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:" ";return t+i+n.repeat(e-t.length)}}]),t}(),g=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{x:0,y:0},i=arguments.length>1?arguments[1]:void 0;Object(h.a)(this,t),this._x=void 0,this._y=void 0,"number"===typeof e?(this._x=e,this._y=i):(this._x=e.x,this._y=e.y)}return Object(o.a)(t,[{key:"x",get:function(){return this._x}},{key:"y",get:function(){return this._y}}]),Object(o.a)(t,[{key:"hash",value:function(){return this.toString()}},{key:"toString",value:function(){return"[".concat(this.x,", ").concat(this.y,"]")}},{key:"invert",value:function(){return new t({x:-this.x,y:-this.y})}},{key:"round",value:function(){return new t({x:Math.round(this.x),y:Math.round(this.y)})}},{key:"floor",value:function(){return new t({x:Math.floor(this.x),y:Math.floor(this.y)})}},{key:"taxicabDistance",value:function(t){return Math.abs(t.x-this.x)+Math.abs(t.y-this.y)}},{key:"diagonalDistance",value:function(t){return Math.max(Math.abs(t.x-this.x),Math.abs(t.y-this.y))}},{key:"distance",value:function(t){var e=Math.abs(t.x-this.x),i=Math.abs(t.y-this.y);return Math.sqrt(e*e+i*i)}},{key:"translate",value:function(e){return new t({x:this.x+e.x,y:this.y+e.y})}},{key:"subtract",value:function(e){return new t({x:this.x-e.x,y:this.y-e.y})}},{key:"add",value:function(e){return new t({x:this.x+e.x,y:this.y+e.y})}},{key:"addX",value:function(e){return new t({x:this.x+e,y:this.y})}},{key:"addY",value:function(e){return new t({x:this.x,y:this.y+e})}},{key:"clampY",value:function(e,i){var n=this.y;return n<e&&(n=e),n>i&&(n=i),new t({x:this.x,y:n})}},{key:"scale",value:function(e,i){return new t({x:(this.x-e.x)*i.x+e.x,y:(this.y-e.y)*i.y+e.y})}},{key:"rotate",value:function(e,i){return i/=180/Math.PI,new t({x:Math.cos(i)*(this.x-e.x)-Math.sin(i)*(this.y-e.y)+e.x,y:Math.sin(i)*(this.x-e.x)+Math.cos(i)*(this.y-e.y)+e.y})}},{key:"equals",value:function(t){return void 0!==t&&(Math.abs(this.x-t.x)<1e-7&&Math.abs(this.y-t.y)<1e-7)}},{key:"multiply",value:function(e){return new t("number"===typeof e?{x:this.x*e,y:this.y*e}:{x:this.x*e.x,y:this.y*e.y})}},{key:"divide",value:function(e){return new t("number"===typeof e?{x:this.x/e,y:this.y/e}:{x:this.x/e.x,y:this.y/e.y})}},{key:"toJSON",value:function(){return{__type:"Vector2",x:this.x,y:this.y}}},{key:"transform",value:function(e,i){return new t({x:Math.floor((this.x-e.x)*i),y:Math.floor((this.y-e.y)*i)})}},{key:"normalize",value:function(){if(0===this.x&&0===this.y)return this;var e=Math.sqrt(this.x*this.x+this.y*this.y);return new t({x:this.x/e,y:this.y/e})}},{key:"withX",value:function(e){return new t({x:e,y:this.y})}},{key:"withY",value:function(e){return new t({x:this.x,y:e})}},{key:"invertX",value:function(){return new t({x:-this.x,y:this.y})}},{key:"lerp",value:function(t,e){return(e>1||e<0)&&console.error("Lerp t must be between 0 and 1."),0===e?this:1===e?t:this.scale({x:0,y:0},{x:1-e,y:1-e}).add(t.scale({x:0,y:0},{x:e,y:e}))}},{key:"lerp2D",value:function(t,e,i){return(e>1||e<0||i>1||i<0)&&console.error("Lerp t must be between 0 and 1."),this.scale({x:0,y:0},{x:1-e,y:1-i}).add(t.scale({x:0,y:0},{x:e,y:i}))}},{key:"coserp",value:function(t,e){return e=.5*(1+Math.cos(2*e*Math.PI)),this.lerp(t,e)}},{key:"half",get:function(){return new t({x:this.x/2,y:this.y/2})}}],[{key:"IsVector2",value:function(e){return e instanceof t}},{key:"Random",value:function(e,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return new t({x:v.RandRange(n,e),y:v.RandRange(s,i)})}},{key:"Deserialize",value:function(e){return e.hasOwnProperty("x")&&e.hasOwnProperty("y")||console.error("Failed deserializing point"),new t({x:e.x,y:e.y})}},{key:"Serialize",value:function(t){return JSON.stringify({x:t.x,y:t.y})}}]),t}();g.Zero=new g(0,0),g.One=new g(1,1);var x,p=function(){function t(e){var i,n,s,r;Object(h.a)(this,t),this._x1=void 0,this._x2=void 0,this._y1=void 0,this._y2=void 0,this.serialized="","x1"in e?(i=e.x1,n=e.x2,s=e.y1,r=e.y2):(i=e.start.x,n=e.end.x,s=e.start.y,r=e.end.y),this._x1=i,this._y1=s,this._x2=n,this._y2=r,this.serialized="".concat(this.x1,"|").concat(this.x2,"|").concat(this.y1,"|").concat(this.y2)}return Object(o.a)(t,[{key:"x1",get:function(){return this._x1}},{key:"x2",get:function(){return this._x2}},{key:"y1",get:function(){return this._y1}},{key:"y2",get:function(){return this._y2}},{key:"start",get:function(){return new g({x:this.x1,y:this.y1})}},{key:"end",get:function(){return new g({x:this.x2,y:this.y2})}},{key:"angleInDegrees",get:function(){var t=this._x1,e=this._y1,i=this._x2,n=this._y2-e,s=i-t,r=Math.atan2(n,s);return(r*=180/Math.PI)<0&&(r=360+r),r}}]),Object(o.a)(t,[{key:"rotateAbout",value:function(e,i){var n=this.start,s=this.end;return new t({start:n.rotate(e,i),end:s.rotate(e,i)})}},{key:"scaleAbout",value:function(e,i){return new t({start:this.start.scale(e,i),end:this.end.scale(e,i)})}},{key:"sharesAVertexWith",value:function(t){return this.start.equals(t.start)||this.start.equals(t.end)?this.start:this.end.equals(t.start)||this.end.equals(t.end)?this.end:null}},{key:"isXAligned",value:function(){return this.x1===this.x2}},{key:"isYAligned",value:function(){return this.y1===this.y2}},{key:"getOverlap",value:function(e){var i=this.x1===this.x2&&this.x1===e.x1&&this.x1===e.x2,n=this.y1===this.y2&&this.y1===e.y1&&this.y1===e.y2;if(i||n){var s=this.length+e.length;if(!(new t({x1:Math.min(this.x1,e.x1),y1:Math.min(this.y1,e.y1),x2:Math.max(this.x2,e.x2),y2:Math.max(this.y2,e.y2)}).length>=s))return new t(i?{x1:this.x1,x2:this.x2,y1:Math.max(this.y1,e.y1),y2:Math.min(this.y2,e.y2)}:{y1:this.y1,y2:this.y2,x1:Math.max(this.x1,e.x1),x2:Math.min(this.x2,e.x2)})}}},{key:"getNonOverlappingSections",value:function(e){var i=this.x1===this.x2&&this.x1===e.x1&&this.x1===e.x2,n=this.y1===this.y2&&this.y1===e.y1&&this.y1===e.y2;if(i||n){var s=new t(this).length+new t(e).length;if(!(new t({x1:Math.min(this.x1,e.x1),y1:Math.min(this.y1,e.y1),x2:Math.max(this.x1,e.x1),y2:Math.max(this.y1,e.y1)}).length>=s))return i?[new t({x1:this.x1,x2:this.x2,y1:Math.min(this.y1,e.y1),y2:Math.max(this.y1,e.y1)}),new t({x1:this.x1,x2:this.x2,y1:Math.min(this.y2,e.y2),y2:Math.max(this.y2,e.y2)})].filter((function(t){return!t.isDegenerate})):[new t({y1:this.y1,y2:this.y2,x1:Math.min(this.x1,e.x1),x2:Math.max(this.x1,e.x1)}),new t({y1:this.y1,y2:this.y2,x1:Math.min(this.x2,e.x2),x2:Math.max(this.x2,e.x2)})].filter((function(t){return!t.isDegenerate}))}}},{key:"clone",value:function(){return new t({x1:this.x1,x2:this.x2,y1:this.y1,y2:this.y2})}},{key:"translate",value:function(e){return new t({x1:this.x1+e.x,x2:this.x2+e.x,y1:this.y1+e.y,y2:this.y2+e.y})}},{key:"transform",value:function(e,i){return new t({start:this.start.transform(e,i),end:this.end.transform(e,i)})}},{key:"toJSON",value:function(){return{x1:this.x1,x2:this.x2,y1:this.y1,y2:this.y2,reviver:"Line"}}},{key:"toString",value:function(){return"Line: [(".concat(this.x1,",").concat(this.y1,") -> (").concat(this.x2,",").concat(this.y2,")]")}},{key:"equals",value:function(t){return null!==t&&(this.x1===t.x1&&this.x2===t.x2&&this.y1===t.y1&&this.y2===t.y2||this.x1===t.x2&&this.x2===t.x1&&this.y1===t.y2&&this.y2===t.y1)}},{key:"withNewEnd",value:function(e){return new t({x1:this.x1,y1:this.y1,x2:e.x,y2:e.y})}},{key:"withNewStart",value:function(e){return new t({x1:e.x,y1:e.y,x2:this.x2,y2:this.y2})}},{key:"drawOnto",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16711680;t.lineStyle(3,e,1),t.moveTo(this.x1,this.y1),t.lineTo(this.x2,this.y2)}},{key:"lineIntersection",value:function(t){var e=this.start,i=this.end,n=t.start,s=t.end,r=((s.x-n.x)*(e.y-n.y)-(s.y-n.y)*(e.x-n.x))/((s.y-n.y)*(i.x-e.x)-(s.x-n.x)*(i.y-e.y)),a=e.x+r*(i.x-e.x),h=e.y+r*(i.y-e.y);return new g({x:a,y:h})}},{key:"segmentIntersection",value:function(t){var e=this.lineIntersection(t),i=e.x,n=e.y;return u(i,Math.min(this.x1,this.x2))&&d(i,Math.max(this.x1,this.x2))&&u(n,Math.min(this.y1,this.y2))&&d(n,Math.max(this.y1,this.y2))&&u(i,Math.min(t.x1,t.x2))&&d(i,Math.max(t.x1,t.x2))&&u(n,Math.min(t.y1,t.y2))&&d(n,Math.max(t.y1,t.y2))?e:null}},{key:"normalize",value:function(){var e=Math.sqrt(Math.pow(this.x1-this.x2,2)+Math.pow(this.y1-this.y2,2));return new t({start:this.start,end:new g({x:this.start.x+(this.end.x-this.start.x)/e,y:this.start.x+(this.end.y-this.start.y)/e})})}},{key:"hash",value:function(){return this.toString()}},{key:"add",value:function(e){return new t({start:this.start.add(e),end:this.end.add(e)})}},{key:"length",get:function(){return Math.sqrt((this.x2-this.x1)*(this.x2-this.x1)+(this.y2-this.y1)*(this.y2-this.y1))}},{key:"isDegenerate",get:function(){return 0===this.length}}],[{key:"DeserializeLine",value:function(e){var i=e.split("|").map((function(t){return Number(t)})),n=Object(l.a)(i,4);return new t({x1:n[0],x2:n[1],y1:n[2],y2:n[3]})}},{key:"Deserialize",value:function(e){return e.hasOwnProperty("x1")&&e.hasOwnProperty("y1")&&e.hasOwnProperty("x2")&&e.hasOwnProperty("y2")||console.error("Failed deserializing Rect"),new t({x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2})}},{key:"Serialize",value:function(t){return JSON.stringify({x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2})}}]),t}(),w=function(){function t(e){Object(h.a)(this,t),this._x=void 0,this._y=void 0,this._width=void 0,this._height=void 0,this._x=e.x,this._y=e.y,this._width=e.width,this._height=e.height}return Object(o.a)(t,[{key:"withRight",value:function(e){return new t({x:this.x,y:this.y,width:e-this.x,height:this.height})}},{key:"withWidth",value:function(e){return new t({x:this.x,y:this.y,width:e,height:this.height})}},{key:"withHeight",value:function(e){return new t({x:this.x,y:this.y,width:this.width,height:e})}},{key:"withBottom",value:function(e){return new t({x:this.x,y:this.y,width:this.width,height:e-this.y})}},{key:"withX",value:function(e){return new t({x:e,y:this.y,width:this.width,height:this.height})}},{key:"withY",value:function(e){return new t({x:this.x,y:e,width:this.width,height:this.height})}},{key:"withTop",value:function(t){return this.withY(t)}},{key:"withLeft",value:function(t){return this.withX(t)}},{key:"withTopLeft",value:function(e){return t.FromPoints(e,this.bottomRight)}},{key:"withTopRight",value:function(e){return t.FromPoints(e,this.bottomLeft)}},{key:"withBottomRight",value:function(e){return t.FromPoints(e,this.topLeft)}},{key:"withBottomLeft",value:function(e){return t.FromPoints(e,this.topRight)}},{key:"withCenter",value:function(e){return new t({x:e.x-this.width/2,y:e.y-this.height/2,width:this.width,height:this.height})}},{key:"withScale",value:function(e){return new t({x:this.centerX-(e.width||this.width)/2,y:this.centerY-(e.height||this.height)/2,width:e.width||this.width,height:e.height||this.height})}},{key:"x",get:function(){return this._x}},{key:"y",get:function(){return this._y}},{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"centerX",get:function(){return this._x+this._width/2}},{key:"centerY",get:function(){return this._y+this._height/2}},{key:"right",get:function(){return this._x+this._width}},{key:"bottom",get:function(){return this._y+this._height}},{key:"top",get:function(){return this._y}},{key:"left",get:function(){return this._x}},{key:"center",get:function(){return new g({x:this.x+this.width/2,y:this.y+this.height/2})}},{key:"dimensions",get:function(){return new g({x:this.width,y:this.height})}},{key:"topLeft",get:function(){return new g({x:this.x,y:this.y})}},{key:"topRight",get:function(){return new g({x:this.right,y:this.y})}},{key:"bottomRight",get:function(){return new g({x:this.right,y:this.bottom})}},{key:"bottomLeft",get:function(){return new g({x:this.x,y:this.bottom})}}],[{key:"FromPoint",value:function(e,i){return new t({x:e.x,y:e.y,width:i,height:i})}},{key:"FromPoints",value:function(e,i){return new t({x:Math.min(e.x,i.x),y:Math.min(e.y,i.y),width:Math.abs(e.x-i.x),height:Math.abs(e.y-i.y)})}},{key:"FromCenter",value:function(e){return new t({x:e.center.x-e.dimensions.x/2,y:e.center.y-e.dimensions.y/2,width:e.dimensions.x,height:e.dimensions.y})}}]),Object(o.a)(t,[{key:"getLinesFromRect",value:function(){return[new p({x1:this.x,y1:this.y,x2:this.x+this.width,y2:this.y}),new p({x1:this.x,y1:this.y,x2:this.x,y2:this.y+this.height}),new p({x1:this.x+this.width,y1:this.y+this.height,x2:this.x+this.width,y2:this.y}),new p({x1:this.x+this.width,y1:this.y+this.height,x2:this.x,y2:this.y+this.height})]}},{key:"getCorners",value:function(){return[new g({x:this.x,y:this.y}),new g({x:this.x+this.width,y:this.y}),new g({x:this.x,y:this.y+this.height}),new g({x:this.x+this.width,y:this.y+this.height})]}},{key:"serialize",value:function(){return"".concat(this.x,"|").concat(this.y,"|").concat(this.width,"|").concat(this.height)}},{key:"intersects",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{edgesOnlyIsAnIntersection:!1},i=this.getIntersection(t,!0);return e.edgesOnlyIsAnIntersection?!!i&&(i.width>0||i.height>0):!!i&&i.width*i.height>0}},{key:"completelyContains",value:function(t){return this.x<=t.x&&this.x+this.width>=t.x+t.width&&this.y<=t.y&&this.y+this.height>=t.y+t.height}},{key:"getIntersection",value:function(e){var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=Math.max(this.x,e.x),s=this.x+this.width,r=e.x+e.width,a=Math.min(s,r);if(a>n||i&&a>=n){var h=Math.max(this.y,e.y),o=this.y+this.height,c=e.y+e.height,l=Math.min(o,c);if(l>=h||i&&l>=h)return new t({x:n,y:h,width:a-n,height:l-h})}}},{key:"contains",value:function(t){return t.x>=this.x&&t.x<this.x+this.width&&t.y>=this.y&&t.y<this.y+this.height}},{key:"clone",value:function(){return new t({x:this.x,y:this.y,width:this.width,height:this.height})}},{key:"add",value:function(t){return this.translate(t)}},{key:"subtract",value:function(t){return this.translate({x:-t.x,y:-t.y})}},{key:"translate",value:function(e){return new t({x:this.x+e.x,y:this.y+e.y,width:this.width,height:this.height})}},{key:"scale",value:function(e){return new t({x:this.x,y:this.y,width:this.width*e.x,height:this.height*e.y})}},{key:"centeredAtOrigin",value:function(){return new t({x:-this.width/2,y:-this.height/2,width:this.width,height:this.height})}},{key:"equals",value:function(t){return!!t&&(this.x===t.x&&this.y===t.y&&this.width===t.width&&this.height===t.height)}},{key:"toJSON",value:function(){return{x:this.x,y:this.y,w:this.width,h:this.height,reviver:"Rect"}}},{key:"hash",value:function(){return this.toString()}},{key:"extend",value:function(e){return new t({x:this.x,y:this.y,width:this.width+e,height:this.height+e})}},{key:"shrink",value:function(e){return new t({x:this.x+e,y:this.y+e,width:Math.max(this.width-2*e,0),height:Math.max(this.height-2*e,0)})}},{key:"floor",value:function(){return new t({x:Math.floor(this.x),y:Math.floor(this.y),width:Math.floor(this.width),height:Math.floor(this.height)})}},{key:"expand",value:function(t){return this.shrink(-t)}},{key:"transform",value:function(e,i){var n=this.topLeft.transform(e,i),s=this.bottomRight.transform(e,i);return new t({x:n.x,y:n.y,width:s.x-n.x,height:s.y-n.y})}},{key:"toString",value:function(){return"[".concat(this.x,", ").concat(this.y,"]")}}],[{key:"DeserializeRect",value:function(e){var i=e.split("|").map((function(t){return Number(t)})),n=Object(l.a)(i,4);return new t({x:n[0],y:n[1],width:n[2],height:n[3]})}},{key:"Deserialize",value:function(e){return e.hasOwnProperty("x")&&e.hasOwnProperty("y")&&e.hasOwnProperty("w")&&e.hasOwnProperty("h")||console.error("Failed deserializing Rect"),new t({x:e.x,y:e.y,width:e.w,height:e.h})}},{key:"Serialize",value:function(t){return JSON.stringify({x:t.x,y:t.y,w:t.width,h:t.height})}}]),t}(),b=function(){function t(e,i){Object(h.a)(this,t),this._first=void 0,this._second=void 0,this._first=e,this._second=i}return Object(o.a)(t,[{key:"hash",value:function(){return"".concat(this._first.hash(),"|").concat(this._second.hash())}},{key:"first",get:function(){return this._first}},{key:"second",get:function(){return this._second}}]),t}(),m=function(){function t(e,i,n){Object(h.a)(this,t),this.config={containerHeightProportion:.9,aspectRatio1:1.6,aspectRatio3:1.6,downscaleRatio12:.75,downscaleRatio23:.35,circleSize:6,circleOnColor:197379,circleOffColor:13553358,circleHoverColor:0,circleFillColor:13882323,borderOffColor:15724527,borderOnColor:12377788,borderThickness:2,centerToEdgeBorderRatio2:1.2,centerToEdgeBorderRatio3:1,cornerCompression1:.08,cornerCompression2:.2,cornerCompression3:.3,debugHasRectBorder:!1,debugRandomOn:!0},this.containerRect=void 0,this.stage=void 0,this.stage=e,this.containerRect=i,this.config=Object.assign({},this.config,n||{})}return Object(o.a)(t,[{key:"drawFirst",value:function(){var t=this.config.debugHasRectBorder,e=this.containerRect.height*this.config.containerHeightProportion,i=this.containerRect.withScale({height:e,width:e*this.config.aspectRatio1});this.drawRect(i,t,this.config.cornerCompression1||0);var n=this.nestRectPair(i,this.config.downscaleRatio12,this.config.aspectRatio2||this.config.aspectRatio1,this.config.centerToEdgeBorderRatio2);this.drawRect(n.first,t,this.config.cornerCompression2||this.config.cornerCompression1||0),this.drawRect(n.second,t,this.config.cornerCompression2||this.config.cornerCompression1||0);var s=new b(this.nestRectPair(n.first,this.config.downscaleRatio23||this.config.downscaleRatio12,this.config.aspectRatio3||this.config.aspectRatio2||this.config.aspectRatio1,this.config.centerToEdgeBorderRatio3||this.config.centerToEdgeBorderRatio2),this.nestRectPair(n.second,this.config.downscaleRatio23||this.config.downscaleRatio12,this.config.aspectRatio3||this.config.aspectRatio2||this.config.aspectRatio1,this.config.centerToEdgeBorderRatio3||this.config.centerToEdgeBorderRatio2));this.drawRect(s.first.first,t,this.config.cornerCompression3||this.config.cornerCompression2||this.config.cornerCompression1||0),this.drawRect(s.second.first,t,this.config.cornerCompression3||this.config.cornerCompression2||this.config.cornerCompression1||0),this.drawRect(s.first.second,t,this.config.cornerCompression3||this.config.cornerCompression2||this.config.cornerCompression1||0),this.drawRect(s.second.second,t,this.config.cornerCompression3||this.config.cornerCompression2||this.config.cornerCompression1||0)}},{key:"nestRectPair",value:function(t,e,i,n){var s=Math.min(t.height,t.width)*e,r=s/i,a=(Math.max(t.height,t.width)-2*r)/(2+n)*n/2+r/2;if(t.height<t.width){var h=s,o=r,c=new g(t.centerX-a,t.centerY),l=new g(t.centerX+a,t.centerY);return new b(w.FromCenter({center:c,dimensions:new g(o,h)}),w.FromCenter({center:l,dimensions:new g(o,h)}))}var u=r,d=s,y=new g(t.centerX,t.centerY-a),f=new g(t.centerX,t.centerY+a);return new b(w.FromCenter({center:y,dimensions:new g(d,u)}),w.FromCenter({center:f,dimensions:new g(d,u)}))}},{key:"drawRect",value:function(t,e,i){var n=this,s=t.withScale({width:t.width-i*(3*t.width+t.height)/4,height:t.height-i*(t.width+3*t.height)/4}),r={left:new g(t.left,t.centerY),right:new g(t.right,t.centerY),top:new g(t.centerX,t.top),bottom:new g(t.centerX,t.bottom)};if(e){var a=new c.c;a.lineStyle(this.config.borderThickness,this.config.borderOffColor,1),a.drawRect(t.x,t.y,t.width,t.height),this.stage.addChild(a)}this.drawLine(s.topLeft,r.left),this.drawLine(s.topLeft,r.top),this.drawLine(s.topRight,r.right),this.drawLine(s.topRight,r.top),this.drawLine(s.bottomLeft,r.left),this.drawLine(s.bottomLeft,r.bottom),this.drawLine(s.bottomRight,r.right),this.drawLine(s.bottomRight,r.bottom),this.drawCorners(s),Object.values(r).map((function(t){return n.drawCircleAt(t)}))}},{key:"drawCorners",value:function(t){this.drawCircleAt(t.topLeft),this.drawCircleAt(t.topRight),this.drawCircleAt(t.bottomLeft),this.drawCircleAt(t.bottomRight)}},{key:"drawLine",value:function(t,e){var i=new c.c;this.config.debugRandomOn&&Math.random()<.5?i.lineStyle(this.config.borderThickness,this.config.borderOnColor,1):i.lineStyle(this.config.borderThickness,this.config.borderOffColor,1),i.moveTo(t.x,t.y),i.lineTo(e.x,e.y),this.stage.addChild(i)}},{key:"drawCircleAt",value:function(t){var e=new c.c;return this.config.debugRandomOn&&Math.random()<.5?e.lineStyle(1,this.config.circleOnColor,1):e.lineStyle(1,this.config.circleOffColor,1),e.beginFill(this.config.circleFillColor,1),e.drawCircle(t.x,t.y,this.config.circleSize),e.endFill(),this.stage.addChild(e),t}}]),t}(),k={canvasWidth:800,canvasHeight:800},_=function(){function t(e,i){Object(h.a)(this,t),this.app=void 0,this.config=void 0,this.renderRects=void 0,this.config=Object.assign({},k,e),this.app=i||new c.a({width:this.config.canvasWidth,height:this.config.canvasHeight,antialias:!0,backgroundColor:16777215}),this.renderRects=new m(this.app.stage,new w({x:0,y:0,width:this.config.canvasWidth,height:this.config.canvasHeight}))}return Object(o.a)(t,[{key:"register",value:function(t){t.appendChild(this.app.view)}},{key:"drawAll",value:function(){}},{key:"moveViewport",value:function(t){}},{key:"drawStart",value:function(){this.renderRects.drawFirst()}},{key:"drawCircle",value:function(){this.renderRects.drawCircleAt(new g(Math.random()*this.config.canvasWidth,Math.random()*this.config.canvasHeight))}}]),t}(),O=i(9),j=i(20),C=i(19);!function(t){t[t.NormalEntity=0]="NormalEntity",t[t.MovingEntity=1]="MovingEntity"}(x||(x={}));var R=function(t){Object(j.a)(i,t);var e=Object(C.a)(i);function i(){var t;Object(h.a)(this,i);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(t=e.call.apply(e,[this].concat(s))).entity=void 0,t}return i}(c.h),M=function(){function t(e){var i,n;if(Object(h.a)(this,t),this.name=void 0,this.activeModes=["Normal"],this.id=f++,this.velocity=g.Zero,this.sprite=void 0,this.hitInfo={hit:!1,collisions:[],interactions:[]},this._collidable=void 0,this._interactable=void 0,this.queuedUpdates=[],this.firstUpdateCalled=!1,this.sprite=new R(e.texture),this.name=e.name,this.sprite.entity=this,this._collidable=null!==(i=e.collidable)&&void 0!==i&&i,this._interactable=null!==(n=e.interactable)&&void 0!==n&&n,e.interactable&&e.collidable)throw new Error("Cant be both interactable and collideable");this.startUpdating(),this.sprite.sortableChildren=!0,this.sprite.anchor.set(0)}return Object(o.a)(t,[{key:"addChild",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.sprite.addChild(t.sprite),null!==e&&(t.x=e),null!==i&&(t.y=i)}},{key:"removeChild",value:function(t){this.sprite.removeChild(t.sprite)}},{key:"startUpdating",value:function(){N.state.entities.put(this)}},{key:"stopUpdating",value:function(){N.state.entities.remove(this)}},{key:"shouldUpdate",value:function(t){return this.activeModes.includes(t.mode)}},{key:"update",value:function(t){}},{key:"firstUpdate",value:function(t){}},{key:"setCollideable",value:function(t){this._collidable=t}},{key:"setTexture",value:function(t){this.sprite.texture=t}},{key:"collisionBounds",value:function(){return new w({x:0,y:0,width:this.width,height:this.height})}},{key:"positionAbsolute",value:function(){var t,e;return!this.parent||this.parent.name!==X&&this.parent.name!==Y&&this.parent.name!==q?this.position.add(null!==(t=null===(e=this.parent)||void 0===e?void 0:e.positionAbsolute())&&void 0!==t?t:new g):this.position}},{key:"children",value:function(){var t,e=this.sprite.children,i=[],n=Object(y.a)(e);try{for(n.s();!(t=n.n()).done;){var s=t.value;s instanceof R&&i.push(s.entity)}}catch(r){n.e(r)}finally{n.f()}return i}},{key:"destroy",value:function(t){t.toBeDestroyed.push(this)}},{key:"hash",value:function(){return"[Entity ".concat(this.id,"]")}},{key:"isCollideable",value:function(){return this._collidable}},{key:"isInteractable",value:function(){return this._interactable}},{key:"dimensions",value:function(){var t=this.collisionBounds();if(t instanceof w)return new g(t.x,t.y);throw new Error("oh no grant doesnt handle this case!!!")}},{key:"baseUpdate",value:function(t){if(this.shouldUpdate(t)){var e,i=Object(y.a)(this.queuedUpdates);try{for(i.s();!(e=i.n()).done;){(0,e.value)(t)}}catch(n){i.e(n)}finally{i.f()}this.firstUpdateCalled||(this.firstUpdateCalled=!0,this.firstUpdate(t)),this.update(t)}this.queuedUpdates=[]}},{key:"addOnClick",value:function(t){var e=this;this.sprite.interactive=!0,this.sprite.on("click",(function(){e.queuedUpdates.push(t)}))}},{key:"addOnMouseOver",value:function(t){var e=this;this.sprite.interactive=!0,this.sprite.on("mouseover",(function(){e.queuedUpdates.push(t)}))}},{key:"addOnMouseOut",value:function(t){var e=this;this.sprite.interactive=!0,this.sprite.on("mouseout",(function(){e.queuedUpdates.push(t)}))}},{key:"distance",value:function(t){return this.position.distance(t)}},{key:"center",get:function(){return new g(this.position).add({x:this.width/2,y:this.height/2})}},{key:"parent",get:function(){var t=this.sprite.parent;if(t instanceof R){var e=t.entity;if(e)return e}return null}},{key:"x",get:function(){return this.sprite.x},set:function(t){this.sprite.x=t}},{key:"y",get:function(){return this.sprite.y},set:function(t){this.sprite.y=t}},{key:"width",get:function(){return this.sprite.width},set:function(t){this.sprite.width=t}},{key:"height",get:function(){return this.sprite.height},set:function(t){this.sprite.height=t}},{key:"alpha",get:function(){return this.sprite.alpha},set:function(t){this.sprite.alpha=t}},{key:"position",get:function(){return new g({x:this.x,y:this.y})},set:function(t){this.x=t.x,this.y=t.y}},{key:"zIndex",get:function(){return this.sprite.zIndex},set:function(t){this.sprite.zIndex=t,this.sprite.parent&&this.sprite.parent.sortChildren()}},{key:"visible",get:function(){return this.sprite.visible},set:function(t){this.sprite.visible=t}},{key:"texture",set:function(t){this.sprite.texture=t}},{key:"mask",set:function(t){this.sprite.mask=t},get:function(){return this.sprite.mask}},{key:"scale",get:function(){return new g({x:this.sprite.scale.x,y:this.sprite.scale.y})},set:function(t){this.sprite.scale.x=t.x,this.sprite.scale.y=t.y}}]),t}(),S=function(){function t(e){Object(h.a)(this,t),this._rects=void 0,this._rects=e}return Object(o.a)(t,[{key:"intersects",value:function(e){if(e instanceof w){var i,n=Object(y.a)(this._rects);try{for(n.s();!(i=n.n()).done;){if(i.value.intersects(e))return!0}}catch(l){n.e(l)}finally{n.f()}return!1}if(e instanceof t){var s,r=Object(y.a)(this._rects);try{for(r.s();!(s=r.n()).done;){var a,h=s.value,o=Object(y.a)(this._rects);try{for(o.s();!(a=o.n()).done;){var c=a.value;if(h.intersects(c))return!0}}catch(l){o.e(l)}finally{o.f()}}}catch(l){r.e(l)}finally{r.f()}return!1}}},{key:"getRects",value:function(){return this._rects}},{key:"add",value:function(e){return new t(this._rects.map((function(t){return t.add(e)})))}},{key:"subtract",value:function(e){return new t(this._rects.map((function(t){return t.subtract(e)})))}}]),t}(),L=!window.location.href.includes("localhost")||window.location.href.includes("debug=false"),A=(!L||window.location.href.includes("debug=true"))&&!window.location.href.includes("debug=false"),D=function(){function t(){Object(h.a)(this,t)}return Object(o.a)(t,null,[{key:"Clear",value:function(){var e,i=Object(y.a)(t.DebugGraphicStack);try{for(i.s();!(e=i.n()).done;){var n=e.value;n.parent.removeChild(n),n.destroy()}}catch(s){i.e(s)}finally{i.f()}t.DebugGraphicStack=[]}},{key:"DrawPoint",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16711680,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];L&&console.error("SHOULD NOT HAPPEN");var n=new c.c;if(new p({x1:t.x-40,x2:t.x+40,y1:t.y-40,y2:t.y+40}).drawOnto(n,e),new p({x1:t.x+40,x2:t.x-40,y1:t.y-40,y2:t.y+40}).drawOnto(n,e),N.stage.sprite.addChild(n),!i&&(this.DebugGraphicStack.push(n),this.DebugGraphicStack.length>500)){var s=this.DebugGraphicStack.shift();s.parent.removeChild(s),s.destroy()}return n}},{key:"DrawLineV2",value:function(e,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:16711680,s=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return L&&console.error("SHOULD NOT HAPPEN"),t.DrawLine(new p({start:e,end:i}),n,s)}},{key:"DrawLine",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16711680,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"fixed";L&&console.error("SHOULD NOT HAPPEN");var s=new c.c;if(t.drawOnto(s,e),"fixed"===n?N.fixedCameraStage.sprite.addChild(s):N.stage.sprite.addChild(s),!i&&(this.DebugGraphicStack.push(s),this.DebugGraphicStack.length>500)){var r=this.DebugGraphicStack.shift();r.parent.removeChild(r),r.destroy()}return s}},{key:"DrawRect",value:function(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16711680,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"fixed";L&&console.error("SHOULD NOT HAPPEN");var r,a=[],h=Object(y.a)(e.getLinesFromRect());try{for(h.s();!(r=h.n()).done;){var o=r.value;a.push(t.DrawLine(o,i,n,s))}}catch(c){h.e(c)}finally{h.f()}return a}},{key:"DrawBounds",value:function(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16711680,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"stage";if(L&&console.error("SHOULD NOT HAPPEN"),e instanceof M&&(e=e.collisionBounds().add(e.positionAbsolute())),e instanceof S){var r,a=[],h=Object(y.a)(e.getRects());try{for(h.s();!(r=h.n()).done;){var o,c=r.value,l=t.DrawRect(c,i,n,s),u=Object(y.a)(l);try{for(u.s();!(o=u.n()).done;){var d=o.value;a.push(d)}}catch(f){u.e(f)}finally{u.f()}}}catch(f){h.e(f)}finally{h.f()}return a}return t.DrawRect(new w({x:e.x,y:e.y,width:e.width,height:e.height}),i,n,s)}},{key:"Profile",value:function(e,i){t.profiles[e]=t.profiles[e]||[];var n=window.performance.now();i();var s=window.performance.now();if(t.profiles[e].push(s-n),60===t.profiles[e].length){var r=t.profiles[e].reduce((function(t,e){return t+e}))/60,a=Math.floor(100*r)/100;t.profiles[e]=[],console.log("".concat(e,": ").concat(a,"ms"))}}},{key:"ResetDrawCount",value:function(){c.h.drawCount=0,c.b.drawCount=0,E=[]}},{key:"GetDrawnObjects",value:function(){return E}},{key:"GetDrawCount",value:function(){return c.h.drawCount+c.b.drawCount}},{key:"DebugStuff",value:function(e){e.keys.justDown.Z&&(t.DebugMode=!0,e.stage.x=0,e.stage.y=0,.2===e.stage.scale.x?e.stage.scale=new g({x:1,y:1}):e.stage.scale=new g({x:.2,y:.2})),t.DebugMode&&(e.keys.down.W&&(e.stage.y+=20),e.keys.down.S&&(e.stage.y-=20),e.keys.down.D&&(e.stage.x-=20),e.keys.down.A&&(e.stage.x+=20))}},{key:"DebugShowRect",value:function(t,e){t.stage.scale=new g({x:.2,y:.2}),t.stage.x=.2*-e.x,t.stage.y=.2*-e.y}}]),t}();D.stageReference=void 0,D.DebugMode=!1,D.DebugGraphicStack=[],D.profiles={};var E=[];A&&(c.h.drawCount=0,c.h.prototype.__render=c.h.prototype._render,c.h.prototype._render=function(t){c.h.drawCount++,this.__render(t),E.push(this)},c.h.prototype.__renderCanvas=c.h.prototype._renderCanvas,c.h.prototype._renderCanvas=function(t){c.h.drawCount++,this.__renderCanvas(t),E.push(this)},c.b.drawCount=0,c.b.prototype.__render=c.b.prototype._render,c.b.prototype._render=function(t){c.b.drawCount++,this.__render(t),E.push(this)},c.b.prototype.__renderCanvas=c.b.prototype._renderCanvas,c.b.prototype._renderCanvas=function(t){c.b.drawCount++,this.__renderCanvas(t),E.push(this)});var T=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];Object(h.a)(this,t),this._values=void 0,this._values=new H;var i,n=Object(y.a)(e);try{for(n.s();!(i=n.n()).done;){var s=i.value;this.put(s)}}catch(r){n.e(r)}finally{n.f()}}return Object(o.a)(t,[{key:"remove",value:function(t){this._values.remove(t)}},{key:"put",value:function(t){this._values.put(t,t)}},{key:"get",value:function(t){return void 0!==this._values.get(t)}},{key:"values",value:function(){return this._values.values()}}]),t}(),H=function(){function t(){Object(h.a)(this,t),this._values={}}return Object(o.a)(t,[{key:"put",value:function(t,e){this._values[t.hash()]=e}},{key:"remove",value:function(t){delete this._values[t.hash()]}},{key:"get",value:function(t){return this._values[t.hash()]}},{key:"values",value:function(){var t=this;return Object.keys(this._values).map((function(e){return t._values[e]}))}}]),t}(),P=function(){function t(e){var i=this;Object(h.a)(this,t),this._position=g.Zero,this._desiredPosition=g.Zero,this._stage=void 0,this._canvasWidth=void 0,this._canvasHeight=void 0,this._currentBounds=void 0,this._immediatelyCenterOn=function(t){i._position=new g(t).subtract(i.halfDimensions())},this.centerOn=function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e?i._immediatelyCenterOn(t):i._desiredPosition=new g(t).subtract(i.halfDimensions())},this.calculateDesiredPosition=function(){var t=i._desiredPosition,e=i._currentBounds;if(!e)return console.error("no region for camera!"),t;if(e.width<i._canvasWidth||e.height<i._canvasHeight)throw new Error("There is a region on the map which is too small for the camera at x: ".concat(e.x," y: ").concat(e.y,"."));return t.x<e.left&&(t=t.withX(e.left)),t.x+i.cameraFrame().width>e.right&&(t=t.withX(e.right-i._canvasWidth)),t.y<e.top&&(t=t.withY(e.top)),t.y+i.cameraFrame().height>e.bottom&&(t=t.withY(e.bottom-i._canvasHeight)),t},this.update=function(e){if(!D.DebugMode){var n=i.calculateDesiredPosition();i._position=i._position.lerp2D(n,t.LERP_SPEED_X,t.LERP_SPEED_Y),i._position=new g(4*Math.floor(i._position.x/4),4*Math.floor(i._position.y/4)),i._stage.x=Math.floor(-i._position.x),i._stage.y=Math.floor(-i._position.y)}},this._stage=e.stage,this._canvasWidth=e.canvasWidth/e.scale,this._canvasHeight=e.canvasHeight/e.scale,this._currentBounds=e.bounds,this._immediatelyCenterOn(new g({x:this._canvasWidth/2,y:this._canvasHeight/2})),this._desiredPosition=this._position}return Object(o.a)(t,[{key:"setBounds",value:function(t){this._currentBounds=t}},{key:"getBounds",value:function(){return this._currentBounds}},{key:"cameraFrame",value:function(){return new w({x:this.center.x-this._canvasWidth/2,y:this.center.y-this._canvasHeight/2,width:this._canvasWidth,height:this._canvasHeight})}},{key:"halfDimensions",value:function(){return new g({x:this._canvasWidth/2,y:this._canvasHeight/2})}},{key:"center",get:function(){return new g({x:this._position.x+this._canvasWidth/2,y:this._position.y+this._canvasHeight/2})}}]),t}();P.LERP_SPEED_X=.03,P.LERP_SPEED_Y=.4;var N,I=i(4),W=function(){function t(e){Object(h.a)(this,t),this._data={},this._makeDefault=void 0,this._count=0,this._makeDefault=e}return Object(o.a)(t,[{key:"getCount",value:function(){return this._count}},{key:"keys",value:function(){for(var t=[],e=0,i=Object.keys(this._data);e<i.length;e++)for(var n=i[e],s=this._data[Number(n)],r=0,a=Object.keys(s);r<a.length;r++){var h=a[r];t.push({x:Number(n),y:Number(h)})}return t}},{key:"values",value:function(){for(var t=[],e=0,i=Object.keys(this._data);e<i.length;e++)for(var n=i[e],s=this._data[Number(n)],r=0,a=Object.keys(s);r<a.length;r++){var h=a[r];t.push(s[Number(h)])}return t}},{key:"set",value:function(t,e,i){this._data[t]||(this._data[t]={}),this._data[t][e]||this._count++,this._data[t][e]=i}},{key:"get",value:function(t,e){return this._data[t]||(this._data[t]={}),void 0===this._data[t][e]&&(this._data[t][e]=this._makeDefault(t,e)),this._data[t][e]}}]),t}(),U=function(){function t(e){var i=this;Object(h.a)(this,t),this._position=g.Zero,this._width=void 0,this._height=void 0,this._cellSize=void 0,this._numCellsPerRow=void 0,this._numCellsPerCol=void 0,this._cells=void 0,this._renderLines=null,this.getRectCollisions=function(t,e){for(var n=[],s=Math.floor(t.x/i._cellSize),r=Math.ceil((t.x+t.width)/i._cellSize),a=Math.floor(t.y/i._cellSize),h=Math.ceil((t.y+t.height)/i._cellSize),o=s;o<r;o++)for(var c=a;c<h;c++)n.push(i._cells.get(o,c));for(var l=[],u=0,d=n;u<d.length;u++){var f,v=d[u],g=Object(y.a)(v.colliders);try{for(g.s();!(f=g.n()).done;){var x=f.value,p=x.rect,w=x.entity;if(w!==e){var b=t.getIntersection(p);b&&l.push({firstRect:p,otherEntity:w,secondRect:t,thisEntity:e,overlap:b})}}}catch(m){g.e(m)}finally{g.f()}}return l},this.getRectGroupCollisions=function(t,e){var n,s=[],r=Object(y.a)(t.getRects());try{for(r.s();!(n=r.n()).done;){var a=n.value;s=[].concat(Object(I.a)(s),Object(I.a)(i.getRectCollisions(a,e)))}}catch(h){r.e(h)}finally{r.f()}return s},this.collidesRectFast=function(t,e){var n,s=t.getCorners().map((function(t){return i._cells.get(Math.floor(t.x/i._cellSize),Math.floor(t.y/i._cellSize))})),r={},a=Object(y.a)(s);try{for(a.s();!(n=a.n()).done;){var h=n.value;r[h.hash()]=h}}catch(g){a.e(g)}finally{a.f()}for(var o=0,c=Object.values(r);o<c.length;o++){var l,u=c[o],d=Object(y.a)(u.colliders);try{for(d.s();!(l=d.n()).done;){var f=l.value,v=f.rect;if(f.entity!==e)if(t.intersects(v))return!0}}catch(g){d.e(g)}finally{d.f()}}return!1},this.collidesPoint=function(t){var e,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=i._cells.get(Math.floor(t.x/i._cellSize),Math.floor(t.y/i._cellSize)),r=[],a=Object(y.a)(s.colliders);try{for(a.s();!(e=a.n()).done;){var h=e.value,o=h.rect,c=h.entity,l=o.contains(t);if(l&&(r.push({firstRect:o,firstEntity:c,secondRect:o,secondEntity:void 0,overlap:t}),n))return r}}catch(u){a.e(u)}finally{a.f()}return r},this.getAllCollisions=function(){var t,e=[],n=Object(y.a)(i.cells);try{for(n.s();!(t=n.n()).done;)for(var s=t.value.colliders,r=0;r<s.length;r++)for(var a=r;a<s.length;a++)if(r!==a){var h=s[r],o=s[a],c=h.rect.getIntersection(o.rect,!1);void 0!==c&&e.push({firstRect:h.rect,secondRect:o.rect,otherEntity:h.entity,thisEntity:o.entity,overlap:c})}}catch(l){n.e(l)}finally{n.f()}return e},this.clear=function(){var t,e=Object(y.a)(i._cells.values());try{for(e.s();!(t=e.n()).done;){t.value.removeAll()}}catch(n){e.e(n)}finally{e.f()}},this.add=function(t,e){for(var n=Math.floor(t.x/i._cellSize),s=Math.floor(t.right/i._cellSize),r=Math.floor(t.y/i._cellSize),a=Math.floor(t.bottom/i._cellSize),h=n;h<=s;h++)for(var o=r;o<=a;o++)i._cells.get(h,o).add(t,e)},this.addRectGroup=function(t,e){var n,s=Object(y.a)(t.getRects());try{for(s.s();!(n=s.n()).done;){var r=n.value;i.add(r,e)}}catch(a){s.e(a)}finally{s.f()}};var n=e.width,s=e.height,r=e.cellSize;this._width=n,this._height=s,this._cellSize=r,this._numCellsPerRow=Math.ceil(n/r),this._numCellsPerCol=Math.ceil(s/r),this._cells=new W((function(t,e){return new F(new g({x:t*r,y:e*r}),r)}))}return Object(o.a)(t,[{key:"debug",value:function(){for(var t=0;t<10;t++)for(var e=0;e<10;e++){D.DrawRect(new w({x:t*this._cellSize,y:e*this._cellSize,width:this._cellSize,height:this._cellSize}),16711680,!0,"fixed");var i,n=Object(y.a)(this._cells.get(t,e).colliders);try{for(n.s();!(i=n.n()).done;){var s=i.value;D.DrawRect(s.rect,16711680,!0,"fixed")}}catch(r){n.e(r)}finally{n.f()}}}},{key:"topLeft",get:function(){return this._position}},{key:"center",get:function(){return this._position.add({x:this._width/2,y:this._height/2})}},{key:"cells",get:function(){return this._cells.values()}}]),t}(),F=function(){function t(e,i){var n=this;Object(h.a)(this,t),this._bounds=void 0,this._rects=[],this.add=function(t,e){n._rects.push({rect:t,entity:e})},this.removeAll=function(){n._rects=[]},this._bounds=w.FromPoint(e,i)}return Object(o.a)(t,[{key:"hash",value:function(){return this._bounds.toString()}},{key:"colliders",get:function(){return this._rects}}]),t}(),z=function t(e){var i=this;if(Object(h.a)(this,t),this._canvasWidth=void 0,this._canvasHeight=void 0,this._tileSize=void 0,this.buildCollisionGrid=function(t){var e,n=t.entities,s=t.bounds,r=new U({width:2*i._canvasWidth,height:2*i._canvasHeight,cellSize:4*i._tileSize}),a=n.values().filter((function(t){return t.isCollideable()||t.isInteractable()})),h=Object(y.a)(a);try{for(h.s();!(e=h.n()).done;){var o=e.value,c=o.collisionBounds().add(o.positionAbsolute());if(c.intersects(s)){var l=c;l instanceof w?r.add(l,o):r.addRectGroup(l,o)}}}catch(u){h.e(u)}finally{h.f()}return r},this.getHitsAt=function(t,e,i){var n=e instanceof w?t.getRectCollisions(e,i):t.getRectGroupCollisions(e,i);return{hits:n.filter((function(t){return!t.otherEntity||t.otherEntity&&!t.otherEntity.isInteractable()})),interactions:n.filter((function(t){return t.otherEntity&&t.otherEntity.isInteractable()}))}},this.resolveCollisions=function(t){var e,n=t.entities,s=t.grid,r=Object(y.a)(n.values());try{for(r.s();!(e=r.n()).done;){var a=e.value,h={hit:!1,collisions:[],interactions:[]};if(0!==a.velocity.x||0!==a.velocity.y){var o=a.collisionBounds().add(a.positionAbsolute()),c=new g({x:a.velocity.x,y:0}),l=new g({x:0,y:a.velocity.y}),u=g.Zero;u=u.add(c),o=o.add(c);var d=i.getHitsAt(s,o,a),f=d.hits,v=d.interactions;if(f.length>0){h.hit=!0,h.right=a.velocity.x>0,h.left=a.velocity.x<0,h.collisions=[].concat(Object(I.a)(h.collisions),Object(I.a)(f)),u=u.subtract(c),o=o.subtract(c);for(var x=0;x<c.x;x++){if(o=o.add(new g(1,0)),u=u.add(new g(1,0)),i.getHitsAt(s,o,a).hits.length>0){o=o.add(new g(-1,0)),u=u.add(new g(-1,0));break}}}v.length>0&&(h.interactions=[].concat(Object(I.a)(h.interactions),Object(I.a)(v))),u=u.add(l),o=o.add(l);var p=i.getHitsAt(s,o,a),w=p.hits,b=p.interactions;if(w.length>0){h.hit=!0,h.up=a.velocity.y<0,h.down=a.velocity.y>0,h.collisions=[].concat(Object(I.a)(h.collisions),Object(I.a)(w)),u=u.subtract(l),o=o.subtract(l);for(var m=0;m<l.y;m++){if(o=o.add(new g(0,1)),u=u.add(new g(0,1)),i.getHitsAt(s,o,a).hits.length>0){o=o.add(new g(0,-1)),u=u.add(new g(0,-1));break}}}b.length>0&&(h.interactions=[].concat(Object(I.a)(h.interactions),Object(I.a)(b))),a.hitInfo=h,h.hit=h.collisions.length>0,a.x=a.x+u.x,a.y=a.y+u.y}}}catch(k){r.e(k)}finally{r.f()}},e.tileWidth!==e.tileHeight)throw new Error("Collision handler does not currently support tileWidth != tileHeight");this._canvasWidth=e.canvasWidth,this._canvasHeight=e.canvasHeight,this._tileSize=e.tileWidth},B=function(){function t(){var e=this;Object(h.a)(this,t),this.down={Q:!1,W:!1,E:!1,R:!1,T:!1,Y:!1,U:!1,I:!1,O:!1,P:!1,A:!1,S:!1,D:!1,F:!1,G:!1,H:!1,J:!1,K:!1,L:!1,Z:!1,X:!1,C:!1,V:!1,B:!1,N:!1,M:!1,Up:!1,Down:!1,Left:!1,Right:!1,Shift:!1,Spacebar:!1,Enter:!1},this.justDown={Q:!1,W:!1,E:!1,R:!1,T:!1,Y:!1,U:!1,I:!1,O:!1,P:!1,A:!1,S:!1,D:!1,F:!1,G:!1,H:!1,J:!1,K:!1,L:!1,Z:!1,X:!1,C:!1,V:!1,B:!1,N:!1,M:!1,Up:!1,Down:!1,Left:!1,Right:!1,Shift:!1,Spacebar:!1,Enter:!1},this.justUp={Q:!1,W:!1,E:!1,R:!1,T:!1,Y:!1,U:!1,I:!1,O:!1,P:!1,A:!1,S:!1,D:!1,F:!1,G:!1,H:!1,J:!1,K:!1,L:!1,Z:!1,X:!1,C:!1,V:!1,B:!1,N:!1,M:!1,Up:!1,Down:!1,Left:!1,Right:!1,Shift:!1,Spacebar:!1,Enter:!1},this._queuedEvents=[],document.addEventListener("keydown",(function(t){return e.keyDown(t)}),!1),document.addEventListener("keyup",(function(t){return e.keyUp(t)}),!1),window.addEventListener("blur",(function(){e.clear()}),!1)}return Object(o.a)(t,[{key:"clear",value:function(){this.down={Q:!1,W:!1,E:!1,R:!1,T:!1,Y:!1,U:!1,I:!1,O:!1,P:!1,A:!1,S:!1,D:!1,F:!1,G:!1,H:!1,J:!1,K:!1,L:!1,Z:!1,X:!1,C:!1,V:!1,B:!1,N:!1,M:!1,Up:!1,Down:!1,Left:!1,Right:!1,Shift:!1,Spacebar:!1,Enter:!1},this.justDown={Q:!1,W:!1,E:!1,R:!1,T:!1,Y:!1,U:!1,I:!1,O:!1,P:!1,A:!1,S:!1,D:!1,F:!1,G:!1,H:!1,J:!1,K:!1,L:!1,Z:!1,X:!1,C:!1,V:!1,B:!1,N:!1,M:!1,Up:!1,Down:!1,Left:!1,Right:!1,Shift:!1,Spacebar:!1,Enter:!1},this.justUp={Q:!1,W:!1,E:!1,R:!1,T:!1,Y:!1,U:!1,I:!1,O:!1,P:!1,A:!1,S:!1,D:!1,F:!1,G:!1,H:!1,J:!1,K:!1,L:!1,Z:!1,X:!1,C:!1,V:!1,B:!1,N:!1,M:!1,Up:!1,Down:!1,Left:!1,Right:!1,Shift:!1,Spacebar:!1,Enter:!1},this._queuedEvents=[]}},{key:"keyUp",value:function(t){this._queuedEvents.push({event:t,isDown:!1})}},{key:"keyDown",value:function(t){this._queuedEvents.push({event:t,isDown:!0})}},{key:"eventToKey",value:function(t){var e,i=t.keyCode||t.which;switch(i){case 13:e="Enter";break;case 16:e="Shift";break;case 37:e="Left";break;case 38:e="Up";break;case 39:e="Right";break;case 40:e="Down";break;default:e=String.fromCharCode(i)}return" "===e?"Spacebar":1===e.length?e.toUpperCase():e[0].toUpperCase()+e.slice(1)}},{key:"update",value:function(){for(var t=0,e=Object.keys(this.justDown);t<e.length;t++){var i=e[t];this.justDown[i]=!1,this.justUp[i]=!1}var n,s=Object(y.a)(this._queuedEvents);try{for(s.s();!(n=s.n()).done;){var r=n.value,a=this.eventToKey(r.event);r.isDown?(this.down[a]||(this.justDown[a]=!0),this.down[a]=!0):(this.down[a]&&(this.justUp[a]=!0),this.down[a]=!1)}}catch(h){s.e(h)}finally{s.f()}this._queuedEvents=[]}}]),t}(),G=function t(){Object(h.a)(this,t),this.camera=void 0,this.keys=void 0,this.renderer=void 0,this.entities=new T,this.toBeDestroyed=[],this.stage=void 0,this.spriteToEntity={},this.mode="Normal",this.lastCollisionGrid=void 0,this.keys=new B},Y="Stage",X="FixedStage",q="ParallaxStage",J=function(){function t(e){var i=this;Object(h.a)(this,t),this.app=void 0,this.state=void 0,this.stage=void 0,this.parallaxStage=void 0,this.fixedCameraStage=void 0,this.assets=void 0,this.renderer=void 0,this.camera=void 0,this.collisionHandler=void 0,this.startGameLoop=function(){i.app.ticker.add((function(){return i.gameLoop()}))},N=this,this.state=Object(O.a)(Object(O.a)({},new G),e.state);var n=document.getElementById("canvas");this.collisionHandler=new z({canvasWidth:e.canvasWidth/e.scale,canvasHeight:e.canvasHeight/e.scale,tileHeight:e.tileHeight,tileWidth:e.tileWidth}),this.app=new c.a({width:e.canvasWidth,height:e.canvasHeight,powerPreference:"low-power",antialias:!1,transparent:!1,resolution:window.devicePixelRatio,autoDensity:!0,backgroundColor:5134169,view:n}),this.app.stage.scale=new c.e(e.scale,e.scale),this.parallaxStage=new M({name:q}),this.stage=new M({name:Y}),this.fixedCameraStage=new M({name:X}),this.state.stage=this.stage,this.app.stage.addChild(this.parallaxStage.sprite),this.app.stage.addChild(this.stage.sprite),this.app.stage.addChild(this.fixedCameraStage.sprite),this.state.renderer=this.app.renderer,this.state.stage=this.stage,this.assets=e.assets,this.assets.onLoadComplete((function(){return i.startGameLoop()})),this.assets.onLoadComplete((function(){return i.initialize()})),this.renderer=this.app.renderer,this.camera=new P({stage:this.stage,state:this.state,canvasWidth:e.canvasWidth,canvasHeight:e.canvasHeight,scale:e.scale,bounds:new w({x:-5e3,y:-5e3,width:1e4,height:1e4})}),this.state.camera=this.camera,this.stage.sprite.sortableChildren=!0,this.fixedCameraStage.sprite.sortableChildren=!0}return Object(o.a)(t,[{key:"initialize",value:function(){}},{key:"gameLoop",value:function(){var t=this;D.Clear();var e=this.state.entities;if(!this.state.lastCollisionGrid){var i=this.collisionHandler.buildCollisionGrid({bounds:new w({x:0,y:0,width:5e3,height:5e3}),entities:this.state.entities});this.state.lastCollisionGrid=i}this.state.tick++,this.state.keys.update();var n,s=Object(y.a)(e.values());try{for(s.s();!(n=s.n()).done;){n.value.baseUpdate(this.state)}}catch(l){s.e(l)}finally{s.f()}this.state.entities=new T(e.values().filter((function(e){return!t.state.toBeDestroyed.includes(e)})));var r,a=Object(y.a)(this.state.toBeDestroyed);try{for(a.s();!(r=a.n()).done;){var h=r.value;h.sprite.parent&&h.sprite.parent.removeChild(h.sprite)}}catch(l){a.e(l)}finally{a.f()}this.state.toBeDestroyed=[];var o=new T(this.state.entities.values().filter((function(e){return e.activeModes.includes(t.state.mode)}))),c=this.collisionHandler.buildCollisionGrid({bounds:this.camera.getBounds(),entities:o});this.state.lastCollisionGrid=c,this.collisionHandler.resolveCollisions({entities:o,grid:c}),this.camera.update(this.state),D.ResetDrawCount()}}]),t}(),Z=function(){function t(){Object(h.a)(this,t),this._data={}}return Object(o.a)(t,[{key:"getCount",value:function(){for(var t=0,e=0,i=Object.keys(this._data);e<i.length;e++){var n=i[e],s=this._data[Number(n)];t+=Object.keys(s).length}return t}},{key:"keys",value:function(){for(var t=[],e=0,i=Object.keys(this._data);e<i.length;e++)for(var n=i[e],s=this._data[Number(n)],r=0,a=Object.keys(s);r<a.length;r++){var h=a[r];t.push({x:Number(n),y:Number(h)})}return t}},{key:"set",value:function(t,e,i){this._data[t]||(this._data[t]={}),this._data[t][e]=i}},{key:"get",value:function(t,e){return this._data[t]?void 0===this._data[t][e]?null:this._data[t][e]:null}},{key:"getOrDefault",value:function(t,e,i){var n=this.get(t,e);return null===n?i:n}}]),t}(),V=function(){function t(){Object(h.a)(this,t)}return Object(o.a)(t,null,[{key:"GetTextureFromSpritesheet",value:function(e){var i=e.resourceName,n=e.x,s=e.y,r=e.tilewidth,a=e.tileheight,h=e.assets,o="".concat(i,"-").concat(n,"-").concat(s);if(!t.Cache[o]){var l=h.getResource(i).clone();l.frame=new c.f(n*r,s*a,r,a),this.Cache[o]=l}return this.Cache[o]}},{key:"GetTextureForTile",value:function(e){var i=e.assets,n=e.tile,s=n.tile,r=s.imageUrlRelativeToGame,a=s.spritesheetx,h=s.spritesheety;return t.GetTextureFromSpritesheet({resourceName:r.slice(0,r.lastIndexOf(".")),x:a,y:h,tilewidth:n.tile.tilewidth,tileheight:n.tile.tileheight,assets:i})}}]),t}();V.Cache={};var K=function(){function t(e){Object(h.a)(this,t),this._layers=void 0,this._customObjects=void 0,this._map=void 0,this._allObjects=[],this._assets=void 0;var i=e.layers,n=e.customObjects,s=e.map;this._assets=e.assets,this._layers=i,this._customObjects=n,this._map=s;var r,a=Object(y.a)(this._layers);try{for(a.s();!(r=a.n()).done;){var o=r.value,c=this.loadLayer(o);this._allObjects=[].concat(Object(I.a)(this._allObjects),Object(I.a)(c))}}catch(l){a.e(l)}finally{a.f()}this.turnOffAllObjects()}return Object(o.a)(t,[{key:"turnOffAllObjects",value:function(){var t,e=Object(y.a)(this._allObjects);try{for(e.s();!(t=e.n()).done;){t.value.entity.stopUpdating()}}catch(i){e.e(i)}finally{e.f()}}},{key:"loadObjectLayers",value:function(){this.turnOffAllObjects();var t,e=[],i=Object(y.a)(this._layers);try{for(i.s();!(t=i.n()).done;){var n=t.value;e.push({entity:new M({name:n.name}),layerName:n.name,objectLayer:!0})}}catch(h){i.e(h)}finally{i.f()}var s,r=Object(y.a)(this._allObjects);try{var a=function(){var t=s.value;e.find((function(e){return e.layerName===t.layerName})).entity.addChild(t.entity),t.entity.startUpdating()};for(r.s();!(s=r.n()).done;)a()}catch(h){r.e(h)}finally{r.f()}return e}},{key:"loadLayer",value:function(t){var e,i=this,n=[],s=[],r=Object(y.a)(t.objects);try{var a=function(){var r=e.value;if(!r.gid){var a,h=Object(y.a)(i._customObjects);try{for(h.s();!(a=h.n()).done;){var o=a.value;if("rect"===o.type&&o.layerName===t.name)return o.process({rect:new w({x:r.x,y:r.y,width:r.width,height:r.height}),properties:Q.ParseTiledProperties(r.properties)}),"continue|processNextObject"}}catch(C){h.e(C)}finally{h.f()}throw new Error("on layer ".concat(t.name," at position x: ").concat(r.x," and y: ").concat(r.y," you have a rect region that's not being processed"))}var c,l=i._map._data.gidInfo(r.gid),u=l.spritesheet,d=l.tileProperties,f=Object(y.a)(r.properties||[]);try{for(f.s();!(c=f.n()).done;){var v=c.value,g=v.name,x=v.value;d[g]=x}}catch(C){f.e(C)}finally{f.f()}var p=Object(O.a)(Object(O.a)({},d),{}),b=null,m={x:r.x,y:r.y-u.tileheight,tile:u,isCollider:i._map._data._gidHasCollision[r.gid]||!1,gid:r.gid,tileProperties:p},k=p.name;if(void 0===k)throw new Error("Custom object needs a tile type");var _=i._customObjects.find((function(t){return"single"===t.type?t.name===k:"group"===t.type&&t.names.includes(k)}));if(void 0===_)throw new Error("Unhandled tile type: ".concat(k));if("single"===_.type){if(_.name===k){var j=V.GetTextureForTile({assets:i._assets,tile:m});b=_.getInstanceType(j,p,{layerName:t.name,x:m.x,y:m.y})}}else"group"===_.type&&_.names.includes(k)&&s.push({name:k,tile:m,gridX:m.x/r.width,gridY:m.y/r.height});b&&(b.x=m.x,b.y=m.y,n.push({entity:b,layerName:t.name}))};for(r.s();!(e=r.n()).done;)a()}catch(q){r.e(q)}finally{r.f()}for(var h=new Z,o=0,c=s;o<c.length;o++){var u=c[o];h.set(u.gridX,u.gridY,{obj:u,grouped:!1})}for(var d=0,f=s;d<f.length;d++){var v=f[d],g=h.get(v.gridX,v.gridY);if(!g)throw new Error("Wat");if(!g.grouped){var x,p=null,b=Object(y.a)(this._customObjects);try{for(b.s();!(x=b.n()).done;){var m=x.value;if("group"===m.type&&m.names.includes(v.name)){p=m;break}}}catch(q){b.e(q)}finally{b.f()}if(null===p)throw new Error("HUH!?!?");for(var k=[v],_=[v];_.length>0;)for(var j=_.pop(),C=0,R=[[1,0],[-1,0],[0,1],[0,-1]];C<R.length;C++){var M=Object(l.a)(R[C],2),S=M[0],L=M[1],A=h.get(j.gridX+S,j.gridY+L);if(A){var D=A.obj;A.grouped||k.includes(D)||p.names.includes(D.name)&&(k.push(D),_.push(D))}}for(var E=0,T=k;E<T.length;E++){var H=T[E];h.get(H.gridX,H.gridY).grouped=!0}for(var P=Number.POSITIVE_INFINITY,N=Number.POSITIVE_INFINITY,I=0,W=k;I<W.length;I++){var U=W[I];P=Math.min(P,U.tile.x),N=Math.min(N,U.tile.y)}var F=p.getGroupInstanceType({layerName:t.name,x:P,y:N});F.x=P,F.y=N;for(var z=0,B=k;z<B.length;z++){var G=B[z],Y=V.GetTextureForTile({assets:this._assets,tile:G.tile}),X=p.getInstanceType(Y);F.addChild(X),X.x=G.tile.x-F.x,X.y=G.tile.y-F.y}n.push({entity:F,layerName:t.name})}}return n}},{key:"getAllObjects",value:function(){return this._allObjects}}]),t}(),Q=function(){function t(e){var i=e.json,n=e.renderer,s=e.pathToTilemap,r=e.customObjects,a=e.assets;Object(h.a)(this,t),this._tileWidth=void 0,this._tileHeight=void 0,this._renderer=void 0,this._objects=void 0,this._assets=void 0,this._data=void 0,this.cache={},this._data=new $({data:i,pathToTilemap:s}),this._renderer=n,this._tileWidth=this._data.getTileWidth(),this._tileHeight=this._data.getTileHeight(),this._assets=a,this._objects=new K({layers:this._data.getAllObjectLayers(),customObjects:r,map:this,assets:null})}return Object(o.a)(t,[{key:"loadRegionLayer",value:function(t){var e=this._data.getLayer(t);if("rects"===e.type)return e.rects;throw new Error("Not a rect layer")}},{key:"loadLayersInRectCached",value:function(t){var e=t.toString();return this.cache[e]||(this.cache[e]=this.loadLayersInRect(t)),this.cache[e]}},{key:"loadLayersInRect",value:function(t){var e,i=[],n=Object(y.a)(this._data.getLayerNames());try{for(n.s();!(e=n.n()).done;){var s=e.value,r=this._data.getLayer(s);if("tiles"===r.type){var a=c.g.create({width:Math.ceil(t.width),height:Math.ceil(t.height)}),h=this._tileWidth,o=this._tileHeight,l=t.x/h,u=t.y/o;if(l!==Math.floor(l)||u!==Math.floor(u))throw new Error("x and y of passed in region aren't divisible by tileWidth/height");for(var d=t.x/h;d<t.right/h;d++)for(var f=t.y/o;f<t.bottom/o;f++){var v=r.grid.get(d,f);if(v){var g=V.GetTextureForTile({assets:this._assets,tile:v}),x=new c.h(g);x.x=v.x-t.x-r.offset.x,x.y=v.y-t.y-r.offset.y,this._renderer.render(x,a,!1)}}var p=new M({texture:a,name:s});p.x=t.x,p.y=t.y,p.width=t.width,p.height=t.height,i.push({entity:p,layerName:s,objectLayer:!1})}}}catch(O){n.e(O)}finally{n.f()}var w,b=this._objects.loadObjectLayers(),m=Object(y.a)(b);try{for(m.s();!(w=m.n()).done;){w.value.entity.zIndex=5}}catch(O){m.e(O)}finally{m.f()}for(var k=0,_=i;k<_.length;k++){_[k].entity.zIndex=0}return i=[].concat(Object(I.a)(i),Object(I.a)(b))}},{key:"turnOffAllObjects",value:function(){this._objects.turnOffAllObjects()}},{key:"getAllObjects",value:function(){return this._objects.getAllObjects()}}],[{key:"ParseTiledProperties",value:function(t){var e={};if(void 0===t)return{};var i,n=Object(y.a)(t);try{for(n.s();!(i=n.n()).done;){var s=i.value;e[s.name]=s.value}}catch(r){n.e(r)}finally{n.f()}return e}}]),t}(),$=function(){function t(e){Object(h.a)(this,t),this._data=void 0,this._tileWidth=void 0,this._tileHeight=void 0,this._layers=void 0,this._tilesets=void 0,this._gidHasCollision={};var i=e.data,n=e.pathToTilemap;this._data=i,this._tileWidth=this._data.tilewidth,this._tileHeight=this._data.tileheight,this._gidHasCollision=this.buildCollisionInfoForTiles(),this._tilesets=this.loadTilesets(n,this._data),this._layers=this.loadTileLayers()}return Object(o.a)(t,[{key:"isGidCollider",value:function(t){return this._gidHasCollision[t]||!1}},{key:"getTileWidth",value:function(){return this._tileWidth}},{key:"getTileHeight",value:function(){return this._tileHeight}},{key:"getTilesets",value:function(){return this._tilesets}},{key:"loadTilesets",value:function(t,e){var i,n=[],s=Object(y.a)(e.tilesets);try{for(s.s();!(i=s.n()).done;){var r=i.value,a=r.image,h=r.name,o=r.firstgid,c=r.imageheight,l=r.imagewidth,u=r.tileheight,d=r.tilewidth,f=r.tiles,v=c*l/(u*d),g=new URL(t+"/"+a,"http://a").href.slice("http://a".length+1);n.push({name:h,imageUrlRelativeToTilemap:a,imageUrlRelativeToGame:g,imagewidth:l,imageheight:c,tilewidth:d,tileheight:u,tiles:f,gidStart:o,gidEnd:o+v})}}catch(x){s.e(x)}finally{s.f()}return n}},{key:"buildCollisionInfoForTiles",value:function(){var t,e={},i=Object(y.a)(this._data.tilesets);try{for(i.s();!(t=i.n()).done;){var n=t.value;if(n.tiles){var s,r=Object(y.a)(n.tiles);try{for(r.s();!(s=r.n()).done;){var a=s.value;a.objectgroup&&(a.objectgroup.objects.length>0&&(e[a.id+n.firstgid]=!0))}}catch(h){r.e(h)}finally{r.f()}}}}catch(h){i.e(h)}finally{i.f()}return e}},{key:"getLayerNames",value:function(){return Object.keys(this._layers)}},{key:"getAllLayers",value:function(){return this._getAllLayersHelper(this._data.layers)}},{key:"getLayer",value:function(t){return this._layers[t]}},{key:"_getAllLayersHelper",value:function(t){var e,i=[],n=Object(y.a)(t);try{for(n.s();!(e=n.n()).done;){var s=e.value;"group"===s.type?i=[].concat(Object(I.a)(i),Object(I.a)(this._getAllLayersHelper(s.layers))):i.push(s)}}catch(r){n.e(r)}finally{n.f()}return i}},{key:"getAllObjectLayers",value:function(){var t,e=this.getAllLayers(),i=[],n=Object(y.a)(e);try{for(n.s();!(t=n.n()).done;){var s=t.value;"objectgroup"===s.type&&i.push(s)}}catch(r){n.e(r)}finally{n.f()}return i}},{key:"loadTileLayers",value:function(){var t,e={},i=this.getAllLayers(),n=Object(y.a)(i);try{for(n.s();!(t=n.n()).done;){var s=t.value;if("tilelayer"===s.type){var r=this.loadTiles(s);e[s.name]={type:"tiles",grid:r,offset:new g(s.offsetx,s.offsety)}}else"objectgroup"===s.type&&(e[s.name]=this.loadRectLayer(s))}}catch(a){n.e(a)}finally{n.f()}return e}},{key:"loadRectLayer",value:function(t){var e,i=t.objects,n=[],s=Object(y.a)(i);try{for(s.s();!(e=s.n()).done;){var r=e.value;r.gid||n.push({rect:new w({x:r.x,y:r.y,width:r.width,height:r.height}),properties:Q.ParseTiledProperties(r.properties)||{}})}}catch(a){s.e(a)}finally{s.f()}return{type:"rects",rects:n,offset:g.Zero}}},{key:"loadTiles",value:function(t){var e,i=new Z,n=t.chunks,s=Object(y.a)(n);try{for(s.s();!(e=s.n()).done;)for(var r=e.value,a=0;a<r.data.length;a++){var h=r.data[a];if(0!==h){if(h>2e5)throw new Error("???");var o=a%r.width,c=Math.floor(a/r.width);isNaN(t.offsetx)&&(t.offsetx=0),isNaN(t.offsety)&&(t.offsety=0);var l=t.offsetx/this._tileWidth,u=t.offsety/this._tileHeight;if(l!==Math.floor(l)||u!==Math.floor(u))throw new Error("AAAAAAAAAAAAAAAAAAAAAAAAA");var d=o+r.x+l,f=c+r.y+u,v=this.gidInfo(h),g=v.spritesheet,x=v.tileProperties;i.set(d,f,{x:d*this._tileWidth+t.offsetx,y:f*this._tileHeight+t.offsety,tile:g,isCollider:this.isGidCollider(h),tileProperties:x,gid:h})}}}catch(p){s.e(p)}finally{s.f()}return i}},{key:"gidInfo",value:function(t){var e,i=Object(y.a)(this._tilesets);try{var n=function(){var i=e.value,n=i.gidStart,s=i.gidEnd,r=i.imageUrlRelativeToGame,a=i.imagewidth,h=i.tilewidth,o=i.tileheight,c=i.tiles;if(t>=n&&t<s){var l=t-n,u=a/h,d={imageUrlRelativeToGame:r,spritesheetx:l%u,spritesheety:Math.floor(l/u),tilewidth:h,tileheight:o,tileProperties:c},f={};if(c){var v=c.find((function(e){return t===n+e.id}));if(v&&v.properties){var g,x=Object(y.a)(v.properties);try{for(x.s();!(g=x.n()).done;){var p=g.value,w=p.name,b=p.value;f[w]=b}}catch(m){x.e(m)}finally{x.f()}}}return{v:{spritesheet:d,tileProperties:f}}}};for(i.s();!(e=i.n()).done;){var s=n();if("object"===typeof s)return s.v}}catch(r){i.e(r)}finally{i.f()}throw new Error("gid out of range. ask gabby what to do?!?")}},{key:"getTilesAtAbsolutePosition",value:function(t,e){var i=this;return this.getLayerNames().map((function(n){return i.getTileAtAbsolutePositionForLayer(t,e,n)})).filter((function(t){return t}))}},{key:"getTileAtAbsolutePositionForLayer",value:function(t,e,i){var n=this._tileWidth,s=this._tileHeight,r=this._layers[i];return"tiles"===r.type?r.grid.get(Math.floor(t/n),Math.floor(e/s)):null}},{key:"getCollidersInRegion",value:function(t){var e=this;return v.FlattenByOne(this.getLayerNames().map((function(i){return e.getCollidersInRegionForLayer(t,i).getRects()})))}},{key:"getCollidersInRegionForLayer",value:function(t,e){for(var i=Math.floor(t.x/this._tileWidth),n=Math.floor(t.y/this._tileHeight),s=Math.ceil(t.right/this._tileWidth),r=Math.ceil(t.bottom/this._tileHeight),a=[],h=i;h<=s;h++)for(var o=n;o<=r;o++){var c=this.getTileAtAbsolutePositionForLayer(h*this._tileWidth,o*this._tileHeight,e);c&&c.isCollider&&a.push(new w({x:h*this._tileWidth,y:o*this._tileHeight,width:this._tileWidth,height:this._tileHeight}))}return new S(a)}}]),t}(),tt={},et=new _(void 0,new J({scale:1,canvasWidth:800,canvasHeight:800,tileHeight:16,tileWidth:16,debugFlags:{},state:{tick:0},assets:new(function(){function t(e){var i=this;Object(h.a)(this,t),this.loader=void 0,this.loadComplete=void 0,this.loadCompleteCallbacks=void 0,this.startStageOneLoading=function(t){for(var e=0,n=Object.keys(t);e<n.length;e++){var s=t[n[e]];if("Animation"===s.type){var r,a=Object(y.a)(s.paths);try{for(a.s();!(r=a.n()).done;){var h=r.value;i.loader.add(h)}}catch(o){a.e(o)}finally{a.f()}}else i.loader.add(s.path)}i.loader.load(i.startStageTwoLoading)},this.startStageTwoLoading=function(){for(var t=[],e=0,n=Object.keys(tt);e<n.length;e++){var s=n[e],r=s,a=s.substring(0,s.lastIndexOf("/"));if("TileMap"===tt[r].type){var h=new $({data:i.getResource(r),pathToTilemap:a});t=t.concat(h.getTilesets().map((function(t){return t.imageUrlRelativeToGame})))}}var o,c=Object(y.a)(t);try{for(c.s();!(o=c.n()).done;){var l=o.value;i.loader.resources[l]||i.loader.add(l)}}catch(u){c.e(u)}finally{c.f()}i.loader.load(i.finishLoading)},this.finishLoading=function(){i.loadComplete=!0;var t,e=Object(y.a)(i.loadCompleteCallbacks);try{for(e.s();!(t=e.n()).done;){(0,t.value)()}}catch(n){e.e(n)}finally{e.f()}i.loadCompleteCallbacks=[]},this.loadCompleteCallbacks=[],this.loader=new c.d,this.loadComplete=!1,this.startStageOneLoading(e)}return Object(o.a)(t,[{key:"getResource",value:function(t){var e=this,i=tt[t];if("Audio"===i.type)return new Audio(i.path);if("Animation"===i.type)return i.paths.map((function(t){return e.loader.resources[t].texture}));if("Image"===i.type)return this.loader.resources[i.path].texture;if("Spritesheet"===i.type)throw new Error("Unhandled");if("TileMap"===i.type)return this.loader.resources[i.path].data;if("TileWorld"===i.type)return this.loader.resources[i.path].data;throw new Error("AAAAAA")}},{key:"onLoadComplete",value:function(t){this.loadComplete?setTimeout((function(){t()}),0):this.loadCompleteCallbacks.push(t)}}]),t}())({})}).app);function it(t){var e=Object(n.useRef)(null);return Object(n.useEffect)((function(){et.register(e.current),et.drawStart()}),[]),s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{ref:e}),s.a.createElement("button",{onClick:function(){return et.drawCircle()}},"draw circle"),s.a.createElement("button",{onClick:function(){return et.drawStart()}},"rerender all"))}var nt=function(){return s.a.createElement("div",{className:"App"},"Hi stuff is here",s.a.createElement(it,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a.a.render(s.a.createElement(s.a.StrictMode,null,s.a.createElement(nt,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(t){t.unregister()})).catch((function(t){console.error(t.message)}))}},[[21,1,2]]]);
//# sourceMappingURL=main.448a8be7.chunk.js.map