(this["webpackJsonpprocgen-skill-tree"]=this["webpackJsonpprocgen-skill-tree"]||[]).push([[0],{136:function(e,t,n){},144:function(e,t,n){},145:function(e,t,n){},146:function(e,t,n){},15:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return i}));n(2),n(3),n(54);var r=Math.pow(2,32);function i(e){var t=(e+r)%r;return t=Math.imul(t,3039394381),t^=t>>>8,t+=1759714724,t^=t<<8,t=Math.imul(t,458671337),((t^=t>>>8)+r)%r}}).call(this,n(13).Buffer)},158:function(e,t){},160:function(e,t){},170:function(e,t){},172:function(e,t){},197:function(e,t){},199:function(e,t){},200:function(e,t){},205:function(e,t){},207:function(e,t){},213:function(e,t){},215:function(e,t){},234:function(e,t){},246:function(e,t){},249:function(e,t){},252:function(e,t,n){},253:function(e,t,n){},254:function(e,t,n){},255:function(e,t,n){},256:function(e,t,n){},257:function(e,t,n){"use strict";n.r(t);var r=n(1),i=n.n(r),a=n(137),o=n.n(a),c=(n(144),n(6)),u=(n(145),n(35)),s=n.n(u),l=(n(146),n(2)),d=n(3),h=function(){function e(){Object(l.a)(this,e),this.frameTimestampsInTicks=[],this.frameTimestampsInTime=[],this.frameTimestampsInTicks.push(0)}return Object(d.a)(e,[{key:"tick",value:function(e){var t=this.frameTimestampsInTicks[this.frameTimestampsInTicks.length-1];this.frameTimestampsInTicks.push(t+e),this.frameTimestampsInTicks.length>120&&(this.frameTimestampsInTicks=this.frameTimestampsInTicks.slice(60)),this.frameTimestampsInTime.push((new Date).getTime()),this.frameTimestampsInTime.length>120&&(this.frameTimestampsInTime=this.frameTimestampsInTime.slice(60))}},{key:"getUps",value:function(){var e=this.frameTimestampsInTicks[this.frameTimestampsInTicks.length-1]-this.frameTimestampsInTicks[0],t=(this.frameTimestampsInTicks.length-1)/e;return t?60*t:60}},{key:"getFps",value:function(){var e=this.frameTimestampsInTime[this.frameTimestampsInTime.length-1]-this.frameTimestampsInTime[0],t=(this.frameTimestampsInTime.length-1)/e;return t?1e3*t:60}},{key:"getFpsString",value:function(){return this.getFps().toFixed(1)}},{key:"getUpsString",value:function(){return this.getUps().toFixed(1)}}]),e}(),p=n(0);function f(e){var t=Object(r.useRef)(new h);return Object(r.useEffect)((function(){t.current.tick(0)}),[e.tick]),Object(p.jsxs)("div",{className:"text",children:[Object(p.jsxs)("div",{children:[e.windowState.innerWidth,"x",e.windowState.innerHeight]}),Object(p.jsx)(v,{}),Object(p.jsxs)("div",{children:["UPS: ",t.current.getFpsString()]})]})}function v(){var e=Object(r.useState)(0),t=Object(c.a)(e,2),n=t[0],i=t[1],a=Object(r.useRef)(new h);Object(r.useEffect)((function(){var e=setTimeout((function(){i((function(e){return e+1})),a.current.tick(0)}),5);return function(){return clearTimeout(e)}}),[n]);var o=Object(r.useMemo)((function(){return n>=0?a.current.getFpsString():""}),[n]);return Object(p.jsxs)("div",{children:["RPS: ",o]})}var b=n(11),O=n(12),j=n(139),y=n(10),g=function(){function e(){Object(l.a)(this,e)}return Object(d.a)(e,null,[{key:"MinBy",value:function(e,t){var n,r=null,i=null,a=Object(y.a)(e);try{for(a.s();!(n=a.n()).done;){var o=n.value,c=t(o);(null===i||c<i)&&(r=o,i=c)}}catch(u){a.e(u)}finally{a.f()}return r}},{key:"MinByAndValue",value:function(e,t){var n,r=null,i=null,a=Object(y.a)(e);try{for(a.s();!(n=a.n()).done;){var o=n.value,c=t(o);(null===i||c<i)&&(r=o,i=c)}}catch(u){a.e(u)}finally{a.f()}return null===r||null===i?null:{obj:r,value:i}}},{key:"MaxBy",value:function(e,t){var n,r=null,i=null,a=Object(y.a)(e);try{for(a.s();!(n=a.n()).done;){var o=n.value,c=t(o);(null===i||c>i)&&(r=o,i=c)}}catch(u){a.e(u)}finally{a.f()}return r}},{key:"RandRange",value:function(e,t){return Math.floor(Math.random()*(t-e)+e)}},{key:"SortByKey",value:function(e,t){return e.sort((function(e,n){return t(e)-t(n)}))}},{key:"ReplaceAll",value:function(e,t){var n=new RegExp(Object.keys(t).join("|"),"gi");return e.replace(n,(function(e){return t[e.toLowerCase()]}))}},{key:"Debounce",value:function(e){var t,n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{isImmediate:!1},a=function(){for(var a=arguments.length,o=new Array(a),c=0;c<a;c++)o[c]=arguments[c];var u=function(){t=void 0,i.isImmediate||e.apply(n,o)},s=i.isImmediate&&void 0===t;void 0!==t&&clearTimeout(t),t=setTimeout(u,r),s&&e.apply(n,o)};return a}},{key:"FormatDate",value:function(e){var t=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][e.getMonth()];return"".concat(t," ").concat(e.getDate(),", ").concat(("00"+e.getHours()).substr(-2),":").concat(("00"+e.getMinutes()).substr(-2),":").concat(("00"+e.getSeconds()).substr(-2))}},{key:"FlattenByOne",value:function(e){var t,n=[],r=Object(y.a)(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;n=n.concat(i)}}catch(a){r.e(a)}finally{r.f()}return n}},{key:"PadString",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:" ";return e+n+r.repeat(t-e.length)}}]),e}();function S(e){return Object.keys(e)}function x(e){var t=[[]],n={get:function(e,r,i){var a=e.path.concat([r.toString()]);return t[t.length-1]===e.path?t[t.length-1]=a:t.push(a),new Proxy({path:a},n)}};return e(new Proxy({path:t[0]},n)),t}function m(e){var t=x(e);return function(e){return t.map((function(t){var n,r=e,i=Object(y.a)(t);try{for(i.s();!(n=i.n()).done;){var a,o=n.value;r=null===(a=r)||void 0===a?void 0:a[o]}}catch(c){i.e(c)}finally{i.f()}return r}))}}var k,w=function(e){Object(b.a)(n,e);var t=Object(O.a)(n);function n(){return Object(l.a)(this,n),t.apply(this,arguments)}return n}(Object(j.a)(Error));!function(e){e.NOOP="NOOP",e.PAN_NORTH="PAN_NORTH",e.PAN_SOUTH="PAN_SOUTH",e.PAN_WEST="PAN_WEST",e.PAN_EAST="PAN_EAST",e.TRAVEL_UPSTAIRS="TRAVEL_UPSTAIRS",e.TRAVEL_DOWNSTAIRS="TRAVEL_DOWNSTAIRS",e.TOGGLE_STRATEGIC_VIEW="TOGGLE_STRATEGIC_VIEW",e.TOGGLE_SIDEBAR="TOGGLE_SIDEBAR",e.TURN_OFF_SIDEBAR="TURN_OFF_SIDEBAR",e.MOVE_CURSOR_WEST="MOVE_CURSOR_WEST",e.MOVE_CURSOR_EAST="MOVE_CURSOR_EAST",e.MOVE_CURSOR_NORTH="MOVE_CURSOR_NORTH",e.MOVE_CURSOR_SOUTH="MOVE_CURSOR_SOUTH",e.MOVE_CURSOR_NORTHWEST="MOVE_CURSOR_NORTHWEST",e.MOVE_CURSOR_NORTHEAST="MOVE_CURSOR_NORTHEAST",e.MOVE_CURSOR_SOUTHWEST="MOVE_CURSOR_SOUTHWEST",e.MOVE_CURSOR_SOUTHEAST="MOVE_CURSOR_SOUTHEAST",e.INTERACT_WITH_NODE="INTERACT_WITH_NODE",e.ZOOM_RECENTER_AT_NODE="ZOOM_RECENTER_AT_NODE"}(k||(k={}));var E=S(k).reduce((function(e,t){return e[t]=!1,e}),{}),T=function(){return{activeIntent:E,newIntent:E,endedIntent:E}},C={w:k.PAN_NORTH,a:k.PAN_WEST,s:k.PAN_SOUTH,d:k.PAN_EAST,k:k.PAN_NORTH,h:k.PAN_WEST,j:k.PAN_SOUTH,l:k.PAN_EAST,m:k.TOGGLE_STRATEGIC_VIEW,i:k.TOGGLE_SIDEBAR,ArrowUp:k.MOVE_CURSOR_NORTH,ArrowLeft:k.MOVE_CURSOR_WEST,ArrowDown:k.MOVE_CURSOR_SOUTH,ArrowRight:k.MOVE_CURSOR_EAST," ":k.INTERACT_WITH_NODE,z:k.ZOOM_RECENTER_AT_NODE,"<":k.TRAVEL_UPSTAIRS,">":k.TRAVEL_DOWNSTAIRS},I=function(e){Object(b.a)(n,e);var t=Object(O.a)(n);function n(e){var r;return Object(l.a)(this,n),(r=t.call(this,e)).handleKeydown=function(e){var t=r.state.keyIntentConfig[e.key];if(t){if(r.props.isTextBoxFocused)return void console.log("bypassing keyboard event processing because text box is focused");e.preventDefault()}!1===e.repeat&&void 0!==t&&t!==k.NOOP&&(r.props.updaters.newIntent[t].enqueueUpdate((function(){return r.props.updaters.newIntent[t].enqueueUpdate((function(){return!1})),!0})),r.props.updaters.activeIntent[t].enqueueUpdate((function(){return!0})))},r.handleKeyup=function(e){var t=r.state.keyIntentConfig[e.key];void 0!==t&&t!==k.NOOP&&(r.props.updaters.activeIntent[t].enqueueUpdate((function(){return!1})),r.props.updaters.endedIntent[t].enqueueUpdate((function(){return r.props.updaters.endedIntent[t].enqueueUpdate((function(){return!1})),!0})))},r.state={keyIntentConfig:C},r}return Object(d.a)(n,[{key:"componentDidMount",value:function(){document.addEventListener("keydown",this.handleKeydown),document.addEventListener("keyup",this.handleKeyup)}},{key:"componentWillUnmount",value:function(){console.log("removing event listeners for keyboard component"),document.removeEventListener("keydown",this.handleKeydown),document.removeEventListener("keyup",this.handleKeyup)}},{key:"render",value:function(){return Object(p.jsx)(p.Fragment,{children:" "})}}]),n}(i.a.Component),_=i.a.createContext([]),U=n(7),N=1e-7,R=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{x:0,y:0},n=arguments.length>1?arguments[1]:void 0;Object(l.a)(this,e),this._x=void 0,this._y=void 0,"number"===typeof t?(this._x=t,this._y=n):(this._x=t.x,this._y=t.y)}return Object(d.a)(e,[{key:"x",get:function(){return this._x}},{key:"y",get:function(){return this._y}},{key:"half",get:function(){return new e({x:this.x/2,y:this.y/2})}},{key:"hash",value:function(){return this.toString()}},{key:"toString",value:function(){return"[".concat(this.x,", ").concat(this.y,"]")}},{key:"invert",value:function(){return new e({x:-this.x,y:-this.y})}},{key:"round",value:function(){return new e({x:Math.round(this.x),y:Math.round(this.y)})}},{key:"floor",value:function(){return new e({x:Math.floor(this.x),y:Math.floor(this.y)})}},{key:"taxicabDistance",value:function(e){return Math.abs(e.x-this.x)+Math.abs(e.y-this.y)}},{key:"diagonalDistance",value:function(e){return Math.max(Math.abs(e.x-this.x),Math.abs(e.y-this.y))}},{key:"distance",value:function(e){var t=Math.abs(e.x-this.x),n=Math.abs(e.y-this.y);return Math.sqrt(t*t+n*n)}},{key:"translate",value:function(t){return new e({x:this.x+t.x,y:this.y+t.y})}},{key:"subtract",value:function(t){return new e({x:this.x-t.x,y:this.y-t.y})}},{key:"add",value:function(t){return new e({x:this.x+t.x,y:this.y+t.y})}},{key:"addX",value:function(t){return new e({x:this.x+t,y:this.y})}},{key:"addY",value:function(t){return new e({x:this.x,y:this.y+t})}},{key:"subtractX",value:function(t){return new e({x:this.x-t,y:this.y})}},{key:"subtractY",value:function(t){return new e({x:this.x,y:this.y-t})}},{key:"clampX",value:function(t,n){var r=this.x;return r<t&&(r=t),r>n&&(r=n),new e({x:r,y:this.y})}},{key:"clampY",value:function(t,n){var r=this.y;return r<t&&(r=t),r>n&&(r=n),new e({x:this.x,y:r})}},{key:"scale",value:function(t,n){return new e({x:(this.x-t.x)*n.x+t.x,y:(this.y-t.y)*n.y+t.y})}},{key:"rotate",value:function(t,n){return n/=180/Math.PI,new e({x:Math.cos(n)*(this.x-t.x)-Math.sin(n)*(this.y-t.y)+t.x,y:Math.sin(n)*(this.x-t.x)+Math.cos(n)*(this.y-t.y)+t.y})}},{key:"equals",value:function(e){return void 0!==e&&null!==e&&(Math.abs(this.x-e.x)<N&&Math.abs(this.y-e.y)<N)}},{key:"multiply",value:function(t){return new e("number"===typeof t?{x:this.x*t,y:this.y*t}:{x:this.x*t.x,y:this.y*t.y})}},{key:"divide",value:function(t){return new e("number"===typeof t?{x:this.x/t,y:this.y/t}:{x:this.x/t.x,y:this.y/t.y})}},{key:"toJSON",value:function(){return{__type:"Vector2",x:this.x,y:this.y}}},{key:"transform",value:function(t,n){return new e({x:Math.floor((this.x-t.x)*n),y:Math.floor((this.y-t.y)*n)})}},{key:"normalize",value:function(){if(0===this.x&&0===this.y)return this;var t=Math.sqrt(this.x*this.x+this.y*this.y);return new e({x:this.x/t,y:this.y/t})}},{key:"withX",value:function(t){return new e({x:t,y:this.y})}},{key:"withY",value:function(t){return new e({x:this.x,y:t})}},{key:"invertX",value:function(){return new e({x:-this.x,y:this.y})}},{key:"lerp",value:function(e,t){return(t>1||t<0)&&console.error("Lerp t must be between 0 and 1."),0===t?this:1===t?e:this.scale({x:0,y:0},{x:1-t,y:1-t}).add(e.scale({x:0,y:0},{x:t,y:t}))}},{key:"lerp2D",value:function(e,t,n){return(t>1||t<0||n>1||n<0)&&console.error("Lerp t must be between 0 and 1."),this.scale({x:0,y:0},{x:1-t,y:1-n}).add(e.scale({x:0,y:0},{x:t,y:n}))}},{key:"coserp",value:function(e,t){return t=.5*(1+Math.cos(2*t*Math.PI)),this.lerp(e,t)}}],[{key:"IsVector2",value:function(t){return t instanceof e}},{key:"Random",value:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return new e({x:g.RandRange(r,t),y:g.RandRange(i,n)})}},{key:"Deserialize",value:function(t){return t&&t.hasOwnProperty("x")&&t.hasOwnProperty("y")?new e({x:t.x,y:t.y}):(console.error("Failed deserializing point"),null)}},{key:"Serialize",value:function(e){return JSON.stringify(this.SerializeToObject(e))}},{key:"SerializeToObject",value:function(e){return{x:e.x,y:e.y}}}]),e}();R.Zero=new R(0,0),R.One=new R(1,1);var M=n(9),D=n(37),A={backgroundBlue:2236962,nodePink:3355443,nodeLavender:4934475,nodeBlue:4473924,nodeAqua:16755370,gateTint:16777215,selectedTint:12303359,allocatedTint:4473924,nodeBorder:6710886,nullTint:16777215,tooltipBorderBlack:2236962,tooltipFillWhite:15658734,white:16777215,grayBlack:1907997,borderBlack:1118481,borderWhite:6710886,black:0,textWhite:8947848};function L(e){return"#"+e.toString(16)}var P=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];Object(l.a)(this,e),this._values=void 0,this._values=new z;var n,r=Object(y.a)(t);try{for(r.s();!(n=r.n()).done;){var i=n.value;this.put(i)}}catch(a){r.e(a)}finally{r.f()}}return Object(d.a)(e,[{key:"remove",value:function(e){this._values.remove(e)}},{key:"put",value:function(e){this._values.put(e,e)}},{key:"get",value:function(e){return void 0!==this._values.get(e)}},{key:"contains",value:function(e){return this._values.contains(e)}},{key:"values",value:function(){return this._values.values()}},{key:"clone",value:function(){var t=new e;return t._values=this._values.clone(),t}},{key:"size",value:function(){return this._values.size()}},{key:"equals",value:function(e){if(void 0===e||null===e)return!1;if(this.size()!==e.size())return!1;var t,n=Object(y.a)(this.values());try{for(n.s();!(t=n.n()).done;){var r=t.value;if(!e.contains(r))return!1}}catch(i){n.e(i)}finally{n.f()}return!0}}]),e}(),z=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];Object(l.a)(this,e),this._values={};var n,r=Object(y.a)(t);try{for(r.s();!(n=r.n()).done;){var i=Object(c.a)(n.value,2),a=i[0],o=i[1];this.put(a,o)}}catch(u){r.e(u)}finally{r.f()}}return Object(d.a)(e,[{key:"put",value:function(e,t){this._values[e.hash()]=t}},{key:"remove",value:function(e){delete this._values[e.hash()]}},{key:"get",value:function(e){return this._values[e.hash()]}},{key:"contains",value:function(e){return void 0!==this.get(e)&&e.hash()in this._values}},{key:"values",value:function(){return Object.values(this._values)}},{key:"size",value:function(){return Object.keys(this._values).length}},{key:"clone",value:function(){var t=new e;return t._values=Object(M.a)({},this._values),t}}]),e}(),G=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];Object(l.a)(this,e),this._kvalues={};var n,r=Object(y.a)(t);try{for(r.s();!(n=r.n()).done;){var i=Object(c.a)(n.value,2),a=i[0],o=i[1];this.put(a,o)}}catch(u){r.e(u)}finally{r.f()}}return Object(d.a)(e,[{key:"put",value:function(e,t){this._kvalues[e.hash()]=[e,t]}},{key:"remove",value:function(e){delete this._kvalues[e.hash()]}},{key:"get",value:function(e){var t;return null===(t=this._kvalues[e.hash()])||void 0===t?void 0:t[1]}},{key:"contains",value:function(e){return void 0!==this.get(e)&&e.hash()in this._kvalues}},{key:"keys",value:function(){var e=this;return Object.keys(this._kvalues).map((function(t){return e._kvalues[t][0]}))}},{key:"entries",value:function(){var e=this;return Object.keys(this._kvalues).map((function(t){return e._kvalues[t]}))}},{key:"values",value:function(){var e=this;return Object.keys(this._kvalues).map((function(t){return e._kvalues[t][1]}))}},{key:"hashKeyset",value:function(){return Object.keys(this._kvalues).map((function(e){return F(e)})).reduce((function(e,t){return e+t})).toString()}},{key:"clone",value:function(){var t=new e;return t._kvalues=Object(M.a)({},this._kvalues),t}},{key:"size",value:function(){return Object.keys(this._kvalues).length}}],[{key:"SerializeToObject",value:function(e,t,n){return e.entries().map((function(e){var r=Object(c.a)(e,2),i=r[0],a=r[1];return[t?t(i):i,n?n(a):a]}))}},{key:"Deserialize",value:function(t,n,r){if(!t||!Array.isArray(t))return console.error("Failed deserializing keyed hash map"),null;try{return new e(t.map((function(e){if(!e||!Array.isArray(e)||2!==e.length)throw new w("Failed deserializing entry ".concat(JSON.stringify(e)));var t=e,i=Object(c.a)(t,2),a=i[0],o=i[1];return[n?n(a):a,r?r(o):o]})))}catch(i){if(i instanceof w)return console.error("Failed deserializing keyed hash map",i),null;throw i}}}]),e}();function F(e){for(var t=0,n=0;n<e.length;n++)t=Math.imul(31,t)+e.charCodeAt(n)|0;return t}function H(e){return new U.d(e.x,e.y)}var q=16711680,W=65280,V=255,B=65536,X=256;function Z(e,t){var n=[e&q,t&q],r=[e&W,t&W],i=[e&V,t&V],a=Math.round(n[0]/B*n[1]/q)*B;return a+=Math.round(r[0]/X*r[1]/W)*X,a+=1*Math.round(i[0]/1*i[1]/V)}function J(e,t,n){if("object"===typeof e){if(e.hasOwnProperty("target"))return K(e);if(e.hasOwnProperty("color")){var r=e;return K({target:r.color,proportion:r.opacity,base:r.background})}throw new Error("missing parameter in interpolateColor: ".concat(e))}if(t)return K({target:e,proportion:t,base:n});throw new Error("missing parameter in interpolateColor: ".concat(e," ").concat(t," ").concat(n))}function K(e){var t=e.target,n=e.base,r=void 0===n?0:n,i=e.proportion,a=void 0===i?1:i,o=[t&q,r&q],c=[t&W,r&W],u=[t&V,r&V],s=Math.round(o[0]/B*a+o[1]/B*(1-a))*B;return s+=Math.round(c[0]/X*a+c[1]/X*(1-a))*X,s+=1*Math.round(u[0]/1*a+u[1]/1*(1-a))}var Y=n(19);function Q(e){var t=[];return[function(e){t.push(e)},function(){if(0!==t.length){var n=Object(Y.a)(t);t=[],e((function(e){var t,r=e,i=Object(y.a)(n);try{for(i.s();!(t=i.n()).done;){var a=t.value;r="function"===typeof a?a(r):a}}catch(o){i.e(o)}finally{i.f()}return r}))}}]}var $=n(4);function ee(e,t){var n={getUpdater:function(){return t}};return n.enqueueUpdate=t,null===e||void 0===e||"object"!==typeof e||Object.keys(e).forEach((function(r){if("enqueueUpdate"===r||"getUpdater"===r||"update"===r)throw Error("Invalid key in updaterGenerator: ".concat(r," conflicts with reserved keywords enqueueUpdate, update, getUpdater."));n[r]=ee(e[r],(function(e){t("function"===typeof e?function(t,n){var i=e(t[r],n);return t[r]===i?t:Object(M.a)(Object(M.a)({},t),{},Object($.a)({},r,i))}:function(t,n){return Object(M.a)(Object(M.a)({},t),{},Object($.a)({},r,e))})}))})),n}function te(e,t){return ee(e,(function(e){t("function"===typeof e?function(t){return e(t,t)}:e)}))}var ne=function(){function e(){Object(l.a)(this,e),this._values=[]}return Object(d.a)(e,[{key:"add",value:function(e){this._values.push(e)}},{key:"remove",value:function(e){var t=this._values.splice(this._values.findIndex((function(t){return t.instance===e})),1);return 0===t.length?void 0:t[0]}},{key:"contains",value:function(e){return this._values.findIndex((function(t){return t.instance===e}))>-1}},{key:"get",value:function(e){return this._values.find((function(t){return t.instance===e}))}},{key:"clone",value:function(){var t=new e;return t._values=Object(Y.a)(this._values),t}},{key:"forEach",value:function(e){this._values.forEach(e)}}]),e}(),re=function(){function e(t){var n=this;Object(l.a)(this,e),this.container=void 0,this.state=void 0,this.stateUpdaters=void 0,this._staleProps=void 0,this._children=new ne,this._childrenToConstruct=new ne,this._childrenToDestruct=new ne,this._forceUpdates=new ne,this.markForceUpdate=function(e){var t,r;null===(t=n._staleProps.args)||void 0===t||null===(r=t.markForceUpdate)||void 0===r||r.call(t,n);var i=n._children.get(e);if(!i)throw new Error("Error, child ".concat(e," not found in ").concat(n));n._forceUpdates.add(i)},this._staleProps=t}return Object(d.a)(e,[{key:"addChild",value:function(e){this._children.add(e),this._childrenToConstruct.add(e)}},{key:"registerChild",value:function(e){this._children.add(e)}},{key:"removeChild",value:function(e){var t=this._children.remove(e);t&&this._childrenToDestruct.add(t)}},{key:"_didConstruct",value:function(e){var t,n=this;this._childrenToConstruct.forEach((function(t){t.instance||(t.instance=new t.childClass(t.propsFactory(e,n.state))),n.container.addChild(t.instance.container)})),this._childrenToConstruct=new ne,this.renderSelf(e),null===(t=this.didMount)||void 0===t||t.call(this)}},{key:"useState",value:function(e,t){var n=function(t){e.state="function"===typeof t?t(e.state):t},r=Q(n),i=Object(c.a)(r,2),a=i[0],o=i[1],u=te(t,a);return this.fireStateUpdaters||(this.fireStateUpdaters=o),this.stateUpdaters||(this.stateUpdaters=u),{state:t,setState:n,fireStateUpdaters:o,stateUpdaters:u}}},{key:"update",value:function(e){this._update(e)}},{key:"_update",value:function(e){var t,n,r,i=this,a=Object(M.a)({},this.state);if(null===(t=this.fireStateUpdaters)||void 0===t||t.call(this),null===(n=this.updateSelf)||void 0===n||n.call(this,e),this.shouldUpdate&&!this.shouldUpdate(this._staleProps,a,e,this.state)){var o=this._forceUpdates.clone();return this._forceUpdates=new ne,void o.forEach((function(t){var n,r=t.instance,a=t.propsFactory;null===r||void 0===r||r._update(a(e,i.state)),r&&(null===(n=i.didForceUpdateChild)||void 0===n||n.call(i,r))}))}null===(r=this.updateChildren)||void 0===r||r.call(this,e),this._updateChildren(e),this.renderSelf(e),this._staleProps=e,new Promise((function(e){var t;return e(null===(t=i.didUpdate)||void 0===t?void 0:t.call(i))}))}},{key:"_updateChildren",value:function(e){var t=this;this._childrenToDestruct.forEach((function(e){var n,r;e.instance&&(null===(n=(r=e.instance).willUnmount)||void 0===n||n.call(r),t.container.removeChild(e.instance.container))})),this._childrenToDestruct=new ne,this._children.forEach((function(n){var r=n.instance,i=n.propsFactory;null===r||void 0===r||r._update(i(e,t.state))})),this._childrenToConstruct.forEach((function(n){n.instance||(n.instance=new n.childClass(n.propsFactory(e,t.state))),t.container.addChild(n.instance.container)})),this._childrenToConstruct=new ne}},{key:"willUnmount",value:function(){}},{key:"toString",value:function(){return"lifecyclehandler object"}}]),e}();function ie(e){return new Proxy(e,{construct:function(e,t){var n=new e(t[0]);return n._didConstruct(t[0]),n}})}new Proxy(re,{construct:function(e,t,n){var r=Reflect.construct(e,t,n);return r._didConstruct.apply(r,Object(Y.a)(t)),r}});var ae,oe,ce,ue=function e(){Object(l.a)(this,e)};ue.CHUNK_HALF_DIM=((ue.CHUNK_DIM=9)-1)/2,ue.DROP_NODES_CHANCE=0,function(e){e.Basic="Basic",e.Nothing="Nothing",e.EfficiencyGate="EfficiencyGate"}(ae||(ae={})),function(e){e.Mana0="Mana0",e.Mana1="Mana1",e.Mana2="Mana2"}(oe||(oe={})),function(e){e.Flat="Flat",e.Increased0="% increased",e.AfterIncreased0="added after % increased",e.Increased1="% increased multiplier",e.AfterIncreased1="added after % increased multiplier"}(ce||(ce={}));var se=ie(function(e){Object(b.a)(n,e);var t=Object(O.a)(n);function n(e){var r,i,a;Object(l.a)(this,n),(a=t.call(this,e)).container=void 0,a.state=void 0,a.sprite=void 0,a.halfwayCenterSprite=void 0,a.centerSprite=void 0,a.topHalfSprite=void 0,a.hitArea=void 0,a.tooltippableArea=void 0,a.state={numClicks:0,descriptionText:""},a.updateSelf(e),a.container=new U.b;var o=null===(r=e.args.pointNodeTexture.find((function(e){return e.cropFraction>=.99})))||void 0===r?void 0:r.texture;a.container.sortableChildren=!0,a.sprite=new U.g(o),a.sprite.anchor.x=.5,a.sprite.anchor.y=.5,a.sprite.zIndex=-2,a.container.addChild(a.sprite),a.topHalfSprite=new U.g(null===(i=e.args.pointNodeTexture.find((function(e){return e.cropFraction>=.499})))||void 0===i?void 0:i.texture),a.topHalfSprite.anchor.x=.5,a.topHalfSprite.anchor.y=.5,a.topHalfSprite.zIndex=-1,e.pointNodeGen.nodeType===ae.EfficiencyGate&&a.container.addChild(a.topHalfSprite);var c=new U.c;return c.beginFill(A.black),c.drawRect(0,0,a.topHalfSprite.width,a.topHalfSprite.height/2),c.pivot.x=a.topHalfSprite.width/2,c.pivot.y=a.topHalfSprite.height/2,c.zIndex=30,a.centerSprite=new U.g(o),a.centerSprite.anchor.x=.5,a.centerSprite.anchor.y=.5,a.centerSprite.scale=H(new R(.5,.5)),a.centerSprite.zIndex=1,a.centerSprite.alpha=0,a.halfwayCenterSprite=new U.g(o),a.halfwayCenterSprite.anchor.x=.5,a.halfwayCenterSprite.anchor.y=.5,a.halfwayCenterSprite.scale=H(new R(.75,.75)),a.halfwayCenterSprite.zIndex=0,a.halfwayCenterSprite.alpha=0,a.container.interactive=!0,a.container.buttonMode=!0,a.hitArea=new U.e(-de.NODE_HITAREA_PX/2,-de.NODE_HITAREA_PX/2,de.NODE_HITAREA_PX,de.NODE_HITAREA_PX),a.container.hitArea=a.hitArea,a}return Object(d.a)(n,[{key:"updateSelf",value:function(e){var t="Nothing (empty node)";e.pointNodeGen.nodeType===ae.EfficiencyGate?t="Unlocks at 300 Mana0 in 14 or fewer allocations":e.pointNodeGen.nodeType!==ae.Nothing&&(t="".concat(e.pointNodeGen.resourceAmount," ").concat(e.pointNodeGen.resourceModifier," ").concat(e.pointNodeGen.resourceType)),this.state.descriptionText=t}},{key:"renderSelf",value:function(e){var t,n,r;this.container.position=H(e.args.position),e.isSelected?(n=A.selectedTint,r=A.selectedTint):(n=A.nullTint,r=A.nullTint),e.isAllocated&&(n=A.allocatedTint);var i=0,a=0;e.pointNodeGen.nodeType===ae.Nothing?i=A.nodeBlue:e.pointNodeGen.nodeType===ae.EfficiencyGate?(i=A.nodeAqua,a=Z(A.nodeAqua,A.gateTint)):e.pointNodeGen.resourceType===oe.Mana0&&(e.pointNodeGen.resourceModifier===ce.Flat?i=A.nodePink:e.pointNodeGen.resourceModifier===ce.Increased0&&(i=A.nodeLavender)),this.sprite.tint=Z(i,n),this.centerSprite.tint=Z(i,r),this.topHalfSprite.tint=Z(a,n);var o=Math.floor(9*Math.random())/8-.001;this.topHalfSprite.texture=null===(t=e.args.pointNodeTexture.find((function(e){return e.cropFraction>=o})))||void 0===t?void 0:t.texture,e.selfPointNodeRef.pointNodeCoord.equals(R.Zero)&&(this.container.scale=H(new R(1.25,1.25)))}},{key:"shouldUpdate",value:function(e,t,n,r){var i,a=Object(y.a)(Object.keys(e));try{for(a.s();!(i=a.n()).done;){var o=i.value;if("delta"!==o&&"args"!==o&&"updaters"!==o){if(e[o]!==n[o])return console.log("node shouldUpdate differed in ".concat(o,", returning true")),!0;var c,u;if("selfPointNodeRef"!==o);else if((null===(c=e[o])||void 0===c?void 0:c.hash())!==(null===(u=n[o])||void 0===u?void 0:u.hash()))return console.log("node shouldUpdate differed in ".concat(o,", returning true")),!0}}}catch(s){a.e(s)}finally{a.f()}return!1}},{key:"didMount",value:function(){var e=this;this.container.addListener("pointerdown",(function(t){e._staleProps.args.markForceUpdate(e),e.state.numClicks++})),this.container.addListener("pointerover",(function(t){var n=t.data.getLocalPosition(e.container),r=new R(e.container.worldTransform.tx,e.container.worldTransform.ty);e._staleProps.tooltipUpdaters.enqueueUpdate((function(t){return Object(M.a)(Object(M.a)({},t),{},{visible:!0,text:e.state.descriptionText,position:r.add(n)})}))})),this.container.addListener("pointerout",(function(t){e._staleProps.tooltipUpdaters.enqueueUpdate((function(e){return Object(M.a)(Object(M.a)({},e),{},{visible:!1,text:""})}))})),this.container.addListener("pointermove",(function(t){var n=t.data.getLocalPosition(e.container),r=new R(e.container.worldTransform.tx,e.container.worldTransform.ty);e._staleProps.tooltipUpdaters.position.enqueueUpdate(r.add(n))}))}},{key:"toString",value:function(){return"PointNodeCompoent "+this._staleProps.selfPointNodeRef.toString()}}]),n}(re)),le=function(){function e(t){Object(l.a)(this,e),this.z=void 0,this.chunkCoord=void 0,this.pointNodeCoord=void 0,this.pointNodeId=void 0,this.z=t.z,this.chunkCoord=t.chunkCoord,this.pointNodeCoord=t.pointNodeCoord,this.pointNodeId=t.pointNodeId}return Object(d.a)(e,[{key:"hash",value:function(){return this.pointNodeId.toString()+this.z.toString()+this.chunkCoord.toString()+this.pointNodeCoord.toString()}},{key:"toString",value:function(){return this.z+","+this.chunkCoord.toString()+","+this.pointNodeCoord.toString()}}]),e}(),de=function e(){Object(l.a)(this,e)};de.SPACING_PX=36,de.CHUNK_SPACING_PX=(ue.CHUNK_DIM+0)*de.SPACING_PX,de.NODE_SIZE_PX=22,de.NODE_HITAREA_PX=de.NODE_SIZE_PX+4,de.NODE_ROUNDED_PX=4;ie(function(e){Object(b.a)(n,e);var t=Object(O.a)(n);function n(e){var r;return Object(l.a)(this,n),(r=t.call(this,e)).container=void 0,r.state=void 0,r.children=void 0,r.state={},r.container=new U.b,r.children=new G,r.resyncChildren(e),r}return Object(d.a)(n,[{key:"renderSelf",value:function(e){this.container.position=H(e.position)}},{key:"shouldUpdate",value:function(e,t,n,r){var i,a=Object(y.a)(Object.keys(e));try{for(a.s();!(i=a.n()).done;){var o=i.value;if("delta"!==o&&"args"!==o&&"updaters"!==o){if("position"===o){if(e[o].equals(n[o]))continue;return console.log("chunk shouldUpdate differed in ".concat(o,", returning true")),!0}var c,u;if("selectedPointNode"!==o)if("selfChunkRef"!==o){if("allocatedPointNodeSubset"===o){if(e[o].equals(n[o]))continue;return console.log("chunk shouldUpdate differed in ".concat(o,", returning true")),!0}if(e[o]!==n[o])return console.log("chunk shouldUpdate differed in ".concat(o,", returning true")),!0}else{var s,l;if((null===(s=e[o])||void 0===s?void 0:s.hash())!==(null===(l=n[o])||void 0===l?void 0:l.hash()))return console.log("chunk shouldUpdate differed in ".concat(o,", returning true")),!0}else if((null===(c=e[o])||void 0===c?void 0:c.hash())!==(null===(u=n[o])||void 0===u?void 0:u.hash()))return console.log("chunk shouldUpdate differed in ".concat(o,", returning true")),!0}}}catch(d){a.e(d)}finally{a.f()}return!1}},{key:"resyncChildren",value:function(e){var t=this,n=this.children.clone();console.log("chunk component upsert children got here");var r,i=Object(y.a)(e.chunkGen.pointNodes.entries());try{var a=function(){var i=Object(c.a)(r.value,2),a=i[0],o=i[1],u=new le({z:e.selfChunkRef.z,chunkCoord:e.selfChunkRef.chunkCoord,pointNodeCoord:a,pointNodeId:o.id}),s=function(e,n){var r;return{delta:e.delta,args:{pointNodeTexture:e.args.pointNodeTexture,markForceUpdate:t.markForceUpdate,position:u.pointNodeCoord.multiply(de.SPACING_PX)},selfPointNodeRef:u,updaters:e.updaters,tooltipUpdaters:e.tooltipUpdaters,pointNodeGen:o,isSelected:(null===(r=e.selectedPointNode)||void 0===r?void 0:r.pointNodeId)===u.pointNodeId,isAllocated:e.allocatedPointNodeSubset.contains(u)}},l=u,d=t.children.get(l);d?n.remove(l):(d=new se(s(e,t.state)),t.children.put(u,d),t.addChild({childClass:se,instance:d,propsFactory:s}))};for(i.s();!(r=i.n()).done;)a()}catch(h){i.e(h)}finally{i.f()}console.log("chunk component to delete has ".concat(n.size()," children"));var o,u=Object(y.a)(n.entries());try{for(u.s();!(o=u.n()).done;){var s=Object(c.a)(o.value,2),l=s[0],d=s[1];this.children.remove(l),this.removeChild(d)}}catch(h){u.e(h)}finally{u.f()}}},{key:"updateChildren",value:function(e){this.resyncChildren(e)}},{key:"didForceUpdateChild",value:function(e){this.container.removeChild(e.container),this.container.addChild(e.container)}}]),n}(re));var he=function(){function e(t){Object(l.a)(this,e),this._wasConstructed=!1,this._value=void 0,this._factory=void 0,this._factory=t}return Object(d.a)(e,[{key:"get",value:function(){return void 0!==this._value||!0===this._wasConstructed||(this._value=this._factory(),this._wasConstructed=!0),this._value}},{key:"wasConstructed",value:function(){return this._wasConstructed}}]),e}();var pe,fe,ve=function(){function e(t){Object(l.a)(this,e),this._values=void 0,this._factory=void 0,this._values=new G,this._factory=t}return Object(d.a)(e,[{key:"setFactory",value:function(e){return this._factory=e,this}},{key:"put",value:function(e,t){this._values.put(e,t)}},{key:"remove",value:function(e){this._values.remove(e)}},{key:"invalidate",value:function(e){this.remove(e)}},{key:"clear",value:function(){this._values=new G}},{key:"peek",value:function(e){return this._values.get(e)}},{key:"get",value:function(e){if(this._values.contains(e))return this._values.get(e);var t=this._factory(e);return this._values.put(e,t),t}},{key:"precompute",value:function(e){if(!this._values.contains(e)){var t=this._factory(e);this._values.put(e,t)}}},{key:"contains",value:function(e){return this._values.contains(e)}},{key:"values",value:function(){return this._values.values()}},{key:"keys",value:function(){return this._values.keys()}},{key:"entries",value:function(){return this._values.entries()}},{key:"size",value:function(){return this._values.size()}},{key:"clone",value:function(t){var n=new e(t||this._factory);return n._values=this._values.clone(),n}}]),e}(),be=ie(function(e){Object(b.a)(n,e);var t=Object(O.a)(n);function n(e){var r;return Object(l.a)(this,n),(r=t.call(this,e)).container=void 0,r.state=void 0,r.container=new U.b,r.container.sortableChildren=!0,r.state={},r}return Object(d.a)(n,[{key:"renderSelf",value:function(e){}}]),n}(re)),Oe=n(53),je=n.n(Oe);!function(e){e.TAKEN="TAKEN",e.AVAILABLE="AVAILABLE",e.UNREACHABLE="UNREACHABLE",e.HIDDEN="HIDDEN"}(pe||(pe={})),function(e){e.true="true",e.false="false"}(fe||(fe={}));var ye,ge={true:{taken:!0},false:{taken:!1}},Se={true:{visible:!0},false:{visible:!1}},xe={true:{reachable:!0},false:{reachable:!1}};!function(e){e.CLOSED="CLOSED",e.TICKING="TICKING",e.OPEN="OPEN"}(ye||(ye={}));var me=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{x:0,y:0,z:0},n=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0;Object(l.a)(this,e),this._x=void 0,this._y=void 0,this._z=void 0,"number"===typeof t?(this._x=t,this._y=n,this._z=r):(this._x=t.x,this._y=t.y,this._z=t.z)}return Object(d.a)(e,[{key:"x",get:function(){return this._x}},{key:"y",get:function(){return this._y}},{key:"z",get:function(){return this._z}},{key:"hash",value:function(){return this.toString()}},{key:"toString",value:function(){return"[".concat(this.x,", ").concat(this.y,", ").concat(this.z,"]")}},{key:"round",value:function(){return new e({x:Math.round(this.x),y:Math.round(this.y),z:Math.round(this.z)})}},{key:"moduloPositive",value:function(t){return new e({x:(this.x%t+t)%t,y:(this.y%t+t)%t,z:(this.z%t+t)%t})}},{key:"subtract",value:function(t){return new e({x:this.x-t.x,y:this.y-t.y,z:this.z-t.z})}},{key:"add",value:function(t,n,r){return new e("number"===typeof t?{x:this.x+t,y:this.y+n,z:this.z+r}:{x:this.x+t.x,y:this.y+t.y,z:this.z+t.z})}},{key:"addX",value:function(t){return new e({x:this.x+t,y:this.y,z:this.z})}},{key:"addY",value:function(t){return new e({x:this.x,y:this.y+t,z:this.z})}},{key:"addZ",value:function(t){return new e({x:this.x,y:this.y,z:this.z+t})}},{key:"subtractX",value:function(t){return new e({x:this.x-t,y:this.y,z:this.z})}},{key:"subtractY",value:function(t){return new e({x:this.x,y:this.y-t,z:this.z})}},{key:"subtractZ",value:function(t){return new e({x:this.x,y:this.y,z:this.z-t})}},{key:"scale",value:function(t,n){return new e({x:(this.x-t.x)*n.x+t.x,y:(this.y-t.y)*n.y+t.y,z:(this.z-t.z)*n.z+t.z})}},{key:"equals",value:function(e){return void 0!==e&&null!==e&&(Math.abs(this.x-e.x)<N&&Math.abs(this.y-e.y)<N&&Math.abs(this.z-e.z)<N)}},{key:"multiply",value:function(t){return new e("number"===typeof t?{x:this.x*t,y:this.y*t,z:this.z*t}:{x:this.x*t.x,y:this.y*t.y,z:this.z*t.z})}},{key:"divide",value:function(t){return new e("number"===typeof t?{x:this.x/t,y:this.y/t,z:this.z/t}:{x:this.x/t.x,y:this.y/t.y,z:this.z/t.z})}},{key:"toJSON",value:function(){return{__type:"Vector3",x:this.x,y:this.y,z:this.z}}},{key:"pairXY",value:function(){return new R({x:this.x,y:this.y})}},{key:"withX",value:function(t){return new e({x:t,y:this.y,z:this.z})}},{key:"withY",value:function(t){return new e({x:this.x,y:t,z:this.z})}},{key:"withZ",value:function(t){return new e({x:this.x,y:this.y,z:t})}}],[{key:"IsVector3",value:function(t){return t instanceof e}},{key:"FromVector2",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new e(t.x,t.y,n)}},{key:"Deserialize",value:function(t){return t&&t.hasOwnProperty("x")&&t.hasOwnProperty("y")&&t.hasOwnProperty("z")?new e({x:t.x,y:t.y,z:t.z}):(console.error("Failed deserializing vector3"),null)}},{key:"Serialize",value:function(e){return JSON.stringify(this.SerializeToObject(e))}},{key:"SerializeToObject",value:function(e){return{x:e.x,y:e.y,z:e.z}}}]),e}();me.Zero=new me(0,0,0),me.One=new me(1,1,1);var ke,we,Ee,Te,Ce=n(15);function Ie(e){for(var t=e.randInt,n=e.weights,r=e.behaviors,i=t/Ce.a,a=Object(Ce.b)(t),o=i*Object.values(n).reduce((function(e,t){return e+t})),u=0,s=Object.entries(n);u<s.length;u++){var l=Object(c.a)(s[u],2),d=l[0],h=l[1];if(o<=h)return r[d](a);o-=h}throw Error()}function _e(e){var t,n=e.randInt,r=e.weights,i=n/Ce.a*Object.values(r).reduce((function(e,t){return e+t})),a=Object(y.a)(Object.entries(r));try{for(a.s();!(t=a.n()).done;){var o=Object(c.a)(t.value,2),u=o[0],s=o[1];if(i<=s)return u;i-=s}}catch(l){a.e(l)}finally{a.f()}throw Error()}function Ue(e){var t=e.randInt,n=e.min,r=e.max,i=e.increment,a=void 0===i?1:i,o=e.inclusive,c=void 0===o||o,u=t/Ce.a,s=Math.ceil((r-n)/a);return n+a*s===r&&!0===c&&(s+=1),n+Math.floor(u*s)*a}!function(e){e.RED0="RED0",e.RED1="RED1",e.RED2="RED2",e.DEL0="DEL0",e.DEL1="DEL1",e.DEL2="DEL2"}(Ee||(Ee={})),function(e){e.FLAT="FLAT",e.INCREASED="INCREASED"}(Te||(Te={}));var Ne,Re,Me,De,Ae,Le={DECISION_0:{EMPTY:150,NO_SPEND:100,SPEND:0},DECISION_1:{SINGLE:500,DOUBLE:0},SINGLE_COLORS:(ke={},Object($.a)(ke,Ee.RED0,100),Object($.a)(ke,Ee.RED1,100),Object($.a)(ke,Ee.RED2,100),Object($.a)(ke,Ee.DEL0,10),Object($.a)(ke,Ee.DEL1,10),Object($.a)(ke,Ee.DEL2,10),ke),SINGLE_MODIFIERS:(we={},Object($.a)(we,Te.FLAT,100),Object($.a)(we,Te.INCREASED,75),we)},Pe=function(){function e(t){Object(l.a)(this,e),this.config=void 0,this.clusterCenterData=void 0,this.config=t,this.clusterCenterData=new z}return Object(d.a)(e,[{key:"createSingle",value:function(e){var t=_e({randInt:e.randInt,weights:Le.SINGLE_COLORS}),n=_e({randInt:Object(Ce.b)(e.randInt),weights:Le.SINGLE_MODIFIERS}),r=0;return r=n===Te.FLAT?function(e){for(var t=e.randInt,n=e.formula,r=e.plus,i=void 0===r?0:r,a=parseInt(n.split("d")[0]),o=parseInt(n.split("d")[1]),c=0,u=0;u<a;u++)c+=Ue({randInt:Object(Ce.b)(t+u),min:1,max:o,inclusive:!0});return c+i}({randInt:Object(Ce.b)(e.randInt+1),formula:"2d6",plus:8}):Ue({randInt:Object(Ce.b)(e.randInt+2),min:4,max:7,increment:.5,inclusive:!0}),{attribute:Ee[t],amount:r,modifier:Te[n]}}},{key:"createNoSpend",value:function(e){var t=this;return Ie({randInt:e.randInt,weights:Le.DECISION_1,behaviors:{SINGLE:function(e){return{lines:[t.createSingle({randInt:e})]}},DOUBLE:function(e){return{lines:[t.createSingle({randInt:e}),t.createSingle({randInt:Object(Ce.b)(e)})]}}}})}},{key:"create",value:function(e){var t,n=this,r=e.seed,i=e.location;if(i.equals(me.Zero))return{lines:[]};var a,o=i.moduloPositive(3).pairXY();return(t=o.equals(new R(1,2))||o.equals(new R(2,1))?i:i.divide(3).round().multiply(3)).equals(me.Zero)?{lines:[]}:Ie({randInt:Object(Ce.b)(r+(a=t,a.x+a.y+Object(Ce.b)(a.x+a.z))),weights:Le.DECISION_0,behaviors:{EMPTY:function(e){return{lines:[]}},NO_SPEND:function(e){return n.createNoSpend({randInt:e})},SPEND:function(e){var t,r=n.createNoSpend({randInt:e}),i=_e({randInt:e,weights:(t={},Object($.a)(t,Ee.RED0,100),Object($.a)(t,Ee.RED1,100),Object($.a)(t,Ee.RED2,100),Object($.a)(t,Ee.DEL0,0),Object($.a)(t,Ee.DEL1,0),Object($.a)(t,Ee.DEL2,0),t)});return Object(M.a)(Object(M.a)({},r),{},{condition:{type:"SPEND",amount:12,attribute:Ee[i]}})}}})}}]),e}();var ze=(Ne={},Object($.a)(Ne,Ee.RED0,"\ud83d\udd34"),Object($.a)(Ne,Ee.RED1,"\ud83d\udfe2"),Object($.a)(Ne,Ee.RED2,"\ud83d\udd35"),Object($.a)(Ne,Ee.DEL0,"\u2694\ufe0f"),Object($.a)(Ne,Ee.DEL1,"\ud83d\udee1"),Object($.a)(Ne,Ee.DEL2,"\u2728"),Ne),Ge=(Re={"":8947848},Object($.a)(Re,Ee.RED0,16711680),Object($.a)(Re,Ee.RED1,65280),Object($.a)(Re,Ee.RED2,255),Object($.a)(Re,Ee.DEL0,5934984),Object($.a)(Re,Ee.DEL1,16761856),Object($.a)(Re,Ee.DEL2,16777027),Re),Fe=(Me={},Object($.a)(Me,Ee.RED0,"Red"),Object($.a)(Me,Ee.RED1,"Green"),Object($.a)(Me,Ee.RED2,"Blue"),Object($.a)(Me,Ee.DEL0,"Offense"),Object($.a)(Me,Ee.DEL1,"Defense"),Object($.a)(Me,Ee.DEL2,"Magic"),Me),He={Red:Ee.RED0,Green:Ee.RED1,Blue:Ee.RED2,Offense:Ee.DEL0,Defense:Ee.DEL1,Magic:Ee.DEL2},qe=(De={},Object($.a)(De,Te.FLAT,"+"),Object($.a)(De,Te.INCREASED,"%"),De),We=(Ae={},Object($.a)(Ae,Te.FLAT,"flat"),Object($.a)(Ae,Te.INCREASED,"increased"),Ae),Ve={flat:Te.FLAT,increased:Te.INCREASED};function Be(e){var t=Fe[e.attribute],n=ze[e.attribute];return e.modifier===Te.FLAT?"+".concat(e.amount," ").concat(n," (").concat(t,")"):"".concat(e.amount,"% increased ").concat(n," (").concat(t,")")}function Xe(e){return{playerUI:{virtualGridLocation:e.playerUI.virtualGridLocation,cursoredNodeLocation:e.playerUI.cursoredNodeLocation,strategicSearch:e.playerUI.strategicSearch},playerSave:{allocationStatusMap:e.playerSave.allocationStatusMap},computed:{fogOfWarStatusMap:e.computed.fogOfWarStatusMap,reachableStatusMap:e.computed.reachableStatusMap,lockStatusMap:e.computed.lockStatusMap},worldGen:{nodeContentsMap:e.worldGen.nodeContentsMap,lockMap:e.worldGen.lockMap}}}var Ze=m(Xe),Je=new R(30,26),Ke=ie(function(e){Object(b.a)(n,e);var t=Object(O.a)(n);function n(e){var r;Object(l.a)(this,n),(r=t.call(this,e)).container=void 0,r.state=void 0,r.graphics=void 0,r.hexGrid=new G,r.state=r.useState(Object(D.a)(r),{phases:{}}).state,r.updateSelf(e),r.container=new U.b,r.graphics=new U.g,r.graphics.texture=e.args.textures.circle,r.graphics.tint=A.borderBlack,r.graphics.visible=!1,r.container.addChild(r.graphics);for(var i=-20;i<=20;i++)for(var a=-35+Math.floor(i/2);a<=35+Math.floor(i/2);a++){var o=new U.g;o.texture=e.args.textures.circle,o.tint=A.nodePink,o.position=H(e.appSize.divide(2).add(new R(Je.x*a-Je.x/2*i,-Je.y*i))),r.container.addChild(o),r.hexGrid.put(new R(a,i),{node:o,animation:null,cursor:null,cursorAnimation:null})}return r}return Object(d.a)(n,[{key:"updateSelf",value:function(e){var t=this;e.gameState.playerUI.strategicSearch!==this._staleProps.gameState.playerUI.strategicSearch&&this.stateUpdaters.phases.enqueueUpdate((function(e){for(var t=Object(M.a)({},e),n=0,r=Object.keys(t);n<r.length;n++){var i=r[n];t[parseInt(i)]=0}return t}));var n,r=Object(y.a)(this.hexGrid.values());try{var i=function(){var e=n.value,r=e.node,i=e.animation;if(i){var a=((t.state.phases[i.periodSecs]||i.phase||0)+1/tt*1*1/i.periodSecs)%1,o=1-Math.abs(2*a-1),c=1-(o<.5?o*o*2:1-2*(1-o)*(1-o));r.tint=J({target:i.max,base:i.min,proportion:c}),i.phase=a,t.stateUpdaters.phases.enqueueUpdate((function(e){var t=Object(M.a)({},e);return t[i.periodSecs]=a,t}))}if(e.cursor&&e.cursorAnimation){var u=e.cursorAnimation,s=((u.phase||0)+1/tt*1*1/u.periodSecs)%1,l=1-Math.abs(2*s-1),d=1-l*l;e.cursor.tint=J({target:u.max,base:u.min,proportion:d}),u.phase=s}};for(r.s();!(n=r.n()).done;)i()}catch(a){r.e(a)}finally{r.f()}}},{key:"renderSelf",value:function(e){var t=this,n=e.gameState;this.container.position=H(e.args.position),this.graphics.position=H(e.appSize.divide(2));var r,i=Object(y.a)(this.hexGrid.entries());try{var a=function(){var i,a,o,u,s=Object(c.a)(r.value,2),l=s[0],d=s[1],h=d.node,p=e.appSize.divide(2).add(new R(Je.x*l.x-Je.x/2*l.y,-Je.y*l.y)),f=0,v=n.playerUI.virtualGridLocation.add(me.FromVector2(l)),b=(null===(i=n.computed.fogOfWarStatusMap)||void 0===i?void 0:i.get(v))||Se.false,O=n.playerSave.allocationStatusMap.get(v)||ge.false,j=(null===(a=n.computed.reachableStatusMap)||void 0===a?void 0:a.get(v))||xe.false,g=n.worldGen.lockMap.get(v),S=null===(o=n.computed.lockStatusMap)||void 0===o?void 0:o.get(v);O.taken?(h.visible=!0,f=A.borderBlack):j.reachable?g&&S!==ye.OPEN?(h.visible=!0,f=A.nodePink):(h.visible=!0,f=A.nodeLavender):b.visible?(h.visible=!0,f=A.nodePink):h.visible=!1,h.visible?(h.interactive=!0,h.buttonMode=!0,h.removeAllListeners(),h.on("pointerdown",(function(){console.log("pointerdown in strategic hex grid pixi",{nodeLocation:v}),e.updaters.playerUI.cursoredNodeLocation.enqueueUpdate((function(e){return console.log("enqueue update in pointerdown in strategic hex grid",{prev:e,nodeLocation:v}),e&&e.equals(v)?null:v}))}))):(h.interactive=!1,h.buttonMode=!1),g&&S!==ye.OPEN?(h.texture=e.args.textures.rect,h.position=H(p),h.position.x-=e.args.textures.rect.width/2,h.position.y-=e.args.textures.rect.height/2):(h.texture=e.args.textures.circle,h.position=H(p),h.position.x-=e.args.textures.circle.width/2,h.position.y-=e.args.textures.circle.height/2);var x=n.worldGen.nodeContentsMap.get(v);if(n.playerUI.strategicSearch.colors.enabled){var m=je()(function(e){if(0===e.lines.length)return Ge[""];var t=Ge[e.lines[0].attribute];return 1===e.lines.length?t:J({color:t,opacity:.5,background:Ge[e.lines[1].attribute]})}(x)).lch(),k=je()(f).lch();f=je.a.lch(k[0],.5*(k[1]+m[1]),m[2]).num()}if(function(e){var t=e.nodeContents,n=e.query;if(!n)return!1;var r=n.highlight1.value.split(" ").filter((function(e){return!!e})).map((function(e){return e.slice(1,e.length-1)}));if(0===r.length)return!1;var i,a=null,o=Object(y.a)(r);try{for(o.s();!(i=o.n()).done;){var c,u,s,l,d=i.value,h=He[d],p=Ve[d];if(h){if((null===(c=t.lines)||void 0===c||null===(u=c[0])||void 0===u?void 0:u.attribute)!==h&&(null===(s=t.lines)||void 0===s||null===(l=s[1])||void 0===l?void 0:l.attribute)!==h){a=h;break}}else if(p){var f,v,b,O;if((null===(f=t.lines)||void 0===f||null===(v=f[0])||void 0===v?void 0:v.modifier)!==p&&(null===(b=t.lines)||void 0===b||null===(O=b[1])||void 0===O?void 0:O.modifier)!==p){a=p;break}}else{if("*"!==d)return console.error("unparsed term: ",d),!1;var j,g,S,x;if(!(null===(j=t.lines)||void 0===j||null===(g=j[0])||void 0===g?void 0:g.attribute)&&!(null===(S=t.lines)||void 0===S||null===(x=S[1])||void 0===x?void 0:x.attribute)){a=d;break}}}}catch(m){o.e(m)}finally{o.f()}if(a)return!1;return!0}({nodeContents:x,query:n.playerUI.strategicSearch})){var w={max:J({color:f,opacity:.75,background:A.white}),min:f,periodSecs:2,mode:"start-max ease-in-out",phase:d.animation?d.animation.phase:0};d.animation=w}else h.tint=f,d.animation=null;if(null===(u=e.gameState.playerUI.cursoredNodeLocation)||void 0===u?void 0:u.equals(v)){if(!d.cursor){var E=new U.g;E.texture=e.args.textures.verticalLine,E.tint=A.borderWhite,t.container.addChild(E),d.cursor=E,d.cursorAnimation={max:A.borderWhite,min:J({color:A.borderWhite,opacity:.25,background:A.backgroundBlue}),periodSecs:1,mode:"start-max ease-in",phase:0}}}else d.cursor&&t.container.removeChild(d.cursor),d.cursor=null;d.cursor&&(d.cursor.position=H(p),d.cursor.position.x-=Je.x/2,d.cursor.position.x+=e.args.textures.verticalLine.width/3,d.cursor.position.y-=e.args.textures.verticalLine.height/2)};for(i.s();!(r=i.n()).done;)a()}catch(o){i.e(o)}finally{i.f()}}},{key:"shouldUpdate",value:function(e,t,n,r){var i,a=Object(y.a)(Object.keys(e));try{for(a.s();!(i=a.n()).done;){var o=i.value;if("delta"!==o&&"args"!==o&&"updaters"!==o)if("gameState"!==o){if(e[o]!==n[o])return console.log("hexgrid shouldUpdate differed in ".concat(o,", returning true")),!0}else for(var c=e[o],u=n[o],s=Ze(c),l=Ze(u),d=0;d<s.length;d++)if(l[d]!==s[d])return console.log("hexgrid substate differed in ".concat(d," : ").concat(x(Xe)[d].join("."),", returning true for shouldupdate")),!0}}catch(h){a.e(h)}finally{a.f()}return!1}}]),n}(re));var Ye=ie(function(e){Object(b.a)(n,e);var t=Object(O.a)(n);function n(e){var r;Object(l.a)(this,n),(r=t.call(this,e)).container=void 0,r.state=void 0,r.stateUpdaters=void 0,r.fireStateUpdaters=void 0,r.fixedCameraStage=void 0,r.actionStage=void 0,r.backdropStage=void 0,r.strategicHexGrid=void 0,r.backdrop=void 0,r.container=new U.b,r.container.sortableChildren=!0,r.state=r.useState(Object(D.a)(r),{pointNodeTexture:new he((function(){return function(e){for(var t=[],n=0;n<=8;n++){var r=n/8,i=new U.c;i.beginFill(A.white),i.drawRoundedRect(-de.NODE_SIZE_PX/2,-de.NODE_SIZE_PX/2,de.NODE_SIZE_PX,de.NODE_SIZE_PX,de.NODE_ROUNDED_PX);var a=new U.c;a.beginFill(A.black),a.drawRect(-de.NODE_SIZE_PX/2,-de.NODE_SIZE_PX/2,de.NODE_SIZE_PX,de.NODE_SIZE_PX*r),i.mask=a;var o=e.generateTexture(i,U.f.LINEAR,1);t.push({cropFraction:r,texture:o})}return t}(e.args.renderer)})),simpleTexture:new he((function(){return function(e){var t=new U.c;t.beginFill(A.white),t.drawCircle(0,0,8);var n=new U.c;n.beginFill(A.white),n.drawRect(0,0,5,18);var r=new U.c;r.beginFill(A.white),r.drawRect(0,0,3,16),r.drawRect(0,0,6,3),r.drawRect(0,15,6,3);var i=new U.c;return i.beginFill(A.white),i.drawRect(0,0,16,16),{circle:e.generateTexture(t,U.f.LINEAR,1),rect:e.generateTexture(n,U.f.LINEAR,1),square:e.generateTexture(i,U.f.LINEAR,1),verticalLine:e.generateTexture(r,U.f.LINEAR,1)}}(e.args.renderer)})),tick:0,playerCurrentZ:0,tooltip:{visible:!1,position:void 0,text:""}}).state;var i=function(e,t){return{args:{renderer:e.args.renderer,markForceUpdate:r.markForceUpdate},delta:e.delta,gameState:e.gameState,appSize:e.appSize,tick:t.tick,tooltip:Object(M.a)({},t.tooltip)}};r.fixedCameraStage=new be(i(e,r.state)),r.addChild({childClass:be,instance:r.fixedCameraStage,propsFactory:i}),r.actionStage=new U.g,r.actionStage.zIndex=0,r.actionStage.sortableChildren=!0,r.container.addChild(r.actionStage);var a=function(e,t){var n=e.gameState;return{delta:e.delta,args:{position:R.Zero,textures:t.simpleTexture.get()},updaters:e.updaters,appSize:e.appSize,gameState:Xe(n)}};return r.strategicHexGrid=new Ke(a(e,r.state)),r.addChild({childClass:Ke,instance:r.strategicHexGrid,propsFactory:a}),r.backdropStage=new U.g,r.backdropStage.zIndex=-1,r.backdropStage.sortableChildren=!0,r.container.addChild(r.backdropStage),r.backdrop=new U.c,r.backdropStage.addChild(r.backdrop),r.backdrop.beginFill(A.backgroundBlue,1),r.backdrop.interactive=!0,r.backdrop.drawRect(0,0,e.appSize.x,e.appSize.y),r}return Object(d.a)(n,[{key:"updateSelf",value:function(e){this.stateUpdaters.tick.enqueueUpdate((function(e){return e+1}))}},{key:"renderSelf",value:function(e){this.backdrop.width=e.appSize.x,this.backdrop.height=e.appSize.y}},{key:"didMount",value:function(){}},{key:"didUpdate",value:function(){}}]),n}(re)),Qe=function(){return{orientation:"original",innerWidth:window.innerWidth,innerHeight:window.innerHeight}};function $e(e){return new R({x:Math.min(1920,((null===e||void 0===e?void 0:e.x)||1/0)-24),y:Math.min(1080,((null===e||void 0===e?void 0:e.y)||1/0)-24)})}var et=new R(800,600),tt=60,nt=function(){function e(t){var n;Object(l.a)(this,e),this.app=void 0,this.state=void 0,this.props=void 0,this.staleProps=void 0,this.rootComponent=void 0,this.onTick=void 0,null===t||void 0===t||null===(n=t.args)||void 0===n||n.isSecondConstructorCall;var r=et;this.state={appSize:r,originalAppSize:r},this.app=new U.a({width:this.state.appSize.x,height:this.state.appSize.y,antialias:!0,transparent:!0,resolution:window.devicePixelRatio||1,autoDensity:!0,powerPreference:"low-power",backgroundColor:A.white})}return Object(d.a)(e,[{key:"pause",value:function(){this.app.ticker.remove(this.onTick)}},{key:"destroy",value:function(){this.app.destroy(!0,{children:!0,texture:!0,baseTexture:!0})}},{key:"didMount",value:function(){var e=this;this.onTick=function(t){return e.baseGameLoop(t)},this.onTick=this.onTick.bind(this),this.app.ticker.add(this.onTick),this.state.appSize=$e(new R(this.props.gameState.windowState.innerWidth,this.props.gameState.windowState.innerHeight))}},{key:"register",value:function(e){e.appendChild(this.app.view)}},{key:"updateSelf",value:function(e,t){e!==t?(e.gameState.windowState.innerWidth===(null===t||void 0===t?void 0:t.gameState.windowState.innerWidth)&&e.gameState.windowState.innerHeight===(null===t||void 0===t?void 0:t.gameState.windowState.innerHeight)||(this.state.appSize=$e(new R(e.gameState.windowState.innerWidth,e.gameState.windowState.innerHeight))),e.updaters.tick.enqueueUpdate((function(e){return e+1}))):e.updaters.tick.enqueueUpdate((function(e){return e+1}))}},{key:"rerender",value:function(e){this.rootComponent&&this.props===e||(this.props=e,this.rootComponent||(this.rootComponent=new Ye({args:{renderer:this.app.renderer,markForceUpdate:function(){}},updaters:this.props.updaters,delta:0,gameState:this.props.gameState,appSize:this.state.appSize}),this.app.stage.addChild(this.rootComponent.container),this.renderSelf(this.props),this.didMount()))}},{key:"renderSelf",value:function(e){this.app.renderer.resize(this.state.appSize.x,this.state.appSize.y)}},{key:"baseGameLoop",value:function(e){var t;if(this.props.gameState.playerUI.isPixiHidden&&this.props.gameState.tick%60!==0)return this.props.updaters.tick.enqueueUpdate((function(e){return e+1})),void this.props.args.fireBatch();this.updateSelf(this.props,this.staleProps),null===(t=this.rootComponent)||void 0===t||t.update({args:{renderer:this.app.renderer,markForceUpdate:function(){}},updaters:this.props.updaters,delta:e,gameState:this.props.gameState,appSize:this.state.appSize}),this.renderSelf(this.props),this.staleProps=this.props,this.props.args.fireBatch()}}]),e}(),rt=new he((function(){return new nt}));function it(e){var t=Object(r.useState)(rt.get()),n=Object(c.a)(t,1)[0],i=Object(r.useRef)(null),a=Object(r.useContext)(_),o=Object(c.a)(a,3),u=o[0],s=o[1],l=o[2];return Object(r.useEffect)((function(){for(var e=i.current.childNodes.length-1;e>=0;e--)i.current.removeChild(i.current.childNodes[e]);i.current.appendChild(n.app.view)}),[n]),Object(r.useEffect)((function(){n.rerender({args:{fireBatch:l,isSecondConstructorCall:!1},updaters:s,gameState:u})}),[n,l,s,u]),Object(p.jsx)(p.Fragment,{children:Object(p.jsx)("div",{ref:i,hidden:e.hidden,style:{}})})}var at,ot=function(e){Object(b.a)(n,e);var t=Object(O.a)(n);function n(e){var r;return Object(l.a)(this,n),(r=t.call(this,e)).handleWindowResize=function(e){r.props.updaters.enqueueUpdate((function(e){return Object(M.a)(Object(M.a)({},e),{},{innerWidth:window.innerWidth,innerHeight:window.innerHeight})}))},r.state={},window.addEventListener("resize",r.handleWindowResize),r}return Object(d.a)(n,[{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.handleWindowResize)}},{key:"render",value:function(){return Object(p.jsx)(p.Fragment,{children:" "})}}]),n}(i.a.Component),ct=function(){return{allocationStatusMap:new G([[me.Zero,ge.true]])}},ut=function(e){return JSON.stringify(function(e){return Object(M.a)(Object(M.a)({},e),{},{allocationStatusMap:G.SerializeToObject(e.allocationStatusMap,me.SerializeToObject)})}(e))},st=function(e){return function(e){if(!e||!e.hasOwnProperty("allocationStatusMap"))return console.error("Failed deserializing PlayerSaveState: ",e),null;var t=G.Deserialize(e.allocationStatusMap,(function(e){var t=me.Deserialize(e);if(!t)throw new w("Failed deserializing vector3 ".concat(JSON.stringify(e)));return t}));return t?Object(M.a)(Object(M.a)({},e),{},{allocationStatusMap:t}):(console.error("Failed deserializing PlayerSaveState: ",e),null)}(JSON.parse(e))},lt="PlayerSaveState",dt=function(){var e=window.localStorage.getItem(lt);return e&&st(e)||null},ht=ct,pt=function(){var e=dt();return e||(console.log("Failed to load PlayerSaveState"),ct())},ft=function(e){var t=ut(e);window.localStorage.setItem(lt,t)},vt=function(){window.localStorage.setItem(lt,"")};function bt(e){var t={};return t.EAST=e.addX(1),t.WEST=e.addX(-1),t.NORTHWEST=e.addY(1),t.SOUTHEAST=e.addY(-1),t.NORTHEAST=e.add(1,1,0),t.SOUTHWEST=e.add(-1,-1,0),t}function Ot(e,t,n,r){var i=new P,a=new P;i.put(e);for(var o=[[e]],c=1;c<=t;c++){o.push([]);var u,s=Object(y.a)(o[c-1]);try{for(s.s();!(u=s.n()).done;)for(var l=u.value,d=Object.values(bt(l)),h=0,p=d;h<p.length;h++){var f=p[h];f&&(i.get(f)||((null===r||void 0===r?void 0:r.contains(f))?a.put(f):(i.put(f),o[c].push(f))))}}catch(O){s.e(O)}finally{s.f()}}for(var v=[],b=n||0;b<=t;b++)v=v.concat(o[b]);return v=v.concat(a.values())}!function(e){e.NORTHWEST="NORTHWEST",e.SOUTHWEST="SOUTHWEST",e.NORTHEAST="NORTHEAST",e.SOUTHEAST="SOUTHEAST",e.EAST="EAST",e.WEST="WEST",e.UP="UP",e.DOWN="DOWN"}(at||(at={}));var jt=function(){function e(t){Object(l.a)(this,e),this.config=void 0,this.config=t}return Object(d.a)(e,[{key:"create",value:function(e){var t=Object(Ce.b)(e.seed+e.location.x+e.location.y+Object(Ce.b)(e.seed+e.location.x+e.location.z))/Ce.a,n={shortTextTarget:"\ud83d\udd12",shortTextTimer:"",lockStatus:ye.TICKING};if(!e.location.equals(me.Zero))return t<.47?n:void 0}}]),e}(),yt="WorldGenState",gt=function(){function e(t){Object(l.a)(this,e),this.config=void 0,this.config=t}return Object(d.a)(e,[{key:"create",value:function(e){var t=e.seed,n=new jt({}),r=new ve((function(e){return n.create({seed:t,location:e})})),i=new Pe({}),a=new ve((function(e){return i.create({seed:t,location:e})}));return{seed:t,lockMap:r,nodeContentsMap:a}}},{key:"tryLoad",value:function(e){var t=this.load();return t?this.create(t):this.create(e)}},{key:"store",value:function(e){var t=this.serialize(e);window.localStorage.setItem(yt,t)}},{key:"load",value:function(){var e=window.localStorage.getItem(yt);return e&&this.deserialize(e)||null}},{key:"deserialize",value:function(e){return this.deserializeFromObject(JSON.parse(e))}},{key:"deserializeFromObject",value:function(e){return e&&e.hasOwnProperty("seed")?Object(M.a)({},e):null}},{key:"serialize",value:function(e){return JSON.stringify(this.serializeToObject(e))}},{key:"serializeToObject",value:function(e){return{seed:e.seed}}},{key:"clear",value:function(){window.localStorage.setItem(yt,"")}}]),e}(),St=function(){function e(t){Object(l.a)(this,e),this.updaters=void 0,this.updaters=t}return Object(d.a)(e,[{key:"enqueueAction",value:function(e){var t,n,r,i=e.nodeLocation,a=e.newStatus;this.updaters.playerSave.allocationStatusMap.enqueueUpdate((function(e){return e.put(i,a),e.clone()})),null===(t=this.updaters.computed.lockStatusMap)||void 0===t||t.enqueueUpdate((function(e,t){if(!e)return e;var n,r=Object(y.a)(t.worldGen.lockMap.entries());try{for(r.s();!(n=r.n()).done;){var i=Object(c.a)(n.value,2),a=i[0];if(i[1]){var o=ye.TICKING;e.put(a,o)}}}catch(u){r.e(u)}finally{r.f()}return e.clone()})),null===(n=this.updaters.computed.reachableStatusMap)||void 0===n||n.enqueueUpdate((function(e){return e?(Ot(i,1).forEach((function(t){e.put(t,xe.true)})),e.clone()):e})),null===(r=this.updaters.computed.fogOfWarStatusMap)||void 0===r||r.enqueueUpdate((function(e,t){return e?(e.put(i,Se.true),Ot(i,1).forEach((function(t){e.put(t,Se.true)})),Ot(i,5,0,{contains:function(e){var n,r=null===(n=t.computed.lockStatusMap)||void 0===n?void 0:n.get(e);return!(!r||r===ye.OPEN)}}).forEach((function(n){var r;(null===(r=e.get(n))||void 0===r?void 0:r.visible)||(t.worldGen.lockMap.precompute(n),e.put(n,Se.true))})),e.clone()):e}))}}]),e}(),xt=(n(252),i.a.memo(mt));function mt(e){var t=e.hexGridPx,n=e.borderWidth,i=e.hexCenterRadius,a=e.appSize,o=e.COLORS;return Object(r.useEffect)((function(){document.documentElement.style.setProperty("--grid-width"," ".concat(t.x,"px")),document.documentElement.style.setProperty("--grid-height"," ".concat(t.y,"px")),document.documentElement.style.setProperty("--hex-center-radius"," ".concat(i,"px")),document.documentElement.style.setProperty("--border-width"," ".concat(n,"px"))}),[t,i,n]),Object(r.useEffect)((function(){document.documentElement.style.setProperty("--background-black",L(o.backgroundBlue)),document.documentElement.style.setProperty("--deemphasized-black",L(o.grayBlack)),document.documentElement.style.setProperty("--active-purple",L(o.nodePink)),document.documentElement.style.setProperty("--border-unimportant-black",L(o.borderBlack)),document.documentElement.style.setProperty("--border-important-white",L(o.borderWhite)),document.documentElement.style.setProperty("--text-readable-white",L(o.textWhite))}),[o]),Object(r.useEffect)((function(){document.documentElement.style.setProperty("--app-size-width"," ".concat(a.x,"px")),document.documentElement.style.setProperty("--app-size-height"," ".concat(a.y,"px"))}),[a]),Object(p.jsx)(p.Fragment,{children:e.children})}n(136),n(78);var kt="The starting node.";function wt(e){var t=e.location,n=e.gameState.computed,r=n.fogOfWarStatusMap,i=n.reachableStatusMap,a=e.gameState.playerSave.allocationStatusMap,o=e.gameState.worldGen,c=o.lockMap,u=o.nodeContentsMap,s=null===r||void 0===r?void 0:r.get(t),l=null===i||void 0===i?void 0:i.get(t),d=a.get(t),h=(null===d||void 0===d?void 0:d.taken)?pe.TAKEN:(null===l||void 0===l?void 0:l.reachable)?pe.AVAILABLE:(null===s||void 0===s?void 0:s.visible)?pe.UNREACHABLE:pe.HIDDEN,f=t.hash(),v=c.get(t),b=u.get(t),O="";b.lines[0]?(O+=qe[b.lines[0].modifier],O+=ze[b.lines[0].attribute]):O="",b.lines[1]&&b.lines[0].attribute!==b.lines[1].attribute&&(O+=ze[b.lines[1].attribute]);var j="";return b.condition&&(j="-"+ze[b.condition.attribute]),{nodeLocation:t,shortText:j?Object(p.jsxs)(p.Fragment,{children:[O,Object(p.jsx)("br",{}),j]}):Object(p.jsx)(p.Fragment,{children:O}),toolTipText:Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)("div",{children:h.toString()}),t.equals(me.Zero)?Object(p.jsxs)(p.Fragment,{children:[" ",Object(p.jsx)("br",{})," ",Object(p.jsx)("div",{children:kt})]}):Object(p.jsx)(p.Fragment,{children:" "}),b.lines[0]?Object(p.jsx)("br",{}):Object(p.jsx)(p.Fragment,{}),Et(b)]}),nodeContents:b,fullText:Object(p.jsx)(p.Fragment,{children:" "}),status:h,lockData:v,id:f}}function Et(e){return Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)("div",{children:e.lines[0]&&Be(e.lines[0])}),Object(p.jsx)("div",{children:e.lines[1]&&Be(e.lines[1])}),Object(p.jsx)("div",{children:e.condition&&(t=e.condition,"SPEND: ".concat(t.amount," ").concat(Fe[t.attribute]))})]});var t}n(253);var Tt=i.a.memo(Ct);function Ct(e){var t=e.id,n=e.onUpdateStatus,i=e.nodeData,a=e.isCursored,o=e.onUpdateCursored,c=(e.debugIsCursored,i.nodeLocation),u=Object(r.useCallback)((function(e){e.stopPropagation(),e.preventDefault(),n({nodeLocation:c,newStatus:pe.TAKEN})}),[n,c]),s=Object(r.useCallback)((function(e){e.stopPropagation(),e.preventDefault(),o(a?null:c)}),[a,o,c]);return Object(p.jsx)(It,{id:t,onClickCenter:u,nodeData:i,onClickQuestionMark:s,isCursored:a},t)}var It=i.a.memo(_t);function _t(e){var t,n,i=e.id,a=e.onClickCenter,o=e.onClickQuestionMark,u=e.nodeData,l=e.isCursored,d=(e.debugIsCursored,u.status),h=!!u.lockData,f=Object(r.useState)(!1),v=Object(c.a)(f,2),b=v[0],O=v[1],j=function(e){console.log("got pointer enter on ".concat(i)),O(!0)},y=function(e){console.log("got pointer leave on ".concat(i)),O(!1)};return Object(p.jsxs)("div",{className:"hex-block hex-full-block",id:i,children:[Object(p.jsx)("div",{className:s()("hex-center",d===pe.TAKEN?"node-allocated":"node-unallocated",d===pe.TAKEN||d===pe.UNREACHABLE?"border-unimportant":"border-important"),onClick:a,onPointerEnter:j,onPointerLeave:y,hidden:d===pe.HIDDEN,children:Object(p.jsx)("div",{className:"hex-center-text-wrapper",children:Object(p.jsx)("div",{className:"tiny-text",children:u.shortText})})}),h?Object(p.jsxs)("div",{className:"hex-center-lock",hidden:d===pe.HIDDEN,onPointerEnter:j,onPointerLeave:y,children:[Object(p.jsx)("div",{className:"hex-center-lock-left",children:Object(p.jsx)("div",{className:"tiny-text",children:null===(t=u.lockData)||void 0===t?void 0:t.shortTextTarget})}),Object(p.jsx)("div",{className:"hex-center-lock-right",children:Object(p.jsx)("div",{className:"tiny-text",children:null===(n=u.lockData)||void 0===n?void 0:n.shortTextTimer})})]}):null,Object(p.jsx)("div",{className:"empty-positioned node-tooltip-wrapper",children:Object(p.jsx)("div",{className:"absolute-positioned node-tooltip",hidden:!b,children:u.toolTipText})}),Object(p.jsx)("div",{className:"empty-positioned",children:Object(p.jsx)("div",{className:"hover-only-2 absolute-positioned",children:Object(p.jsx)("div",{className:"question",hidden:d===pe.HIDDEN,onClick:o,children:"?"})})}),Object(p.jsx)("div",{className:"empty-positioned selection-cursor-wrapper",children:Object(p.jsx)("div",{className:"absolute-positioned selection-cursor",hidden:!l})})]},i)}function Ut(e){return{playerUI:{cursoredNodeLocation:e.playerUI.cursoredNodeLocation},playerSave:{allocationStatusMap:e.playerSave.allocationStatusMap},worldGen:{nodeContentsMap:e.worldGen.nodeContentsMap,lockMap:e.worldGen.lockMap},computed:{fogOfWarStatusMap:e.computed.fogOfWarStatusMap,reachableStatusMap:e.computed.reachableStatusMap,lockStatusMap:e.computed.lockStatusMap}}}var Nt=m(Ut),Rt=i.a.memo(Mt);function Mt(e){var t,n=e.gameState,i=e.virtualGridDims,a=e.virtualCoordsToLocation,o=e.updateNodeStatusByLocationCb,c=e.cursoredVirtualNode,u=e.setCursoredLocation,s=e.debug,l=+new Date;null===s||void 0===s||s.rerenderGameAreaGrid();var d=(null===s||void 0===s||null===(t=s.isFlipCursored)||void 0===t?void 0:t.call(s))||!1,h=Object(r.useMemo)((function(){return new ve((function(e){return wt({location:e,gameState:n})}))}),[n]),f=Object(p.jsx)(p.Fragment,{children:Array(i.y).fill(0).map((function(e,t){return Object(p.jsx)(Dt,{rowIdx:t,children:Array(i.x).fill(0).map((function(e,n){var r=new R(n,t),i=a(r),s=h.get(i),l=!!c&&c.equals(r),f=s.id||"loading".concat(n);return Object(p.jsx)(Tt,{id:f,nodeData:s,onUpdateStatus:o,isCursored:l,debugIsCursored:d?!l:l,onUpdateCursored:u},f)}))},a(new R(0,t)).y.toString())}))}),v=+new Date,b=v-l;return console.log("Game area grid elapsed ".concat(b,"ms at ").concat(v)),f}var Dt=i.a.memo(At);function At(e){var t=e.rowIdx,n=e.children,r=!!(t%2);return Object(p.jsxs)("div",{className:"hex-block-row",children:[r&&Object(p.jsx)("div",{className:"hex-block hex-half-block"}),n,!r&&Object(p.jsx)("div",{className:"hex-block hex-half-block"})]})}var Lt=i.a.memo(Pt);function Pt(e){var t=e.hexGridPx,n=e.virtualGridDims,i=e.appSize,a=e.updaters,o=e.triggerScrollRecenterCb,u=e.keyboardScrollDirection,l=e.debug,d=Object(r.useRef)(null),h=Object(r.useState)(new R(0,0)),f=Object(c.a)(h,2),v=f[0],b=f[1];Object(r.useEffect)((function(){if(d.current){o();var e=function(e){var t=e.virtualGridDims,n=e.hexGridPx,r=t.divide(2).floor(),i=(r.y+.5)*n.y,a=(r.x+.5)*n.x;return r.y%2===1&&(a+=.5*n.x),new R(a,i)}({virtualGridDims:n,hexGridPx:t});d.current.scrollTop=e.y-i.y/2,d.current.scrollLeft=e.x-i.x/2}}),[i,n,t,o]),Object(r.useEffect)((function(){if(v){var e=d.current;e&&e.scrollTo(e.scrollLeft-v.x*t.x,e.scrollTop-v.y*t.y)}}),[v,t]);var O=Object(r.useCallback)((function(e){var t=new R(e.direction.x,-1*e.direction.y);e.direction.x===e.direction.y&&(t=new R(0,-1*e.direction.y));var n=new R(t.x,0).add(new R(-.5,-1).multiply(t.y));a.playerUI.virtualGridLocation.enqueueUpdate((function(e){return e.add(me.FromVector2(t,0))})),b(n)}),[a]),j=l.getForceJumpOffset;Object(r.useEffect)((function(){var e=null===j||void 0===j?void 0:j();e&&a.playerUI.virtualGridLocation.enqueueUpdate((function(t){return t.addX(e.x).add(new me(-1,-2,0).multiply(e.y/2))}))}),[a,j]);var y=l.enableScrollJump,g=Object(r.useCallback)((function(e){if(y){var r={x:0,y:0},a=e.target,o=a.scrollTop,c=a.scrollLeft;a.scrollTop<.9*t.y&&(o+=2*t.y,r.y-=1),a.scrollTop>(n.y-.9)*t.y-i.y&&(o-=2*t.y,r.y+=1),a.scrollLeft<.9*t.x&&(c+=2*t.x,r.x-=1),a.scrollLeft>(n.x-.9)*t.x-i.x&&(c-=2*t.x,r.x+=1),a.scrollTop===o&&a.scrollLeft===c||O({direction:new R(r.x,r.y)})}}),[i,O,t,n,y]);return Object(r.useEffect)((function(){if(!u.equals(R.Zero)){var e=null,t=function(){var t=d.current;if(t){var n=R.Zero;if(null===e)n=u.multiply(8),e=+new Date;else{var r=+new Date-e;r>40&&console.log("WAS SLOW - "+r.toString()),n=u.multiply(r),e=+new Date}n=n.multiply(.75),t.scrollTo(t.scrollLeft+n.x,t.scrollTop-n.y)}},n=setInterval(t,8);return t(),function(){return clearInterval(n)}}}),[u]),Object(p.jsx)("div",{ref:d,className:s()({"game-area":!0,"hidden-scrollbars":!(null===l||void 0===l?void 0:l.debugShowScrollbars)}),hidden:e.hidden,onScroll:g,children:Object(p.jsx)("div",{className:"virtual-game-area",children:e.children})})}var zt=i.a.memo(Gt);function Gt(e){var t=e.gameState,n=e.appSize,i=e.virtualGridDims,a=Object(r.useCallback)((function(e){return function(e){var t=e.virtualCoords,n=e.virtualGridLocation,r=e.virtualGridDims.divide(2).floor(),i=t.subtract(r),a=R.Zero;return a=(a=i.y%2===0?new R(-1,-2).multiply(i.y/2):r.y%2===0?new R(0,-1).add(new R(-1,-2).multiply((i.y-1)/2)):new R(-1,-1).add(new R(-1,-2).multiply((i.y-1)/2))).addX(i.x),n.add(me.FromVector2(a,0))}({virtualCoords:e,virtualGridDims:i,virtualGridLocation:t.playerUI.virtualGridLocation})}),[t.playerUI.virtualGridLocation,i]),o=Object(r.useCallback)((function(e){return function(e){var t=e.location,n=e.virtualGridLocation,r=e.virtualGridDims.divide(2).floor(),i=t.subtract(n),a=R.Zero;return 0!==i.z?null:(a=(a=i.y%2===0?new R(-1,-2).multiply(i.y/2):r.y%2===0?new R(-1,-1).add(new R(-1,-2).multiply((i.y-1)/2)):new R(0,-1).add(new R(-1,-2).multiply((i.y-1)/2))).addX(i.x),r.add(a))}({location:e,virtualGridDims:i,virtualGridLocation:t.playerUI.virtualGridLocation})}),[t.playerUI.virtualGridLocation,i]),c=Object(r.useCallback)((function(n){var r,i,a=n.nodeLocation,o=n.newStatus,c=(null===(r=t.computed.reachableStatusMap)||void 0===r?void 0:r.get(a))||xe.false;if(o===pe.TAKEN){if(c!==xe.true)return void console.log("cant do that, not reachable:",c);var u=t.worldGen.lockMap.get(a);if(u)return void console.log("is locked",u)}(null===(i=t.playerSave.allocationStatusMap.get(a))||void 0===i?void 0:i.taken)||e.actions.allocateNode.enqueueAction({nodeLocation:a,newStatus:ge.true})}),[e.actions,t.playerSave.allocationStatusMap,t.computed.reachableStatusMap,t.worldGen.lockMap]),u=Object(r.useCallback)((function(e){var t=e.virtualCoords,n=e.newStatus,r=a(t);c({nodeLocation:r,newStatus:n})}),[a,c]),s=Object(r.useCallback)((function(t){e.updaters.playerUI.cursoredNodeLocation.enqueueUpdate((function(e){return t})),t&&(e.updaters.playerUI.isSidebarOpen.enqueueUpdate((function(){return!0})),e.updaters.playerUI.isLeftSidebarOpen.enqueueUpdate((function(){return!0})),e.updaters.playerUI.isRightSidebarOpen.enqueueUpdate((function(){return!0})))}),[e.updaters]),l=Object(r.useMemo)((function(){return t.playerUI.cursoredNodeLocation?o(t.playerUI.cursoredNodeLocation):null}),[t.playerUI.cursoredNodeLocation,o]);Object(r.useEffect)((function(){var t=a(i.divide(2).floor());e.gameState.intent.newIntent.MOVE_CURSOR_EAST&&e.updaters.playerUI.cursoredNodeLocation.enqueueUpdate((function(e){return(null===e||void 0===e?void 0:e.addX(1))||t})),e.gameState.intent.newIntent.MOVE_CURSOR_WEST&&e.updaters.playerUI.cursoredNodeLocation.enqueueUpdate((function(e){return(null===e||void 0===e?void 0:e.addX(-1))||t})),e.gameState.intent.newIntent.MOVE_CURSOR_NORTHEAST&&e.updaters.playerUI.cursoredNodeLocation.enqueueUpdate((function(e){return(null===e||void 0===e?void 0:e.add({x:1,y:1,z:0}))||t})),e.gameState.intent.newIntent.MOVE_CURSOR_NORTHWEST&&e.updaters.playerUI.cursoredNodeLocation.enqueueUpdate((function(e){return(null===e||void 0===e?void 0:e.addY(1))||t})),e.gameState.intent.newIntent.MOVE_CURSOR_SOUTHEAST&&e.updaters.playerUI.cursoredNodeLocation.enqueueUpdate((function(e){return(null===e||void 0===e?void 0:e.addY(-1))||t})),e.gameState.intent.newIntent.MOVE_CURSOR_SOUTHWEST&&e.updaters.playerUI.cursoredNodeLocation.enqueueUpdate((function(e){return(null===e||void 0===e?void 0:e.add({x:-1,y:-1,z:0}))||t})),e.gameState.intent.newIntent.MOVE_CURSOR_SOUTH&&e.updaters.playerUI.cursoredNodeLocation.enqueueUpdate((function(e){return e&&e.y%2===0?null===e||void 0===e?void 0:e.add({x:0,y:-1,z:0}):e&&e.y%2!==0?null===e||void 0===e?void 0:e.add({x:-1,y:-1,z:0}):t})),e.gameState.intent.newIntent.MOVE_CURSOR_NORTH&&e.updaters.playerUI.cursoredNodeLocation.enqueueUpdate((function(e){return e&&e.y%2===0?null===e||void 0===e?void 0:e.add({x:1,y:1,z:0}):e&&e.y%2!==0?null===e||void 0===e?void 0:e.add({x:0,y:1,z:0}):t})),e.gameState.intent.newIntent.INTERACT_WITH_NODE&&l&&u({virtualCoords:l,newStatus:pe.TAKEN})}),[e.gameState.intent.newIntent.INTERACT_WITH_NODE,e.gameState.intent.newIntent.MOVE_CURSOR_EAST,e.gameState.intent.newIntent.MOVE_CURSOR_NORTH,e.gameState.intent.newIntent.MOVE_CURSOR_NORTHEAST,e.gameState.intent.newIntent.MOVE_CURSOR_NORTHWEST,e.gameState.intent.newIntent.MOVE_CURSOR_SOUTH,e.gameState.intent.newIntent.MOVE_CURSOR_SOUTHEAST,e.gameState.intent.newIntent.MOVE_CURSOR_SOUTHWEST,e.gameState.intent.newIntent.MOVE_CURSOR_WEST,e.updaters,a,i,l,u]),Object(r.useEffect)((function(){if(e.gameState.intent.newIntent.ZOOM_RECENTER_AT_NODE){var n=t.playerUI.cursoredNodeLocation;n&&(e.updaters.playerUI.virtualGridLocation.enqueueUpdate((function(e){return n})),e.updaters.playerUI.triggerScrollRecenterCb.enqueueUpdate((function(){return function(){console.log("zoomed to location: ",{location:n})}})))}}),[e.gameState.intent.newIntent.ZOOM_RECENTER_AT_NODE,t.playerUI.cursoredNodeLocation,e.updaters]);var d=Object(r.useMemo)((function(){var t=R.Zero;return e.gameState.intent.activeIntent.PAN_EAST&&(t=t.addX(1)),e.gameState.intent.activeIntent.PAN_WEST&&(t=t.addX(-1)),e.gameState.intent.activeIntent.PAN_NORTH&&(t=t.addY(1)),e.gameState.intent.activeIntent.PAN_SOUTH&&(t=t.addY(-1)),t}),[e.gameState.intent.activeIntent.PAN_EAST,e.gameState.intent.activeIntent.PAN_WEST,e.gameState.intent.activeIntent.PAN_NORTH,e.gameState.intent.activeIntent.PAN_SOUTH]),h=Object(r.useMemo)((function(){return{debugShowScrollbars:t.debug.debugShowScrollbars,enableScrollJump:t.debug.enableScrollJump,getForceJumpOffset:t.debug.getForceJumpOffset}}),[t.debug.debugShowScrollbars,t.debug.enableScrollJump,t.debug.getForceJumpOffset]),f=Object(r.useMemo)((function(){return{rerenderGameAreaGrid:t.debug.rerenderGameAreaGrid,getOffsetX:t.debug.getOffsetX,isFlipCursored:t.debug.isFlipCursored}}),[t.debug.rerenderGameAreaGrid,t.debug.getOffsetX,t.debug.isFlipCursored]),v=Object(r.useMemo)((function(){return Ut(t)}),Nt(t));return Object(p.jsx)(p.Fragment,{children:Object(p.jsx)(Lt,{hidden:!t.playerUI.isPixiHidden,appSize:n,triggerScrollRecenterCb:t.playerUI.triggerScrollRecenterCb,updaters:e.updaters,hexGridPx:Ft,virtualGridDims:i,keyboardScrollDirection:d,debug:h,children:Object(p.jsx)(Rt,{gameState:v,virtualGridDims:i,virtualCoordsToLocation:a,updateNodeStatusByLocationCb:c,cursoredVirtualNode:l,setCursoredLocation:s,debug:f})})})}var Ft=new R(194,168);function Ht(e){return{playerUI:{virtualGridLocation:e.playerUI.virtualGridLocation,cursoredNodeLocation:e.playerUI.cursoredNodeLocation,isPixiHidden:e.playerUI.isPixiHidden,triggerScrollRecenterCb:e.playerUI.triggerScrollRecenterCb},playerSave:{allocationStatusMap:e.playerSave.allocationStatusMap},worldGen:{nodeContentsMap:e.worldGen.nodeContentsMap,lockMap:e.worldGen.lockMap},computed:{fogOfWarStatusMap:e.computed.fogOfWarStatusMap,reachableStatusMap:e.computed.reachableStatusMap,lockStatusMap:e.computed.lockStatusMap},intent:e.intent,debug:{debugShowScrollbars:e.debug.debugShowScrollbars,rerenderGameAreaGrid:e.debug.rerenderGameAreaGrid,enableScrollJump:e.debug.enableScrollJump,getForceJumpOffset:e.debug.getForceJumpOffset,getOffsetX:e.debug.getOffsetX,isFlipCursored:e.debug.isFlipCursored}}}var qt=m(Ht);function Wt(e){var t=e.gameState,n=Object(r.useMemo)((function(){return $e(new R(t.windowState.innerWidth,t.windowState.innerHeight))}),[t.windowState.innerWidth,t.windowState.innerHeight]),i=t.debug.retriggerVirtualGridDims,a=Object(r.useMemo)((function(){i();var e=Math.floor(2*n.x/Ft.x-.5),t=Math.floor(2*n.y/Ft.y);return new R(e,t)}),[n,i]),o=Object(r.useMemo)((function(){return Ht(t)}),qt(t)),c=Object(r.useMemo)((function(){return{allocateNode:new St(e.updaters)}}),[e.updaters]);return Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)(xt,{appSize:n,hexCenterRadius:44,hexGridPx:Ft,borderWidth:2,COLORS:A}),Object(p.jsx)(zt,{appSize:n,virtualGridDims:a,gameState:o,updaters:e.updaters,actions:c})]})}function Vt(e){var t=e.gameState,n=t.tick,i=Object(r.useState)(+new Date),a=Object(c.a)(i,2),o=a[0],u=a[1],s=Object(r.useState)([]),l=Object(c.a)(s,2),d=l[0],h=l[1],f=Object(r.useMemo)((function(){return $e(new R(t.windowState.innerWidth,t.windowState.innerHeight))}),[t.windowState.innerWidth,t.windowState.innerHeight]),v=Object(r.useMemo)((function(){var e=Math.floor(2*f.x/Ft.x-.5),t=Math.floor(2*f.y/Ft.y);return new R(e,t)}),[f]);Object(r.useEffect)((function(){var e=new Date,t=+e-o;if(t>30){var r="Tick ".concat(n," took ").concat(t,"ms at ").concat(e.toTimeString().split(" ")[0]);console.log(r),h((function(e){return[r].concat(Object(Y.a)(e))}))}u(+new Date)}),[n,o,u,h]);var b=Object(r.useCallback)((function(){console.log("tried triggered update from debug tab"),e.updaters.debug.retriggerVirtualGridDims.enqueueUpdate((function(e){return function(){console.log("force triggered update from debug tab")}}))}),[e.updaters]),O=Object(r.useCallback)((function(){var t;null===(t=e.updaters.debug.debugShowScrollbars)||void 0===t||t.enqueueUpdate((function(e){return!e}))}),[e.updaters]),j=Object(r.useCallback)((function(){e.updaters.debug.rerenderGameAreaGrid.enqueueUpdate((function(e){return function(){console.log("force triggered react rerender from debug tab")}}))}),[e.updaters]),y=Object(r.useCallback)((function(){e.updaters.debug.enableScrollJump.enqueueUpdate((function(){return!1}))}),[e.updaters]),g=Object(r.useCallback)((function(){e.updaters.debug.enableScrollJump.enqueueUpdate((function(){return!0}))}),[e.updaters]),S=Object(r.useCallback)((function(){e.updaters.debug.getForceJumpOffset.enqueueUpdate((function(e){return function(){return console.log("force triggered virtual jump only"),new R(1,2)}}))}),[e.updaters]),x=Object(r.useCallback)((function(){e.updaters.debug.getOffsetX.enqueueUpdate((function(e){var t=e()||0;return function(){return t+1}}))}),[e.updaters]),m=Object(r.useCallback)((function(){e.updaters.debug.isFlipCursored.enqueueUpdate((function(e){var t=e()||!1;return function(){return!t}}))}),[e.updaters]),k=Object(r.useCallback)((function(){e.updaters.playerUI.isTextBoxFocused.enqueueUpdate((function(e){var t=!e;return console.log({isTextBoxFocused:t}),t}))}),[e.updaters]),w=Object(r.useCallback)((function(){hn.store(e.gameState.playerUI)}),[e.gameState]),E=Object(r.useCallback)((function(){var t=hn.load();t&&e.updaters.playerUI.enqueueUpdate((function(){return t}))}),[e.updaters]),T=Object(r.useCallback)((function(){hn.clear(),new gt({}).clear(),vt(),e.updaters.justDisabledSave.enqueueUpdate(!0)}),[e.updaters]),C=Object(r.useCallback)((function(){vt(),e.updaters.playerSave.enqueueUpdate((function(e){return ht()})),e.updaters.justDisabledSave.enqueueUpdate(!0)}),[e.updaters]);return e.hidden?Object(p.jsx)(p.Fragment,{children:" "}):Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)("div",{children:" debug tab "}),Object(p.jsxs)("div",{className:"tab-content-body",children:[Object(p.jsx)("br",{}),Object(p.jsx)("div",{children:"Recent slow renders:"}),d.slice(0,5).map((function(e,t){return Object(p.jsx)("div",{children:e},t)})),Object(p.jsx)("br",{})]}),Object(p.jsx)("br",{}),Object(p.jsx)("div",{children:" virtual grid location "}),Object(p.jsxs)("div",{children:["( ",t.playerUI.virtualGridLocation.x," ,"," ",t.playerUI.virtualGridLocation.y," )"]}),Object(p.jsx)("br",{}),Object(p.jsx)("div",{children:" virtual grid dims "}),Object(p.jsxs)("div",{children:["( ",v.x," , ",v.y," )"]}),Object(p.jsx)("br",{}),Object(p.jsx)("div",{children:" buttons "}),Object(p.jsxs)("div",{className:"tab-content-body",children:[Object(p.jsx)("br",{}),Object(p.jsx)("div",{children:Object(p.jsx)("button",{onClick:O,children:"Toggle scrollbars"})}),Object(p.jsx)("div",{children:Object(p.jsx)("button",{onClick:b,children:"Trigger virtual grid dims rerender"})}),Object(p.jsx)("div",{children:Object(p.jsx)("button",{onClick:j,children:"Trigger only virtual game area grid react rerender"})}),Object(p.jsx)("div",{children:Object(p.jsx)("button",{onClick:y,children:"Disable scroll jump trigger"})}),Object(p.jsx)("div",{children:Object(p.jsx)("button",{onClick:g,children:"Reenable scroll jump trigger"})}),Object(p.jsx)("div",{children:Object(p.jsx)("button",{onClick:S,children:"Force virtual grid jump only"})}),Object(p.jsx)("div",{children:Object(p.jsx)("button",{onClick:x,children:"add weird x offset to grid"})}),Object(p.jsx)("div",{children:Object(p.jsx)("button",{onClick:m,children:"weird flip cursored state on all nodes"})}),Object(p.jsx)("div",{children:Object(p.jsx)("button",{onClick:k,children:"toggle text box focused"})}),Object(p.jsx)("div",{children:Object(p.jsx)("button",{onClick:w,children:"save state to local storage"})}),Object(p.jsx)("div",{children:Object(p.jsx)("button",{onClick:E,children:"load state from local storage"})}),Object(p.jsx)("div",{children:Object(p.jsx)("button",{onClick:T,children:"clear local storage and disable saving"})}),Object(p.jsx)("div",{children:Object(p.jsx)("button",{onClick:C,children:"clear save"})})]})]})}var Bt=i.a.memo(Xt);function Xt(e){var t=e.gameState,n=e.updaters,i=Object(r.useState)(!1),a=Object(c.a)(i,2),o=a[0],u=a[1],s=Object(r.useState)(""),l=Object(c.a)(s,2),d=l[0],h=l[1],f=Object(r.useCallback)((function(){n.playerUI.isTextBoxFocused.enqueueUpdate(!0)}),[n]),v=Object(r.useCallback)((function(){n.playerUI.isTextBoxFocused.enqueueUpdate(!1)}),[n]),b=Object(r.useCallback)((function(){n.playerUI.strategicSearch.highlight1.enqueueUpdate((function(){return{value:d}}))}),[n,d]),O=Object(r.useCallback)((function(){h(""),n.playerUI.strategicSearch.highlight1.enqueueUpdate((function(){return{value:""}}))}),[n]),j=Object(r.useCallback)((function(e){n.playerUI.strategicSearch.colors.enabled.enqueueUpdate((function(t){return e.target.checked}))}),[n]);return t.playerUI.isPixiHidden?Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)("div",{children:"Strategic view is not open!"}),Object(p.jsx)("br",{}),Object(p.jsx)("div",{children:"Click [m] to toggle strategic view."})]}):Object(p.jsxs)(p.Fragment,{children:[Object(p.jsxs)("div",{children:[o?"Custom":"Basic"," search"]}),Object(p.jsx)("br",{}),Object(p.jsxs)("div",{className:"tab-content-body",children:[Object(p.jsxs)("div",{children:[Object(p.jsx)("input",{type:"checkbox",onChange:j,defaultChecked:t.playerUI.strategicSearch.colors.enabled})," ","Colors enabled?"]}),Object(p.jsx)("br",{}),Object(p.jsxs)("div",{children:["Symbols: ",Object(p.jsx)(Zt,{updateTextInputValue:h,attribute:Ee.RED0}),Object(p.jsx)(Zt,{updateTextInputValue:h,attribute:Ee.RED1}),Object(p.jsx)(Zt,{updateTextInputValue:h,attribute:Ee.RED2}),Object(p.jsx)(Zt,{updateTextInputValue:h,attribute:Ee.DEL0}),Object(p.jsx)(Zt,{updateTextInputValue:h,attribute:Ee.DEL1}),Object(p.jsx)(Zt,{updateTextInputValue:h,attribute:Ee.DEL2}),Object(p.jsx)(Jt,{updateTextInputValue:h,icon:"*",insertedText:"[*] "}),Object(p.jsx)("br",{}),Object(p.jsx)(Jt,{updateTextInputValue:h,id:Te.FLAT,icon:qe[Te.FLAT],insertedText:"["+We[Te.FLAT]+"] "}),Object(p.jsx)(Jt,{updateTextInputValue:h,id:Te.INCREASED,icon:qe[Te.INCREASED],insertedText:"["+We[Te.INCREASED]+"] "})]}),Object(p.jsx)("br",{}),Object(p.jsxs)("div",{children:["Highlight:"," ",Object(p.jsx)("input",{type:"text",onFocus:f,onChange:function(e){h(e.target.value)},onBlur:v,value:d}),Object(p.jsx)("button",{onClick:b,children:"\ud83d\udd0e"}),Object(p.jsx)("button",{onClick:O,children:"\ud83d\udeab"})]}),o?Object(p.jsxs)(p.Fragment,{children:[Object(p.jsxs)("div",{children:["Highlight 2: ",Object(p.jsx)("input",{type:"text"}),Object(p.jsx)("button",{children:"Apply"}),Object(p.jsx)("button",{children:"Cancel"})]}),Object(p.jsx)("br",{}),Object(p.jsx)("div",{children:"Filter:"}),Object(p.jsx)("br",{}),Object(p.jsxs)("div",{children:["Show if: ",Object(p.jsx)("input",{type:"text"}),Object(p.jsx)("button",{children:"Apply"}),Object(p.jsx)("button",{children:"Cancel"})]}),Object(p.jsx)("br",{}),Object(p.jsx)("div",{children:"Color:"}),Object(p.jsx)("br",{}),Object(p.jsxs)("div",{children:["Grayscale by: ",Object(p.jsx)("input",{type:"text"}),Object(p.jsx)("button",{children:"Apply"}),Object(p.jsx)("button",{children:"Cancel"})]}),Object(p.jsxs)("div",{children:["Color by: ",Object(p.jsx)("input",{type:"text"}),Object(p.jsx)("button",{children:"Apply"}),Object(p.jsx)("button",{children:"Cancel"})]}),Object(p.jsx)("br",{}),Object(p.jsx)("div",{children:"Shape:"}),Object(p.jsx)("br",{}),Object(p.jsxs)("div",{children:["Shape = | if: ",Object(p.jsx)("input",{type:"text"}),Object(p.jsx)("button",{children:"Apply"}),Object(p.jsx)("button",{children:"Cancel"})]}),Object(p.jsx)("br",{}),Object(p.jsx)("br",{}),Object(p.jsxs)("div",{children:[Object(p.jsx)("input",{type:"text"}),Object(p.jsx)("button",{children:"Save config"})]}),Object(p.jsxs)("div",{children:[Object(p.jsx)("input",{type:"text"}),Object(p.jsx)("button",{children:"Load config"})]}),Object(p.jsx)("div",{children:Object(p.jsx)("button",{children:"Reset to defaults"})}),Object(p.jsx)("br",{}),Object(p.jsx)("div",{children:Object(p.jsx)("button",{onClick:function(){u(!1)},children:"Use basic search"})})]}):Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)("br",{}),Object(p.jsx)("div",{children:Object(p.jsx)("button",{onClick:function(){u(!0)},children:"Use custom search"})})]})]})]})}function Zt(e){return Object(p.jsx)(Jt,{updateTextInputValue:e.updateTextInputValue,insertedText:"["+Fe[e.attribute]+"] ",icon:ze[e.attribute]})}function Jt(e){return Object(p.jsx)("button",{onMouseDown:function(e){e.preventDefault()},onPointerDown:function(e){e.preventDefault()},onClick:function(t){t.preventDefault(),e.updateTextInputValue((function(t){return t+e.insertedText}))},children:e.icon})}var Kt=i.a.memo(Yt);function Yt(e){var t,n,i,a,o,c,u,s,l=e.gameState,d=l.playerUI.cursoredNodeLocation,h=Object(r.useCallback)((function(t){t.preventDefault(),d&&e.actions.allocateNode.enqueueAction({nodeLocation:d,newStatus:ge.true})}),[e.actions.allocateNode,d]),f=Object(r.useCallback)((function(t){t.preventDefault(),d&&(e.updaters.playerUI.virtualGridLocation.enqueueUpdate((function(e){return d})),e.updaters.playerUI.triggerScrollRecenterCb.enqueueUpdate((function(){return function(){console.log("zoomed to location: ",{location:d})}})))}),[e.updaters,d]);if(null===d)return Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)("div",{children:"Nothing selected!"}),Object(p.jsx)("div",{children:Object(p.jsx)("br",{})}),Object(p.jsx)("div",{children:"Hover and click the"}),Object(p.jsx)("div",{children:" question mark tooltip to"}),Object(p.jsx)("div",{children:"select a node."})]});var v=new R(d.x-d.y/2,d.y*Math.sqrt(3)/2);v=new R(Math.round(100*v.x)/100,Math.round(100*v.y)/100);var b=(null===(t=l.playerSave.allocationStatusMap)||void 0===t||null===(n=t.get(d))||void 0===n?void 0:n.taken)||!1,O=(null===(i=l.computed.reachableStatusMap)||void 0===i||null===(a=i.get(d))||void 0===a?void 0:a.reachable)||!1,j=(null===(o=l.computed.fogOfWarStatusMap)||void 0===o||null===(c=o.get(d))||void 0===c?void 0:c.visible)||!1,y=j&&(null===(u=l.worldGen.lockMap)||void 0===u?void 0:u.get(d))||null,g=O&&!y&&!b,S="";S=d.equals(me.Zero)?kt:j?void 0!==(null===(s=l.worldGen.lockMap)||void 0===s?void 0:s.get(d))?"A locked node.":"An allocatable node.":"Unknown.";var x=j&&l.worldGen.nodeContentsMap.get(d)||null,m=(null===x||void 0===x?void 0:x.lines[0])?Et(x):"empty";return Object(p.jsx)(p.Fragment,{children:Object(p.jsxs)("div",{className:"tab-content-body",children:[Object(p.jsxs)("div",{children:["Location: ( ",v.x," , ",v.y," ) , z-layer = ",d.z]}),Object(p.jsx)("br",{}),Object(p.jsx)("div",{children:Object(p.jsx)("button",{onClick:f,children:"Zoom to here (hotkey: z)"})}),Object(p.jsx)("br",{}),Object(p.jsxs)("div",{children:["Description: ",S]}),Object(p.jsx)("br",{}),Object(p.jsxs)("div",{children:["Taken?: ",b.toString()]}),Object(p.jsxs)("div",{children:["Reachable?: ",O.toString()]}),Object(p.jsxs)("div",{children:["Visible?: ",j.toString()]}),j?Object(p.jsxs)(p.Fragment,{children:[Object(p.jsxs)("div",{children:["Locked?: ",(!!y).toString()]}),Object(p.jsxs)("div",{children:["Can be allocated?: ",g.toString()]}),Object(p.jsx)("br",{}),Object(p.jsxs)("div",{children:["Contents: ",m]}),Object(p.jsx)("br",{}),Object(p.jsx)("button",{disabled:!g,onClick:h,children:"Allocate (hotkey: spacebar)"})]}):Object(p.jsx)(p.Fragment,{children:" "})]})})}var Qt,$t=i.a.memo(en);function en(e){var t=e.gameState,n=Object(r.useState)(!1),i=Object(c.a)(n,2),a=i[0],o=i[1],u=Object.fromEntries(S(Ee).map((function(e){var n=Fe[e],r=ze[e],i=Object.fromEntries(S(Te).map((function(n){var r=t.playerSave.allocationStatusMap.entries().map((function(r){var i,a,o,u,s=Object(c.a)(r,2),l=s[0];if(!s[1].taken)return 0;var d=t.worldGen.nodeContentsMap.get(l);return(null===(i=d.lines[0])||void 0===i?void 0:i.attribute)===e&&(null===(a=d.lines[0])||void 0===a?void 0:a.modifier)===n?d.lines[0].amount:(null===(o=d.lines[1])||void 0===o?void 0:o.attribute)===e&&(null===(u=d.lines[1])||void 0===u?void 0:u.modifier)===n?d.lines[1].amount:0})).reduce((function(e,t){return e+t}));return[n,r]}))),o=Object(p.jsx)(p.Fragment,{children:Object(p.jsxs)("details",{className:"details",open:a,children:[Object(p.jsxs)("summary",{children:[" ",r," (",n,"):"]}),Object(p.jsxs)("div",{className:"details-body",children:[Object(p.jsxs)("div",{children:["+: ",i[Te.FLAT]]}),Object(p.jsxs)("div",{children:["%: ",i[Te.INCREASED]]}),Object(p.jsxs)("div",{className:"final-total",children:["Total:"," ",Math.round(i[Te.FLAT]*(1+.01*i[Te.INCREASED]))]})]})]})});return[e,o]})));return Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)("div",{children:"Current stats"}),Object(p.jsx)("br",{}),Object(p.jsxs)("div",{children:[Object(p.jsx)("button",{onClick:function(){o(!0)},children:"Open all"})," ",Object(p.jsx)("button",{onClick:function(){o(!1)},children:"Close all"})]}),Object(p.jsx)("br",{}),Object(p.jsxs)("div",{className:"tab-content-body",children:[u[Ee.RED0],u[Ee.RED1],u[Ee.RED2],u[Ee.DEL0],u[Ee.DEL1],u[Ee.DEL2]]})]})}function tn(e){var t,n=e.tabName,r=(t={},Object($.a)(t,Qt.EMPTY,Object(p.jsx)(rn,{})),Object($.a)(t,Qt.SELECTED_NODE,Object(p.jsx)(Kt,{gameState:e.gameState,updaters:e.updaters,actions:e.actions})),Object($.a)(t,Qt.STATS,Object(p.jsx)($t,{gameState:e.gameState,updaters:e.updaters})),Object($.a)(t,Qt.QUESTS,Object(p.jsx)(p.Fragment,{children:"quests info???"})),Object($.a)(t,Qt.STRATEGIC_VIEW,Object(p.jsx)(Bt,{gameState:e.gameState,updaters:e.updaters})),Object($.a)(t,Qt.DEBUG,Object(p.jsx)(Vt,{gameState:e.gameState,updaters:e.updaters,hidden:n!==Qt.DEBUG})),Object($.a)(t,Qt.HELP,Object(p.jsx)(p.Fragment,{children:"How to play the game"})),t);return Object(p.jsx)(nn,{tabComponents:r,tabName:n})}function nn(e){var t=e.tabName,n=Object.keys(Qt);return Object(p.jsx)(p.Fragment,{children:n.map((function(n){return Object(p.jsx)("div",{hidden:n!==t,children:e.tabComponents[n]},n)}))})}!function(e){e.EMPTY="EMPTY",e.SELECTED_NODE="SELECTED_NODE",e.STATS="STATS",e.QUESTS="QUESTS",e.DEBUG="DEBUG",e.HELP="HELP",e.STRATEGIC_VIEW="STRATEGIC_VIEW"}(Qt||(Qt={}));var rn=i.a.memo(an);function an(e){return console.log("got here empty tab content"),Object(p.jsx)("div",{children:"Nothing here!"})}var on={left:[],right:[Qt.SELECTED_NODE,Qt.STATS,Qt.QUESTS,Qt.DEBUG,Qt.HELP,Qt.STRATEGIC_VIEW]},cn=function(){return{triggerScrollRecenterCb:function(){},tabs:{left:{tabs:on.left,activeIndex:0},right:{tabs:on.right,activeIndex:0}},strategicSearch:{colors:{enabled:!1},highlight1:{value:""}},isPixiHidden:!0,virtualGridLocation:me.Zero,cursoredNodeLocation:null,isSidebarOpen:!1,isLeftSidebarOpen:!1,isRightSidebarOpen:!1,isTextBoxFocused:!1}},un=function(e){return JSON.stringify(function(e){return Object(M.a)(Object(M.a)({},e),{},{triggerScrollRecenterCb:void 0,virtualGridLocation:me.SerializeToObject(e.virtualGridLocation)})}(e))},sn=function(e){return function(e){if(!e||!e.hasOwnProperty("isPixiHidden")||!e.hasOwnProperty("virtualGridLocation")||!e.hasOwnProperty("cursoredNodeLocation")||!e.hasOwnProperty("isSidebarOpen")||!e.hasOwnProperty("isLeftSidebarOpen")||!e.hasOwnProperty("isRightSidebarOpen")||!e.hasOwnProperty("isTextBoxFocused")||!e.hasOwnProperty("tabs")||!e.hasOwnProperty("strategicSearch"))return console.error("Failed deserializing PlayerUIState: ",e),null;var t=e.strategicSearch;if(!t||!t.hasOwnProperty("colors")||!t.hasOwnProperty("highlight1"))return console.error("Failed deserializing PlayerUIState: ",e),null;var n=me.Deserialize(e.virtualGridLocation);if(!n)return console.error("Failed deserializing PlayerUIState: ",e),null;var r=me.Deserialize(e.cursoredNodeLocation);return Object(M.a)(Object(M.a)({},e),{},{virtualGridLocation:n,cursoredNodeLocation:r,triggerScrollRecenterCb:function(){}})}(JSON.parse(e))},ln="PlayerUIState",dn=function(){var e=window.localStorage.getItem(ln);return e&&sn(e)||null},hn={new:cn,serialize:un,deserialize:sn,tryLoad:function(){var e=dn();return e||(console.log("Failed to load PlayerUIState"),cn())},load:dn,store:function(e){var t=un(e);window.localStorage.setItem(ln,t)},clear:function(){window.localStorage.setItem(ln,"")}};function pn(e){var t=e.gameState,n=Object(r.useCallback)((function(){t.justDisabledSave?console.log("skipping save because it was just disabled!"):(hn.store(t.playerUI),ft(t.playerSave),new gt({}).store(t.worldGen))}),[t.playerUI,t.justDisabledSave,t.worldGen,t.playerSave]);return Object(r.useEffect)((function(){return window.onbeforeunload=n,function(){window.onbeforeunload=null}})),Object(p.jsx)(p.Fragment,{children:" "})}function fn(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,t=e||vn,n=new gt({}),r={tick:0,worldGen:n.tryLoad({seed:t}),playerSave:pt(),playerUI:hn.tryLoad(),computed:{},intent:T(),windowState:Qe(),debug:{retriggerVirtualGridDims:function(){},debugShowScrollbars:!1,rerenderGameAreaGrid:function(){},enableScrollJump:!0,getForceJumpOffset:function(){},getOffsetX:function(){},isFlipCursored:function(){}},justDisabledSave:!1};return On(r),r}var vn=103043,bn=function(){function e(t){Object(l.a)(this,e),this.config=void 0,this.config=t}return Object(d.a)(e,[{key:"loadOrCreate",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;return fn(e)}},{key:"create",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,t=e||vn,n=new gt({}),r={tick:0,worldGen:n.create({seed:t}),playerSave:ct(),playerUI:hn.new(),computed:{},intent:T(),windowState:Qe(),debug:{retriggerVirtualGridDims:function(){},debugShowScrollbars:!1,rerenderGameAreaGrid:function(){},enableScrollJump:!0,getForceJumpOffset:function(){},getOffsetX:function(){},isFlipCursored:function(){}},justDisabledSave:!1};return On(r),r}}]),e}();function On(e){e.computed.lockStatusMap=new z,e.computed.fogOfWarStatusMap=new z,e.computed.reachableStatusMap=new z,Ot(me.Zero,5).forEach((function(t){e.worldGen.lockMap.precompute(t)}));var t,n=e.computed.lockStatusMap,r=e,i=Object(y.a)(r.worldGen.lockMap.entries());try{for(i.s();!(t=i.n()).done;){var a=Object(c.a)(t.value,2),o=a[0];if(a[1]){var u=ye.TICKING;n.put(o,u)}}}catch(h){i.e(h)}finally{i.f()}var s=e.computed.fogOfWarStatusMap,l=e.computed.reachableStatusMap,d=e;return e.playerSave.allocationStatusMap.entries().filter((function(e){var t=Object(c.a)(e,2);t[0];return!0===t[1].taken})).map((function(e){return e[0]})).forEach((function(e){s.put(e,Se.true),Ot(e,1).forEach((function(e){s.put(e,Se.true),l.put(e,xe.true)})),Ot(e,5,0,{contains:function(e){var t,n=null===(t=d.computed.lockStatusMap)||void 0===t?void 0:t.get(e);return!(!n||n===ye.OPEN)}}).forEach((function(e){var t;(null===(t=s.get(e))||void 0===t?void 0:t.visible)||(d.worldGen.lockMap.precompute(e),s.put(e,Se.true))}))})),e}n(254),n(255);function jn(e){var t=e.children,n=e.hidden,r=e.placement;return Object(p.jsx)("div",{className:"left"===r?"layout left-sidebar":"layout right-sidebar",hidden:n,children:Object(p.jsx)(p.Fragment,{children:t})})}n(256);var yn=i.a.memo(gn);function gn(e){var t=e.value,n=e.labels,r=e.onChange;return Object(p.jsx)("div",{className:"tab-label-container",children:n.map((function(e,n){return Object(p.jsx)(Sn,{onClick:r,value:n,active:t===n,children:e},n)}))})}var Sn=i.a.memo(xn);function xn(e){var t=e.onClick,n=e.value,i=e.active,a=e.children,o=Object(r.useCallback)((function(){t(n)}),[t,n]);return Object(p.jsx)("div",{className:i?"tab-label active":"tab-label inactive",children:Object(p.jsx)("div",{onClick:o,children:a})})}var mn=[Qt.EMPTY];Qt.SELECTED_NODE,Qt.STATS,Qt.QUESTS,Qt.DEBUG,Qt.HELP,Qt.STRATEGIC_VIEW;function kn(e){var t=e.gameState,n=e.updaters,i=Object(r.useCallback)((function(){n.playerUI.isSidebarOpen.enqueueUpdate((function(){return!1})),n.playerUI.isLeftSidebarOpen.enqueueUpdate((function(){return!1}))}),[n]),a=Object(r.useCallback)((function(){n.playerUI.isSidebarOpen.enqueueUpdate((function(){return!0})),n.playerUI.isLeftSidebarOpen.enqueueUpdate((function(){return!0}))}),[n]),o=Object(r.useCallback)((function(){n.playerUI.isSidebarOpen.enqueueUpdate((function(){return!1})),n.playerUI.isRightSidebarOpen.enqueueUpdate((function(){return!1}))}),[n]),c=Object(r.useCallback)((function(){n.playerUI.isSidebarOpen.enqueueUpdate((function(){return!0})),n.playerUI.isRightSidebarOpen.enqueueUpdate((function(){return!0}))}),[n]),u=t.playerUI.tabs,s=n.playerUI.tabs,l=u.left.tabs,d=u.right.tabs,h=u.left.activeIndex,f=u.right.activeIndex,v=s.left.tabs.enqueueUpdate,b=s.right.tabs.enqueueUpdate,O=s.left.activeIndex.enqueueUpdate,j=s.right.activeIndex.enqueueUpdate,y=Object(r.useCallback)((function(){if(0!==d.length){var e=d[f];if(void 0!==e){var t=d.slice(0,f).concat(d.slice(f+1));b(t),j(Math.max(0,Math.min(f,t.length-1)));var n=[].concat(Object(Y.a)(l),[e]);v(n),O(n.length-1),a()}}}),[l,v,d,b,O,f,j,a]),g=Object(r.useCallback)((function(){if(0!==l.length){var e=l[h];if(void 0!==e){var t=l.slice(0,h).concat(l.slice(h+1));v(t),O(Math.max(Math.min(h,t.length-1),0));var n=[].concat(Object(Y.a)(d),[e]);b(n),j(n.length-1),c()}}}),[l,v,d,b,h,O,j,c]),S=Object(r.useMemo)((function(){return 0===l.length?Qt.EMPTY:l[h]}),[l,h]),x=Object(r.useMemo)((function(){return 0===d.length?Qt.EMPTY:d[f]}),[d,f]),m=Object(r.useMemo)((function(){return{allocateNode:new St(e.updaters)}}),[e.updaters]);return Object(p.jsxs)(p.Fragment,{children:[Object(p.jsxs)(jn,{hidden:!t.playerUI.isLeftSidebarOpen,placement:"left",children:[Object(p.jsxs)("div",{className:"sidebar-header",children:[Object(p.jsx)("div",{className:"sidebar-header-button",onClick:g,children:"\u27a1\ufe0f\ufe0f Send right"}),Object(p.jsx)("div",{className:"sidebar-header-gap"}),Object(p.jsx)("div",{className:"sidebar-header-button",onClick:function(){i()},children:"\u274e Close"})]}),Object(p.jsx)(yn,{value:h||0,labels:l.length?l:mn,onChange:O}),Object(p.jsx)(tn,{gameState:t,updaters:n,tabName:S,actions:m})]}),Object(p.jsxs)(jn,{hidden:!t.playerUI.isRightSidebarOpen,placement:"right",children:[Object(p.jsxs)("div",{className:"sidebar-header",children:[Object(p.jsx)("div",{className:"sidebar-header-button",onClick:y,children:"\u2b05\ufe0f Send left"}),Object(p.jsx)("div",{className:"sidebar-header-gap"}),Object(p.jsx)("div",{className:"sidebar-header-button",onClick:function(){o()},children:"\u274e Close"})]}),Object(p.jsx)(yn,{value:f||0,labels:d.length?d:mn,onChange:j}),Object(p.jsx)(tn,{gameState:t,updaters:n,tabName:x,actions:m})]})]})}var wn=new he((function(){return new bn({}).loadOrCreate(+new Date)}));var En=function(){var e=Object(r.useState)((function(){return wn.get()})),t=Object(c.a)(e,2),n=t[0],i=t[1],a=Object(r.useMemo)((function(){return Q(i)}),[i]),o=Object(c.a)(a,2),u=o[0],l=o[1],d=Object(r.useMemo)((function(){return te(wn.get(),u)}),[u]),h=Object(r.useMemo)((function(){return[n,d,l]}),[n,d,l]);return Object(r.useEffect)((function(){console.log("maybe toggling strategic view"),n.intent.newIntent.TOGGLE_STRATEGIC_VIEW&&d.playerUI.isPixiHidden.enqueueUpdate((function(e){return!e}))}),[n.intent.newIntent.TOGGLE_STRATEGIC_VIEW,d]),Object(r.useEffect)((function(){console.log("maybe toggling sidebar"),n.intent.newIntent.TOGGLE_SIDEBAR&&(d.playerUI.isSidebarOpen.enqueueUpdate((function(e){return!e})),d.playerUI.isLeftSidebarOpen.enqueueUpdate((function(e){return!e})),d.playerUI.isRightSidebarOpen.enqueueUpdate((function(e){return!e})))}),[n.intent.newIntent.TOGGLE_SIDEBAR,d]),Object(r.useEffect)((function(){n.intent.newIntent.TURN_OFF_SIDEBAR&&(d.playerUI.isLeftSidebarOpen.enqueueUpdate((function(e){return!1})),d.playerUI.isRightSidebarOpen.enqueueUpdate((function(e){return!1})))}),[n.intent.newIntent.TURN_OFF_SIDEBAR,d]),Object(p.jsxs)("div",{className:s()({App:!0}),children:[Object(p.jsxs)("div",{className:"entire-area",children:[Object(p.jsx)(_.Provider,{value:h,children:Object(p.jsx)(it,{hidden:n.playerUI.isPixiHidden})}),Object(p.jsx)(Wt,{gameState:n,updaters:d})]}),Object(p.jsx)("div",{className:"debug-overlay",children:Object(p.jsx)(f,{tick:n.tick,windowState:n.windowState})}),Object(p.jsxs)("div",{className:"button-zone",children:[Object(p.jsx)("button",{className:"button-pixi-toggle",style:{},onClick:function(){d.playerUI.isPixiHidden.enqueueUpdate((function(e){return!e}))},children:"Toggle strategic view (hotkey: m)"}),Object(p.jsx)("span",{children:" "}),Object(p.jsx)("button",{onClick:function(){d.playerUI.isSidebarOpen.enqueueUpdate((function(e){return!e})),d.playerUI.isLeftSidebarOpen.enqueueUpdate((function(e){return!e})),d.playerUI.isRightSidebarOpen.enqueueUpdate((function(e){return!e}))},children:"Toggle sidebars (hotkey: i)"})]}),Object(p.jsx)(kn,{gameState:n,updaters:d}),Object(p.jsx)(I,{isTextBoxFocused:n.playerUI.isTextBoxFocused,updaters:d.intent}),Object(p.jsx)(ot,{updaters:d.windowState}),Object(p.jsx)(pn,{gameState:n})]})};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(Object(p.jsx)(i.a.StrictMode,{children:Object(p.jsx)(En,{})}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},78:function(e,t,n){}},[[257,1,2]]]);
//# sourceMappingURL=main.0c4e8b88.chunk.js.map