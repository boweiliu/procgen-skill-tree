(this["webpackJsonpprocgen-skill-tree"]=this["webpackJsonpprocgen-skill-tree"]||[]).push([[0],{124:function(e,t,n){},133:function(e,t,n){},134:function(e,t,n){},135:function(e,t,n){},145:function(e,t){},147:function(e,t){},158:function(e,t){},160:function(e,t){},185:function(e,t){},187:function(e,t){},188:function(e,t){},193:function(e,t){},195:function(e,t){},214:function(e,t){},226:function(e,t){},229:function(e,t){},232:function(e,t,n){},233:function(e,t,n){},234:function(e,t,n){},235:function(e,t,n){"use strict";n.r(t);var i=n(0),r=n(1),a=n.n(r),o=n(125),c=n.n(o),u=(n(133),n(10)),s=(n(134),n(46)),d=n.n(s),l=(n(135),n(2)),h=n(3),p=function(){function e(){Object(l.a)(this,e),this.frameTimestampsInTicks=[],this.frameTimestampsInTime=[],this.frameTimestampsInTicks.push(0)}return Object(h.a)(e,[{key:"tick",value:function(e){var t=this.frameTimestampsInTicks[this.frameTimestampsInTicks.length-1];this.frameTimestampsInTicks.push(t+e),this.frameTimestampsInTicks.length>120&&(this.frameTimestampsInTicks=this.frameTimestampsInTicks.slice(60)),this.frameTimestampsInTime.push((new Date).getTime()),this.frameTimestampsInTime.length>120&&(this.frameTimestampsInTime=this.frameTimestampsInTime.slice(60))}},{key:"getUps",value:function(){var e=this.frameTimestampsInTicks[this.frameTimestampsInTicks.length-1]-this.frameTimestampsInTicks[0],t=(this.frameTimestampsInTicks.length-1)/e;return t?60*t:60}},{key:"getFps",value:function(){var e=this.frameTimestampsInTime[this.frameTimestampsInTime.length-1]-this.frameTimestampsInTime[0],t=(this.frameTimestampsInTime.length-1)/e;return t?1e3*t:60}},{key:"getFpsString",value:function(){return this.getFps().toFixed(1)}},{key:"getUpsString",value:function(){return this.getUps().toFixed(1)}}]),e}();function f(e){var t=Object(r.useRef)(new p);return Object(r.useEffect)((function(){t.current.tick(0)}),[e.tick]),Object(i.jsxs)("div",{className:"text",children:[Object(i.jsxs)("div",{children:[e.windowState.innerWidth,"x",e.windowState.innerHeight]}),Object(i.jsx)(v,{}),Object(i.jsxs)("div",{children:["UPS: ",t.current.getFpsString()]})]})}function v(){var e=Object(r.useState)(0),t=Object(u.a)(e,2),n=t[0],a=t[1],o=Object(r.useRef)(new p);Object(r.useEffect)((function(){var e=setTimeout((function(){a((function(e){return e+1})),o.current.tick(0)}),5);return function(){return clearTimeout(e)}}),[n]);var c=Object(r.useMemo)((function(){return o.current.getFpsString()}),[n]);return Object(i.jsxs)("div",{children:["RPS: ",c]})}var y=n(13),O=n(12),b=1e-7,S=n(8),m=function(){function e(){Object(l.a)(this,e)}return Object(h.a)(e,null,[{key:"MinBy",value:function(e,t){var n,i=null,r=null,a=Object(S.a)(e);try{for(a.s();!(n=a.n()).done;){var o=n.value,c=t(o);(null===r||c<r)&&(i=o,r=c)}}catch(u){a.e(u)}finally{a.f()}return i}},{key:"MinByAndValue",value:function(e,t){var n,i=null,r=null,a=Object(S.a)(e);try{for(a.s();!(n=a.n()).done;){var o=n.value,c=t(o);(null===r||c<r)&&(i=o,r=c)}}catch(u){a.e(u)}finally{a.f()}return null===i||null===r?null:{obj:i,value:r}}},{key:"MaxBy",value:function(e,t){var n,i=null,r=null,a=Object(S.a)(e);try{for(a.s();!(n=a.n()).done;){var o=n.value,c=t(o);(null===r||c>r)&&(i=o,r=c)}}catch(u){a.e(u)}finally{a.f()}return i}},{key:"RandRange",value:function(e,t){return Math.floor(Math.random()*(t-e)+e)}},{key:"SortByKey",value:function(e,t){return e.sort((function(e,n){return t(e)-t(n)}))}},{key:"ReplaceAll",value:function(e,t){var n=new RegExp(Object.keys(t).join("|"),"gi");return e.replace(n,(function(e){return t[e.toLowerCase()]}))}},{key:"Debounce",value:function(e){var t,n=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{isImmediate:!1},a=function(){for(var a=arguments.length,o=new Array(a),c=0;c<a;c++)o[c]=arguments[c];var u=function(){t=void 0,r.isImmediate||e.apply(n,o)},s=r.isImmediate&&void 0===t;void 0!==t&&clearTimeout(t),t=setTimeout(u,i),s&&e.apply(n,o)};return a}},{key:"FormatDate",value:function(e){var t=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][e.getMonth()];return"".concat(t," ").concat(e.getDate(),", ").concat(("00"+e.getHours()).substr(-2),":").concat(("00"+e.getMinutes()).substr(-2),":").concat(("00"+e.getSeconds()).substr(-2))}},{key:"FlattenByOne",value:function(e){var t,n=[],i=Object(S.a)(e);try{for(i.s();!(t=i.n()).done;){var r=t.value;n=n.concat(r)}}catch(a){i.e(a)}finally{i.f()}return n}},{key:"PadString",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:" ";return e+n+i.repeat(t-e.length)}}]),e}();function g(e,t){var n=[16711680&e,16711680&t],i=[255&e,255&t],r=[65280&e,65280&t],a=65536*Math.round(n[0]/65536*n[1]/16777215);return a+=256*Math.round(r[0]/256*r[1]/65280),a+=Math.round(i[0]*i[1]/255)}function k(e){return Object.keys(e)}var x=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{x:0,y:0},n=arguments.length>1?arguments[1]:void 0;Object(l.a)(this,e),this._x=void 0,this._y=void 0,"number"===typeof t?(this._x=t,this._y=n):(this._x=t.x,this._y=t.y)}return Object(h.a)(e,[{key:"x",get:function(){return this._x}},{key:"y",get:function(){return this._y}}]),Object(h.a)(e,[{key:"hash",value:function(){return this.toString()}},{key:"toString",value:function(){return"[".concat(this.x,", ").concat(this.y,"]")}},{key:"invert",value:function(){return new e({x:-this.x,y:-this.y})}},{key:"round",value:function(){return new e({x:Math.round(this.x),y:Math.round(this.y)})}},{key:"floor",value:function(){return new e({x:Math.floor(this.x),y:Math.floor(this.y)})}},{key:"taxicabDistance",value:function(e){return Math.abs(e.x-this.x)+Math.abs(e.y-this.y)}},{key:"diagonalDistance",value:function(e){return Math.max(Math.abs(e.x-this.x),Math.abs(e.y-this.y))}},{key:"distance",value:function(e){var t=Math.abs(e.x-this.x),n=Math.abs(e.y-this.y);return Math.sqrt(t*t+n*n)}},{key:"translate",value:function(t){return new e({x:this.x+t.x,y:this.y+t.y})}},{key:"subtract",value:function(t){return new e({x:this.x-t.x,y:this.y-t.y})}},{key:"add",value:function(t){return new e({x:this.x+t.x,y:this.y+t.y})}},{key:"addX",value:function(t){return new e({x:this.x+t,y:this.y})}},{key:"addY",value:function(t){return new e({x:this.x,y:this.y+t})}},{key:"subtractX",value:function(t){return new e({x:this.x-t,y:this.y})}},{key:"subtractY",value:function(t){return new e({x:this.x,y:this.y-t})}},{key:"clampX",value:function(t,n){var i=this.x;return i<t&&(i=t),i>n&&(i=n),new e({x:i,y:this.y})}},{key:"clampY",value:function(t,n){var i=this.y;return i<t&&(i=t),i>n&&(i=n),new e({x:this.x,y:i})}},{key:"scale",value:function(t,n){return new e({x:(this.x-t.x)*n.x+t.x,y:(this.y-t.y)*n.y+t.y})}},{key:"rotate",value:function(t,n){return n/=180/Math.PI,new e({x:Math.cos(n)*(this.x-t.x)-Math.sin(n)*(this.y-t.y)+t.x,y:Math.sin(n)*(this.x-t.x)+Math.cos(n)*(this.y-t.y)+t.y})}},{key:"equals",value:function(e){return void 0!==e&&(Math.abs(this.x-e.x)<b&&Math.abs(this.y-e.y)<b)}},{key:"multiply",value:function(t){return new e("number"===typeof t?{x:this.x*t,y:this.y*t}:{x:this.x*t.x,y:this.y*t.y})}},{key:"divide",value:function(t){return new e("number"===typeof t?{x:this.x/t,y:this.y/t}:{x:this.x/t.x,y:this.y/t.y})}},{key:"toJSON",value:function(){return{__type:"Vector2",x:this.x,y:this.y}}},{key:"transform",value:function(t,n){return new e({x:Math.floor((this.x-t.x)*n),y:Math.floor((this.y-t.y)*n)})}},{key:"normalize",value:function(){if(0===this.x&&0===this.y)return this;var t=Math.sqrt(this.x*this.x+this.y*this.y);return new e({x:this.x/t,y:this.y/t})}},{key:"withX",value:function(t){return new e({x:t,y:this.y})}},{key:"withY",value:function(t){return new e({x:this.x,y:t})}},{key:"invertX",value:function(){return new e({x:-this.x,y:this.y})}},{key:"lerp",value:function(e,t){return(t>1||t<0)&&console.error("Lerp t must be between 0 and 1."),0===t?this:1===t?e:this.scale({x:0,y:0},{x:1-t,y:1-t}).add(e.scale({x:0,y:0},{x:t,y:t}))}},{key:"lerp2D",value:function(e,t,n){return(t>1||t<0||n>1||n<0)&&console.error("Lerp t must be between 0 and 1."),this.scale({x:0,y:0},{x:1-t,y:1-n}).add(e.scale({x:0,y:0},{x:t,y:n}))}},{key:"coserp",value:function(e,t){return t=.5*(1+Math.cos(2*t*Math.PI)),this.lerp(e,t)}},{key:"half",get:function(){return new e({x:this.x/2,y:this.y/2})}}],[{key:"IsVector2",value:function(t){return t instanceof e}},{key:"Random",value:function(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return new e({x:m.RandRange(i,t),y:m.RandRange(r,n)})}},{key:"Deserialize",value:function(t){return t.hasOwnProperty("x")&&t.hasOwnProperty("y")||console.error("Failed deserializing point"),new e({x:t.x,y:t.y})}},{key:"Serialize",value:function(e){return JSON.stringify({x:e.x,y:e.y})}}]),e}();x.Zero=new x(0,0),x.One=new x(1,1);var j,w,E,T,N=function(){function e(t){Object(l.a)(this,e),this.z=void 0,this.chunkCoord=void 0,this.pointNodeCoord=void 0,this.pointNodeId=void 0,this.z=t.z,this.chunkCoord=t.chunkCoord,this.pointNodeCoord=t.pointNodeCoord,this.pointNodeId=t.pointNodeId}return Object(h.a)(e,[{key:"hash",value:function(){return this.pointNodeId.toString()+this.z.toString()+this.chunkCoord.toString()+this.pointNodeCoord.toString()}},{key:"toString",value:function(){return this.z+","+this.chunkCoord.toString()+","+this.pointNodeCoord.toString()}}]),e}(),_=function e(){Object(l.a)(this,e)};_.CHUNK_HALF_DIM=((_.CHUNK_DIM=9)-1)/2,_.DROP_NODES_CHANCE=0,function(e){e.Basic="Basic",e.Nothing="Nothing",e.EfficiencyGate="EfficiencyGate"}(j||(j={})),function(e){e.Mana0="Mana0",e.Mana1="Mana1",e.Mana2="Mana2"}(w||(w={})),function(e){e.Flat="Flat",e.Increased0="% increased",e.AfterIncreased0="added after % increased",e.Increased1="% increased multiplier",e.AfterIncreased1="added after % increased multiplier"}(E||(E={})),function(e){e.NOOP="NOOP",e.PAN_NORTH="PAN_NORTH",e.PAN_SOUTH="PAN_SOUTH",e.PAN_WEST="PAN_WEST",e.PAN_EAST="PAN_EAST",e.TRAVEL_UPSTAIRS="TRAVEL_UPSTAIRS",e.TRAVEL_DOWNSTAIRS="TRAVEL_DOWNSTAIRS",e.TOGGLE_STRATEGIC_VIEW="TOGGLE_STRATEGIC_VIEW",e.TOGGLE_SIDEBAR="TOGGLE_SIDEBAR",e.MOVE_CURSOR_WEST="MOVE_CURSOR_WEST",e.MOVE_CURSOR_EAST="MOVE_CURSOR_EAST",e.MOVE_CURSOR_NORTH="MOVE_CURSOR_NORTH",e.MOVE_CURSOR_SOUTH="MOVE_CURSOR_SOUTH",e.MOVE_CURSOR_NORTHWEST="MOVE_CURSOR_NORTHWEST",e.MOVE_CURSOR_NORTHEAST="MOVE_CURSOR_NORTHEAST",e.MOVE_CURSOR_SOUTHWEST="MOVE_CURSOR_SOUTHWEST",e.MOVE_CURSOR_SOUTHEAST="MOVE_CURSOR_SOUTHEAST",e.INTERACT_WITH_NODE="INTERACT_WITH_NODE"}(T||(T={}));var C,I,U=k(T).reduce((function(e,t){return e[t]=!1,e}),{});function M(e){return new x({x:Math.min(1920,((null===e||void 0===e?void 0:e.x)||1/0)-24),y:Math.min(1080,((null===e||void 0===e?void 0:e.y)||1/0)-24)})}!function(e){e.TAKEN="TAKEN",e.VISIBLE="VISIBLE",e.HIDDEN="HIDDEN",e.AVAILABLE="AVAILABLE",e.UNREACHABLE="UNREACHABLE"}(C||(C={})),function(e){e.CLOSED="CLOSED",e.TICKING="TICKING",e.OPEN="OPEN"}(I||(I={}));var R=function(){function e(t){Object(l.a)(this,e),this.type=void 0,this.modifier=void 0,this.type=t.type,this.modifier=t.modifier}return Object(h.a)(e,[{key:"hash",value:function(){return this.type.toString()+","+this.modifier.toString()}}]),e}(),A={ArrowUp:T.PAN_NORTH,ArrowLeft:T.PAN_WEST,ArrowDown:T.PAN_SOUTH,ArrowRight:T.PAN_EAST,k:T.PAN_NORTH,h:T.PAN_WEST,j:T.PAN_SOUTH,l:T.PAN_EAST,m:T.TOGGLE_STRATEGIC_VIEW,i:T.TOGGLE_SIDEBAR,q:T.MOVE_CURSOR_NORTHWEST,w:T.MOVE_CURSOR_NORTH,a:T.MOVE_CURSOR_WEST,s:T.MOVE_CURSOR_SOUTH,d:T.MOVE_CURSOR_EAST,e:T.MOVE_CURSOR_NORTHEAST,z:T.MOVE_CURSOR_SOUTHWEST,x:T.MOVE_CURSOR_SOUTHEAST,c:T.MOVE_CURSOR_SOUTHEAST," ":T.INTERACT_WITH_NODE,"<":T.TRAVEL_UPSTAIRS,">":T.TRAVEL_DOWNSTAIRS},D=function(e){Object(y.a)(n,e);var t=Object(O.a)(n);function n(e){var i;return Object(l.a)(this,n),(i=t.call(this,e)).handleKeydown=function(e){var t=i.state.keyIntentConfig[e.key];t&&e.preventDefault(),!1===e.repeat&&void 0!==t&&t!==T.NOOP&&(i.props.updaters.newIntent[t].enqueueUpdate((function(){return i.props.updaters.newIntent[t].enqueueUpdate((function(){return!1})),!0})),i.props.updaters.activeIntent[t].enqueueUpdate((function(){return!0})))},i.handleKeyup=function(e){var t=i.state.keyIntentConfig[e.key];void 0!==t&&t!==T.NOOP&&(i.props.updaters.activeIntent[t].enqueueUpdate((function(){return!1})),i.props.updaters.endedIntent[t].enqueueUpdate((function(){return i.props.updaters.endedIntent[t].enqueueUpdate((function(){return!1})),!0})))},i.state={keyIntentConfig:A},document.addEventListener("keydown",i.handleKeydown),document.addEventListener("keyup",i.handleKeyup),i}return Object(h.a)(n,[{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.handleKeydown),document.removeEventListener("keyup",this.handleKeyup)}},{key:"render",value:function(){return Object(i.jsx)(i.Fragment,{children:" "})}}]),n}(a.a.Component),H=a.a.createContext([]),z=n(6),P=n(11),L=n(47),G={backgroundBlue:2236962,nodePink:3351108,nodeLavender:7829367,nodeBlue:14540253,nodeAqua:16755370,gateTint:16777215,selectedTint:12303359,allocatedTint:4473924,nodeBorder:6710886,nullTint:16777215,tooltipBorderBlack:2236962,tooltipFillWhite:15658734,white:16777215,grayBlack:1907997,borderBlack:1118481,borderWhite:6710886,black:0,textWhite:8947848};function W(e){return"#"+e.toString(16)}var F=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];Object(l.a)(this,e),this._values=void 0,this._values=new V;var n,i=Object(S.a)(t);try{for(i.s();!(n=i.n()).done;){var r=n.value;this.put(r)}}catch(a){i.e(a)}finally{i.f()}}return Object(h.a)(e,[{key:"remove",value:function(e){this._values.remove(e)}},{key:"put",value:function(e){this._values.put(e,e)}},{key:"get",value:function(e){return void 0!==this._values.get(e)}},{key:"contains",value:function(e){return this._values.contains(e)}},{key:"values",value:function(){return this._values.values()}},{key:"clone",value:function(){var t=new e;return t._values=this._values.clone(),t}},{key:"size",value:function(){return this._values.size()}},{key:"equals",value:function(e){if(void 0===e||null===e)return!1;if(this.size()!==e.size())return!1;var t,n=Object(S.a)(this.values());try{for(n.s();!(t=n.n()).done;){var i=t.value;if(!e.contains(i))return!1}}catch(r){n.e(r)}finally{n.f()}return!0}}]),e}(),V=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];Object(l.a)(this,e),this._values={};var n,i=Object(S.a)(t);try{for(i.s();!(n=i.n()).done;){var r=Object(u.a)(n.value,2),a=r[0],o=r[1];this.put(a,o)}}catch(c){i.e(c)}finally{i.f()}}return Object(h.a)(e,[{key:"put",value:function(e,t){this._values[e.hash()]=t}},{key:"remove",value:function(e){delete this._values[e.hash()]}},{key:"get",value:function(e){return this._values[e.hash()]}},{key:"contains",value:function(e){return void 0!==this.get(e)&&e.hash()in this._values}},{key:"values",value:function(){return Object.values(this._values)}},{key:"size",value:function(){return Object.keys(this._values).length}},{key:"clone",value:function(){var t=new e;return t._values=Object(P.a)({},this._values),t}}]),e}(),q=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];Object(l.a)(this,e),this._kvalues={};var n,i=Object(S.a)(t);try{for(i.s();!(n=i.n()).done;){var r=Object(u.a)(n.value,2),a=r[0],o=r[1];this.put(a,o)}}catch(c){i.e(c)}finally{i.f()}}return Object(h.a)(e,[{key:"put",value:function(e,t){this._kvalues[e.hash()]=[e,t]}},{key:"remove",value:function(e){delete this._kvalues[e.hash()]}},{key:"get",value:function(e){var t;return null===(t=this._kvalues[e.hash()])||void 0===t?void 0:t[1]}},{key:"contains",value:function(e){return void 0!==this.get(e)&&e.hash()in this._kvalues}},{key:"keys",value:function(){var e=this;return Object.keys(this._kvalues).map((function(t){return e._kvalues[t][0]}))}},{key:"entries",value:function(){var e=this;return Object.keys(this._kvalues).map((function(t){return e._kvalues[t]}))}},{key:"values",value:function(){var e=this;return Object.keys(this._kvalues).map((function(t){return e._kvalues[t][1]}))}},{key:"hashKeyset",value:function(){return Object.keys(this._kvalues).map((function(e){return B(e)})).reduce((function(e,t){return e+t})).toString()}},{key:"clone",value:function(){var t=new e;return t._kvalues=Object(P.a)({},this._kvalues),t}},{key:"size",value:function(){return Object.keys(this._kvalues).length}}]),e}();function B(e){for(var t=0,n=0;n<e.length;n++)t=Math.imul(31,t)+e.charCodeAt(n)|0;return t}function K(e){return new z.d(e.x,e.y)}var X=n(22);function Z(e){var t=[];return[function(e){t.push(e)},function(){if(0!==t.length){var n=Object(X.a)(t);t=[],e((function(e){var t,i=e,r=Object(S.a)(n);try{for(r.s();!(t=r.n()).done;){var a=t.value;i="function"===typeof a?a(i):a}}catch(o){r.e(o)}finally{r.f()}return i}))}}]}var Y=n(9);function J(e,t){var n={getUpdater:function(){return t}};return n.enqueueUpdate=t,"object"!==typeof e||Object.keys(e).forEach((function(i){if("enqueueUpdate"===i||"getUpdater"===i||"update"===i)throw Error("Invalid key in updaterGenerator: ".concat(i," conflicts with reserved keywords enqueueUpdate, update, getUpdater."));n[i]=J(e[i],(function(e){t("function"===typeof e?function(t,n){var r=e(t[i],n);return t[i]===r?t:Object(P.a)(Object(P.a)({},t),{},Object(Y.a)({},i,r))}:function(t,n){return Object(P.a)(Object(P.a)({},t),{},Object(Y.a)({},i,e))})}))})),n}function Q(e,t){return J(e,(function(e){t("function"===typeof e?function(t){return e(t,t)}:e)}))}var $=function(){function e(){Object(l.a)(this,e),this._values=[]}return Object(h.a)(e,[{key:"add",value:function(e){-1===this._values.indexOf(e)||e.instance&&this.contains(e.instance),this._values.push(e)}},{key:"remove",value:function(e){var t=this._values.splice(this._values.findIndex((function(t){return t.instance===e})),1);return 0===t.length?void 0:t[0]}},{key:"contains",value:function(e){return this._values.findIndex((function(t){return t.instance===e}))>-1}},{key:"get",value:function(e){return this._values.find((function(t){return t.instance===e}))}},{key:"clone",value:function(){var t=new e;return t._values=Object(X.a)(this._values),t}},{key:"forEach",value:function(e){this._values.forEach(e)}}]),e}(),ee=function(){function e(t){var n=this;Object(l.a)(this,e),this.container=void 0,this.state=void 0,this._staleProps=void 0,this._children=new $,this._childrenToConstruct=new $,this._childrenToDestruct=new $,this._forceUpdates=new $,this.markForceUpdate=function(e){var t,i;null===(t=n._staleProps.args)||void 0===t||null===(i=t.markForceUpdate)||void 0===i||i.call(t,n);var r=n._children.get(e);if(!r)throw new Error("Error, child ".concat(e," not found in ").concat(n));n._forceUpdates.add(r)},this._staleProps=t}return Object(h.a)(e,[{key:"addChild",value:function(e){this._children.add(e),this._childrenToConstruct.add(e)}},{key:"registerChild",value:function(e){this._children.add(e)}},{key:"removeChild",value:function(e){var t=this._children.remove(e);t&&this._childrenToDestruct.add(t)}},{key:"_didConstruct",value:function(e){var t,n=this;this._childrenToConstruct.forEach((function(t){t.instance||(t.instance=new t.childClass(t.propsFactory(e,n.state))),n.container.addChild(t.instance.container)})),this.renderSelf(e),null===(t=this.didMount)||void 0===t||t.call(this)}},{key:"useState",value:function(e,t){var n=function(t){e.state="function"===typeof t?t(e.state):t},i=Z(n),r=Object(u.a)(i,2),a=r[0];return{state:t,setState:n,fireStateUpdaters:r[1],stateUpdaters:Q(t,a)}}},{key:"update",value:function(e){this._update(e)}},{key:"_update",value:function(e){var t,n,i,r=this,a=Object(P.a)({},this.state);if(null===(t=this.fireStateUpdaters)||void 0===t||t.call(this),null===(n=this.updateSelf)||void 0===n||n.call(this,e),this.shouldUpdate&&!this.shouldUpdate(this._staleProps,a,e,this.state)){var o,c=this._forceUpdates.clone();return this._forceUpdates=new $,c.forEach((function(t){var n,i=t.instance,a=t.propsFactory;null===i||void 0===i||i._update(a(e,r.state)),i&&(null===(n=r.didForceUpdateChild)||void 0===n||n.call(r,i))})),void(null===(o=this.didForceUpdate)||void 0===o||o.call(this))}null===(i=this.updateChildren)||void 0===i||i.call(this,e),this._updateChildren(e),this.renderSelf(e),this._staleProps=e,new Promise((function(e){var t;return e(null===(t=r.didUpdate)||void 0===t?void 0:t.call(r))}))}},{key:"_updateChildren",value:function(e){var t=this;this._childrenToDestruct.forEach((function(e){var n,i;e.instance&&(null===(n=(i=e.instance).willUnmount)||void 0===n||n.call(i),t.container.removeChild(e.instance.container))})),this._childrenToDestruct=new $,this._children.forEach((function(n){var i=n.instance,r=n.propsFactory;null===i||void 0===i||i._update(r(e,t.state))})),this._childrenToConstruct.forEach((function(n){n.instance||(n.instance=new n.childClass(n.propsFactory(e,t.state))),t.container.addChild(n.instance.container)})),this._childrenToConstruct=new $}},{key:"willUnmount",value:function(){}},{key:"toString",value:function(){return"lifecyclehandler object"}}]),e}();function te(e){return new Proxy(e,{construct:function(e,t){var n=new e(t[0]);return n._didConstruct(t[0]),n}})}var ne;new Proxy(ee,{construct:function(e,t,n){var i=Reflect.construct(e,t,n);return i._didConstruct.apply(i,Object(X.a)(t)),i}});function ie(e){var t,n={},i=function(e){var t,n=new V,i=Object(S.a)(e.playerSave.allocatedPointNodeHistory);try{for(i.s();!(t=i.n()).done;){var r=t.value,a=e.worldGen.zLevels[r.z].chunks.get(r.chunkCoord).pointNodes.get(r.pointNodeCoord);if(a.nodeType!==j.Nothing){var o=new R({type:a.resourceType,modifier:a.resourceModifier});n.put(o,(n.get(o)||0)+a.resourceAmount)}}}catch(c){i.e(c)}finally{i.f()}return n}(e),r=Object(S.a)(k(w));try{for(r.s();!(t=r.n()).done;){var a=t.value,o=i.get(new R({type:a,modifier:E.Flat}))||0;o*=1+.01*(i.get(new R({type:a,modifier:E.Increased0}))||0),o=Math.floor(o),o+=i.get(new R({type:a,modifier:E.AfterIncreased0}))||0,o*=1+.01*(i.get(new R({type:a,modifier:E.Increased1}))||0),o=Math.floor(o),o+=i.get(new R({type:a,modifier:E.AfterIncreased1}))||0,n[a]=o}}catch(c){r.e(c)}finally{r.f()}return{playerResourceAmounts:n,playerResourceNodesAggregated:i}}function re(e,t){var n,i=function(e,t){var n={},i=t.zLevels[e.z],r=i.chunks.get(e.chunkCoord);if(e.pointNodeCoord.x===_.CHUNK_HALF_DIM){var a=e.chunkCoord.addX(1),o=i.chunks.get(a);if(o){var c=e.pointNodeCoord.withX(-_.CHUNK_HALF_DIM),u=o.pointNodes.get(c);u&&(n.EAST=new N({z:e.z,chunkCoord:a,pointNodeCoord:c,pointNodeId:u.id}))}}else{var s=e.pointNodeCoord.addX(1),d=r.pointNodes.get(s);d&&(n.EAST=new N({z:e.z,chunkCoord:e.chunkCoord,pointNodeCoord:s,pointNodeId:d.id}))}if(e.pointNodeCoord.x===-_.CHUNK_HALF_DIM){var l=e.chunkCoord.addX(-1),h=i.chunks.get(l);if(h){var p=e.pointNodeCoord.withX(_.CHUNK_HALF_DIM),f=h.pointNodes.get(p);f&&(n.WEST=new N({z:e.z,chunkCoord:l,pointNodeCoord:p,pointNodeId:f.id}))}}else{var v=e.pointNodeCoord.addX(-1),y=r.pointNodes.get(v);y&&(n.WEST=new N({z:e.z,chunkCoord:e.chunkCoord,pointNodeCoord:v,pointNodeId:y.id}))}if(e.pointNodeCoord.equals(x.Zero)){var O=t.zLevels[e.z+1];if(O){var b=e.chunkCoord,S=Math.round(b.x/_.CHUNK_DIM),m=b.x-_.CHUNK_DIM*S,g=Math.round(b.y/_.CHUNK_DIM),k=b.y-_.CHUNK_DIM*S,j=new x(S,g),w=O.chunks.get(j);if(w){var E=new x(m,k),T=w.pointNodes.get(E);T&&(n.UP=new N({z:e.z+1,chunkCoord:j,pointNodeCoord:E,pointNodeId:T.id}))}}}var C=t.zLevels[e.z-1];if(C){var I=e.chunkCoord.multiply(9).add(e.pointNodeCoord),U=C.chunks.get(I);if(U){var M=U.pointNodes.get(x.Zero);M&&(n.DOWN=new N({z:e.z-1,chunkCoord:I,pointNodeCoord:x.Zero,pointNodeId:M.id}))}}return n}(e,t),r=[],a=Object(S.a)(k(ne));try{for(a.s();!(n=a.n()).done;){var o=i[n.value];o&&r.push(o)}}catch(c){a.e(c)}finally{a.f()}return r}function ae(e,t,n){if("yes"===function(e,t,n,i){if(n.contains(e))return"already allocated";var r,a=re(e,t),o=!1,c=Object(S.a)(a);try{for(c.s();!(r=c.n()).done;){var u=r.value;n.contains(u)&&(o=!0)}}catch(s){c.e(s)}finally{c.f()}return o?"yes":"not connected"}(n,t.worldGen,t.playerSave.allocatedPointNodeSet,t.playerSave.activeQuest)&&function(e,t){var n,i=null===(n=t.worldGen.zLevels[e.z].chunks.get(e.chunkCoord))||void 0===n?void 0:n.pointNodes.get(e.pointNodeCoord);if(i.nodeType!==j.EfficiencyGate)return!0;var r,a=i.efficiencyGateInfo.thresholdResourceType;return((null===(r=t.computed.playerResourceAmounts)||void 0===r?void 0:r[a])||0)>=i.efficiencyGateInfo.thresholdResourceAmount&&t.playerSave.allocatedPointNodeHistory.length<=i.efficiencyGateInfo.timeUntilLocked}(n,t)){var i=e.allocatedPointNodeSet.clone();i.put(n);var r=Object(X.a)(e.allocatedPointNodeHistory);return r.push(n),[Object(P.a)(Object(P.a)({},e),{},{allocatedPointNodeHistory:r,allocatedPointNodeSet:i}),!0]}return[e,!1]}function oe(e,t){var n=!1,i=!1,r=!1;e.playerUI.selectedPointNode.enqueueUpdate((function(e,i){return(null===e||void 0===e?void 0:e.pointNodeId)===t.pointNodeId&&(n=!0),t})),e.playerSave.enqueueUpdate((function(e,a){if(n){n=!1;var o=ae(e,a,t),c=Object(u.a)(o,2),s=c[0];return c[1]?(i=!0,s):(r=!0,e)}return e})),e.computed.enqueueUpdate((function(e,t){return i?ie(t):e})),e.playerSave.enqueueUpdate((function(e,t){return i?(i=!1,function(e,t){var n=Object(P.a)({},e);if(void 0!==n.spSpentThisQuest&&(n.spSpentThisQuest+=1),n.activeQuest){var i,r=n.activeQuest.resourceType,a=(null===(i=t.computed.playerResourceAmounts)||void 0===i?void 0:i[r])||0;n.questProgressHistory=[].concat(Object(X.a)(n.questProgressHistory),[a])}return n}(e,t)):e})),e.playerUI.activeTab.enqueueUpdate((function(e,t){return r?(r=!1,1):e}))}!function(e){e.NORTHWEST="NORTHWEST",e.SOUTHWEST="SOUTHWEST",e.NORTHEAST="NORTHEAST",e.SOUTHEAST="SOUTHEAST",e.EAST="EAST",e.WEST="WEST",e.UP="UP",e.DOWN="DOWN"}(ne||(ne={}));var ce=te(function(e){Object(y.a)(n,e);var t=Object(O.a)(n);function n(e){var i,r,a;Object(l.a)(this,n),(a=t.call(this,e)).container=void 0,a.state=void 0,a.sprite=void 0,a.halfwayCenterSprite=void 0,a.centerSprite=void 0,a.topHalfSprite=void 0,a.hitArea=void 0,a.tooltippableArea=void 0,a.state={numClicks:0,descriptionText:""},a.updateSelf(e),a.container=new z.b;var o=null===(i=e.args.pointNodeTexture.find((function(e){return e.cropFraction>=.99})))||void 0===i?void 0:i.texture;a.container.sortableChildren=!0,a.sprite=new z.g(o),a.sprite.anchor.x=.5,a.sprite.anchor.y=.5,a.sprite.zIndex=-2,a.container.addChild(a.sprite),a.topHalfSprite=new z.g(null===(r=e.args.pointNodeTexture.find((function(e){return e.cropFraction>=.499})))||void 0===r?void 0:r.texture),a.topHalfSprite.anchor.x=.5,a.topHalfSprite.anchor.y=.5,a.topHalfSprite.zIndex=-1,e.pointNodeGen.nodeType===j.EfficiencyGate&&a.container.addChild(a.topHalfSprite);var c=new z.c;return c.beginFill(G.black),c.drawRect(0,0,a.topHalfSprite.width,a.topHalfSprite.height/2),c.pivot.x=a.topHalfSprite.width/2,c.pivot.y=a.topHalfSprite.height/2,c.zIndex=30,a.centerSprite=new z.g(o),a.centerSprite.anchor.x=.5,a.centerSprite.anchor.y=.5,a.centerSprite.scale=K(new x(.5,.5)),a.centerSprite.zIndex=1,a.centerSprite.alpha=0,a.halfwayCenterSprite=new z.g(o),a.halfwayCenterSprite.anchor.x=.5,a.halfwayCenterSprite.anchor.y=.5,a.halfwayCenterSprite.scale=K(new x(.75,.75)),a.halfwayCenterSprite.zIndex=0,a.halfwayCenterSprite.alpha=0,a.container.interactive=!0,a.container.buttonMode=!0,a.hitArea=new z.e(-ue.NODE_HITAREA_PX/2,-ue.NODE_HITAREA_PX/2,ue.NODE_HITAREA_PX,ue.NODE_HITAREA_PX),a.container.hitArea=a.hitArea,a}return Object(h.a)(n,[{key:"updateSelf",value:function(e){var t="Nothing (empty node)";e.pointNodeGen.nodeType===j.EfficiencyGate?t="Unlocks at 300 Mana0 in 14 or fewer allocations":e.pointNodeGen.nodeType!==j.Nothing&&(t="".concat(e.pointNodeGen.resourceAmount," ").concat(e.pointNodeGen.resourceModifier," ").concat(e.pointNodeGen.resourceType)),this.state.descriptionText=t}},{key:"renderSelf",value:function(e){var t,n,i;this.container.position=K(e.args.position),e.isSelected?(n=G.selectedTint,i=G.selectedTint):(n=G.nullTint,i=G.nullTint),e.isAllocated&&(n=G.allocatedTint);var r=0,a=0;e.pointNodeGen.nodeType===j.Nothing?r=G.nodeBlue:e.pointNodeGen.nodeType===j.EfficiencyGate?(r=G.nodeAqua,a=g(G.nodeAqua,G.gateTint)):e.pointNodeGen.resourceType===w.Mana0&&(e.pointNodeGen.resourceModifier===E.Flat?r=G.nodePink:e.pointNodeGen.resourceModifier===E.Increased0&&(r=G.nodeLavender)),this.sprite.tint=g(r,n),this.centerSprite.tint=g(r,i),this.topHalfSprite.tint=g(a,n);var o=Math.floor(9*Math.random())/8-.001;this.topHalfSprite.texture=null===(t=e.args.pointNodeTexture.find((function(e){return e.cropFraction>=o})))||void 0===t?void 0:t.texture,e.selfPointNodeRef.pointNodeCoord.equals(x.Zero)&&(this.container.scale=K(new x(1.25,1.25)))}},{key:"shouldUpdate",value:function(e,t,n,i){var r,a=Object(S.a)(Object.keys(e));try{for(a.s();!(r=a.n()).done;){var o=r.value;if("delta"!==o&&"args"!==o&&"updaters"!==o){if(e[o]!==n[o])return console.log("node shouldUpdate differed in ".concat(o,", returning true")),!0;var c,u;if("selfPointNodeRef"!==o);else if((null===(c=e[o])||void 0===c?void 0:c.hash())!==(null===(u=n[o])||void 0===u?void 0:u.hash()))return console.log("node shouldUpdate differed in ".concat(o,", returning true")),!0}}}catch(s){a.e(s)}finally{a.f()}return!1}},{key:"didMount",value:function(){var e=this,t=this._staleProps.updaters;this.container.addListener("pointerdown",(function(n){e._staleProps.args.markForceUpdate(e),e.state.numClicks++,oe(t,e._staleProps.selfPointNodeRef)})),this.container.addListener("pointerover",(function(t){var n=t.data.getLocalPosition(e.container),i=new x(e.container.worldTransform.tx,e.container.worldTransform.ty);e._staleProps.tooltipUpdaters.enqueueUpdate((function(t){return Object(P.a)(Object(P.a)({},t),{},{visible:!0,text:e.state.descriptionText,position:i.add(n)})}))})),this.container.addListener("pointerout",(function(t){e._staleProps.tooltipUpdaters.enqueueUpdate((function(e){return Object(P.a)(Object(P.a)({},e),{},{visible:!1,text:""})}))})),this.container.addListener("pointermove",(function(t){var n=t.data.getLocalPosition(e.container),i=new x(e.container.worldTransform.tx,e.container.worldTransform.ty);e._staleProps.tooltipUpdaters.position.enqueueUpdate(i.add(n))}))}},{key:"toString",value:function(){return"PointNodeCompoent "+this._staleProps.selfPointNodeRef.toString()}}]),n}(ee)),ue=function e(){Object(l.a)(this,e)};ue.SPACING_PX=36,ue.CHUNK_SPACING_PX=(_.CHUNK_DIM+0)*ue.SPACING_PX,ue.NODE_SIZE_PX=22,ue.NODE_HITAREA_PX=ue.NODE_SIZE_PX+4,ue.NODE_ROUNDED_PX=4;te(function(e){Object(y.a)(n,e);var t=Object(O.a)(n);function n(e){var i;return Object(l.a)(this,n),(i=t.call(this,e)).container=void 0,i.state=void 0,i.children=void 0,i.state={},i.container=new z.b,i.children=new q,i.resyncChildren(e),i}return Object(h.a)(n,[{key:"renderSelf",value:function(e){this.container.position=K(e.position)}},{key:"shouldUpdate",value:function(e,t,n,i){var r,a=Object(S.a)(Object.keys(e));try{for(a.s();!(r=a.n()).done;){var o=r.value;if("delta"!==o&&"args"!==o&&"updaters"!==o){if("position"===o){if(e[o].equals(n[o]))continue;return console.log("chunk shouldUpdate differed in ".concat(o,", returning true")),!0}var c,u;if("selectedPointNode"!==o)if("selfChunkRef"!==o){if("allocatedPointNodeSubset"===o){if(e[o].equals(n[o]))continue;return console.log("chunk shouldUpdate differed in ".concat(o,", returning true")),!0}if(e[o]!==n[o])return console.log("chunk shouldUpdate differed in ".concat(o,", returning true")),!0}else{var s,d;if((null===(s=e[o])||void 0===s?void 0:s.hash())!==(null===(d=n[o])||void 0===d?void 0:d.hash()))return console.log("chunk shouldUpdate differed in ".concat(o,", returning true")),!0}else if((null===(c=e[o])||void 0===c?void 0:c.hash())!==(null===(u=n[o])||void 0===u?void 0:u.hash()))return console.log("chunk shouldUpdate differed in ".concat(o,", returning true")),!0}}}catch(l){a.e(l)}finally{a.f()}return!1}},{key:"resyncChildren",value:function(e){var t=this,n=this.children.clone();console.log("chunk component upsert children got here");var i,r=Object(S.a)(e.chunkGen.pointNodes.entries());try{var a=function(){var r=Object(u.a)(i.value,2),a=r[0],o=r[1],c=new N({z:e.selfChunkRef.z,chunkCoord:e.selfChunkRef.chunkCoord,pointNodeCoord:a,pointNodeId:o.id}),s=function(e,n){var i;return{delta:e.delta,args:{pointNodeTexture:e.args.pointNodeTexture,markForceUpdate:t.markForceUpdate,position:c.pointNodeCoord.multiply(ue.SPACING_PX)},selfPointNodeRef:c,updaters:e.updaters,tooltipUpdaters:e.tooltipUpdaters,pointNodeGen:o,isSelected:(null===(i=e.selectedPointNode)||void 0===i?void 0:i.pointNodeId)===c.pointNodeId,isAllocated:e.allocatedPointNodeSubset.contains(c)}},d=c,l=t.children.get(d);l?n.remove(d):(l=new ce(s(e,t.state)),t.children.put(c,l),t.addChild({childClass:ce,instance:l,propsFactory:s}))};for(r.s();!(i=r.n()).done;)a()}catch(h){r.e(h)}finally{r.f()}console.log("chunk component to delete has ".concat(n.size()," children"));var o,c=Object(S.a)(n.entries());try{for(c.s();!(o=c.n()).done;){var s=Object(u.a)(o.value,2),d=s[0],l=s[1];this.children.remove(d),this.removeChild(l)}}catch(h){c.e(h)}finally{c.f()}}},{key:"updateChildren",value:function(e){this.resyncChildren(e)}},{key:"didForceUpdateChild",value:function(e){this.container.removeChild(e.container),this.container.addChild(e.container)}}]),n}(ee));var se=function(){function e(t){Object(l.a)(this,e),this._wasConstructed=!1,this._value=void 0,this._factory=void 0,this._factory=t}return Object(h.a)(e,[{key:"get",value:function(){return void 0!==this._value||!0===this._wasConstructed||(this._value=this._factory(),this._wasConstructed=!0),this._value}},{key:"wasConstructed",value:function(){return this._wasConstructed}}]),e}();var de=function(){function e(t){Object(l.a)(this,e),this._values=void 0,this._factory=void 0,this._values=new q,this._factory=t}return Object(h.a)(e,[{key:"put",value:function(e,t){this._values.put(e,t)}},{key:"peek",value:function(e){return this._values.get(e)}},{key:"get",value:function(e){if(this._values.contains(e))return this._values.get(e);var t=this._factory(e);return this._values.put(e,t),t}},{key:"precompute",value:function(e){if(!this._values.contains(e)){var t=this._factory(e);this._values.put(e,t)}}},{key:"contains",value:function(e){return this._values.contains(e)}},{key:"values",value:function(){return this._values.values()}},{key:"keys",value:function(){return this._values.keys()}},{key:"entries",value:function(){return this._values.entries()}},{key:"size",value:function(){return this._values.size()}},{key:"clone",value:function(){var t=new e(this._factory);return t._values=this._values.clone(),t}}]),e}(),le=te(function(e){Object(y.a)(n,e);var t=Object(O.a)(n);function n(e){var i;return Object(l.a)(this,n),(i=t.call(this,e)).container=void 0,i.state=void 0,i.container=new z.b,i.container.sortableChildren=!0,i.state={},i}return Object(h.a)(n,[{key:"renderSelf",value:function(e){}}]),n}(ee)),he=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{x:0,y:0,z:0},n=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0;Object(l.a)(this,e),this._x=void 0,this._y=void 0,this._z=void 0,"number"===typeof t?(this._x=t,this._y=n,this._z=i):(this._x=t.x,this._y=t.y,this._z=t.z)}return Object(h.a)(e,[{key:"x",get:function(){return this._x}},{key:"y",get:function(){return this._y}},{key:"z",get:function(){return this._z}}]),Object(h.a)(e,[{key:"hash",value:function(){return this.toString()}},{key:"toString",value:function(){return"[".concat(this.x,", ").concat(this.y,", ").concat(this.z,"]")}},{key:"subtract",value:function(t){return new e({x:this.x-t.x,y:this.y-t.y,z:this.z-t.z})}},{key:"add",value:function(t,n,i){return new e("number"===typeof t?{x:this.x+t,y:this.y+n,z:this.z+i}:{x:this.x+t.x,y:this.y+t.y,z:this.z+t.z})}},{key:"addX",value:function(t){return new e({x:this.x+t,y:this.y,z:this.z})}},{key:"addY",value:function(t){return new e({x:this.x,y:this.y+t,z:this.z})}},{key:"addZ",value:function(t){return new e({x:this.x,y:this.y,z:this.z+t})}},{key:"subtractX",value:function(t){return new e({x:this.x-t,y:this.y,z:this.z})}},{key:"subtractY",value:function(t){return new e({x:this.x,y:this.y-t,z:this.z})}},{key:"subtractZ",value:function(t){return new e({x:this.x,y:this.y,z:this.z-t})}},{key:"scale",value:function(t,n){return new e({x:(this.x-t.x)*n.x+t.x,y:(this.y-t.y)*n.y+t.y,z:(this.z-t.z)*n.z+t.z})}},{key:"equals",value:function(e){return void 0!==e&&(Math.abs(this.x-e.x)<b&&Math.abs(this.y-e.y)<b&&Math.abs(this.z-e.z)<b)}},{key:"multiply",value:function(t){return new e("number"===typeof t?{x:this.x*t,y:this.y*t,z:this.z*t}:{x:this.x*t.x,y:this.y*t.y,z:this.z*t.z})}},{key:"divide",value:function(t){return new e("number"===typeof t?{x:this.x/t,y:this.y/t,z:this.z/t}:{x:this.x/t.x,y:this.y/t.y,z:this.z/t.z})}},{key:"toJSON",value:function(){return{__type:"Vector3",x:this.x,y:this.y,z:this.z}}},{key:"pairXY",value:function(){return new x({x:this.x,y:this.y})}},{key:"withX",value:function(t){return new e({x:t,y:this.y,z:this.z})}},{key:"withY",value:function(t){return new e({x:this.x,y:t,z:this.z})}},{key:"withZ",value:function(t){return new e({x:this.x,y:this.y,z:t})}}],[{key:"IsVector3",value:function(t){return t instanceof e}},{key:"FromVector2",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new e(t.x,t.y,n)}},{key:"Deserialize",value:function(t){return t.hasOwnProperty("x")&&t.hasOwnProperty("y")&&t.hasOwnProperty("z")||console.error("Failed deserializing vector3"),new e({x:t.x,y:t.y,z:t.z})}},{key:"Serialize",value:function(e){return JSON.stringify({x:e.x,y:e.y})}}]),e}();he.Zero=new he(0,0,0),he.One=new he(1,1,1);var pe=te(function(e){Object(y.a)(n,e);var t=Object(O.a)(n);function n(e){var i;Object(l.a)(this,n),(i=t.call(this,e)).container=void 0,i.state=void 0,i.graphics=void 0,i.hexGrid=new q,i.state={numClicks:0,descriptionText:""},i.updateSelf(e),i.container=new z.b,i.graphics=new z.g,i.graphics.texture=e.args.textures.circle,i.graphics.tint=G.borderBlack,i.graphics.visible=!1,i.container.addChild(i.graphics);for(var r=-20;r<=20;r++)for(var a=-35+Math.floor(r/2);a<=35+Math.floor(r/2);a++){var o=new z.g;o.texture=e.args.textures.circle,o.tint=G.nodePink,o.position=K(e.appSize.divide(2).add(new x(30*a-15*r,-26*r))),i.container.addChild(o),i.hexGrid.put(new x(a,r),o)}return i}return Object(h.a)(n,[{key:"updateSelf",value:function(e){}},{key:"renderSelf",value:function(e){this.container.position=K(e.args.position),this.graphics.position=K(e.appSize.divide(2));var t,n=Object(S.a)(this.hexGrid.entries());try{for(n.s();!(t=n.n()).done;){var i=Object(u.a)(t.value,2),r=i[0],a=i[1];a.position=K(e.appSize.divide(2).add(new x(30*r.x-15*r.y,-26*r.y)));var o=e.virtualGridLocation.add(he.FromVector2(r)),c=e.fogOfWarStatusMap.get(o)||C.HIDDEN,s=e.allocationStatusMap.get(o)||C.HIDDEN,d=e.lockMap.get(o);e.lockStatusMap.get(o);c===C.HIDDEN?a.visible=!1:s===C.TAKEN?(a.visible=!0,a.tint=G.borderBlack):c!==C.AVAILABLE&&c!==C.UNREACHABLE||(a.visible=!0,a.tint=G.nodePink),d?(a.texture=e.args.textures.rect,a.position.x-=e.args.textures.rect.width/2,a.position.y-=e.args.textures.rect.height/2):(a.texture=e.args.textures.circle,a.position.x-=e.args.textures.circle.width/2,a.position.y-=e.args.textures.circle.height/2)}}catch(l){n.e(l)}finally{n.f()}}},{key:"shouldUpdate",value:function(e,t,n,i){var r,a=Object(S.a)(Object.keys(e));try{for(a.s();!(r=a.n()).done;){var o=r.value;if("args"!==o&&e[o]!==n[o])return console.log("hexgrid shouldUpdate differed in ".concat(o,", returning true")),!0}}catch(c){a.e(c)}finally{a.f()}return!1}}]),n}(ee));var fe=te(function(e){Object(y.a)(n,e);var t=Object(O.a)(n);function n(e){var i;Object(l.a)(this,n),(i=t.call(this,e)).container=void 0,i.state=void 0,i.stateUpdaters=void 0,i.fireStateUpdaters=void 0,i.fixedCameraStage=void 0,i.actionStage=void 0,i.backdropStage=void 0,i.strategicHexGrid=void 0,i.backdrop=void 0,i.container=new z.b,i.container.sortableChildren=!0;var r=i.useState(Object(L.a)(i),{pointNodeTexture:new se((function(){return function(e){for(var t=[],n=0;n<=8;n++){var i=n/8,r=new z.c;r.beginFill(G.white),r.drawRoundedRect(-ue.NODE_SIZE_PX/2,-ue.NODE_SIZE_PX/2,ue.NODE_SIZE_PX,ue.NODE_SIZE_PX,ue.NODE_ROUNDED_PX);var a=new z.c;a.beginFill(G.black),a.drawRect(-ue.NODE_SIZE_PX/2,-ue.NODE_SIZE_PX/2,ue.NODE_SIZE_PX,ue.NODE_SIZE_PX*i),r.mask=a;var o=e.generateTexture(r,z.f.LINEAR,1);t.push({cropFraction:i,texture:o})}return t}(e.args.renderer)})),simpleTexture:new se((function(){return function(e){var t=new z.c;t.beginFill(G.white),t.drawCircle(0,0,8);var n=new z.c;n.beginFill(G.white),n.drawRect(0,0,4,20);var i=new z.c;return i.beginFill(G.white),i.drawRect(0,0,16,16),{circle:e.generateTexture(t,z.f.LINEAR,1),rect:e.generateTexture(n,z.f.LINEAR,1),square:e.generateTexture(i,z.f.LINEAR,1)}}(e.args.renderer)})),tick:0,playerCurrentZ:0,tooltip:{visible:!1,position:void 0,text:""}});i.state=r.state,i.stateUpdaters=r.stateUpdaters,i.fireStateUpdaters=r.fireStateUpdaters;var a=function(e,t){return{args:{renderer:e.args.renderer,markForceUpdate:i.markForceUpdate},delta:e.delta,gameState:e.gameState,appSize:e.appSize,tick:t.tick,tooltip:Object(P.a)({},t.tooltip)}};i.fixedCameraStage=new le(a(e,i.state)),i.addChild({childClass:le,instance:i.fixedCameraStage,propsFactory:a}),i.actionStage=new z.g,i.actionStage.zIndex=0,i.actionStage.sortableChildren=!0,i.container.addChild(i.actionStage);var o=function(e,t){return{args:{position:x.Zero,textures:t.simpleTexture.get()},appSize:e.appSize,virtualGridLocation:e.gameState.playerUI.virtualGridLocation,allocationStatusMap:e.gameState.playerSave.allocationStatusMap,fogOfWarStatusMap:e.gameState.computed.fogOfWarStatusMap,lockStatusMap:e.gameState.computed.lockStatusMap,lockMap:e.gameState.worldGen.lockMap}};return i.strategicHexGrid=new pe(o(e,i.state)),i.addChild({childClass:pe,instance:i.strategicHexGrid,propsFactory:o}),i.backdropStage=new z.g,i.backdropStage.zIndex=-1,i.backdropStage.sortableChildren=!0,i.container.addChild(i.backdropStage),i.backdrop=new z.c,i.backdropStage.addChild(i.backdrop),i.backdrop.beginFill(G.backgroundBlue,1),i.backdrop.interactive=!0,i.backdrop.drawRect(0,0,e.appSize.x,e.appSize.y),i}return Object(h.a)(n,[{key:"updateSelf",value:function(e){this.state.tick++}},{key:"renderSelf",value:function(e){this.backdrop.width=e.appSize.x,this.backdrop.height=e.appSize.y}},{key:"didMount",value:function(){this._staleProps.updaters}},{key:"didUpdate",value:function(){this._staleProps.updaters}}]),n}(ee));function ve(e){return new x({x:Math.min(1920,((null===e||void 0===e?void 0:e.x)||1/0)-24),y:Math.min(1080,((null===e||void 0===e?void 0:e.y)||1/0)-24)})}var ye=function(){function e(t){var n;Object(l.a)(this,e),this.app=void 0,this.state=void 0,this.props=void 0,this.staleProps=void 0,this.rootComponent=void 0,this.onTick=void 0,null===t||void 0===t||null===(n=t.args)||void 0===n||n.isSecondConstructorCall;var i=new x(800,600);this.state={appSize:i,originalAppSize:i},this.app=new z.a({width:this.state.appSize.x,height:this.state.appSize.y,antialias:!0,transparent:!0,resolution:window.devicePixelRatio||1,autoDensity:!0,powerPreference:"low-power",backgroundColor:G.white})}return Object(h.a)(e,[{key:"pause",value:function(){this.app.ticker.remove(this.onTick)}},{key:"destroy",value:function(){this.app.destroy(!0,{children:!0,texture:!0,baseTexture:!0})}},{key:"didMount",value:function(){var e=this;this.onTick=function(t){return e.baseGameLoop(t)},this.onTick=this.onTick.bind(this),this.app.ticker.add(this.onTick),this.state.appSize=ve(new x(this.props.gameState.windowState.innerWidth,this.props.gameState.windowState.innerHeight))}},{key:"register",value:function(e){e.appendChild(this.app.view)}},{key:"updateSelf",value:function(e,t){e!==t?(e.gameState.windowState.innerWidth===(null===t||void 0===t?void 0:t.gameState.windowState.innerWidth)&&e.gameState.windowState.innerHeight===(null===t||void 0===t?void 0:t.gameState.windowState.innerHeight)||(this.state.appSize=ve(new x(e.gameState.windowState.innerWidth,e.gameState.windowState.innerHeight))),e.updaters.tick.enqueueUpdate((function(e){return e+1}))):e.updaters.tick.enqueueUpdate((function(e){return e+1}))}},{key:"rerender",value:function(e){this.rootComponent&&this.props===e||(this.props=e,this.rootComponent||(this.rootComponent=new fe({args:{renderer:this.app.renderer,markForceUpdate:function(){}},updaters:this.props.updaters,delta:0,gameState:this.props.gameState,appSize:this.state.appSize}),this.app.stage.addChild(this.rootComponent.container),this.renderSelf(this.props),this.didMount()))}},{key:"renderSelf",value:function(e){this.app.renderer.resize(this.state.appSize.x,this.state.appSize.y)}},{key:"baseGameLoop",value:function(e){var t;if(this.props.gameState.playerUI.isPixiHidden)return this.props.updaters.tick.enqueueUpdate((function(e){return e+1})),void this.props.args.fireBatch();this.updateSelf(this.props,this.staleProps),null===(t=this.rootComponent)||void 0===t||t.update({args:{renderer:this.app.renderer,markForceUpdate:function(){}},updaters:this.props.updaters,delta:e,gameState:this.props.gameState,appSize:this.state.appSize}),this.renderSelf(this.props),this.staleProps=this.props,this.props.args.fireBatch()}}]),e}(),Oe=new se((function(){return new ye}));function be(e){var t=Object(r.useState)(Oe.get()),n=Object(u.a)(t,2),a=n[0],o=(n[1],Object(r.useRef)(null)),c=Object(r.useContext)(H),s=Object(u.a)(c,3),d=s[0],l=s[1],h=s[2];return Object(r.useEffect)((function(){for(var e=o.current.childNodes.length-1;e>=0;e--)o.current.removeChild(o.current.childNodes[e]);o.current.appendChild(a.app.view)}),[a]),Object(r.useEffect)((function(){a.rerender({args:{fireBatch:h,isSecondConstructorCall:!1},updaters:l,gameState:d})}),[a,h,l,d]),Object(i.jsx)(i.Fragment,{children:Object(i.jsx)("div",{ref:o,hidden:e.hidden,style:{}})})}var Se=n(127);"Mobile Safari"===(new(n.n(Se).a)).getBrowser().name&&(window.innerWidth,window.innerHeight);var me,ge=function(e){Object(y.a)(n,e);var t=Object(O.a)(n);function n(e){var i;return Object(l.a)(this,n),(i=t.call(this,e)).handleWindowResize=function(e){i.props.updaters.enqueueUpdate((function(e){return Object(P.a)(Object(P.a)({},e),{},{innerWidth:window.innerWidth,innerHeight:window.innerHeight})}))},i.state={},window.addEventListener("resize",i.handleWindowResize),i}return Object(h.a)(n,[{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.handleWindowResize)}},{key:"render",value:function(){return Object(i.jsx)(i.Fragment,{children:" "})}}]),n}(a.a.Component);!function(e){e.NORTHWEST="NORTHWEST",e.SOUTHWEST="SOUTHWEST",e.NORTHEAST="NORTHEAST",e.SOUTHEAST="SOUTHEAST",e.EAST="EAST",e.WEST="WEST",e.UP="UP",e.DOWN="DOWN"}(me||(me={}));function ke(e){var t={};return t.EAST=e.addX(1),t.WEST=e.addX(-1),t.NORTHWEST=e.addY(1),t.SOUTHEAST=e.addY(-1),t.NORTHEAST=e.add(1,1,0),t.SOUTHWEST=e.add(-1,-1,0),t}function xe(e,t,n,i){var r=new F,a=new F;r.put(e);for(var o=[[e]],c=1;c<=t;c++){o.push([]);var u,s=Object(S.a)(o[c-1]);try{for(s.s();!(u=s.n()).done;)for(var d=u.value,l=Object.values(ke(d)),h=0,p=l;h<p.length;h++){var f=p[h];f&&(r.get(f)||((null===i||void 0===i?void 0:i.contains(f))?a.put(f):(r.put(f),o[c].push(f))))}}catch(O){s.e(O)}finally{s.f()}}for(var v=[],y=n||0;y<=t;y++)v=v.concat(o[y]);return v=v.concat(a.values())}var je,we,Ee=n(5),Te=function(){function e(t){Object(l.a)(this,e),this.config=void 0,this.chunkGenFactory=void 0,this.config=t,this.chunkGenFactory=new Ne({})}return Object(h.a)(e,[{key:"create",value:function(e){for(var t=Object(Ee.b)(e.seed+e.z),n=new q,i=e.startingChunks||3,r=-i;r<=i;r++)for(var a=-i;a<=i;a++){var o=new x(r,a);n.put(o,this.chunkGenFactory.create({seed:t,location:o,z:e.z}))}return{id:t,chunks:n}}}]),e}(),Ne=function(){function e(t){Object(l.a)(this,e),this.config=void 0,this.pointNodeGenFactory=void 0,this.config=t,this.pointNodeGenFactory=new _e({})}return Object(h.a)(e,[{key:"create",value:function(e){for(var t=Object(Ee.b)(e.seed+Object(Ee.b)(e.seed+e.location.x)+e.location.y),n=new q,i=new F,r=-_.CHUNK_HALF_DIM;r<=_.CHUNK_HALF_DIM;r++)for(var a=-_.CHUNK_HALF_DIM;a<=_.CHUNK_HALF_DIM;a++)0===r&&0===a||Object(Ee.b)(t+r*_.CHUNK_DIM+a)/Ee.a<_.DROP_NODES_CHANCE/4&&(i.put(new x(r,a)),i.put(new x(a,-r)),i.put(new x(-r,-a)),i.put(new x(-a,r)));for(var o=-_.CHUNK_HALF_DIM;o<=_.CHUNK_HALF_DIM;o++)for(var c=-_.CHUNK_HALF_DIM;c<=_.CHUNK_HALF_DIM;c++){var u=new x(o,c);i.get(u)||n.put(u,this.pointNodeGenFactory.create({seed:t,location:u,chunk:e.location,z:e.z}))}return{id:t,pointNodes:n}}}]),e}(),_e=function(){function e(t){Object(l.a)(this,e),this.config=void 0,this.config=t}return Object(h.a)(e,[{key:"create",value:function(e){var t,n=Object(Ee.b)(e.seed+Object(Ee.b)(e.seed+e.location.x)+e.location.y),i=Object(Ee.b)(n+1)/Ee.a,r=w.Mana2,a=j.Nothing;i<0?a=j.Nothing:i<.15?(a=j.Basic,r=w.Mana0):i<.35?(a=j.EfficiencyGate,r=w.Mana0):i<-.35?(a=j.Basic,r=w.Mana1):i<-.6?(a=j.Basic,r=w.Mana2):a=j.Nothing,e.location.equals(x.Zero)&&e.chunk.equals(x.Zero)&&0===e.z&&(a=j.Nothing);var o=0;if((t=(i=Object(Ee.b)(n+2)/Ee.a)<.55?E.Flat:i<-.7?E.AfterIncreased0:i<-.7?E.AfterIncreased1:i<1.95?E.Increased0:E.Increased1)===E.Flat||t===E.AfterIncreased0||t===E.AfterIncreased1?(i=Math.floor(Object(Ee.b)(n+3)/Ee.a*4),i+=Math.floor(Object(Ee.b)(n+4)/Ee.a*4),o=20*(i+=Math.floor(Object(Ee.b)(n+5)/Ee.a*4))+60):(i=Math.floor(Object(Ee.b)(n+3)/Ee.a*2),i+=Math.floor(Object(Ee.b)(n+4)/Ee.a*2),i+=Math.floor(Object(Ee.b)(n+5)/Ee.a*2),o=(i+=Math.floor(Object(Ee.b)(n+6)/Ee.a*3))+3),a===j.Nothing)return{id:n,nodeType:a};if(a===j.EfficiencyGate){return{id:n,resourceAmount:o,resourceModifier:t,resourceType:r,nodeType:a,efficiencyGateInfo:{thresholdResourceAmount:300,thresholdResourceType:w.Mana0,timeUntilLocked:14}}}return{id:n,resourceAmount:o,resourceModifier:t,resourceType:r,nodeType:a}}}]),e}(),Ce=function(){function e(t){Object(l.a)(this,e),this.config=void 0,this.config=t}return Object(h.a)(e,[{key:"create",value:function(e){var t=Object(Ee.b)(e.seed+e.location.x+e.location.y+Object(Ee.b)(e.seed+e.location.x+e.location.z))/Ee.a,n={shortTextTarget:"\ud83d\udd12",shortTextTimer:"",lockStatus:I.TICKING};if(!e.location.equals(he.Zero))return t<.47?n:void 0}}]),e}();function Ie(e){for(var t=e.randInt,n=e.weights,i=e.behaviors,r=t/Ee.a,a=Object(Ee.b)(t),o=r*Object.values(n).reduce((function(e,t){return e+t})),c=0,s=Object.entries(n);c<s.length;c++){var d=Object(u.a)(s[c],2),l=d[0],h=d[1];if(o<=h)return i[l](a);o-=h}throw Error()}function Ue(e){var t,n=e.randInt,i=e.weights,r=n/Ee.a*Object.values(i).reduce((function(e,t){return e+t})),a=Object(S.a)(Object.entries(i));try{for(a.s();!(t=a.n()).done;){var o=Object(u.a)(t.value,2),c=o[0],s=o[1];if(r<=s)return c;r-=s}}catch(d){a.e(d)}finally{a.f()}throw Error()}function Me(e){var t=e.randInt,n=e.min,i=e.max,r=e.increment,a=void 0===r?1:r,o=e.inclusive,c=void 0===o||o,u=t/Ee.a,s=Math.ceil((i-n)/a);return n+a*s===i&&!0===c&&(s+=1),n+Math.floor(u*s)*a}!function(e){e.RED0="RED0",e.RED1="RED1",e.RED2="RED2",e.DEL0="DEL0",e.DEL1="DEL1",e.DEL2="DEL2"}(je||(je={})),function(e){e.FLAT="FLAT",e.INCREASED="INCREASED"}(we||(we={}));var Re={DECISION_0:{EMPTY:800,NO_SPEND:100,SPEND:10},DECISION_1:{SINGLE:500,DOUBLE:100}},Ae=function(){function e(t){Object(l.a)(this,e),this.config=void 0,this.config=t}return Object(h.a)(e,[{key:"createSingle",value:function(e){var t,n,i=Ue({randInt:e.randInt,weights:(t={},Object(Y.a)(t,je.RED0,100),Object(Y.a)(t,je.RED1,100),Object(Y.a)(t,je.RED2,100),Object(Y.a)(t,je.DEL0,10),Object(Y.a)(t,je.DEL1,10),Object(Y.a)(t,je.DEL2,10),t)}),r=Ue({randInt:Object(Ee.b)(e.randInt),weights:(n={},Object(Y.a)(n,we.FLAT,100),Object(Y.a)(n,we.INCREASED,75),n)}),a=0;return a=r===we.FLAT?function(e){for(var t=e.randInt,n=e.formula,i=e.plus,r=void 0===i?0:i,a=parseInt(n.split("d")[0]),o=parseInt(n.split("d")[1]),c=0,u=0;u<a;u++)c+=Me({randInt:Object(Ee.b)(t+u),min:1,max:o,inclusive:!0});return c+r}({randInt:Object(Ee.b)(e.randInt+1),formula:"2d6",plus:8}):Me({randInt:Object(Ee.b)(e.randInt+2),min:4,max:7,increment:.5,inclusive:!0}),{attribute:je[i],amount:a,modifier:we[r]}}},{key:"createNoSpend",value:function(e){var t=this;return Ie({randInt:e.randInt,weights:Re.DECISION_1,behaviors:{SINGLE:function(e){return{lines:[t.createSingle({randInt:e})]}},DOUBLE:function(e){return{lines:[t.createSingle({randInt:e}),t.createSingle({randInt:Object(Ee.b)(e)})]}}}})}},{key:"create",value:function(e){var t=this,n=e.seed,i=e.location;return i.equals(he.Zero)?{lines:[]}:Ie({randInt:Object(Ee.b)(n+i.x+i.y+Object(Ee.b)(n+i.x+i.z)),weights:Re.DECISION_0,behaviors:{EMPTY:function(e){return{lines:[]}},NO_SPEND:function(e){return t.createNoSpend({randInt:e})},SPEND:function(e){var n,i=t.createNoSpend({randInt:e}),r=Ue({randInt:e,weights:(n={},Object(Y.a)(n,je.RED0,100),Object(Y.a)(n,je.RED1,100),Object(Y.a)(n,je.RED2,100),Object(Y.a)(n,je.DEL0,0),Object(Y.a)(n,je.DEL1,0),Object(Y.a)(n,je.DEL2,0),n)});return Object(P.a)(Object(P.a)({},i),{},{condition:{type:"SPEND",amount:12,attribute:je[r]}})}}})}}]),e}(),De=function(){function e(t){Object(l.a)(this,e),this.updaters=void 0,this.updaters=t}return Object(h.a)(e,[{key:"enqueueAction",value:function(e){var t,n,i=e.nodeLocation,r=e.newStatus;this.updaters.playerSave.allocationStatusMap.enqueueUpdate((function(e){return e.put(i,r),e.clone()})),null===(t=this.updaters.computed.lockStatusMap)||void 0===t||t.enqueueUpdate((function(e,t){if(!e)return e;var n,i=Object(S.a)(t.worldGen.lockMap.entries());try{for(i.s();!(n=i.n()).done;){var r=Object(u.a)(n.value,2),a=r[0];if(r[1]){var o=I.TICKING;e.put(a,o)}}}catch(c){i.e(c)}finally{i.f()}return e.clone()})),null===(n=this.updaters.computed.fogOfWarStatusMap)||void 0===n||n.enqueueUpdate((function(e,t){return e?(e.put(i,C.VISIBLE),xe(i,1).forEach((function(t){e.put(t,C.AVAILABLE)})),xe(i,6,0,{contains:function(e){var n,i=null===(n=t.computed.lockStatusMap)||void 0===n?void 0:n.get(e);return!(!i||i===I.OPEN)}}).forEach((function(n){(e.get(n)||C.HIDDEN)===C.HIDDEN&&(t.worldGen.lockMap.precompute(n),e.put(n,C.UNREACHABLE))})),e.clone()):e}))}}]),e}(),He=function(){function e(t){Object(l.a)(this,e),this.config=void 0,this.config=t}return Object(h.a)(e,[{key:"create",value:function(){var e,t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,i=n||103043,r=new Te({}).create({seed:i,z:0,startingChunks:0}),a=new x(0,0),o=null===(e=r.chunks.get(a))||void 0===e||null===(t=e.pointNodes.get(a))||void 0===t?void 0:t.id,c=new N({z:0,chunkCoord:a,pointNodeId:o,pointNodeCoord:a}),s={orientation:"original",innerWidth:window.innerWidth,innerHeight:window.innerHeight},d=new Ce({}),l=new de((function(e){return d.create({seed:i,location:e})})),h=new Ae({}),p=new de((function(e){return h.create({seed:i,location:e})})),f={tick:0,worldGen:{seed:i,zLevels:{0:r},lockMap:l,nodeContentsMap:p},playerSave:{activeQuest:void 0,spSpentThisQuest:void 0,questProgressHistory:[],questInitialAmount:0,questsCompleted:[],allocatedPointNodeSet:new F([c]),allocatedPointNodeHistory:[c],score:0,allocationStatusMap:new q([[he.Zero,C.TAKEN]])},playerUI:{selectedPointNode:void 0,activeTab:0,isPixiHidden:!0,virtualGridLocation:he.Zero,cursoredNodeLocation:void 0,isSidebarOpen:!1},computed:{},intent:{activeIntent:U,newIntent:U,endedIntent:U},windowState:s};f.computed=Object(P.a)({},ie(f)),f.computed.lockStatusMap=new V,f.computed.fogOfWarStatusMap=new V,xe(he.Zero,6).forEach((function(e){f.worldGen.lockMap.precompute(e)}));var v,y=f.computed.lockStatusMap,O=(he.Zero,f),b=Object(S.a)(O.worldGen.lockMap.entries());try{for(b.s();!(v=b.n()).done;){var m=Object(u.a)(v.value,2),g=m[0],k=m[1];if(k){var j=I.TICKING;y.put(g,j)}}}catch(M){b.e(M)}finally{b.f()}var w=f.computed.fogOfWarStatusMap,E=he.Zero,T=(C.TAKEN,f);w.put(E,C.VISIBLE),xe(E,1).forEach((function(e){w.put(e,C.AVAILABLE)}));var _={contains:function(e){var t,n=null===(t=T.computed.lockStatusMap)||void 0===t?void 0:t.get(e);return!(!n||n===I.OPEN)}};return xe(E,6,0,_).forEach((function(e){(w.get(e)||C.HIDDEN)===C.HIDDEN&&(T.worldGen.lockMap.precompute(e),w.put(e,C.UNREACHABLE))})),f}}]),e}();n(232);function ze(e){var t=e.children,n=e.hidden,r=e.setSidebarHidden;return Object(i.jsxs)("div",{className:"layout",hidden:n,children:[Object(i.jsx)("div",{className:"close",onClick:function(){r()},children:"\u274e Close"}),Object(i.jsx)("br",{}),Object(i.jsx)(i.Fragment,{children:t})]})}n(233);function Pe(e){var t=e.value,n=e.labels,r=e.onChange;return Object(i.jsx)("div",{className:"tab-label-container",children:n.map((function(e,n){return Object(i.jsx)(Le,{onClick:r,value:n,active:t===n,children:e},n)}))})}function Le(e){var t=e.onClick,n=e.value,r=e.active,a=e.children;return Object(i.jsx)("div",{className:r?"tab-label active":"tab-label inactive",children:Object(i.jsx)("div",{onClick:function(){t(n)},children:a})})}var Ge,We,Fe,Ve=a.a.memo(qe);function qe(e){var t=e.hexGridPx,n=e.borderWidth,a=e.hexCenterRadius,o=(e.appSize,e.COLORS);return Object(r.useEffect)((function(){document.documentElement.style.setProperty("--grid-width"," ".concat(t.x,"px")),document.documentElement.style.setProperty("--grid-height"," ".concat(t.y,"px")),document.documentElement.style.setProperty("--hex-center-radius"," ".concat(a,"px")),document.documentElement.style.setProperty("--border-width"," ".concat(n,"px"))}),[t,a,n]),Object(r.useEffect)((function(){document.documentElement.style.setProperty("--background-black",W(o.backgroundBlue)),document.documentElement.style.setProperty("--deemphasized-black",W(o.grayBlack)),document.documentElement.style.setProperty("--active-purple",W(o.nodePink)),document.documentElement.style.setProperty("--border-unimportant-black",W(o.borderBlack)),document.documentElement.style.setProperty("--border-important-white",W(o.borderWhite)),document.documentElement.style.setProperty("--text-readable-white",W(o.textWhite))}),[o]),Object(r.useEffect)((function(){document.documentElement.style.setProperty("--app-size-width"," ".concat(e.appSize.x,"px")),document.documentElement.style.setProperty("--app-size-height"," ".concat(e.appSize.y,"px"))}),[e.appSize]),Object(i.jsx)(i.Fragment,{children:e.children})}var Be=(Ge={},Object(Y.a)(Ge,je.RED0,"\ud83d\udd34"),Object(Y.a)(Ge,je.RED1,"\ud83d\udfe2"),Object(Y.a)(Ge,je.RED2,"\ud83d\udd35"),Object(Y.a)(Ge,je.DEL0,"\u2694\ufe0f"),Object(Y.a)(Ge,je.DEL1,"\ud83d\udee1"),Object(Y.a)(Ge,je.DEL2,"\u2728"),Ge),Ke=(We={},Object(Y.a)(We,je.RED0,"Red"),Object(Y.a)(We,je.RED1,"Green"),Object(Y.a)(We,je.RED2,"Blue"),Object(Y.a)(We,je.DEL0,"Offense"),Object(Y.a)(We,je.DEL1,"Defense"),Object(Y.a)(We,je.DEL2,"Magic"),We);Fe={},Object(Y.a)(Fe,we.FLAT,"flat"),Object(Y.a)(Fe,we.INCREASED,"increased");function Xe(e){return e.modifier===we.FLAT?"+".concat(e.amount," ").concat(Ke[e.attribute]):"".concat(e.amount,"% increased ").concat(Ke[e.attribute])}n(124),n(70),n(234);var Ze=a.a.memo(Ye);function Ye(e){var t=e.idx,n=e.rowIdx,a=e.onUpdateStatus,o=e.nodeData,c=e.isCursored,u=e.onUpdateCursored,s=Object(r.useCallback)((function(e){e.stopPropagation(),e.preventDefault(),a({virtualCoords:new x(t,n),newStatus:C.TAKEN})}),[a,o.status,t,n]),d=Object(r.useCallback)((function(e){e.stopPropagation(),e.preventDefault(),u(c?void 0:new x(t,n))}),[c,u]);return Object(i.jsx)(Je,{onClickCenter:s,nodeData:o,onClickQuestionMark:d,isCursored:c})}var Je=a.a.memo(Qe);function Qe(e){var t,n,r=e.onClickCenter,a=e.onClickQuestionMark,o=e.nodeData,c=e.isCursored,u=o.status,s=!!o.lockData;return Object(i.jsxs)("div",{className:"hex-block hex-full-block",children:[Object(i.jsx)("div",{className:d()("hex-center",u===C.TAKEN?"node-allocated":"node-unallocated",u===C.TAKEN||u===C.UNREACHABLE?"border-unimportant":"border-important"),onClick:r,hidden:u===C.HIDDEN,children:Object(i.jsx)("div",{className:"hex-center-text-wrapper",children:Object(i.jsx)("div",{className:"tiny-text",children:o.shortText})})}),s?Object(i.jsxs)("div",{className:"hex-center-lock",hidden:u===C.HIDDEN,children:[Object(i.jsx)("div",{className:"hex-center-lock-left",children:Object(i.jsx)("div",{className:"tiny-text",children:null===(t=o.lockData)||void 0===t?void 0:t.shortTextTarget})}),Object(i.jsx)("div",{className:"hex-center-lock-right",children:Object(i.jsx)("div",{className:"tiny-text",children:null===(n=o.lockData)||void 0===n?void 0:n.shortTextTimer})})]}):null,Object(i.jsx)("div",{className:"empty-positioned",children:Object(i.jsx)("div",{className:"hover-only-2 absolute-positioned",children:Object(i.jsx)("div",{className:"question",hidden:u===C.HIDDEN,onClick:a,children:"?"})})}),Object(i.jsx)("div",{className:"empty-positioned node-tooltip-wrapper",children:Object(i.jsx)("div",{className:"hover-only absolute-positioned node-tooltip",children:o.toolTipText})}),Object(i.jsx)("div",{className:"empty-positioned selection-cursor-wrapper",children:Object(i.jsx)("div",{className:"absolute-positioned selection-cursor",hidden:!c})})]})}var $e=a.a.memo(et);function et(e){var t=e.virtualGridDims,n=e.virtualCoordsToLocation,r=e.virtualNodeDataMap,a=e.updateNodeStatusCb,o=e.cursoredVirtualNode,c=e.setCursoredVirtualNode;return console.log("Game area grid rerender"),Object(i.jsx)(i.Fragment,{children:Array(t.y).fill(0).map((function(e,u){return Object(i.jsx)(tt,{rowIdx:u,children:Array(t.x).fill(0).map((function(e,t){var n,s=new x(t,u),d=r.get(s);return Object(i.jsx)(Ze,{nodeData:d,idx:t,rowIdx:u,onUpdateStatus:a,isCursored:!!o&&o.equals(s),onUpdateCursored:c},null!==(n=null===d||void 0===d?void 0:d.id)&&void 0!==n?n:"loading".concat(t))}))},n(new x(0,u)).y.toString())}))})}var tt=a.a.memo(nt);function nt(e){var t=e.rowIdx,n=e.children,r=!!(t%2);return Object(i.jsxs)("div",{className:"hex-block-row",children:[r&&Object(i.jsx)("div",{className:"hex-block hex-half-block"}),n,!r&&Object(i.jsx)("div",{className:"hex-block hex-half-block"})]})}var it=a.a.memo(rt);function rt(e){var t=e.hexGridPx,n=e.virtualGridDims,a=e.appSize,o=e.updaters,c=e.keyboardScrollDirection;console.log("infinite scroll manager rerender");var s=Object(r.useRef)(null),d=Object(r.useRef)(null),l=Object(r.useState)(new x(0,0)),h=Object(u.a)(l,2),p=h[0],f=h[1];Object(r.useEffect)((function(){null!=s.current&&s.current!==d.current&&(s.current.scrollTop=(n.y*t.y-a.y)/2,s.current.scrollLeft=((n.x+.5)*t.x-a.x)/2),d.current=s.current}),[s.current,a]),Object(r.useEffect)((function(){if(p){var e=s.current;e&&e.scrollTo(e.scrollLeft-p.x*t.x,e.scrollTop-p.y*t.y)}}),[p]);var v=Object(r.useCallback)((function(e){var t=n.multiply(.35).floor(),i=(t=(t=t.withY(2*Math.floor(t.y/2))).clampX(1,n.x-1).clampY(2,2*Math.floor((n.y-1)/2))).multiply(e.direction);o.playerUI.virtualGridLocation.enqueueUpdate((function(e){return e.addX(i.x).add(new he(-1,-2,0).multiply(i.y/2))})),f(i)}),[n,o]),y=Object(r.useCallback)((function(e){var i={x:0,y:0},r=e.target,o=r.scrollTop,c=r.scrollLeft;r.scrollTop<.4*t.y&&(o+=2*t.y,i.y-=1),r.scrollTop>(n.y-.4)*t.y-a.y&&(o-=2*t.y,i.y+=1),r.scrollLeft<.9*t.x&&(c+=2*t.x,i.x-=1),r.scrollLeft>(n.x-.9)*t.x-a.x&&(c-=2*t.x,i.x+=1),r.scrollTop===o&&r.scrollLeft===c||v({direction:new x(i.x,i.y)})}),[a.x,a.y]);return Object(r.useEffect)((function(){if(!c.equals(x.Zero)){var e=null,t=function(){var t=s.current;if(t){var n=x.Zero;if(null===e)n=c.multiply(8),e=+new Date;else{var i=+new Date-e;i>40&&console.log("WAS SLOW - "+i.toString()),n=c.multiply(i),e=+new Date}n=n.multiply(.75),t.scrollTo(t.scrollLeft+n.x,t.scrollTop-n.y)}},n=setInterval(t,8);return t(),function(){return clearInterval(n)}}}),[c,s.current]),Object(i.jsx)("div",{ref:s,className:"game-area",hidden:e.hidden,onScroll:y,children:Object(i.jsx)("div",{className:"virtual-game-area",children:e.children})})}var at=a.a.memo(ot);function ot(e){var t=e.gameState,n=e.appSize,a=e.virtualGridDims,o=Object(r.useCallback)((function(e){return function(e){var t=e.virtualCoords,n=e.virtualGridLocation,i=e.virtualGridDims.divide(2).floor(),r=t.subtract(i),a=x.Zero;return a=(a=r.y%2===0?new x(-1,-2).multiply(r.y/2):i.y%2===0?new x(0,-1).add(new x(-1,-2).multiply((r.y-1)/2)):new x(-1,-1).add(new x(-1,-2).multiply((r.y-1)/2))).addX(r.x),n.add(he.FromVector2(a,0))}({virtualCoords:e,virtualGridDims:a,virtualGridLocation:t.playerUI.virtualGridLocation})}),[t.playerUI.virtualGridLocation,a]),c=Object(r.useCallback)((function(e){return function(e){var t=e.location,n=e.virtualGridLocation,i=e.virtualGridDims.divide(2).floor(),r=t.subtract(n),a=x.Zero;if(0===r.z)return a=(a=r.y%2===0?new x(-1,-2).multiply(r.y/2):i.y%2===0?new x(-1,-1).add(new x(-1,-2).multiply((r.y-1)/2)):new x(0,-1).add(new x(-1,-2).multiply((r.y-1)/2))).addX(r.x),i.add(a)}({location:e,virtualGridDims:a,virtualGridLocation:t.playerUI.virtualGridLocation})}),[t.playerUI.virtualGridLocation,a]),u=Object(r.useMemo)((function(){return function(e){for(var t,n=e.allocationStatusMap,r=e.nodeContentsMap,a=e.lockMap,o=e.fogOfWarStatusMap,c=e.virtualGridDims,u=e.virtualCoordsToLocation,s=+new Date,d=new q,l=0;l<c.x;l++)for(var h=0;h<c.y;h++){var p=new x(l,h),f=u(p),v=null===o||void 0===o?void 0:o.get(f),y=n.get(f)===C.TAKEN?C.TAKEN:v||C.HIDDEN,O=f.hash(),b=a.get(f),S=r.get(f),m="+";S.lines[0]?m+=Be[S.lines[0].attribute]:m="",S.lines[1]&&S.lines[0].attribute!==S.lines[1].attribute&&(m+=Be[S.lines[1].attribute]);var g="";S.condition&&(g="-"+Be[S.condition.attribute]);var k={shortText:g?Object(i.jsxs)(i.Fragment,{children:[m,Object(i.jsx)("br",{}),g]}):Object(i.jsx)(i.Fragment,{children:m}),toolTipText:Object(i.jsxs)(i.Fragment,{children:[Object(i.jsx)("div",{children:y.toString()}),S.lines[0]?Object(i.jsx)("br",{}):Object(i.jsx)(i.Fragment,{}),Object(i.jsx)("div",{children:S.lines[0]&&Xe(S.lines[0])}),Object(i.jsx)("div",{children:S.lines[1]&&Xe(S.lines[1])}),Object(i.jsx)("div",{children:S.condition&&(t=S.condition,"SPEND: ".concat(t.amount," ").concat(Ke[t.attribute]))})]}),fullText:Object(i.jsx)(i.Fragment,{children:" "}),status:y,lockData:b,id:O};d.put(p,k)}var j=+new Date-s;return j>100&&window.alert("compute took "+j.toString()),d}({allocationStatusMap:t.playerSave.allocationStatusMap,nodeContentsMap:t.worldGen.nodeContentsMap,lockMap:t.worldGen.lockMap,fogOfWarStatusMap:t.computed.fogOfWarStatusMap,virtualGridDims:a,virtualCoordsToLocation:o})}),[t.playerSave.allocationStatusMap,t.worldGen.nodeContentsMap,t.worldGen.lockMap,t.computed.fogOfWarStatusMap,a,o]),s=Object(r.useCallback)((function(n){var i,r=n.virtualCoords,a=n.newStatus,c=o(r),u=(null===(i=t.computed.fogOfWarStatusMap)||void 0===i?void 0:i.get(c))||C.HIDDEN;if(a===C.TAKEN){if(u!==C.AVAILABLE)return void console.log("cant do that",u);var s=t.worldGen.lockMap.get(c);if(s)return void console.log("is locked",s)}t.playerSave.allocationStatusMap.get(c)!==C.TAKEN&&e.actions.allocateNode.enqueueAction({nodeLocation:c,newStatus:C.TAKEN})}),[e.updaters,o,t.playerSave.allocationStatusMap,t.computed.fogOfWarStatusMap,t.computed.lockStatusMap,t.worldGen.lockMap]),d=Object(r.useMemo)((function(){return t.playerUI.cursoredNodeLocation?c(t.playerUI.cursoredNodeLocation):void 0}),[t.playerUI.cursoredNodeLocation,c]),l=Object(r.useCallback)((function(t){e.updaters.playerUI.cursoredNodeLocation.enqueueUpdate((function(e){var n=t?o(t):void 0;return console.log({updated:n}),n})),t&&e.updaters.playerUI.isSidebarOpen.enqueueUpdate((function(){return!0}))}),[e.updaters,o]);Object(r.useEffect)((function(){var t=e.gameState.intent.newIntent,n=o(a.divide(2).floor());t[T.MOVE_CURSOR_EAST]&&e.updaters.playerUI.cursoredNodeLocation.enqueueUpdate((function(e){return(null===e||void 0===e?void 0:e.addX(1))||n})),t[T.MOVE_CURSOR_WEST]&&e.updaters.playerUI.cursoredNodeLocation.enqueueUpdate((function(e){return(null===e||void 0===e?void 0:e.addX(-1))||n})),t[T.MOVE_CURSOR_NORTHEAST]&&e.updaters.playerUI.cursoredNodeLocation.enqueueUpdate((function(e){return(null===e||void 0===e?void 0:e.add({x:1,y:1,z:0}))||n})),t[T.MOVE_CURSOR_NORTHWEST]&&e.updaters.playerUI.cursoredNodeLocation.enqueueUpdate((function(e){return(null===e||void 0===e?void 0:e.addY(1))||n})),t[T.MOVE_CURSOR_SOUTHEAST]&&e.updaters.playerUI.cursoredNodeLocation.enqueueUpdate((function(e){return(null===e||void 0===e?void 0:e.addY(-1))||n})),t[T.MOVE_CURSOR_SOUTHWEST]&&e.updaters.playerUI.cursoredNodeLocation.enqueueUpdate((function(e){return(null===e||void 0===e?void 0:e.add({x:-1,y:-1,z:0}))||n})),t[T.MOVE_CURSOR_SOUTH]&&e.updaters.playerUI.cursoredNodeLocation.enqueueUpdate((function(e){return e&&e.y%2===0?null===e||void 0===e?void 0:e.add({x:0,y:-1,z:0}):e&&e.y%2!==0?null===e||void 0===e?void 0:e.add({x:-1,y:-1,z:0}):n})),t[T.MOVE_CURSOR_NORTH]&&e.updaters.playerUI.cursoredNodeLocation.enqueueUpdate((function(e){return e&&e.y%2===0?null===e||void 0===e?void 0:e.add({x:1,y:1,z:0}):e&&e.y%2!==0?null===e||void 0===e?void 0:e.add({x:0,y:1,z:0}):n})),t[T.INTERACT_WITH_NODE]&&d&&s({virtualCoords:d,newStatus:C.TAKEN})}),[e.gameState.intent.newIntent.INTERACT_WITH_NODE,e.gameState.intent.newIntent.MOVE_CURSOR_EAST,e.gameState.intent.newIntent.MOVE_CURSOR_NORTH,e.gameState.intent.newIntent.MOVE_CURSOR_NORTHEAST,e.gameState.intent.newIntent.MOVE_CURSOR_NORTHWEST,e.gameState.intent.newIntent.MOVE_CURSOR_SOUTH,e.gameState.intent.newIntent.MOVE_CURSOR_SOUTHEAST,e.gameState.intent.newIntent.MOVE_CURSOR_SOUTHWEST,e.gameState.intent.newIntent.MOVE_CURSOR_WEST,e.updaters,d,s]);var h=Object(r.useMemo)((function(){var t=x.Zero;return e.gameState.intent.activeIntent.PAN_EAST&&(t=t.addX(1)),e.gameState.intent.activeIntent.PAN_WEST&&(t=t.addX(-1)),e.gameState.intent.activeIntent.PAN_NORTH&&(t=t.addY(1)),e.gameState.intent.activeIntent.PAN_SOUTH&&(t=t.addY(-1)),t}),[e.gameState.intent.activeIntent.PAN_EAST,e.gameState.intent.activeIntent.PAN_WEST,e.gameState.intent.activeIntent.PAN_NORTH,e.gameState.intent.activeIntent.PAN_SOUTH]);return Object(i.jsx)(i.Fragment,{children:Object(i.jsx)(it,{hidden:!t.playerUI.isPixiHidden,appSize:n,updaters:e.updaters,hexGridPx:ct,virtualGridDims:a,keyboardScrollDirection:h,children:Object(i.jsx)($e,{virtualGridDims:a,virtualNodeDataMap:u,virtualCoordsToLocation:o,updateNodeStatusCb:s,cursoredVirtualNode:d,setCursoredVirtualNode:l})})})}var ct=new x(268,232);function ut(e){var t=e.gameState,n=Object(r.useMemo)((function(){return M(new x(t.windowState.innerWidth,t.windowState.innerHeight))}),[t.windowState.innerWidth,t.windowState.innerHeight]),a=Object(r.useMemo)((function(){var e=Math.floor(3*n.x/ct.x-.5),t=Math.floor(3*n.y/ct.y);return new x(e,t)}),[n,3,ct]),o=Object(r.useMemo)((function(){return console.log("sub game state recalculated!"),{playerUI:{virtualGridLocation:t.playerUI.virtualGridLocation,cursoredNodeLocation:t.playerUI.cursoredNodeLocation,isPixiHidden:t.playerUI.isPixiHidden},playerSave:{allocationStatusMap:t.playerSave.allocationStatusMap},worldGen:{nodeContentsMap:t.worldGen.nodeContentsMap,lockMap:t.worldGen.lockMap},computed:{fogOfWarStatusMap:t.computed.fogOfWarStatusMap,lockStatusMap:t.computed.lockStatusMap},intent:t.intent}}),[t.playerUI.virtualGridLocation,t.playerUI.cursoredNodeLocation,t.playerUI.isPixiHidden,t.playerSave.allocationStatusMap,t.worldGen.nodeContentsMap,t.worldGen.lockMap,t.computed.fogOfWarStatusMap,t.computed.lockStatusMap,t.intent]),c=Object(r.useMemo)((function(){return{allocateNode:new De(e.updaters)}}),[e.updaters]);return Object(i.jsxs)(i.Fragment,{children:[Object(i.jsx)(Ve,{appSize:n,hexCenterRadius:48,hexGridPx:ct,borderWidth:2,COLORS:G}),Object(i.jsx)(at,{appSize:n,virtualGridDims:a,gameState:o,updaters:e.updaters,actions:c})]})}var st=new se((function(){return new He({}).create(+new Date)}));var dt=function(){var e=Object(r.useState)((function(){return st.get()})),t=Object(u.a)(e,2),n=t[0],a=t[1],o=Object(r.useMemo)((function(){return Z(a)}),[a]),c=Object(u.a)(o,2),s=c[0],l=c[1],h=Object(r.useMemo)((function(){return Q(st.get(),s)}),[s]),p=(Object(r.useMemo)((function(){return M(new x(n.windowState.innerWidth,n.windowState.innerHeight))}),[n.windowState.innerWidth,n.windowState.innerHeight]),Object(r.useMemo)((function(){return[n,h,l]}),[n,h,l]));return Object(r.useEffect)((function(){console.log("maybe toggling strategic view"),n.intent.newIntent.TOGGLE_STRATEGIC_VIEW&&h.playerUI.isPixiHidden.enqueueUpdate((function(e){return!e}))}),[n.intent.newIntent.TOGGLE_STRATEGIC_VIEW]),Object(r.useEffect)((function(){console.log("maybe toggling sidebar"),n.intent.newIntent.TOGGLE_SIDEBAR&&h.playerUI.isSidebarOpen.enqueueUpdate((function(e){return!e}))}),[n.intent.newIntent.TOGGLE_SIDEBAR]),Object(i.jsxs)("div",{className:d()({App:!0}),children:[Object(i.jsxs)("div",{className:"entire-area",children:[Object(i.jsx)(H.Provider,{value:p,children:Object(i.jsx)(be,{hidden:n.playerUI.isPixiHidden})}),Object(i.jsx)(ut,{gameState:n,updaters:h})]}),Object(i.jsx)("div",{className:"debug-overlay",children:Object(i.jsx)(f,{tick:n.tick,windowState:n.windowState})}),Object(i.jsxs)("div",{className:"button-zone",children:[Object(i.jsx)("button",{className:"button-pixi-toggle",style:{},onClick:function(){h.playerUI.isPixiHidden.enqueueUpdate((function(e){return!e}))},children:"Toggle strategic view (hotkey: m)"}),Object(i.jsx)("span",{children:" "}),Object(i.jsx)("button",{onClick:function(){h.playerUI.isSidebarOpen.enqueueUpdate((function(e){return!e}))},children:"Toggle sidebar (hotkey: i)"})]}),Object(i.jsxs)(ze,{hidden:!n.playerUI.isSidebarOpen,setSidebarHidden:function(){h.playerUI.isSidebarOpen.enqueueUpdate((function(){return!1}))},children:[Object(i.jsx)(Pe,{onClick:function(){},value:0,labels:["foo","bar"],onChange:function(e){},active:!0}),Object(i.jsx)("br",{}),"content"]}),Object(i.jsx)(D,{intent:n.intent,updaters:h.intent}),Object(i.jsx)(ge,{updaters:h.windowState})]})};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(Object(i.jsx)(a.a.StrictMode,{children:Object(i.jsx)(dt,{})}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},5:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return r}));n(2),n(3),n(48);var i=Math.pow(2,32);function r(e){var t=(e+i)%i;return t=Math.imul(t,3039394381),t^=t>>>8,t+=1759714724,t^=t<<8,t=Math.imul(t,458671337),((t^=t>>>8)+i)%i}}).call(this,n(14).Buffer)},70:function(e,t,n){}},[[235,1,2]]]);
//# sourceMappingURL=main.9a868d8f.chunk.js.map