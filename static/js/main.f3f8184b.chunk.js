(this["webpackJsonpprocgen-skill-tree"]=this["webpackJsonpprocgen-skill-tree"]||[]).push([[0],{131:function(e,t,n){},132:function(e,t,n){},133:function(e,t,n){},143:function(e,t){},145:function(e,t){},156:function(e,t){},158:function(e,t){},183:function(e,t){},185:function(e,t){},186:function(e,t){},191:function(e,t){},193:function(e,t){},212:function(e,t){},224:function(e,t){},227:function(e,t){},230:function(e,t,n){},231:function(e,t,n){},232:function(e,t,n){},233:function(e,t,n){"use strict";n.r(t);var i=n(0),r=n(6),o=n.n(r),a=n(123),c=n.n(a),s=(n(131),n(10)),u=(n(132),n(46)),d=n.n(u),l=n(124),h=n.n(l),p=n(18),v=n(1),f=n(2),y=n(8),b=function(){function e(){Object(v.a)(this,e)}return Object(f.a)(e,null,[{key:"MinBy",value:function(e,t){var n,i=null,r=null,o=Object(y.a)(e);try{for(o.s();!(n=o.n()).done;){var a=n.value,c=t(a);(null===r||c<r)&&(i=a,r=c)}}catch(s){o.e(s)}finally{o.f()}return i}},{key:"MinByAndValue",value:function(e,t){var n,i=null,r=null,o=Object(y.a)(e);try{for(o.s();!(n=o.n()).done;){var a=n.value,c=t(a);(null===r||c<r)&&(i=a,r=c)}}catch(s){o.e(s)}finally{o.f()}return null===i||null===r?null:{obj:i,value:r}}},{key:"MaxBy",value:function(e,t){var n,i=null,r=null,o=Object(y.a)(e);try{for(o.s();!(n=o.n()).done;){var a=n.value,c=t(a);(null===r||c>r)&&(i=a,r=c)}}catch(s){o.e(s)}finally{o.f()}return i}},{key:"RandRange",value:function(e,t){return Math.floor(Math.random()*(t-e)+e)}},{key:"SortByKey",value:function(e,t){return e.sort((function(e,n){return t(e)-t(n)}))}},{key:"ReplaceAll",value:function(e,t){var n=new RegExp(Object.keys(t).join("|"),"gi");return e.replace(n,(function(e){return t[e.toLowerCase()]}))}},{key:"Debounce",value:function(e){var t,n=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{isImmediate:!1},o=function(){for(var o=arguments.length,a=new Array(o),c=0;c<o;c++)a[c]=arguments[c];var s=function(){t=void 0,r.isImmediate||e.apply(n,a)},u=r.isImmediate&&void 0===t;void 0!==t&&clearTimeout(t),t=setTimeout(s,i),u&&e.apply(n,a)};return o}},{key:"FormatDate",value:function(e){var t=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][e.getMonth()];return"".concat(t," ").concat(e.getDate(),", ").concat(("00"+e.getHours()).substr(-2),":").concat(("00"+e.getMinutes()).substr(-2),":").concat(("00"+e.getSeconds()).substr(-2))}},{key:"FlattenByOne",value:function(e){var t,n=[],i=Object(y.a)(e);try{for(i.s();!(t=i.n()).done;){var r=t.value;n=n.concat(r)}}catch(o){i.e(o)}finally{i.f()}return n}},{key:"PadString",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:" ";return e+n+i.repeat(t-e.length)}}]),e}(),j={};function g(e){var t=e.toString();if(void 0!==j[t]){if(1!==j[t][1])throw new Error("Error, called more than twice with same id: "+t+" , callback the first time was : "+j[t]);j[t][1]=2}else{var n=(new Error).stack;j[t]=[n,1]}}var k=function(){function e(t){Object(v.a)(this,e),this._wasConstructed=!1,this._value=void 0,this._factory=void 0,this._factory=t}return Object(f.a)(e,[{key:"get",value:function(){return void 0!==this._value||!0===this._wasConstructed||(this._value=this._factory(),this._wasConstructed=!0),this._value}},{key:"wasConstructed",value:function(){return this._wasConstructed}}]),e}();function O(e,t){var n=[16711680&e,16711680&t],i=[255&e,255&t],r=[65280&e,65280&t],o=65536*Math.round(n[0]/65536*n[1]/16777215);return o+=256*Math.round(r[0]/256*r[1]/65280),o+=Math.round(i[0]*i[1]/255)}function x(e){return Object.keys(e)}var m,w=function(){function e(t){Object(v.a)(this,e),this.z=void 0,this.chunkCoord=void 0,this.pointNodeCoord=void 0,this.pointNodeId=void 0,this.z=t.z,this.chunkCoord=t.chunkCoord,this.pointNodeCoord=t.pointNodeCoord,this.pointNodeId=t.pointNodeId}return Object(f.a)(e,[{key:"hash",value:function(){return this.pointNodeId.toString()+this.z.toString()+this.chunkCoord.toString()+this.pointNodeCoord.toString()}},{key:"toString",value:function(){return this.z+","+this.chunkCoord.toString()+","+this.pointNodeCoord.toString()}}]),e}(),C=function(){function e(t){Object(v.a)(this,e),this.z=void 0,this.chunkCoord=void 0,this.chunkId=void 0,this.z=t.z,this.chunkCoord=t.chunkCoord,this.chunkId=t.chunkId}return Object(f.a)(e,[{key:"hash",value:function(){return this.chunkId.toString()+this.z.toString()+this.chunkCoord.toString()}}]),e}(),S=n(7),N=function e(){Object(v.a)(this,e)};N.CHUNK_HALF_DIM=((N.CHUNK_DIM=9)-1)/2,N.DROP_NODES_CHANCE=.3,function(e){e.Mana0="Mana0",e.Mana1="Mana1",e.Mana2="Mana2"}(m||(m={}));var _,T,I=Object(S.a)({Nothing:"Nothing"},m);!function(e){e.Flat="Flat",e.Increased0="% increased",e.AfterIncreased0="added after % increased",e.Increased1="% increased multiplier",e.AfterIncreased1="added after % increased multiplier"}(_||(_={})),function(e){e.NOOP="NOOP",e.PAN_NORTH="PAN_NORTH",e.PAN_SOUTH="PAN_SOUTH",e.PAN_WEST="PAN_WEST",e.PAN_EAST="PAN_EAST",e.TRAVEL_IN="TRAVEL_IN",e.TRAVEL_OUT="TRAVEL_OUT"}(T||(T={}));var U,P=x(T).reduce((function(e,t){return e[t]=!1,e}),{}),z=function(){function e(t){Object(v.a)(this,e),this.type=void 0,this.modifier=void 0,this.type=t.type,this.modifier=t.modifier}return Object(f.a)(e,[{key:"hash",value:function(){return this.type.toString()+","+this.modifier.toString()}}]),e}(),A=1e-7,F=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{x:0,y:0},n=arguments.length>1?arguments[1]:void 0;Object(v.a)(this,e),this._x=void 0,this._y=void 0,"number"===typeof t?(this._x=t,this._y=n):(this._x=t.x,this._y=t.y)}return Object(f.a)(e,[{key:"x",get:function(){return this._x}},{key:"y",get:function(){return this._y}}]),Object(f.a)(e,[{key:"hash",value:function(){return this.toString()}},{key:"toString",value:function(){return"[".concat(this.x,", ").concat(this.y,"]")}},{key:"invert",value:function(){return new e({x:-this.x,y:-this.y})}},{key:"round",value:function(){return new e({x:Math.round(this.x),y:Math.round(this.y)})}},{key:"floor",value:function(){return new e({x:Math.floor(this.x),y:Math.floor(this.y)})}},{key:"taxicabDistance",value:function(e){return Math.abs(e.x-this.x)+Math.abs(e.y-this.y)}},{key:"diagonalDistance",value:function(e){return Math.max(Math.abs(e.x-this.x),Math.abs(e.y-this.y))}},{key:"distance",value:function(e){var t=Math.abs(e.x-this.x),n=Math.abs(e.y-this.y);return Math.sqrt(t*t+n*n)}},{key:"translate",value:function(t){return new e({x:this.x+t.x,y:this.y+t.y})}},{key:"subtract",value:function(t){return new e({x:this.x-t.x,y:this.y-t.y})}},{key:"add",value:function(t){return new e({x:this.x+t.x,y:this.y+t.y})}},{key:"addX",value:function(t){return new e({x:this.x+t,y:this.y})}},{key:"addY",value:function(t){return new e({x:this.x,y:this.y+t})}},{key:"subtractX",value:function(t){return new e({x:this.x-t,y:this.y})}},{key:"subtractY",value:function(t){return new e({x:this.x,y:this.y-t})}},{key:"clampY",value:function(t,n){var i=this.y;return i<t&&(i=t),i>n&&(i=n),new e({x:this.x,y:i})}},{key:"scale",value:function(t,n){return new e({x:(this.x-t.x)*n.x+t.x,y:(this.y-t.y)*n.y+t.y})}},{key:"rotate",value:function(t,n){return n/=180/Math.PI,new e({x:Math.cos(n)*(this.x-t.x)-Math.sin(n)*(this.y-t.y)+t.x,y:Math.sin(n)*(this.x-t.x)+Math.cos(n)*(this.y-t.y)+t.y})}},{key:"equals",value:function(e){return void 0!==e&&(Math.abs(this.x-e.x)<A&&Math.abs(this.y-e.y)<A)}},{key:"multiply",value:function(t){return new e("number"===typeof t?{x:this.x*t,y:this.y*t}:{x:this.x*t.x,y:this.y*t.y})}},{key:"divide",value:function(t){return new e("number"===typeof t?{x:this.x/t,y:this.y/t}:{x:this.x/t.x,y:this.y/t.y})}},{key:"toJSON",value:function(){return{__type:"Vector2",x:this.x,y:this.y}}},{key:"transform",value:function(t,n){return new e({x:Math.floor((this.x-t.x)*n),y:Math.floor((this.y-t.y)*n)})}},{key:"normalize",value:function(){if(0===this.x&&0===this.y)return this;var t=Math.sqrt(this.x*this.x+this.y*this.y);return new e({x:this.x/t,y:this.y/t})}},{key:"withX",value:function(t){return new e({x:t,y:this.y})}},{key:"withY",value:function(t){return new e({x:this.x,y:t})}},{key:"invertX",value:function(){return new e({x:-this.x,y:this.y})}},{key:"lerp",value:function(e,t){return(t>1||t<0)&&console.error("Lerp t must be between 0 and 1."),0===t?this:1===t?e:this.scale({x:0,y:0},{x:1-t,y:1-t}).add(e.scale({x:0,y:0},{x:t,y:t}))}},{key:"lerp2D",value:function(e,t,n){return(t>1||t<0||n>1||n<0)&&console.error("Lerp t must be between 0 and 1."),this.scale({x:0,y:0},{x:1-t,y:1-n}).add(e.scale({x:0,y:0},{x:t,y:n}))}},{key:"coserp",value:function(e,t){return t=.5*(1+Math.cos(2*t*Math.PI)),this.lerp(e,t)}},{key:"half",get:function(){return new e({x:this.x/2,y:this.y/2})}}],[{key:"IsVector2",value:function(t){return t instanceof e}},{key:"Random",value:function(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return new e({x:b.RandRange(i,t),y:b.RandRange(r,n)})}},{key:"Deserialize",value:function(t){return t.hasOwnProperty("x")&&t.hasOwnProperty("y")||console.error("Failed deserializing point"),new e({x:t.x,y:t.y})}},{key:"Serialize",value:function(e){return JSON.stringify({x:e.x,y:e.y})}}]),e}();function M(e,t){var n,i=function(e,t){var n={},i=t.zLevels[e.z],r=i.chunks.get(e.chunkCoord);if(e.pointNodeCoord.x===N.CHUNK_HALF_DIM){var o=e.chunkCoord.addX(1),a=i.chunks.get(o);if(a){var c=e.pointNodeCoord.withX(-N.CHUNK_HALF_DIM),s=a.pointNodes.get(c);s&&(n.EAST=new w({z:e.z,chunkCoord:o,pointNodeCoord:c,pointNodeId:s.id}))}}else{var u=e.pointNodeCoord.addX(1),d=r.pointNodes.get(u);d&&(n.EAST=new w({z:e.z,chunkCoord:e.chunkCoord,pointNodeCoord:u,pointNodeId:d.id}))}if(e.pointNodeCoord.x===-N.CHUNK_HALF_DIM){var l=e.chunkCoord.addX(-1),h=i.chunks.get(l);if(h){var p=e.pointNodeCoord.withX(N.CHUNK_HALF_DIM),v=h.pointNodes.get(p);v&&(n.WEST=new w({z:e.z,chunkCoord:l,pointNodeCoord:p,pointNodeId:v.id}))}}else{var f=e.pointNodeCoord.addX(-1),y=r.pointNodes.get(f);y&&(n.WEST=new w({z:e.z,chunkCoord:e.chunkCoord,pointNodeCoord:f,pointNodeId:y.id}))}if(e.pointNodeCoord.y===N.CHUNK_HALF_DIM){var b=e.chunkCoord.addY(1),j=i.chunks.get(b);if(j){var g=e.pointNodeCoord.withY(-N.CHUNK_HALF_DIM),k=j.pointNodes.get(g);k&&(n.SOUTH=new w({z:e.z,chunkCoord:b,pointNodeCoord:g,pointNodeId:k.id}))}}else{var O=e.pointNodeCoord.addY(1),x=r.pointNodes.get(O);x&&(n.SOUTH=new w({z:e.z,chunkCoord:e.chunkCoord,pointNodeCoord:O,pointNodeId:x.id}))}if(e.pointNodeCoord.y===-N.CHUNK_HALF_DIM){var m=e.chunkCoord.addY(-1),C=i.chunks.get(m);if(C){var S=e.pointNodeCoord.withY(N.CHUNK_HALF_DIM),_=C.pointNodes.get(S);_&&(n.NORTH=new w({z:e.z,chunkCoord:m,pointNodeCoord:S,pointNodeId:_.id}))}}else{var T=e.pointNodeCoord.addY(-1),I=r.pointNodes.get(T);I&&(n.NORTH=new w({z:e.z,chunkCoord:e.chunkCoord,pointNodeCoord:T,pointNodeId:I.id}))}if(e.pointNodeCoord.equals(F.Zero)){var U=t.zLevels[e.z+1];if(U){var P=e.chunkCoord,z=Math.round(P.x/N.CHUNK_DIM),A=P.x-N.CHUNK_DIM*z,M=Math.round(P.y/N.CHUNK_DIM),H=P.y-N.CHUNK_DIM*z,E=new F(z,M),R=U.chunks.get(E);if(R){var D=new F(A,H),B=R.pointNodes.get(D);B&&(n.UP=new w({z:e.z+1,chunkCoord:E,pointNodeCoord:D,pointNodeId:B.id}))}}}var q=t.zLevels[e.z-1];if(q){var L=e.chunkCoord.multiply(9).add(e.pointNodeCoord),G=q.chunks.get(L);if(G){var W=G.pointNodes.get(F.Zero);W&&(n.DOWN=new w({z:e.z-1,chunkCoord:L,pointNodeCoord:F.Zero,pointNodeId:W.id}))}}return n}(e,t),r=[],o=Object(y.a)(x(U));try{for(o.s();!(n=o.n()).done;){var a=i[n.value];a&&r.push(a)}}catch(c){o.e(c)}finally{o.f()}return r}function H(e,t,n,i){if(n.contains(e))return"already allocated";if(!1===i)return"no active quest";var r,o=M(e,t),a=Object(y.a)(o);try{for(a.s();!(r=a.n()).done;){var c=r.value;if(n.contains(c))return"yes"}}catch(s){a.e(s)}finally{a.f()}return"not connected"}function E(e){if(0===e.questProgressHistory.length)return 100;var t=0;e.questProgressHistory.forEach((function(n,i,r){n===(0===i?e.questInitialAmount:r[i-1])&&(t+=1)}));var n=100*t/(e.questProgressHistory.length+.5);return console.log({noEffectNodeCount:t,noEffectNodePercent:n}),100-n}function R(e){var t=e/100;return t=1.05*(t=1-Math.pow(1-t,3))+.05,t=Math.max(0,Math.min(100*t,100))}function D(e){var t=R(e);return t<=20?"D":t<=40?"C":t<=60?"B":t<=80?"A":"S"}function B(e){var t=e.selectedPointNode,n=e.playerSave,o=e.worldGen,a=e.computed,c=n.allocatedPointNodeSet,u=Object(r.useState)(""),d=Object(s.a)(u,2),l=d[0],h=d[1],v=Object(r.useState)([]),f=Object(s.a)(v,2),y=f[0],b=f[1];if(Object(r.useEffect)((function(){t&&b((function(e){return[].concat(Object(p.a)(e),[t])}))}),[t]),!t)return Object(i.jsx)(i.Fragment,{children:" "});var j=o.zLevels[t.z].chunks.get(t.chunkCoord).pointNodes.get(t.pointNodeCoord),g=c.contains(t),k=H(t,o,c,void 0!==n.activeQuest),O="Nothing (empty node)";return j.resourceType!==I.Nothing&&(O="".concat(j.resourceAmount," ").concat(j.resourceModifier," ").concat(j.resourceType)),Object(i.jsxs)(i.Fragment,{children:[Object(i.jsx)("h3",{children:"Player resources"}),JSON.stringify(a.playerResourceAmounts),Object(i.jsx)("h3",{children:"Export to string"}),Object(i.jsx)("div",{children:Object(i.jsxs)("button",{onClick:function(){h(btoa(JSON.stringify(n,void 0,2)))},children:["export to base64 "," "]})}),Object(i.jsx)("div",{children:l}),Object(i.jsx)("h3",{children:"Current Node"}),Object(i.jsxs)("div",{children:["Z=",t.z]}),Object(i.jsxs)("div",{children:["Chunk=",t.chunkCoord.x,",",t.chunkCoord.y]}),Object(i.jsxs)("div",{children:["Node=",t.pointNodeCoord.x,",",t.pointNodeCoord.y]}),Object(i.jsx)("br",{}),Object(i.jsxs)("div",{children:["Allocated? ",Object(i.jsx)("br",{}),g?"yes":"no"," "]}),Object(i.jsx)("br",{}),Object(i.jsxs)("div",{children:["Can be allocated? ",Object(i.jsx)("br",{}),k," "]}),Object(i.jsx)("br",{}),Object(i.jsx)("div",{children:" Stats: "}),Object(i.jsxs)("div",{children:[" ",O," "]}),Object(i.jsx)("h3",{children:"efficiency percent"}),E(n),Object(i.jsx)("h3",{children:"Quest progress history"}),0===n.questProgressHistory.length?Object(i.jsx)(i.Fragment,{children:" empty "}):n.questProgressHistory.map((function(e,t){return Object(i.jsxs)("div",{children:["i=",t,", quest progress=",e]},t)})),Object(i.jsx)("h3",{children:"Previous"}),y.slice(0,-1).map((function(e,t){return Object(i.jsx)("div",{children:Object(i.jsxs)("div",{children:["Z=",e.z," ","Chunk=",e.chunkCoord.x,",",e.chunkCoord.y," ","Node=",e.pointNodeCoord.x,",",e.pointNodeCoord.y]})},t)})).reverse()]})}F.Zero=new F(0,0),F.One=new F(1,1),function(e){e.NORTH="NORTH",e.SOUTH="SOUTH",e.EAST="EAST",e.WEST="WEST",e.UP="UP",e.DOWN="DOWN"}(U||(U={}));var q=n(12),L=n(11),G={w:T.PAN_NORTH,a:T.PAN_WEST,s:T.PAN_SOUTH,d:T.PAN_EAST,ArrowUp:T.PAN_NORTH,ArrowLeft:T.PAN_WEST,ArrowDown:T.PAN_SOUTH,ArrowRight:T.PAN_EAST,"<":T.TRAVEL_OUT,">":T.TRAVEL_IN},W=function(e){Object(q.a)(n,e);var t=Object(L.a)(n);function n(e){var i;return Object(v.a)(this,n),(i=t.call(this,e)).handleKeydown=function(e){var t=i.state.keyIntentConfig[e.key];!1===e.repeat&&void 0!==t&&t!==T.NOOP&&(i.props.updaters.newIntent[t].enqueueUpdate((function(){return i.props.updaters.newIntent[t].enqueueUpdate((function(){return!1})),!0})),i.props.updaters.activeIntent[t].enqueueUpdate((function(){return!0})))},i.handleKeyup=function(e){var t=i.state.keyIntentConfig[e.key];void 0!==t&&t!==T.NOOP&&(i.props.updaters.activeIntent[t].enqueueUpdate((function(){return!1})),i.props.updaters.endedIntent[t].enqueueUpdate((function(){return i.props.updaters.endedIntent[t].enqueueUpdate((function(){return!1})),!0})))},i.state={keyIntentConfig:G},document.addEventListener("keydown",i.handleKeydown),document.addEventListener("keyup",i.handleKeyup),i}return Object(f.a)(n,[{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.handleKeydown),document.removeEventListener("keyup",this.handleKeyup)}},{key:"render",value:function(){return"hi"}}]),n}(o.a.Component),K=o.a.memo(X);function X(e){var t=e.selectedPointNode,n=e.allocatedPointNodeSet,r=e.worldGen,o=e.hasActiveQuest;if(!t)return Object(i.jsxs)(i.Fragment,{children:[Object(i.jsx)("h1",{children:"Stats"}),Object(i.jsx)("div",{children:"Select a node first!"})]});var a=r.zLevels[t.z].chunks.get(t.chunkCoord).pointNodes.get(t.pointNodeCoord),c=n.contains(t),s=H(t,r,n,o),u="Nothing (empty node)";return a.resourceType!==I.Nothing&&(u="".concat(a.resourceAmount," ").concat(a.resourceModifier," ").concat(a.resourceType)),Object(i.jsxs)(i.Fragment,{children:[Object(i.jsx)("h1",{children:"Stats"}),Object(i.jsxs)("div",{children:[" ",u," "]}),Object(i.jsx)("h3",{children:"Allocated?"}),c?"yes":"no",Object(i.jsx)("h3",{children:"Can be allocated?"}),s]})}n(133);var Q=o.a.createContext([]);function Z(e){var t=e.application,n=e.windowState,o=Object(r.useRef)(null),a=Object(r.useContext)(Q),c=Object(s.a)(a,3),u=c[0],d=c[1],l=c[2];return Object(r.useEffect)((function(){for(var e=o.current.childNodes.length-1;e>=0;e--)o.current.removeChild(o.current.childNodes[e]);o.current.appendChild(t.app.view)}),[t]),t.rerender({args:{fireBatch:function(){l(),e.fireBatchedSetWindowState()},isSecondConstructorCall:!1},updaters:d,windowState:n,gameState:u}),Object(i.jsx)(i.Fragment,{children:Object(i.jsx)("div",{ref:o})})}var V=n(3),Y=n(47),J=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];Object(v.a)(this,e),this._values=void 0,this._values=new $;var n,i=Object(y.a)(t);try{for(i.s();!(n=i.n()).done;){var r=n.value;this.put(r)}}catch(o){i.e(o)}finally{i.f()}}return Object(f.a)(e,[{key:"remove",value:function(e){this._values.remove(e)}},{key:"put",value:function(e){this._values.put(e,e)}},{key:"get",value:function(e){return void 0!==this._values.get(e)}},{key:"contains",value:function(e){return this._values.contains(e)}},{key:"values",value:function(){return this._values.values()}},{key:"clone",value:function(){var t=new e;return t._values=this._values.clone(),t}},{key:"size",value:function(){return this._values.size()}},{key:"equals",value:function(e){if(void 0===e||null===e)return!1;if(this.size()!==e.size())return!1;var t,n=Object(y.a)(this.values());try{for(n.s();!(t=n.n()).done;){var i=t.value;if(!e.contains(i))return!1}}catch(r){n.e(r)}finally{n.f()}return!0}}]),e}(),$=function(){function e(){Object(v.a)(this,e),this._values={}}return Object(f.a)(e,[{key:"put",value:function(e,t){this._values[e.hash()]=t}},{key:"remove",value:function(e){delete this._values[e.hash()]}},{key:"get",value:function(e){return this._values[e.hash()]}},{key:"contains",value:function(e){return void 0!==this.get(e)&&e.hash()in this._values}},{key:"values",value:function(){return Object.values(this._values)}},{key:"size",value:function(){return Object.keys(this._values).length}},{key:"clone",value:function(){var t=new e;return t._values=Object(S.a)({},this._values),t}}]),e}(),ee=function(){function e(){Object(v.a)(this,e),this._kvalues={}}return Object(f.a)(e,[{key:"put",value:function(e,t){this._kvalues[e.hash()]=[e,t]}},{key:"remove",value:function(e){delete this._kvalues[e.hash()]}},{key:"get",value:function(e){var t;return null===(t=this._kvalues[e.hash()])||void 0===t?void 0:t[1]}},{key:"contains",value:function(e){return void 0!==this.get(e)&&e.hash()in this._kvalues}},{key:"keys",value:function(){var e=this;return Object.keys(this._kvalues).map((function(t){return e._kvalues[t][0]}))}},{key:"entries",value:function(){var e=this;return Object.keys(this._kvalues).map((function(t){return e._kvalues[t]}))}},{key:"values",value:function(){var e=this;return Object.keys(this._kvalues).map((function(t){return e._kvalues[t][1]}))}},{key:"hashKeyset",value:function(){return Object.keys(this._kvalues).map((function(e){return te(e)})).reduce((function(e,t){return e+t})).toString()}},{key:"clone",value:function(){var t=new e;return t._kvalues=Object(S.a)({},this._kvalues),t}},{key:"size",value:function(){return Object.keys(this._kvalues).length}}]),e}();function te(e){for(var t=0,n=0;n<e.length;n++)t=Math.imul(31,t)+e.charCodeAt(n)|0;return t}function ne(e){return new V.d(e.x,e.y)}function ie(e){var t=[];return[function(e){t.push(e)},function(){if(0!==t.length){var n=Object(p.a)(t);t=[],e((function(e){var t,i=e,r=Object(y.a)(n);try{for(r.s();!(t=r.n()).done;){var o=t.value;i="function"===typeof o?o(i):o}}catch(a){r.e(a)}finally{r.f()}return i}))}}]}var re=n(25);function oe(e,t){var n={getUpdater:function(){return t}};return n.enqueueUpdate=t,"object"!==typeof e||Object.keys(e).forEach((function(i){if("enqueueUpdate"===i||"getUpdater"===i||"update"===i)throw Error("Invalid key in updaterGenerator: ".concat(i," conflicts with reserved keywords enqueueUpdate, update, getUpdater."));n[i]=oe(e[i],(function(e){t("function"===typeof e?function(t,n){var r=e(t[i],n);return t[i]===r?t:Object(S.a)(Object(S.a)({},t),{},Object(re.a)({},i,r))}:function(t,n){return Object(S.a)(Object(S.a)({},t),{},Object(re.a)({},i,e))})}))})),n}function ae(e,t){return oe(e,(function(e){t("function"===typeof e?function(t){return e(t,t)}:e)}))}var ce=function(){function e(){Object(v.a)(this,e),this._values=[]}return Object(f.a)(e,[{key:"add",value:function(e){-1===this._values.indexOf(e)||e.instance&&this.contains(e.instance),this._values.push(e)}},{key:"remove",value:function(e){var t=this._values.splice(this._values.findIndex((function(t){return t.instance===e})),1);return 0===t.length?void 0:t[0]}},{key:"contains",value:function(e){return this._values.findIndex((function(t){return t.instance===e}))>-1}},{key:"get",value:function(e){return this._values.find((function(t){return t.instance===e}))}},{key:"clone",value:function(){var t=new e;return t._values=Object(p.a)(this._values),t}},{key:"forEach",value:function(e){this._values.forEach(e)}}]),e}(),se=function(){function e(t){var n=this;Object(v.a)(this,e),this.container=void 0,this.state=void 0,this._staleProps=void 0,this._children=new ce,this._childrenToConstruct=new ce,this._childrenToDestruct=new ce,this._forceUpdates=new ce,this.markForceUpdate=function(e){var t,i;null===(t=n._staleProps.args)||void 0===t||null===(i=t.markForceUpdate)||void 0===i||i.call(t,n);var r=n._children.get(e);if(!r)throw new Error("Error, child ".concat(e," not found in ").concat(n));n._forceUpdates.add(r)},this._staleProps=t}return Object(f.a)(e,[{key:"addChild",value:function(e){this._children.add(e),this._childrenToConstruct.add(e)}},{key:"registerChild",value:function(e){this._children.add(e)}},{key:"removeChild",value:function(e){var t=this._children.remove(e);t&&this._childrenToDestruct.add(t)}},{key:"_didConstruct",value:function(e){var t,n=this;this._childrenToConstruct.forEach((function(t){t.instance||(t.instance=new t.childClass(t.propsFactory(e,n.state))),n.container.addChild(t.instance.container)})),this.renderSelf(e),null===(t=this.didMount)||void 0===t||t.call(this)}},{key:"useState",value:function(e,t){var n=function(t){e.state="function"===typeof t?t(e.state):t},i=ie(n),r=Object(s.a)(i,2),o=r[0];return{state:t,setState:n,fireStateUpdaters:r[1],stateUpdaters:ae(t,o)}}},{key:"update",value:function(e){this._update(e)}},{key:"_update",value:function(e){var t,n,i,r=this,o=Object(S.a)({},this.state);if(null===(t=this.fireStateUpdaters)||void 0===t||t.call(this),null===(n=this.updateSelf)||void 0===n||n.call(this,e),this.shouldUpdate&&!this.shouldUpdate(this._staleProps,o,e,this.state)){var a,c=this._forceUpdates.clone();return this._forceUpdates=new ce,c.forEach((function(t){var n,i=t.instance,o=t.propsFactory;null===i||void 0===i||i._update(o(e,r.state)),i&&(null===(n=r.didForceUpdateChild)||void 0===n||n.call(r,i))})),void(null===(a=this.didForceUpdate)||void 0===a||a.call(this))}null===(i=this.updateChildren)||void 0===i||i.call(this,e),this._updateChildren(e),this.renderSelf(e),this._staleProps=e,new Promise((function(e){var t;return e(null===(t=r.didUpdate)||void 0===t?void 0:t.call(r))}))}},{key:"_updateChildren",value:function(e){var t=this;this._childrenToDestruct.forEach((function(e){var n,i;e.instance&&(null===(n=(i=e.instance).willUnmount)||void 0===n||n.call(i),t.container.removeChild(e.instance.container))})),this._childrenToDestruct=new ce,this._children.forEach((function(n){var i=n.instance,r=n.propsFactory;null===i||void 0===i||i._update(r(e,t.state))})),this._childrenToConstruct.forEach((function(n){n.instance||(n.instance=new n.childClass(n.propsFactory(e,t.state))),t.container.addChild(n.instance.container)})),this._childrenToConstruct=new ce}},{key:"willUnmount",value:function(){}},{key:"toString",value:function(){return"lifecyclehandler object"}}]),e}();function ue(e){return new Proxy(e,{construct:function(e,t){var n=new e(t[0]);return n._didConstruct(t[0]),n}})}new Proxy(se,{construct:function(e,t,n){var i=Reflect.construct(e,t,n);return i._didConstruct.apply(i,Object(p.a)(t)),i}});function de(e){var t,n={},i=new $,r=Object(y.a)(e.playerSave.allocatedPointNodeHistory);try{for(r.s();!(t=r.n()).done;){var o=t.value,a=e.worldGen.zLevels[o.z].chunks.get(o.chunkCoord).pointNodes.get(o.pointNodeCoord);if("Nothing"!==a.resourceType){var c=new z({type:a.resourceType,modifier:a.resourceModifier});i.put(c,(i.get(c)||0)+a.resourceAmount)}}}catch(h){r.e(h)}finally{r.f()}var s,u=Object(y.a)(x(m));try{for(u.s();!(s=u.n()).done;){var d=s.value,l=i.get(new z({type:d,modifier:_.Flat}))||0;l*=1+.01*(i.get(new z({type:d,modifier:_.Increased0}))||0),l=Math.floor(l),l+=i.get(new z({type:d,modifier:_.AfterIncreased0}))||0,l*=1+.01*(i.get(new z({type:d,modifier:_.Increased1}))||0),l=Math.floor(l),l+=i.get(new z({type:d,modifier:_.AfterIncreased1}))||0,n[d]=l}}catch(h){u.e(h)}finally{u.f()}return{playerResourceAmounts:n,playerResourceNodesAggregated:i}}function le(e,t){var n=!1,i=!1,r=!1;e.playerUI.selectedPointNode.enqueueUpdate((function(e,i){return(null===e||void 0===e?void 0:e.pointNodeId)===t.pointNodeId&&(n=!0),t})),e.playerSave.enqueueUpdate((function(e,o){if(n){n=!1;var a=function(e,t,n){if("yes"===H(n,t.worldGen,t.playerSave.allocatedPointNodeSet,void 0!==t.playerSave.activeQuest)){var i=e.allocatedPointNodeSet.clone();i.put(n);var r=Object(p.a)(e.allocatedPointNodeHistory);return r.push(n),[Object(S.a)(Object(S.a)({},e),{},{allocatedPointNodeHistory:r,allocatedPointNodeSet:i}),!0]}return[e,!1]}(e,o,t),c=Object(s.a)(a,2),u=c[0];return c[1]?(i=!0,u):(r=!0,e)}return e})),e.computed.enqueueUpdate((function(e,t){return i?de(t):e})),e.playerSave.enqueueUpdate((function(e,t){return i?(i=!1,function(e,t){var n=Object(S.a)({},e);if(void 0!==n.spSpentThisQuest&&(n.spSpentThisQuest+=1),n.activeQuest){var i,r=n.activeQuest.resourceType,o=(null===(i=t.computed.playerResourceAmounts)||void 0===i?void 0:i[r])||0;n.questProgressHistory.push(o)}return n}(e,t)):e})),e.playerUI.activeTab.enqueueUpdate((function(e,t){return r?(r=!1,1):e}))}var he=ue(function(e){Object(q.a)(n,e);var t=Object(L.a)(n);function n(e){var i;return Object(v.a)(this,n),(i=t.call(this,e)).container=void 0,i.state=void 0,i.sprite=void 0,i.halfwayCenterSprite=void 0,i.centerSprite=void 0,i.hitArea=void 0,i.tooltippableArea=void 0,i.state={numClicks:0,descriptionText:""},i.updateSelf(e),i.container=new V.b,i.container.sortableChildren=!0,i.sprite=new V.g(e.args.pointNodeTexture),i.sprite.anchor.x=.5,i.sprite.anchor.y=.5,i.sprite.zIndex=-1,i.container.addChild(i.sprite),i.centerSprite=new V.g(e.args.pointNodeTexture),i.centerSprite.anchor.x=.5,i.centerSprite.anchor.y=.5,i.centerSprite.scale=ne(new F(.5,.5)),i.centerSprite.zIndex=1,i.centerSprite.alpha=0,i.halfwayCenterSprite=new V.g(e.args.pointNodeTexture),i.halfwayCenterSprite.anchor.x=.5,i.halfwayCenterSprite.anchor.y=.5,i.halfwayCenterSprite.scale=ne(new F(.75,.75)),i.halfwayCenterSprite.zIndex=0,i.halfwayCenterSprite.alpha=0,i.container.interactive=!0,i.container.buttonMode=!0,i.hitArea=new V.e(-pe.NODE_HITAREA_PX/2,-pe.NODE_HITAREA_PX/2,pe.NODE_HITAREA_PX,pe.NODE_HITAREA_PX),i.container.hitArea=i.hitArea,i}return Object(f.a)(n,[{key:"updateSelf",value:function(e){var t="Nothing (empty node)";e.pointNodeGen.resourceType!==I.Nothing&&(t="".concat(e.pointNodeGen.resourceAmount," ").concat(e.pointNodeGen.resourceModifier," ").concat(e.pointNodeGen.resourceType)),this.state.descriptionText=t}},{key:"renderSelf",value:function(e){var t,n;this.container.position=ne(e.position),e.isSelected?(t=12303359,n=12303359):(t=16777215,n=16777215),e.isAllocated&&(t=4473924);var i=0;e.pointNodeGen.resourceType===I.Nothing?i=10075135:e.pointNodeGen.resourceType===I.Mana0&&(e.pointNodeGen.resourceModifier===_.Flat?i=15641258:e.pointNodeGen.resourceModifier===_.Increased0&&(i=13404398)),this.sprite.tint=O(i,t),this.centerSprite.tint=O(i,n),e.selfPointNodeRef.pointNodeCoord.equals(F.Zero)&&(this.container.scale=ne(new F(1.25,1.25)))}},{key:"shouldUpdate",value:function(e,t,n,i){var r,o=Object(y.a)(Object.keys(e));try{for(o.s();!(r=o.n()).done;){var a=r.value;if("delta"!==a&&"args"!==a&&"updaters"!==a){if(e[a]!==n[a])return!0;if("position"===a){if(e[a].equals(n[a]))continue;return console.log("chunk shouldUpdate differed in ".concat(a,", returning true")),!0}var c,s;if("selfPointNodeRef"!==a);else if((null===(c=e[a])||void 0===c?void 0:c.hash())!==(null===(s=n[a])||void 0===s?void 0:s.hash()))return console.log("chunk shouldUpdate differed in ".concat(a,", returning true")),!0}}}catch(u){o.e(u)}finally{o.f()}return!1}},{key:"didMount",value:function(){var e=this,t=this._staleProps.updaters;this.container.addListener("pointerdown",(function(n){e._staleProps.args.markForceUpdate(e),e.state.numClicks++,le(t,e._staleProps.selfPointNodeRef)})),this.container.addListener("pointerover",(function(t){var n=t.data.getLocalPosition(e.container),i=new F(e.container.worldTransform.tx,e.container.worldTransform.ty);e._staleProps.tooltipUpdaters.enqueueUpdate((function(t){return Object(S.a)(Object(S.a)({},t),{},{visible:!0,text:e.state.descriptionText,position:i.add(n)})}))})),this.container.addListener("pointerout",(function(t){e._staleProps.tooltipUpdaters.enqueueUpdate((function(e){return Object(S.a)(Object(S.a)({},e),{},{visible:!1,text:""})}))})),this.container.addListener("pointermove",(function(t){var n=t.data.getLocalPosition(e.container),i=new F(e.container.worldTransform.tx,e.container.worldTransform.ty);e._staleProps.tooltipUpdaters.position.enqueueUpdate(i.add(n))}))}},{key:"toString",value:function(){return"PointNodeCompoent "+this._staleProps.selfPointNodeRef.toString()}}]),n}(se)),pe=function e(){Object(v.a)(this,e)};pe.SPACING_PX=36,pe.CHUNK_SPACING_PX=(N.CHUNK_DIM+0)*pe.SPACING_PX,pe.NODE_SIZE_PX=22,pe.NODE_HITAREA_PX=pe.NODE_SIZE_PX+4,pe.NODE_ROUNDED_PX=4;var ve=ue(function(e){Object(q.a)(n,e);var t=Object(L.a)(n);function n(e){var i;return Object(v.a)(this,n),(i=t.call(this,e)).container=void 0,i.state=void 0,i.children=void 0,i.state={},i.container=new V.b,i.children=new ee,i.resyncChildren(e),i}return Object(f.a)(n,[{key:"renderSelf",value:function(e){this.container.position=ne(e.position)}},{key:"shouldUpdate",value:function(e,t,n,i){var r,o=Object(y.a)(Object.keys(e));try{for(o.s();!(r=o.n()).done;){var a=r.value;if("delta"!==a&&"args"!==a&&"updaters"!==a){if("position"===a){if(e[a].equals(n[a]))continue;return console.log("chunk shouldUpdate differed in ".concat(a,", returning true")),!0}var c,s;if("selectedPointNode"!==a)if("selfChunkRef"!==a){if("allocatedPointNodeSubset"===a){if(e[a].equals(n[a]))continue;return console.log("chunk shouldUpdate differed in ".concat(a,", returning true")),!0}if(e[a]!==n[a])return console.log("chunk shouldUpdate differed in ".concat(a,", returning true")),!0}else{var u,d;if((null===(u=e[a])||void 0===u?void 0:u.hash())!==(null===(d=n[a])||void 0===d?void 0:d.hash()))return console.log("chunk shouldUpdate differed in ".concat(a,", returning true")),!0}else if((null===(c=e[a])||void 0===c?void 0:c.hash())!==(null===(s=n[a])||void 0===s?void 0:s.hash()))return console.log("chunk shouldUpdate differed in ".concat(a,", returning true")),!0}}}catch(l){o.e(l)}finally{o.f()}return!1}},{key:"resyncChildren",value:function(e){var t=this,n=this.children.clone();console.log("chunk component upsert children got here");var i,r=Object(y.a)(e.chunkGen.pointNodes.entries());try{var o=function(){var r=Object(s.a)(i.value,2),o=r[0],a=r[1],c=new w({z:e.selfChunkRef.z,chunkCoord:e.selfChunkRef.chunkCoord,pointNodeCoord:o,pointNodeId:a.id}),u=function(e,n){var i;return{delta:e.delta,args:{pointNodeTexture:e.args.pointNodeTexture,markForceUpdate:t.markForceUpdate},selfPointNodeRef:c,updaters:e.updaters,tooltipUpdaters:e.tooltipUpdaters,position:c.pointNodeCoord.multiply(pe.SPACING_PX),pointNodeGen:a,isSelected:(null===(i=e.selectedPointNode)||void 0===i?void 0:i.pointNodeId)===c.pointNodeId,isAllocated:e.allocatedPointNodeSubset.contains(c)}},d=c,l=t.children.get(d);l?n.remove(d):(l=new he(u(e,t.state)),t.children.put(c,l),t.addChild({childClass:he,instance:l,propsFactory:u}))};for(r.s();!(i=r.n()).done;)o()}catch(h){r.e(h)}finally{r.f()}console.log("chunk component to delete has ".concat(n.size()," children"));var a,c=Object(y.a)(n.entries());try{for(c.s();!(a=c.n()).done;){var u=Object(s.a)(a.value,2),d=u[0],l=u[1];this.children.remove(d),this.removeChild(l)}}catch(h){c.e(h)}finally{c.f()}}},{key:"updateChildren",value:function(e){this.resyncChildren(e)}},{key:"didForceUpdateChild",value:function(e){this.container.removeChild(e.container),this.container.addChild(e.container)}}]),n}(se));var fe=n(9),ye=function(){function e(t){Object(v.a)(this,e),this.config=void 0,this.chunkGenFactory=void 0,this.config=t,this.chunkGenFactory=new be({})}return Object(f.a)(e,[{key:"create",value:function(e){for(var t=Object(fe.b)(e.seed+e.z),n=new ee,i=e.startingChunks||3,r=-i;r<=i;r++)for(var o=-i;o<=i;o++){var a=new F(r,o);n.put(a,this.chunkGenFactory.create({seed:t,location:a,z:e.z}))}return{id:t,chunks:n}}}]),e}(),be=function(){function e(t){Object(v.a)(this,e),this.config=void 0,this.pointNodeGenFactory=void 0,this.config=t,this.pointNodeGenFactory=new je({})}return Object(f.a)(e,[{key:"create",value:function(e){for(var t=Object(fe.b)(e.seed+Object(fe.b)(e.seed+e.location.x)+e.location.y),n=new ee,i=new J,r=-N.CHUNK_HALF_DIM;r<=N.CHUNK_HALF_DIM;r++)for(var o=-N.CHUNK_HALF_DIM;o<=N.CHUNK_HALF_DIM;o++)0===r&&0===o||Object(fe.b)(t+r*N.CHUNK_DIM+o)/fe.a<N.DROP_NODES_CHANCE/4&&(i.put(new F(r,o)),i.put(new F(o,-r)),i.put(new F(-r,-o)),i.put(new F(-o,r)));for(var a=-N.CHUNK_HALF_DIM;a<=N.CHUNK_HALF_DIM;a++)for(var c=-N.CHUNK_HALF_DIM;c<=N.CHUNK_HALF_DIM;c++){var s=new F(a,c);i.get(s)||n.put(s,this.pointNodeGenFactory.create({seed:t,location:s,chunk:e.location,z:e.z}))}return{id:t,pointNodes:n}}}]),e}(),je=function(){function e(t){Object(v.a)(this,e),this.config=void 0,this.config=t}return Object(f.a)(e,[{key:"create",value:function(e){var t,n,i=Object(fe.b)(e.seed+Object(fe.b)(e.seed+e.location.x)+e.location.y),r=Object(fe.b)(i+1)/fe.a;t=r<0?"Nothing":r<.15?I.Mana0:r<-.35?I.Mana1:r<-.6?I.Mana2:"Nothing",e.location.equals(F.Zero)&&e.chunk.equals(F.Zero)&&0===e.z&&(t="Nothing");var o=0;return(n=(r=Object(fe.b)(i+2)/fe.a)<.55?_.Flat:r<-.7?_.AfterIncreased0:r<-.7?_.AfterIncreased1:r<1.95?_.Increased0:_.Increased1)===_.Flat||n===_.AfterIncreased0||n===_.AfterIncreased1?(r=Math.floor(Object(fe.b)(i+3)/fe.a*4),r+=Math.floor(Object(fe.b)(i+4)/fe.a*4),o=20*(r+=Math.floor(Object(fe.b)(i+5)/fe.a*4))+60):(r=Math.floor(Object(fe.b)(i+3)/fe.a*2),r+=Math.floor(Object(fe.b)(i+4)/fe.a*2),r+=Math.floor(Object(fe.b)(i+5)/fe.a*2),o=(r+=Math.floor(Object(fe.b)(i+6)/fe.a*3))+3),{id:i,resourceAmount:o,resourceModifier:n,resourceType:t}}}]),e}(),ge=ue(function(e){Object(q.a)(n,e);var t=Object(L.a)(n);function n(e){var i;return Object(v.a)(this,n),(i=t.call(this,e)).container=void 0,i.state=void 0,i.children=new ee,i.state={},i.container=new V.b,i.upsertChildren(e),i}return Object(f.a)(n,[{key:"renderSelf",value:function(e){this.container.position=ne(e.position)}},{key:"didMount",value:function(){var e=this;this._staleProps.updaters.worldGen.zLevels.enqueueUpdate((function(t,n){return t[e._staleProps.z]?t:Object(re.a)({},e._staleProps.z,new ye({}).create({seed:n.worldGen.seed,z:e._staleProps.z}))}))}},{key:"didForceUpdateChild",value:function(e){this.container.removeChild(e.container),this.container.addChild(e.container)}},{key:"shouldUpdate",value:function(e,t,n,i){var r,o=Object(y.a)(Object.keys(e));try{for(o.s();!(r=o.n()).done;){var a=r.value;if("delta"!==a&&"args"!==a&&"updaters"!==a){if("position"===a){if(e[a].equals(n[a]))continue;return console.log("zlevel shouldUpdate differed in ".concat(a,", returning true")),!0}var c,s;if("selectedPointNode"!==a){if(e[a]!==n[a])return console.log("zlevel shouldUpdate differed in ".concat(a,", returning true")),!0}else if((null===(c=e[a])||void 0===c?void 0:c.hash())!==(null===(s=n[a])||void 0===s?void 0:s.hash()))return console.log("zlevel shouldUpdate differed in ".concat(a,", returning true")),!0}}}catch(u){o.e(u)}finally{o.f()}return!1}},{key:"updateChildren",value:function(e){this.upsertChildren(e)}},{key:"upsertChildren",value:function(e){var t,n,i=this.children.clone();console.log("zlevel component have ".concat(this.children.size()," children"));var r,o=Object(y.a)((null===(t=e.zLevelGen)||void 0===t||null===(n=t.chunks)||void 0===n?void 0:n.entries())||[]);try{for(o.s();!(r=o.n()).done;){var a=Object(s.a)(r.value,2),c=a[0],u=a[1],d=this.doChild(e,c,u),l=d.childKey,h=d.childPropsFactory,p=this.children.get(l);p?i.remove(l):(p=new ve(h(e,this.state)),this.children.put(l,p),this.addChild({childClass:ve,instance:p,propsFactory:h}))}}catch(k){o.e(k)}finally{o.f()}console.log("zlevel component have ".concat(i.size()," children to delete"));var v,f=Object(y.a)(i.entries());try{for(f.s();!(v=f.n()).done;){var b=Object(s.a)(v.value,2),j=b[0],g=b[1];this.children.remove(j),this.removeChild(g)}}catch(k){f.e(k)}finally{f.f()}}},{key:"doChild",value:function(e,t,n){var i=this,r=new C({z:e.z,chunkCoord:t,chunkId:n.id});return{childKey:r,childPropsFactory:function(e,t){var o,a=new J(e.allocatedPointNodeSubset.values().filter((function(e){return e.chunkCoord.equals(r.chunkCoord)})));return{delta:e.delta,args:{pointNodeTexture:e.args.pointNodeTexture,markForceUpdate:i.markForceUpdate},selfChunkRef:r,updaters:e.updaters,tooltipUpdaters:e.tooltipUpdaters,position:r.chunkCoord.multiply(pe.CHUNK_SPACING_PX),chunkGen:n,selectedPointNode:(null===(o=e.selectedPointNode)||void 0===o?void 0:o.chunkCoord.equals(r.chunkCoord))?e.selectedPointNode:void 0,allocatedPointNodeSubset:a}}}}}]),n}(se)),ke=ue(function(e){Object(q.a)(n,e);var t=Object(L.a)(n);function n(e){var i;Object(v.a)(this,n),(i=t.call(this,e)).container=void 0,i.state={},i.cornerRadius=10,i.boundingBoxWidth=100,i.boundingBox=void 0,i.innerBarWidth=24,i.innerBarHeight=200,i.textHeight=24,i.paddingBottom=12,i.innerBar=void 0,i.barBorder=void 0,i.filter=void 0,i.barFill=void 0,i.mask=void 0,i.titleText=void 0,i.textStyle={fontFamily:"PixelMix",padding:4,fontSize:26},i.container=new V.b,i.container.interactive=!0,i.container.sortableChildren=!0,i.titleText=new V.h("Efficiency",i.textStyle),i.titleText.scale=ne(new F(.5,.5)),i.titleText.anchor=ne(new F(.5,0)),i.titleText.zIndex=0,i.titleText.x=50,i.titleText.y=4,i.container.addChild(i.titleText),i.boundingBox=new V.c,i.boundingBox.beginFill(14544639),i.boundingBox.drawRoundedRect(0,0,i.boundingBoxWidth,i.textHeight+i.innerBarHeight+i.paddingBottom,i.cornerRadius),i.boundingBox.zIndex=-1,i.boundingBox.alpha=.8,i.container.addChild(i.boundingBox),i.innerBar=new V.c,i.innerBar.beginFill(16777215),i.innerBar.drawRoundedRect(0,0,i.innerBarWidth,i.innerBarHeight,i.cornerRadius),i.innerBar.pivot.x=i.innerBarWidth/2,i.innerBar.x=i.boundingBoxWidth/2,i.innerBar.y=i.textHeight,i.innerBar.zIndex=3,i.container.addChild(i.innerBar);var r=new V.b;i.barFill=new V.c,i.barFill.beginFill(6927180),i.barFill.drawRect(0,0,i.innerBarWidth,i.innerBarHeight/5),i.barFill.beginFill(11318068),i.barFill.drawRect(0,40,i.innerBarWidth,i.innerBarHeight/5),i.barFill.beginFill(16430899),i.barFill.drawRect(0,80,i.innerBarWidth,i.innerBarHeight/5),i.barFill.beginFill(16748053),i.barFill.drawRect(0,120,i.innerBarWidth,i.innerBarHeight/5),i.barFill.beginFill(16731665),i.barFill.drawRect(0,160,i.innerBarWidth,i.innerBarHeight/5),i.barFill.pivot.x=i.innerBarWidth/2,i.barFill.x=i.boundingBoxWidth/2,i.barFill.y=i.textHeight,i.barFill.zIndex=4,r.addChild(i.barFill),r.zIndex=4,i.container.addChild(r);var o=new V.b;i.mask=new V.c,i.mask.beginFill(0,1),i.mask.drawRoundedRect(0,0,i.innerBarWidth,i.innerBarHeight,i.cornerRadius),i.mask.zIndex=30,i.mask.pivot.x=i.innerBarWidth/2,i.mask.x=i.boundingBoxWidth/2,i.mask.y=i.textHeight;var a=new V.c;return a.beginFill(0,1),a.drawRoundedRect(0,0,i.innerBarWidth,i.innerBarHeight,i.cornerRadius),a.zIndex=31,a.pivot.x=i.innerBarWidth/2,a.x=i.boundingBoxWidth/2,a.y=i.textHeight,o.addChild(i.mask),i.container.addChild(o),i.barFill.mask=o,i.container.addChild(a),r.mask=a,i.barBorder=new V.c,i.barBorder.lineStyle(2,0,1),i.barBorder.drawRoundedRect(0,0,i.innerBarWidth,i.innerBarHeight,i.cornerRadius),i.barBorder.pivot.x=i.innerBarWidth/2,i.barBorder.x=i.boundingBoxWidth/2,i.barBorder.y=i.textHeight,i.barBorder.zIndex=7,i.container.addChild(i.barBorder),i}return Object(f.a)(n,[{key:"renderSelf",value:function(e){this.container.position=ne(e.position),e.tick<60&&e.tick%10===5&&this.titleText.updateText(!1),this.mask.y=2*(100-e.efficiencyPercent)+24}}]),n}(se)),Oe=function(){function e(){Object(v.a)(this,e),this.frameTimestampsInTicks=[],this.frameTimestampsInTime=[],this.frameTimestampsInTicks.push(0)}return Object(f.a)(e,[{key:"tick",value:function(e){var t=this.frameTimestampsInTicks[this.frameTimestampsInTicks.length-1];this.frameTimestampsInTicks.push(t+e),this.frameTimestampsInTicks.length>120&&(this.frameTimestampsInTicks=this.frameTimestampsInTicks.slice(60)),this.frameTimestampsInTime.push((new Date).getTime()),this.frameTimestampsInTime.length>120&&(this.frameTimestampsInTime=this.frameTimestampsInTime.slice(60))}},{key:"getUps",value:function(){var e=this.frameTimestampsInTicks[this.frameTimestampsInTicks.length-1]-this.frameTimestampsInTicks[0],t=(this.frameTimestampsInTicks.length-1)/e;return t?60*t:60}},{key:"getFps",value:function(){var e=this.frameTimestampsInTime[this.frameTimestampsInTime.length-1]-this.frameTimestampsInTime[0],t=(this.frameTimestampsInTime.length-1)/e;return t?1e3*t:60}},{key:"getFpsString",value:function(){return this.getFps().toFixed(1)}},{key:"getUpsString",value:function(){return this.getUps().toFixed(1)}}]),e}(),xe=ue(function(e){Object(q.a)(n,e);var t=Object(L.a)(n);function n(e){var i;return Object(v.a)(this,n),(i=t.call(this,e)).container=void 0,i.state=void 0,i.container=new V.h("",{fontFamily:"PixelMix",fontSize:12}),i.state={fpsTracker:new Oe},i}return Object(f.a)(n,[{key:"updateSelf",value:function(e){this.state.fpsTracker.tick(e.delta)}},{key:"renderSelf",value:function(e){this.container.text=this.state.fpsTracker.getFpsString()+" FPS\n"+this.state.fpsTracker.getUpsString()+" UPS\n"+e.appSize.x+"x"+e.appSize.y,this.container.position=ne(e.position)}}]),n}(se)),me=ue(function(e){Object(q.a)(n,e);var t=Object(L.a)(n);function n(e){var i;Object(v.a)(this,n),(i=t.call(this,e)).container=void 0,i.state=void 0,i.container=new V.b,i.state={position:e.appSize.multiply(.5)};var r=new V.c;return r.lineStyle(2,0),r.alpha=.5,r.drawCircle(0,0,16),r.interactive=!0,i.container.addChild(r),r.moveTo(0,-8),r.lineTo(0,8),r.moveTo(-8,0),r.lineTo(8,0),i}return Object(f.a)(n,[{key:"updateSelf",value:function(e){this.state.position=e.appSize.multiply(.5)}},{key:"renderSelf",value:function(e){this.container.position=ne(this.state.position)}}]),n}(se)),we=ue(function(e){Object(q.a)(n,e);var t=Object(L.a)(n);function n(e){var i;return Object(v.a)(this,n),(i=t.call(this,e)).container=void 0,i.state=void 0,i.text=void 0,i.box=void 0,i.container=new V.b,i.container.sortableChildren=!0,i.state={},i.text=new V.h(e.text,{fontFamily:"PixelMix",padding:4,fontSize:26}),i.text.scale=ne(new F(.5,.5)),i.text.x=10,i.text.y=10,i.text.zIndex=2,i.container.addChild(i.text),i}return Object(f.a)(n,[{key:"shouldUpdate",value:function(e,t,n,i){var r,o=Object(y.a)(Object.keys(e));try{for(o.s();!(r=o.n()).done;){var a=r.value;if(e[a]!==n[a])return!0}}catch(c){o.e(c)}finally{o.f()}return!1}},{key:"renderSelf",value:function(e){this.container.visible=e.visible,this.container.position=ne(e.offset.add((null===e||void 0===e?void 0:e.position)||F.Zero)),this.text.text=e.text,this.box&&this.container.removeChild(this.box),this.box=new V.c,this.box.lineStyle(1,2236962,1),this.box.beginFill(15658734),this.box.drawRoundedRect(0,0,this.text.width+18,this.text.height+18,4),this.box.zIndex=0,this.container.addChild(this.box)}}]),n}(se)),Ce=ue(function(e){Object(q.a)(n,e);var t=Object(L.a)(n);function n(e){var i;return Object(v.a)(this,n),(i=t.call(this,e)).container=void 0,i.state=void 0,i.fpsTracker=void 0,i.reticle=void 0,i.efficiencyBar=void 0,i.container=new V.b,i.container.sortableChildren=!0,i.state={},i.addChild({childClass:xe,propsFactory:function(e,t){return{delta:e.delta,position:new F(0,0),appSize:e.appSize}}}),i.addChild({childClass:me,propsFactory:function(e,t){return{appSize:e.appSize}}}),i.addChild({childClass:ke,propsFactory:function(e,t){return{delta:e.delta,args:{},updaters:{},tick:e.tick,position:new F(60,60),efficiencyPercent:R(E(e.gameState.playerSave))}}}),i.addChild({childClass:we,propsFactory:function(e,t){return Object(S.a)({offset:new F(8,8)},e.tooltip)}}),i}return Object(f.a)(n,[{key:"renderSelf",value:function(e){}}]),n}(se)),Se=ue(function(e){Object(q.a)(n,e);var t=Object(L.a)(n);function n(e){var i;Object(v.a)(this,n),(i=t.call(this,e)).container=void 0,i.state=void 0,i.stateUpdaters=void 0,i.fireStateUpdaters=void 0,i.fixedCameraStage=void 0,i.actionStage=void 0,i.backdropStage=void 0,i.zLevel=void 0,i.zLevelPropsFactory=void 0,i.backdrop=void 0,i.container=new V.b,i.container.sortableChildren=!0;var r=i.useState(Object(Y.a)(i),{pointNodeTexture:new k((function(){return function(e){var t=new V.c;return t.beginFill(16777215),t.drawRoundedRect(-pe.NODE_SIZE_PX/2,-pe.NODE_SIZE_PX/2,pe.NODE_SIZE_PX,pe.NODE_SIZE_PX,pe.NODE_ROUNDED_PX),e.generateTexture(t,V.f.NEAREST,1)}(e.args.renderer)})),tick:0,playerCurrentZ:0,tooltip:{visible:!1,position:void 0,text:""}});i.state=r.state,i.stateUpdaters=r.stateUpdaters,i.fireStateUpdaters=r.fireStateUpdaters;var o=function(e,t){return{args:{renderer:e.args.renderer,markForceUpdate:i.markForceUpdate},delta:e.delta,gameState:e.gameState,appSize:e.appSize,tick:t.tick,tooltip:Object(S.a)({},t.tooltip)}};return i.fixedCameraStage=new Ce(o(e,i.state)),i.addChild({childClass:Ce,instance:i.fixedCameraStage,propsFactory:o}),i.actionStage=new V.g,i.actionStage.zIndex=0,i.actionStage.sortableChildren=!0,i.container.addChild(i.actionStage),i.backdropStage=new V.g,i.backdropStage.zIndex=-1,i.backdropStage.sortableChildren=!0,i.container.addChild(i.backdropStage),i.backdrop=new V.c,i.backdropStage.addChild(i.backdrop),i.backdrop.beginFill(11259375,1),i.backdrop.interactive=!0,i.backdrop.drawRect(0,0,e.appSize.x,e.appSize.y),i.zLevelPropsFactory=function(e,t){return{delta:e.delta,args:{pointNodeTexture:t.pointNodeTexture.get(),markForceUpdate:i.markForceUpdate},z:t.playerCurrentZ,updaters:e.updaters,tooltipUpdaters:i.stateUpdaters.tooltip,position:e.appSize.multiply(.5),zLevelGen:e.gameState.worldGen.zLevels[t.playerCurrentZ],selectedPointNode:e.gameState.playerUI.selectedPointNode,allocatedPointNodeSubset:e.gameState.playerSave.allocatedPointNodeSet}},i.zLevel=new ge(i.zLevelPropsFactory(e,i.state)),i.actionStage.addChild(i.zLevel.container),i.registerChild({childClass:ge,instance:i.zLevel,propsFactory:i.zLevelPropsFactory}),i}return Object(f.a)(n,[{key:"updateSelf",value:function(e){this.state.tick++;var t=e.gameState.intent.activeIntent,n=0,i=0,r=5*e.delta;t[T.PAN_WEST]&&(n+=r),t[T.PAN_EAST]&&(n+=-r),t[T.PAN_SOUTH]&&(i+=-r),t[T.PAN_NORTH]&&(i+=r),this.actionStage.x+=n,this.actionStage.y+=i,e.gameState.intent.newIntent[T.TRAVEL_IN]&&(this.state.playerCurrentZ--,this.actionStage.x*=N.CHUNK_DIM,this.actionStage.y*=N.CHUNK_DIM),e.gameState.intent.newIntent[T.TRAVEL_OUT]&&(this.state.playerCurrentZ++,this.actionStage.x/=N.CHUNK_DIM,this.actionStage.y/=N.CHUNK_DIM)}},{key:"renderSelf",value:function(e){this.backdrop.width=e.appSize.x,this.backdrop.height=e.appSize.y}},{key:"didMount",value:function(){var e=this._staleProps.updaters;this.backdrop.addListener("pointerdown",(function(t){e.playerUI.selectedPointNode.enqueueUpdate((function(e,t){}))}))}},{key:"didUpdate",value:function(){var e=this._staleProps.updaters;this.state.tick>60&&!this._staleProps.gameState.worldGen.zLevels[-1]&&e.worldGen.zLevels.enqueueUpdate((function(e,t){return e[-1]?e:(e[-1]=new ye({}).create({seed:t.worldGen.seed,z:-1}),Object(S.a)({},e))})),this.state.tick>120&&!this._staleProps.gameState.worldGen.zLevels[1]&&e.worldGen.zLevels.enqueueUpdate((function(e,t){return e[1]?e:(e[1]=new ye({}).create({seed:t.worldGen.seed,z:1}),Object(S.a)({},e))}))}}]),n}(se));var Ne=function(){function e(t){var n;Object(v.a)(this,e),this.app=void 0,this.state=void 0,this.props=void 0,this.rootComponent=void 0,this.onTick=void 0,null===t||void 0===t||null===(n=t.args)||void 0===n||n.isSecondConstructorCall;var i=new F(800,600);this.state={appSize:i,originalAppSize:i},this.app=new V.a({width:this.state.appSize.x,height:this.state.appSize.y,antialias:!0,transparent:!0,resolution:window.devicePixelRatio||1,autoDensity:!0,powerPreference:"low-power",backgroundColor:16777215})}return Object(f.a)(e,[{key:"pause",value:function(){this.app.ticker.remove(this.onTick)}},{key:"destroy",value:function(){this.app.destroy(!0,{children:!0,texture:!0,baseTexture:!0})}},{key:"didMount",value:function(){var e=this;this.onTick=function(t){return e.baseGameLoop(t)},this.onTick=this.onTick.bind(this),this.app.ticker.add(this.onTick)}},{key:"register",value:function(e){e.appendChild(this.app.view)}},{key:"updateSelf",value:function(e){this.state.appSize=function(e){return new F({x:Math.min(1920,((null===e||void 0===e?void 0:e.x)||1/0)-24),y:Math.min(1080,((null===e||void 0===e?void 0:e.y)||1/0)-24)})}(new F(e.windowState.innerWidth,e.windowState.innerHeight))}},{key:"rerender",value:function(e){console.log("base app rerender called",{playerUI:e.gameState.playerUI}),this.props=e,this.rootComponent||(this.rootComponent=new Se({args:{renderer:this.app.renderer,markForceUpdate:function(){}},updaters:this.props.updaters,delta:0,gameState:this.props.gameState,appSize:this.state.appSize}),this.app.stage.addChild(this.rootComponent.container),this.renderSelf(this.props),this.didMount())}},{key:"renderSelf",value:function(e){this.app.renderer.resize(this.state.appSize.x,this.state.appSize.y)}},{key:"baseGameLoop",value:function(e){var t;this.updateSelf(this.props),null===(t=this.rootComponent)||void 0===t||t.update({args:{renderer:this.app.renderer,markForceUpdate:function(){}},updaters:this.props.updaters,delta:e,gameState:this.props.gameState,appSize:this.state.appSize}),this.renderSelf(this.props),this.props.args.fireBatch()}}]),e}(),_e=function(){function e(t){Object(v.a)(this,e),this.config=void 0,this.config=t}return Object(f.a)(e,[{key:"create",value:function(){var e,t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;void 0===n&&g("GameStateFactory.create");var i=n||103043,r=new ye({}).create({seed:i,z:0,startingChunks:0}),o=new F(0,0),a=null===(e=r.chunks.get(o))||void 0===e||null===(t=e.pointNodes.get(o))||void 0===t?void 0:t.id,c=new w({z:0,chunkCoord:o,pointNodeId:a,pointNodeCoord:o}),s={worldGen:{seed:i,zLevels:{0:r}},playerSave:{activeQuest:void 0,spSpentThisQuest:void 0,questProgressHistory:[],questInitialAmount:0,questsCompleted:[],allocatedPointNodeSet:new J([c]),allocatedPointNodeHistory:[c],score:0},playerUI:{selectedPointNode:void 0,activeTab:0},computed:{},intent:{activeIntent:P,newIntent:P,endedIntent:P}};return s.computed=Object(S.a)({},de(s)),s}}]),e}(),Te=new k((function(){return new Ne}));function Ie(e){var t=Object(r.useContext)(Q),n=Object(s.a)(t,2),o=(n[0],n[1]),a=Object(r.useState)({orientation:"original",innerHeight:window.innerHeight,innerWidth:window.innerWidth}),c=Object(s.a)(a,2),u=c[0],d=c[1],l=Object(r.useMemo)((function(){return ie(d)}),[d]),h=Object(s.a)(l,2),p=h[0],v=h[1],f=Object(r.useState)(Te.get()),y=Object(s.a)(f,2),b=y[0],j=y[1];return window.onresize=function(){p((function(e){return e.innerWidth=window.innerWidth,e.innerHeight=window.innerHeight,Object(S.a)({},e)}))},Object(i.jsxs)(i.Fragment,{children:[Object(i.jsx)(Z,{application:b,windowState:u,fireBatchedSetWindowState:v}),Object(i.jsx)("button",{onClick:function(){o.enqueueUpdate((function(e){var t=new _e({}).create(e.worldGen.seed);return e.playerSave=t.playerSave,e.playerUI=t.playerUI,e.worldGen=t.worldGen,e}))},children:"Reset game state"}),Object(i.jsx)("button",{onClick:function(){b.pause(),b.destroy(),j(new Ne(void 0,!0));var t=new _e({}).create(+new Date);e.originalSetGameState((function(e){return e.playerSave=t.playerSave,e.playerUI=t.playerUI,e.worldGen=t.worldGen,e}))},children:"Get a fresh seed, reset, and rerender"}),Object(i.jsx)("button",{onClick:function(){b.pause(),b.destroy(),j(new Ne(void 0,!0))},children:"Rerender pixi application"})]})}n(230);var Ue=o.a.memo(Pe);function Pe(e){var t=e.activeQuest,n=e.spSpentThisQuest,o=e.createQuestCb,a=e.playerResourceAmounts,c=e.updaters,u=e.efficiencyGrade,l=e.score,h=e.questInitialAmount,p=Object(r.useState)({total:0,scoreComponents:[]}),v=Object(s.a)(p,2),f=v[0],y=v[1],b=t&&((null===a||void 0===a?void 0:a[t.resourceType])||0)>=t.resourceAmount;var j=function(){var e=function(){var e,t={scoreComponents:[]};t.scoreComponents.push({inputAmount:1,inputTitle:"quest completed",outputScore:5,outputDescription:""}),t.scoreComponents.push({inputAmount:"",inputTitle:"efficiency grade: "+u,outputScore:Math.floor(10/(e=u,1+("S"===e?4:"A"===e?3:"B"===e?2:"C"===e?1:0))),outputDescription:""});var n=t.scoreComponents.reduce((function(e,t){return e+t.outputScore}),0);return console.log(n),Object(S.a)(Object(S.a)({},t),{},{total:n})}();c.score.enqueueUpdate((function(t){return console.log({score:l,lastScore:t,questScore:e}),console.log("updating score"),t+e.total})),c.activeQuest.enqueueUpdate((function(){})),y(e)};return Object(i.jsxs)(i.Fragment,{children:[Object(i.jsx)(ze,{score:l,scoreDetails:f}),void 0===t?Object(i.jsxs)(i.Fragment,{children:[Object(i.jsx)("h2",{children:"No active quest"}),Object(i.jsx)("br",{}),Object(i.jsx)("button",{className:"button",onClick:function(){o()},children:"Start a quest"}),Object(i.jsx)("br",{}),Object(i.jsx)("br",{}),Object(i.jsx)("br",{})]}):Object(i.jsxs)(i.Fragment,{children:[Object(i.jsx)("h2",{children:" Active quest: "}),Object(i.jsxs)("table",{className:d()({table:!0}),children:[Object(i.jsxs)("tr",{children:[Object(i.jsx)("td",{children:"Initial"}),Object(i.jsxs)("td",{children:[h," ",t.resourceType]})]}),Object(i.jsxs)("tr",{children:[Object(i.jsx)("td",{children:"Current"}),Object(i.jsxs)("td",{children:[null===a||void 0===a?void 0:a[t.resourceType]," ",t.resourceType]})]}),Object(i.jsxs)("tr",{children:[Object(i.jsx)("td",{children:"Target"}),Object(i.jsxs)("td",{children:[t.resourceAmount," ",t.resourceType]})]}),Object(i.jsxs)("tr",{children:[Object(i.jsx)("td",{children:"SP spent"}),Object(i.jsx)("td",{children:void 0===n?"":n})]}),Object(i.jsxs)("tr",{children:[Object(i.jsx)("td",{children:"Efficiency"}),Object(i.jsx)("td",{children:u})]})]}),b?Object(i.jsxs)(i.Fragment,{children:[Object(i.jsx)("br",{}),Object(i.jsx)("button",{className:"button",onClick:function(){j()},children:"Finish quest"})]}):Object(i.jsx)(i.Fragment,{})]})]})}function ze(e){var t=e.scoreDetails,n=e.score,a=Object(r.useState)(!0),c=Object(s.a)(a,2),u=c[0],d=c[1];return Object(r.useEffect)((function(){console.log({scoreDetails:t}),0!==t.total&&d(!1)}),[t]),Object(i.jsx)(i.Fragment,{children:!u&&Object(i.jsxs)(i.Fragment,{children:[Object(i.jsxs)("h3",{children:["Score: ",n]}),!!t.total&&Object(i.jsxs)("h4",{children:["Your score increased by ",t.total,"!"]}),t.scoreComponents.map((function(e){return Object(i.jsx)(o.a.Fragment,{children:Object(i.jsxs)("h5",{children:[e.outputDescription&&e.outputDescription+": ",(t=e.outputScore,t<0?t.toString():"+"+t.toString())," score for"," ",e.inputAmount," ",e.inputTitle]})},e.inputTitle);var t})),Object(i.jsx)("button",{onClick:function(){return d(!0)},children:"OK"})]})})}n(231);function Ae(e){var t=e.children;return Object(i.jsx)("div",{className:"layout",children:t})}function Fe(e){var t=e.showContent,n=e.children;return Object(i.jsx)("div",{hidden:!t,children:n})}n(232);function Me(e){var t=e.value,n=e.labels,r=e.onChange;return Object(i.jsx)("div",{className:"tab-label-container",children:n.map((function(e,n){return Object(i.jsx)(He,{onClick:r,value:n,active:t===n,children:e},n)}))})}function He(e){var t=e.onClick,n=e.value,r=e.active,o=e.children;return Object(i.jsx)("div",{className:r?"tab-label active":"tab-label inactive",children:Object(i.jsx)("div",{onClick:function(){t(n)},children:o})})}var Ee=(new h.a).getBrowser(),Re=!1;"Mobile Safari"===Ee.name&&window.innerWidth<window.innerHeight&&(Re=!0);var De=["Quest Progress","Node Details","Debug"],Be=new k((function(){return new _e({}).create()}));var qe=function(){var e=Object(r.useState)((function(){return Be.get()})),t=Object(s.a)(e,2),n=t[0],o=t[1],a=Object(r.useMemo)((function(){return ie(o)}),[o]),c=Object(s.a)(a,2),u=c[0],l=c[1],h=Object(r.useMemo)((function(){return ae(Be.get(),u)}),[u]),v=Object(r.useCallback)((function(){return function(e){e.playerSave.questsCompleted.enqueueUpdate((function(e,t){var n=Object(p.a)(e);return t.playerSave.activeQuest&&n.push(t.playerSave.activeQuest),n})),e.playerSave.activeQuest.enqueueUpdate((function(e,t){var n,i,r=t.playerSave.questsCompleted.length,o=(null===(n=t.computed.playerResourceNodesAggregated)||void 0===n?void 0:n.size())||5,a=I.Mana0,c=((null===(i=t.computed.playerResourceAmounts)||void 0===i?void 0:i[a])||50)/o,s=o+Math.round(3*Math.sqrt(o)-2),u=Object(fe.b)(t.worldGen.seed+r)/fe.a*.4+.8;return{resourceType:a,resourceAmount:Math.round(s*c*u),description:""}})),e.playerSave.spSpentThisQuest.enqueueUpdate((function(e){return 0})),e.playerSave.questProgressHistory.enqueueUpdate((function(e){return[]})),e.playerSave.questInitialAmount.enqueueUpdate((function(e,t){var n,i,r=null===(n=t.playerSave.activeQuest)||void 0===n?void 0:n.resourceType;return r&&(null===(i=t.computed.playerResourceAmounts)||void 0===i?void 0:i[r])||e}))}(h)}),[h]),f=[];return f=[Object(i.jsx)(Ue,{spSpentThisQuest:n.playerSave.spSpentThisQuest,createQuestCb:v,activeQuest:n.playerSave.activeQuest,playerResourceAmounts:n.computed.playerResourceAmounts,updaters:h.playerSave,score:n.playerSave.score,efficiencyGrade:D(E(n.playerSave)),questInitialAmount:n.playerSave.questInitialAmount}),Object(i.jsx)(K,{selectedPointNode:n.playerUI.selectedPointNode,allocatedPointNodeSet:n.playerSave.allocatedPointNodeSet,worldGen:n.worldGen,hasActiveQuest:void 0!==n.playerSave.activeQuest}),Object(i.jsx)(B,{selectedPointNode:n.playerUI.selectedPointNode,allocatedPointNodeSet:n.playerSave.allocatedPointNodeSet,worldGen:n.worldGen,playerSave:n.playerSave,computed:n.computed})],Object(i.jsxs)("div",{className:d()({App:!0,"force-landscape":Re}),children:[Object(i.jsxs)(Q.Provider,{value:[n,h,l],children:[Object(i.jsx)(Ie,{originalSetGameState:o}),Object(i.jsxs)(Ae,{children:[Object(i.jsx)(Me,{value:n.playerUI.activeTab,labels:De,onChange:h.playerUI.activeTab.getUpdater()}),f.map((function(e,t){return Object(i.jsx)(Fe,{showContent:n.playerUI.activeTab===t,children:e},t)}))]})]}),Object(i.jsx)(W,{intent:n.intent,updaters:h.intent})]})};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(Object(i.jsx)(o.a.StrictMode,{children:Object(i.jsx)(qe,{})}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},9:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return r}));n(1),n(2),n(48);var i=Math.pow(2,32);function r(e){var t=(e+i)%i;return t=Math.imul(t,3039394381),t^=t>>>8,t+=1759714724,t^=t<<8,t=Math.imul(t,458671337),((t^=t>>>8)+i)%i}}).call(this,n(13).Buffer)}},[[233,1,2]]]);
//# sourceMappingURL=main.f3f8184b.chunk.js.map