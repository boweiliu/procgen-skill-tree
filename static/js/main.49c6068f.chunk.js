(this["webpackJsonpprocgen-skill-tree"]=this["webpackJsonpprocgen-skill-tree"]||[]).push([[0],{136:function(e,t,n){},144:function(e,t,n){},145:function(e,t,n){},146:function(e,t,n){},15:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return i}));n(2),n(3),n(54);var r=Math.pow(2,32);function i(e){var t=(e+r)%r;return t=Math.imul(t,3039394381),t^=t>>>8,t+=1759714724,t^=t<<8,t=Math.imul(t,458671337),((t^=t>>>8)+r)%r}}).call(this,n(13).Buffer)},158:function(e,t){},160:function(e,t){},170:function(e,t){},172:function(e,t){},197:function(e,t){},199:function(e,t){},200:function(e,t){},205:function(e,t){},207:function(e,t){},213:function(e,t){},215:function(e,t){},234:function(e,t){},246:function(e,t){},249:function(e,t){},252:function(e,t,n){},253:function(e,t,n){},254:function(e,t,n){},255:function(e,t,n){},256:function(e,t,n){},257:function(e,t,n){"use strict";n.r(t);var r=n(1),i=n.n(r),a=n(137),o=n.n(a),c=(n(144),n(6)),u=(n(145),n(35)),s=n.n(u),l=(n(146),n(2)),d=n(3),h=function(){function e(){Object(l.a)(this,e),this.frameTimestampsInTicks=[],this.frameTimestampsInTime=[],this.frameTimestampsInTicks.push(0)}return Object(d.a)(e,[{key:"tick",value:function(e){var t=this.frameTimestampsInTicks[this.frameTimestampsInTicks.length-1];this.frameTimestampsInTicks.push(t+e),this.frameTimestampsInTicks.length>120&&(this.frameTimestampsInTicks=this.frameTimestampsInTicks.slice(60)),this.frameTimestampsInTime.push((new Date).getTime()),this.frameTimestampsInTime.length>120&&(this.frameTimestampsInTime=this.frameTimestampsInTime.slice(60))}},{key:"getUps",value:function(){var e=this.frameTimestampsInTicks[this.frameTimestampsInTicks.length-1]-this.frameTimestampsInTicks[0],t=(this.frameTimestampsInTicks.length-1)/e;return t?60*t:60}},{key:"getFps",value:function(){var e=this.frameTimestampsInTime[this.frameTimestampsInTime.length-1]-this.frameTimestampsInTime[0],t=(this.frameTimestampsInTime.length-1)/e;return t?1e3*t:60}},{key:"getFpsString",value:function(){return this.getFps().toFixed(1)}},{key:"getUpsString",value:function(){return this.getUps().toFixed(1)}}]),e}(),p=n(0);function v(e){var t=Object(r.useRef)(new h);return Object(r.useEffect)((function(){t.current.tick(0)}),[e.tick]),Object(p.jsxs)("div",{className:"text",children:[Object(p.jsxs)("div",{children:[e.windowState.innerWidth,"x",e.windowState.innerHeight]}),Object(p.jsx)(f,{}),Object(p.jsxs)("div",{children:["UPS: ",t.current.getFpsString()]})]})}function f(){var e=Object(r.useState)(0),t=Object(c.a)(e,2),n=t[0],i=t[1],a=Object(r.useRef)(new h);Object(r.useEffect)((function(){var e=setTimeout((function(){i((function(e){return e+1})),a.current.tick(0)}),5);return function(){return clearTimeout(e)}}),[n]);var o=Object(r.useMemo)((function(){return n>=0?a.current.getFpsString():""}),[n]);return Object(p.jsxs)("div",{children:["RPS: ",o]})}var b=n(11),O=n(12),j=n(139),y=n(10),g=function(){function e(){Object(l.a)(this,e)}return Object(d.a)(e,null,[{key:"MinBy",value:function(e,t){var n,r=null,i=null,a=Object(y.a)(e);try{for(a.s();!(n=a.n()).done;){var o=n.value,c=t(o);(null===i||c<i)&&(r=o,i=c)}}catch(u){a.e(u)}finally{a.f()}return r}},{key:"MinByAndValue",value:function(e,t){var n,r=null,i=null,a=Object(y.a)(e);try{for(a.s();!(n=a.n()).done;){var o=n.value,c=t(o);(null===i||c<i)&&(r=o,i=c)}}catch(u){a.e(u)}finally{a.f()}return null===r||null===i?null:{obj:r,value:i}}},{key:"MaxBy",value:function(e,t){var n,r=null,i=null,a=Object(y.a)(e);try{for(a.s();!(n=a.n()).done;){var o=n.value,c=t(o);(null===i||c>i)&&(r=o,i=c)}}catch(u){a.e(u)}finally{a.f()}return r}},{key:"RandRange",value:function(e,t){return Math.floor(Math.random()*(t-e)+e)}},{key:"SortByKey",value:function(e,t){return e.sort((function(e,n){return t(e)-t(n)}))}},{key:"ReplaceAll",value:function(e,t){var n=new RegExp(Object.keys(t).join("|"),"gi");return e.replace(n,(function(e){return t[e.toLowerCase()]}))}},{key:"Debounce",value:function(e){var t,n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{isImmediate:!1},a=function(){for(var a=arguments.length,o=new Array(a),c=0;c<a;c++)o[c]=arguments[c];var u=function(){t=void 0,i.isImmediate||e.apply(n,o)},s=i.isImmediate&&void 0===t;void 0!==t&&clearTimeout(t),t=setTimeout(u,r),s&&e.apply(n,o)};return a}},{key:"FormatDate",value:function(e){var t=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][e.getMonth()];return"".concat(t," ").concat(e.getDate(),", ").concat(("00"+e.getHours()).substr(-2),":").concat(("00"+e.getMinutes()).substr(-2),":").concat(("00"+e.getSeconds()).substr(-2))}},{key:"FlattenByOne",value:function(e){var t,n=[],r=Object(y.a)(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;n=n.concat(i)}}catch(a){r.e(a)}finally{r.f()}return n}},{key:"PadString",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:" ";return e+n+r.repeat(t-e.length)}}]),e}();function S(e){return Object.keys(e)}function x(e,t){return n=S(e).map(t),Object.fromEntries(n);var n}function m(e){var t=[[]],n={get:function(e,r,i){var a=e.path.concat([r.toString()]);return t[t.length-1]===e.path?t[t.length-1]=a:t.push(a),new Proxy({path:a},n)}};return e(new Proxy({path:t[0]},n)),t}function E(e){var t=m(e);return function(e){return t.map((function(t){var n,r=e,i=Object(y.a)(t);try{for(i.s();!(n=i.n()).done;){var a,o=n.value;r=null===(a=r)||void 0===a?void 0:a[o]}}catch(c){i.e(c)}finally{i.f()}return r}))}}var w,k=function(e){Object(b.a)(n,e);var t=Object(O.a)(n);function n(){return Object(l.a)(this,n),t.apply(this,arguments)}return n}(Object(j.a)(Error));!function(e){e.NOOP="NOOP",e.PAN_NORTH="PAN_NORTH",e.PAN_SOUTH="PAN_SOUTH",e.PAN_WEST="PAN_WEST",e.PAN_EAST="PAN_EAST",e.TRAVEL_UPSTAIRS="TRAVEL_UPSTAIRS",e.TRAVEL_DOWNSTAIRS="TRAVEL_DOWNSTAIRS",e.TOGGLE_STRATEGIC_VIEW="TOGGLE_STRATEGIC_VIEW",e.TOGGLE_SIDEBAR="TOGGLE_SIDEBAR",e.TOGGLE_LEFT_SIDEBAR="TOGGLE_LEFT_SIDEBAR",e.TOGGLE_RIGHT_SIDEBAR="TOGGLE_RIGHT_SIDEBAR",e.TURN_OFF_SIDEBAR="TURN_OFF_SIDEBAR",e.EXIT="EXIT",e.HARD_REFRESH_PAGE="HARD_REFRESH_PAGE",e.MOVE_CURSOR_WEST="MOVE_CURSOR_WEST",e.MOVE_CURSOR_EAST="MOVE_CURSOR_EAST",e.MOVE_CURSOR_NORTH="MOVE_CURSOR_NORTH",e.MOVE_CURSOR_SOUTH="MOVE_CURSOR_SOUTH",e.MOVE_CURSOR_NORTHWEST="MOVE_CURSOR_NORTHWEST",e.MOVE_CURSOR_NORTHEAST="MOVE_CURSOR_NORTHEAST",e.MOVE_CURSOR_SOUTHWEST="MOVE_CURSOR_SOUTHWEST",e.MOVE_CURSOR_SOUTHEAST="MOVE_CURSOR_SOUTHEAST",e.MOVE_CURSOR_NORTHNORTH="MOVE_CURSOR_NORTHNORTH",e.MOVE_CURSOR_SOUTHSOUTH="MOVE_CURSOR_SOUTHSOUTH",e.INTERACT_WITH_NODE="INTERACT_WITH_NODE",e.ZOOM_RECENTER_AT_NODE="ZOOM_RECENTER_AT_NODE"}(w||(w={}));var T=S(w).reduce((function(e,t){return e[t]=!1,e}),{}),I=function(){return{activeIntent:T,newIntent:T,endedIntent:T}},_={w:w.PAN_NORTH,a:w.PAN_WEST,s:w.PAN_SOUTH,d:w.PAN_EAST,b:w.TOGGLE_STRATEGIC_VIEW,t:w.TOGGLE_LEFT_SIDEBAR,y:w.TOGGLE_RIGHT_SIDEBAR,Escape:w.EXIT,j:w.MOVE_CURSOR_WEST,l:w.MOVE_CURSOR_EAST,u:w.MOVE_CURSOR_NORTHWEST,i:w.MOVE_CURSOR_NORTHEAST,n:w.MOVE_CURSOR_SOUTHWEST,m:w.MOVE_CURSOR_SOUTHEAST,k:w.MOVE_CURSOR_SOUTHWEST,ArrowUp:w.MOVE_CURSOR_NORTHEAST,ArrowLeft:w.MOVE_CURSOR_WEST,ArrowDown:w.MOVE_CURSOR_SOUTHWEST,ArrowRight:w.MOVE_CURSOR_EAST,RightShift:w.MOVE_CURSOR_NORTHWEST,RightControl:w.MOVE_CURSOR_SOUTHEAST," ":w.INTERACT_WITH_NODE,r:w.ZOOM_RECENTER_AT_NODE,"\\":w.ZOOM_RECENTER_AT_NODE,"<":w.TRAVEL_UPSTAIRS,">":w.TRAVEL_DOWNSTAIRS,"Ctrl-Shift-R":w.HARD_REFRESH_PAGE},C=function(e){Object(b.a)(n,e);var t=Object(O.a)(n);function n(e){var r;return Object(l.a)(this,n),(r=t.call(this,e)).handleKeydown=function(e){var t=r.state.keyIntentConfig,n=e.key;"Control"===n||"Shift"===n||"Meta"===n||"Alt"===n?1===e.location?n="Left"+n:2===e.location?n="Right"+n:3===e.location&&(n="Extra"+n):(e.shiftKey&&(n="Shift-"+n),e.altKey&&(n="Alt-"+n),e.ctrlKey&&(n="Ctrl-"+n));var i=t[n];if(i){if(r.props.isTextBoxFocused)return void console.log("bypassing keyboard event processing because text box is focused");e.preventDefault()}else console.log("Unregistered key ",n,e);!1===e.repeat&&void 0!==i&&i!==w.NOOP&&(r.props.updaters.newIntent[i].enqueueUpdate((function(){return r.props.updaters.newIntent[i].enqueueUpdate((function(){return!1})),!0})),r.props.updaters.activeIntent[i].enqueueUpdate((function(){return!0})))},r.handleKeyup=function(e){var t=r.state.keyIntentConfig[e.key];void 0!==t&&t!==w.NOOP&&(r.props.updaters.activeIntent[t].enqueueUpdate((function(){return!1})),r.props.updaters.endedIntent[t].enqueueUpdate((function(){return r.props.updaters.endedIntent[t].enqueueUpdate((function(){return!1})),!0})))},r.state={keyIntentConfig:_},r}return Object(d.a)(n,[{key:"componentDidMount",value:function(){document.addEventListener("keydown",this.handleKeydown),document.addEventListener("keyup",this.handleKeyup)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.handleKeydown),document.removeEventListener("keyup",this.handleKeyup)}},{key:"render",value:function(){return Object(p.jsx)(p.Fragment,{children:" "})}}]),n}(i.a.Component),U=i.a.createContext([]),R=n(7),N=1e-7,M=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{x:0,y:0},n=arguments.length>1?arguments[1]:void 0;Object(l.a)(this,e),this._x=void 0,this._y=void 0,"number"===typeof t?(this._x=t,this._y=n):(this._x=t.x,this._y=t.y)}return Object(d.a)(e,[{key:"x",get:function(){return this._x}},{key:"y",get:function(){return this._y}},{key:"half",get:function(){return new e({x:this.x/2,y:this.y/2})}},{key:"hash",value:function(){return this.toString()}},{key:"toString",value:function(){return"[".concat(this.x,", ").concat(this.y,"]")}},{key:"invert",value:function(){return new e({x:-this.x,y:-this.y})}},{key:"round",value:function(){return new e({x:Math.round(this.x),y:Math.round(this.y)})}},{key:"floor",value:function(){return new e({x:Math.floor(this.x),y:Math.floor(this.y)})}},{key:"taxicabDistance",value:function(e){return Math.abs(e.x-this.x)+Math.abs(e.y-this.y)}},{key:"diagonalDistance",value:function(e){return Math.max(Math.abs(e.x-this.x),Math.abs(e.y-this.y))}},{key:"distance",value:function(e){var t=Math.abs(e.x-this.x),n=Math.abs(e.y-this.y);return Math.sqrt(t*t+n*n)}},{key:"translate",value:function(t){return new e({x:this.x+t.x,y:this.y+t.y})}},{key:"subtract",value:function(t){return new e({x:this.x-t.x,y:this.y-t.y})}},{key:"add",value:function(t){return new e({x:this.x+t.x,y:this.y+t.y})}},{key:"addX",value:function(t){return new e({x:this.x+t,y:this.y})}},{key:"addY",value:function(t){return new e({x:this.x,y:this.y+t})}},{key:"subtractX",value:function(t){return new e({x:this.x-t,y:this.y})}},{key:"subtractY",value:function(t){return new e({x:this.x,y:this.y-t})}},{key:"clampX",value:function(t,n){var r=this.x;return r<t&&(r=t),r>n&&(r=n),new e({x:r,y:this.y})}},{key:"clampY",value:function(t,n){var r=this.y;return r<t&&(r=t),r>n&&(r=n),new e({x:this.x,y:r})}},{key:"scale",value:function(t,n){return new e({x:(this.x-t.x)*n.x+t.x,y:(this.y-t.y)*n.y+t.y})}},{key:"rotate",value:function(t,n){return n/=180/Math.PI,new e({x:Math.cos(n)*(this.x-t.x)-Math.sin(n)*(this.y-t.y)+t.x,y:Math.sin(n)*(this.x-t.x)+Math.cos(n)*(this.y-t.y)+t.y})}},{key:"equals",value:function(e){return void 0!==e&&null!==e&&(Math.abs(this.x-e.x)<N&&Math.abs(this.y-e.y)<N)}},{key:"multiply",value:function(t){return new e("number"===typeof t?{x:this.x*t,y:this.y*t}:{x:this.x*t.x,y:this.y*t.y})}},{key:"divide",value:function(t){return new e("number"===typeof t?{x:this.x/t,y:this.y/t}:{x:this.x/t.x,y:this.y/t.y})}},{key:"toJSON",value:function(){return{__type:"Vector2",x:this.x,y:this.y}}},{key:"transform",value:function(t,n){return new e({x:Math.floor((this.x-t.x)*n),y:Math.floor((this.y-t.y)*n)})}},{key:"normalize",value:function(){if(0===this.x&&0===this.y)return this;var t=Math.sqrt(this.x*this.x+this.y*this.y);return new e({x:this.x/t,y:this.y/t})}},{key:"withX",value:function(t){return new e({x:t,y:this.y})}},{key:"withY",value:function(t){return new e({x:this.x,y:t})}},{key:"invertX",value:function(){return new e({x:-this.x,y:this.y})}},{key:"lerp",value:function(e,t){return(t>1||t<0)&&console.error("Lerp t must be between 0 and 1."),0===t?this:1===t?e:this.scale({x:0,y:0},{x:1-t,y:1-t}).add(e.scale({x:0,y:0},{x:t,y:t}))}},{key:"lerp2D",value:function(e,t,n){return(t>1||t<0||n>1||n<0)&&console.error("Lerp t must be between 0 and 1."),this.scale({x:0,y:0},{x:1-t,y:1-n}).add(e.scale({x:0,y:0},{x:t,y:n}))}},{key:"coserp",value:function(e,t){return t=.5*(1+Math.cos(2*t*Math.PI)),this.lerp(e,t)}}],[{key:"IsVector2",value:function(t){return t instanceof e}},{key:"Random",value:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return new e({x:g.RandRange(r,t),y:g.RandRange(i,n)})}},{key:"Deserialize",value:function(t){return t&&t.hasOwnProperty("x")&&t.hasOwnProperty("y")?new e({x:t.x,y:t.y}):(console.error("Failed deserializing point"),null)}},{key:"Serialize",value:function(e){return JSON.stringify(this.SerializeToObject(e))}},{key:"SerializeToObject",value:function(e){return{x:e.x,y:e.y}}}]),e}();M.Zero=new M(0,0),M.One=new M(1,1);var D=n(9),A=n(37),L={backgroundBlue:2236962,nodePink:3355443,nodeLavender:4934475,nodeBlue:4473924,nodeAqua:16755370,gateTint:16777215,selectedTint:12303359,allocatedTint:4473924,nodeBorder:6710886,nullTint:16777215,tooltipBorderBlack:2236962,tooltipFillWhite:15658734,white:16777215,grayBlack:1907997,borderBlack:1118481,borderWhite:6710886,black:0,textWhite:8947848};function G(e){return"#"+e.toString(16)}var P=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];Object(l.a)(this,e),this._values=void 0,this._values=new z;var n,r=Object(y.a)(t);try{for(r.s();!(n=r.n()).done;){var i=n.value;this.put(i)}}catch(a){r.e(a)}finally{r.f()}}return Object(d.a)(e,[{key:"remove",value:function(e){this._values.remove(e)}},{key:"put",value:function(e){this._values.put(e,e)}},{key:"get",value:function(e){return void 0!==this._values.get(e)}},{key:"contains",value:function(e){return this._values.contains(e)}},{key:"values",value:function(){return this._values.values()}},{key:"clone",value:function(){var t=new e;return t._values=this._values.clone(),t}},{key:"size",value:function(){return this._values.size()}},{key:"equals",value:function(e){if(void 0===e||null===e)return!1;if(this.size()!==e.size())return!1;var t,n=Object(y.a)(this.values());try{for(n.s();!(t=n.n()).done;){var r=t.value;if(!e.contains(r))return!1}}catch(i){n.e(i)}finally{n.f()}return!0}}]),e}(),z=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];Object(l.a)(this,e),this._values={};var n,r=Object(y.a)(t);try{for(r.s();!(n=r.n()).done;){var i=Object(c.a)(n.value,2),a=i[0],o=i[1];this.put(a,o)}}catch(u){r.e(u)}finally{r.f()}}return Object(d.a)(e,[{key:"put",value:function(e,t){this._values[e.hash()]=t}},{key:"remove",value:function(e){delete this._values[e.hash()]}},{key:"get",value:function(e){return this._values[e.hash()]}},{key:"contains",value:function(e){return void 0!==this.get(e)&&e.hash()in this._values}},{key:"values",value:function(){return Object.values(this._values)}},{key:"size",value:function(){return Object.keys(this._values).length}},{key:"clone",value:function(){var t=new e;return t._values=Object(D.a)({},this._values),t}}]),e}(),F=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];Object(l.a)(this,e),this._kvalues={};var n,r=Object(y.a)(t);try{for(r.s();!(n=r.n()).done;){var i=Object(c.a)(n.value,2),a=i[0],o=i[1];this.put(a,o)}}catch(u){r.e(u)}finally{r.f()}}return Object(d.a)(e,[{key:"put",value:function(e,t){this._kvalues[e.hash()]=[e,t]}},{key:"remove",value:function(e){delete this._kvalues[e.hash()]}},{key:"get",value:function(e){var t;return null===(t=this._kvalues[e.hash()])||void 0===t?void 0:t[1]}},{key:"contains",value:function(e){return void 0!==this.get(e)&&e.hash()in this._kvalues}},{key:"keys",value:function(){var e=this;return Object.keys(this._kvalues).map((function(t){return e._kvalues[t][0]}))}},{key:"entries",value:function(){var e=this;return Object.keys(this._kvalues).map((function(t){return e._kvalues[t]}))}},{key:"values",value:function(){var e=this;return Object.keys(this._kvalues).map((function(t){return e._kvalues[t][1]}))}},{key:"hashKeyset",value:function(){return Object.keys(this._kvalues).map((function(e){return H(e)})).reduce((function(e,t){return e+t})).toString()}},{key:"clone",value:function(){var t=new e;return t._kvalues=Object(D.a)({},this._kvalues),t}},{key:"size",value:function(){return Object.keys(this._kvalues).length}}],[{key:"SerializeToObject",value:function(e,t,n){return e.entries().map((function(e){var r=Object(c.a)(e,2),i=r[0],a=r[1];return[t?t(i):i,n?n(a):a]}))}},{key:"Deserialize",value:function(t,n,r){if(!t||!Array.isArray(t))return console.error("Failed deserializing keyed hash map"),null;try{return new e(t.map((function(e){if(!e||!Array.isArray(e)||2!==e.length)throw new k("Failed deserializing entry ".concat(JSON.stringify(e)));var t=e,i=Object(c.a)(t,2),a=i[0],o=i[1];return[n?n(a):a,r?r(o):o]})))}catch(i){if(i instanceof k)return console.error("Failed deserializing keyed hash map",i),null;throw i}}}]),e}();function H(e){for(var t=0,n=0;n<e.length;n++)t=Math.imul(31,t)+e.charCodeAt(n)|0;return t}function q(e){return new R.d(e.x,e.y)}var W=16711680,V=65280,B=255,X=65536,Z=256;function J(e,t){var n=[e&W,t&W],r=[e&V,t&V],i=[e&B,t&B],a=Math.round(n[0]/X*n[1]/W)*X;return a+=Math.round(r[0]/Z*r[1]/V)*Z,a+=1*Math.round(i[0]/1*i[1]/B)}function K(e,t,n){if("object"===typeof e){if(e.hasOwnProperty("target"))return Y(e);if(e.hasOwnProperty("color")){var r=e;return Y({target:r.color,proportion:r.opacity,base:r.background})}throw new Error("missing parameter in interpolateColor: ".concat(e))}if(t)return Y({target:e,proportion:t,base:n});throw new Error("missing parameter in interpolateColor: ".concat(e," ").concat(t," ").concat(n))}function Y(e){var t=e.target,n=e.base,r=void 0===n?0:n,i=e.proportion,a=void 0===i?1:i,o=[t&W,r&W],c=[t&V,r&V],u=[t&B,r&B],s=Math.round(o[0]/X*a+o[1]/X*(1-a))*X;return s+=Math.round(c[0]/Z*a+c[1]/Z*(1-a))*Z,s+=1*Math.round(u[0]/1*a+u[1]/1*(1-a))}var Q=n(19);function $(e){var t=[];return[function(e){t.push(e)},function(){if(0!==t.length){var n=Object(Q.a)(t);t=[],e((function(e){var t,r=e,i=Object(y.a)(n);try{for(i.s();!(t=i.n()).done;){var a=t.value;r="function"===typeof a?a(r):a}}catch(o){i.e(o)}finally{i.f()}return r}))}}]}var ee=n(4);function te(e,t){var n={getUpdater:function(){return t}};return n.enqueueUpdate=t,null===e||void 0===e||"object"!==typeof e||Object.keys(e).forEach((function(r){if("enqueueUpdate"===r||"getUpdater"===r||"update"===r)throw Error("Invalid key in updaterGenerator: ".concat(r," conflicts with reserved keywords enqueueUpdate, update, getUpdater."));n[r]=te(e[r],(function(e){t("function"===typeof e?function(t,n){var i=e(t[r],n);return t[r]===i?t:Object(D.a)(Object(D.a)({},t),{},Object(ee.a)({},r,i))}:function(t,n){return Object(D.a)(Object(D.a)({},t),{},Object(ee.a)({},r,e))})}))})),n}function ne(e,t){return te(e,(function(e){t("function"===typeof e?function(t){return e(t,t)}:e)}))}var re=function(){function e(){Object(l.a)(this,e),this._values=[]}return Object(d.a)(e,[{key:"add",value:function(e){this._values.push(e)}},{key:"remove",value:function(e){var t=this._values.splice(this._values.findIndex((function(t){return t.instance===e})),1);return 0===t.length?void 0:t[0]}},{key:"contains",value:function(e){return this._values.findIndex((function(t){return t.instance===e}))>-1}},{key:"get",value:function(e){return this._values.find((function(t){return t.instance===e}))}},{key:"clone",value:function(){var t=new e;return t._values=Object(Q.a)(this._values),t}},{key:"forEach",value:function(e){this._values.forEach(e)}}]),e}(),ie=function(){function e(t){var n=this;Object(l.a)(this,e),this.container=void 0,this.state=void 0,this.stateUpdaters=void 0,this._staleProps=void 0,this._children=new re,this._childrenToConstruct=new re,this._childrenToDestruct=new re,this._forceUpdates=new re,this.markForceUpdate=function(e){var t,r;null===(t=n._staleProps.args)||void 0===t||null===(r=t.markForceUpdate)||void 0===r||r.call(t,n);var i=n._children.get(e);if(!i)throw new Error("Error, child ".concat(e," not found in ").concat(n));n._forceUpdates.add(i)},this._staleProps=t}return Object(d.a)(e,[{key:"addChild",value:function(e){this._children.add(e),this._childrenToConstruct.add(e)}},{key:"registerChild",value:function(e){this._children.add(e)}},{key:"removeChild",value:function(e){var t=this._children.remove(e);t&&this._childrenToDestruct.add(t)}},{key:"_didConstruct",value:function(e){var t,n=this;this._childrenToConstruct.forEach((function(t){t.instance||(t.instance=new t.childClass(t.propsFactory(e,n.state))),n.container.addChild(t.instance.container)})),this._childrenToConstruct=new re,this.renderSelf(e),null===(t=this.didMount)||void 0===t||t.call(this)}},{key:"useState",value:function(e,t){var n=function(t){e.state="function"===typeof t?t(e.state):t},r=$(n),i=Object(c.a)(r,2),a=i[0],o=i[1],u=ne(t,a);return this.fireStateUpdaters||(this.fireStateUpdaters=o),this.stateUpdaters||(this.stateUpdaters=u),{state:t,setState:n,fireStateUpdaters:o,stateUpdaters:u}}},{key:"update",value:function(e){this._update(e)}},{key:"_update",value:function(e){var t,n,r,i=this,a=Object(D.a)({},this.state);if(null===(t=this.fireStateUpdaters)||void 0===t||t.call(this),null===(n=this.updateSelf)||void 0===n||n.call(this,e),this.shouldUpdate&&!this.shouldUpdate(this._staleProps,a,e,this.state)){var o=this._forceUpdates.clone();return this._forceUpdates=new re,void o.forEach((function(t){var n,r=t.instance,a=t.propsFactory;null===r||void 0===r||r._update(a(e,i.state)),r&&(null===(n=i.didForceUpdateChild)||void 0===n||n.call(i,r))}))}null===(r=this.updateChildren)||void 0===r||r.call(this,e),this._updateChildren(e),this.renderSelf(e),this._staleProps=e,new Promise((function(e){var t;return e(null===(t=i.didUpdate)||void 0===t?void 0:t.call(i))}))}},{key:"_updateChildren",value:function(e){var t=this;this._childrenToDestruct.forEach((function(e){var n,r;e.instance&&(null===(n=(r=e.instance).willUnmount)||void 0===n||n.call(r),t.container.removeChild(e.instance.container))})),this._childrenToDestruct=new re,this._children.forEach((function(n){var r=n.instance,i=n.propsFactory;null===r||void 0===r||r._update(i(e,t.state))})),this._childrenToConstruct.forEach((function(n){n.instance||(n.instance=new n.childClass(n.propsFactory(e,t.state))),t.container.addChild(n.instance.container)})),this._childrenToConstruct=new re}},{key:"willUnmount",value:function(){}},{key:"toString",value:function(){return"lifecyclehandler object"}}]),e}();function ae(e){return new Proxy(e,{construct:function(e,t){var n=new e(t[0]);return n._didConstruct(t[0]),n}})}new Proxy(ie,{construct:function(e,t,n){var r=Reflect.construct(e,t,n);return r._didConstruct.apply(r,Object(Q.a)(t)),r}});var oe,ce,ue,se=function e(){Object(l.a)(this,e)};se.CHUNK_HALF_DIM=((se.CHUNK_DIM=9)-1)/2,se.DROP_NODES_CHANCE=0,function(e){e.Basic="Basic",e.Nothing="Nothing",e.EfficiencyGate="EfficiencyGate"}(oe||(oe={})),function(e){e.Mana0="Mana0",e.Mana1="Mana1",e.Mana2="Mana2"}(ce||(ce={})),function(e){e.Flat="Flat",e.Increased0="% increased",e.AfterIncreased0="added after % increased",e.Increased1="% increased multiplier",e.AfterIncreased1="added after % increased multiplier"}(ue||(ue={}));var le=ae(function(e){Object(b.a)(n,e);var t=Object(O.a)(n);function n(e){var r,i,a;Object(l.a)(this,n),(a=t.call(this,e)).container=void 0,a.state=void 0,a.sprite=void 0,a.halfwayCenterSprite=void 0,a.centerSprite=void 0,a.topHalfSprite=void 0,a.hitArea=void 0,a.tooltippableArea=void 0,a.state={numClicks:0,descriptionText:""},a.updateSelf(e),a.container=new R.b;var o=null===(r=e.args.pointNodeTexture.find((function(e){return e.cropFraction>=.99})))||void 0===r?void 0:r.texture;a.container.sortableChildren=!0,a.sprite=new R.g(o),a.sprite.anchor.x=.5,a.sprite.anchor.y=.5,a.sprite.zIndex=-2,a.container.addChild(a.sprite),a.topHalfSprite=new R.g(null===(i=e.args.pointNodeTexture.find((function(e){return e.cropFraction>=.499})))||void 0===i?void 0:i.texture),a.topHalfSprite.anchor.x=.5,a.topHalfSprite.anchor.y=.5,a.topHalfSprite.zIndex=-1,e.pointNodeGen.nodeType===oe.EfficiencyGate&&a.container.addChild(a.topHalfSprite);var c=new R.c;return c.beginFill(L.black),c.drawRect(0,0,a.topHalfSprite.width,a.topHalfSprite.height/2),c.pivot.x=a.topHalfSprite.width/2,c.pivot.y=a.topHalfSprite.height/2,c.zIndex=30,a.centerSprite=new R.g(o),a.centerSprite.anchor.x=.5,a.centerSprite.anchor.y=.5,a.centerSprite.scale=q(new M(.5,.5)),a.centerSprite.zIndex=1,a.centerSprite.alpha=0,a.halfwayCenterSprite=new R.g(o),a.halfwayCenterSprite.anchor.x=.5,a.halfwayCenterSprite.anchor.y=.5,a.halfwayCenterSprite.scale=q(new M(.75,.75)),a.halfwayCenterSprite.zIndex=0,a.halfwayCenterSprite.alpha=0,a.container.interactive=!0,a.container.buttonMode=!0,a.hitArea=new R.e(-he.NODE_HITAREA_PX/2,-he.NODE_HITAREA_PX/2,he.NODE_HITAREA_PX,he.NODE_HITAREA_PX),a.container.hitArea=a.hitArea,a}return Object(d.a)(n,[{key:"updateSelf",value:function(e){var t="Nothing (empty node)";e.pointNodeGen.nodeType===oe.EfficiencyGate?t="Unlocks at 300 Mana0 in 14 or fewer allocations":e.pointNodeGen.nodeType!==oe.Nothing&&(t="".concat(e.pointNodeGen.resourceAmount," ").concat(e.pointNodeGen.resourceModifier," ").concat(e.pointNodeGen.resourceType)),this.state.descriptionText=t}},{key:"renderSelf",value:function(e){var t,n,r;this.container.position=q(e.args.position),e.isSelected?(n=L.selectedTint,r=L.selectedTint):(n=L.nullTint,r=L.nullTint),e.isAllocated&&(n=L.allocatedTint);var i=0,a=0;e.pointNodeGen.nodeType===oe.Nothing?i=L.nodeBlue:e.pointNodeGen.nodeType===oe.EfficiencyGate?(i=L.nodeAqua,a=J(L.nodeAqua,L.gateTint)):e.pointNodeGen.resourceType===ce.Mana0&&(e.pointNodeGen.resourceModifier===ue.Flat?i=L.nodePink:e.pointNodeGen.resourceModifier===ue.Increased0&&(i=L.nodeLavender)),this.sprite.tint=J(i,n),this.centerSprite.tint=J(i,r),this.topHalfSprite.tint=J(a,n);var o=Math.floor(9*Math.random())/8-.001;this.topHalfSprite.texture=null===(t=e.args.pointNodeTexture.find((function(e){return e.cropFraction>=o})))||void 0===t?void 0:t.texture,e.selfPointNodeRef.pointNodeCoord.equals(M.Zero)&&(this.container.scale=q(new M(1.25,1.25)))}},{key:"shouldUpdate",value:function(e,t,n,r){var i,a=Object(y.a)(Object.keys(e));try{for(a.s();!(i=a.n()).done;){var o=i.value;if("delta"!==o&&"args"!==o&&"updaters"!==o){if(e[o]!==n[o])return console.log("node shouldUpdate differed in ".concat(o,", returning true")),!0;var c,u;if("selfPointNodeRef"!==o);else if((null===(c=e[o])||void 0===c?void 0:c.hash())!==(null===(u=n[o])||void 0===u?void 0:u.hash()))return console.log("node shouldUpdate differed in ".concat(o,", returning true")),!0}}}catch(s){a.e(s)}finally{a.f()}return!1}},{key:"didMount",value:function(){var e=this;this.container.addListener("pointerdown",(function(t){e._staleProps.args.markForceUpdate(e),e.state.numClicks++})),this.container.addListener("pointerover",(function(t){var n=t.data.getLocalPosition(e.container),r=new M(e.container.worldTransform.tx,e.container.worldTransform.ty);e._staleProps.tooltipUpdaters.enqueueUpdate((function(t){return Object(D.a)(Object(D.a)({},t),{},{visible:!0,text:e.state.descriptionText,position:r.add(n)})}))})),this.container.addListener("pointerout",(function(t){e._staleProps.tooltipUpdaters.enqueueUpdate((function(e){return Object(D.a)(Object(D.a)({},e),{},{visible:!1,text:""})}))})),this.container.addListener("pointermove",(function(t){var n=t.data.getLocalPosition(e.container),r=new M(e.container.worldTransform.tx,e.container.worldTransform.ty);e._staleProps.tooltipUpdaters.position.enqueueUpdate(r.add(n))}))}},{key:"toString",value:function(){return"PointNodeCompoent "+this._staleProps.selfPointNodeRef.toString()}}]),n}(ie)),de=function(){function e(t){Object(l.a)(this,e),this.z=void 0,this.chunkCoord=void 0,this.pointNodeCoord=void 0,this.pointNodeId=void 0,this.z=t.z,this.chunkCoord=t.chunkCoord,this.pointNodeCoord=t.pointNodeCoord,this.pointNodeId=t.pointNodeId}return Object(d.a)(e,[{key:"hash",value:function(){return this.pointNodeId.toString()+this.z.toString()+this.chunkCoord.toString()+this.pointNodeCoord.toString()}},{key:"toString",value:function(){return this.z+","+this.chunkCoord.toString()+","+this.pointNodeCoord.toString()}}]),e}(),he=function e(){Object(l.a)(this,e)};he.SPACING_PX=36,he.CHUNK_SPACING_PX=(se.CHUNK_DIM+0)*he.SPACING_PX,he.NODE_SIZE_PX=22,he.NODE_HITAREA_PX=he.NODE_SIZE_PX+4,he.NODE_ROUNDED_PX=4;ae(function(e){Object(b.a)(n,e);var t=Object(O.a)(n);function n(e){var r;return Object(l.a)(this,n),(r=t.call(this,e)).container=void 0,r.state=void 0,r.children=void 0,r.state={},r.container=new R.b,r.children=new F,r.resyncChildren(e),r}return Object(d.a)(n,[{key:"renderSelf",value:function(e){this.container.position=q(e.position)}},{key:"shouldUpdate",value:function(e,t,n,r){var i,a=Object(y.a)(Object.keys(e));try{for(a.s();!(i=a.n()).done;){var o=i.value;if("delta"!==o&&"args"!==o&&"updaters"!==o){if("position"===o){if(e[o].equals(n[o]))continue;return console.log("chunk shouldUpdate differed in ".concat(o,", returning true")),!0}var c,u;if("selectedPointNode"!==o)if("selfChunkRef"!==o){if("allocatedPointNodeSubset"===o){if(e[o].equals(n[o]))continue;return console.log("chunk shouldUpdate differed in ".concat(o,", returning true")),!0}if(e[o]!==n[o])return console.log("chunk shouldUpdate differed in ".concat(o,", returning true")),!0}else{var s,l;if((null===(s=e[o])||void 0===s?void 0:s.hash())!==(null===(l=n[o])||void 0===l?void 0:l.hash()))return console.log("chunk shouldUpdate differed in ".concat(o,", returning true")),!0}else if((null===(c=e[o])||void 0===c?void 0:c.hash())!==(null===(u=n[o])||void 0===u?void 0:u.hash()))return console.log("chunk shouldUpdate differed in ".concat(o,", returning true")),!0}}}catch(d){a.e(d)}finally{a.f()}return!1}},{key:"resyncChildren",value:function(e){var t=this,n=this.children.clone();console.log("chunk component upsert children got here");var r,i=Object(y.a)(e.chunkGen.pointNodes.entries());try{var a=function(){var i=Object(c.a)(r.value,2),a=i[0],o=i[1],u=new de({z:e.selfChunkRef.z,chunkCoord:e.selfChunkRef.chunkCoord,pointNodeCoord:a,pointNodeId:o.id}),s=function(e,n){var r;return{delta:e.delta,args:{pointNodeTexture:e.args.pointNodeTexture,markForceUpdate:t.markForceUpdate,position:u.pointNodeCoord.multiply(he.SPACING_PX)},selfPointNodeRef:u,updaters:e.updaters,tooltipUpdaters:e.tooltipUpdaters,pointNodeGen:o,isSelected:(null===(r=e.selectedPointNode)||void 0===r?void 0:r.pointNodeId)===u.pointNodeId,isAllocated:e.allocatedPointNodeSubset.contains(u)}},l=u,d=t.children.get(l);d?n.remove(l):(d=new le(s(e,t.state)),t.children.put(u,d),t.addChild({childClass:le,instance:d,propsFactory:s}))};for(i.s();!(r=i.n()).done;)a()}catch(h){i.e(h)}finally{i.f()}console.log("chunk component to delete has ".concat(n.size()," children"));var o,u=Object(y.a)(n.entries());try{for(u.s();!(o=u.n()).done;){var s=Object(c.a)(o.value,2),l=s[0],d=s[1];this.children.remove(l),this.removeChild(d)}}catch(h){u.e(h)}finally{u.f()}}},{key:"updateChildren",value:function(e){this.resyncChildren(e)}},{key:"didForceUpdateChild",value:function(e){this.container.removeChild(e.container),this.container.addChild(e.container)}}]),n}(ie));var pe=function(){function e(t){Object(l.a)(this,e),this._wasConstructed=!1,this._value=void 0,this._factory=void 0,this._factory=t}return Object(d.a)(e,[{key:"get",value:function(){return void 0!==this._value||!0===this._wasConstructed||(this._value=this._factory(),this._wasConstructed=!0),this._value}},{key:"wasConstructed",value:function(){return this._wasConstructed}}]),e}();var ve,fe,be=function(){function e(t){Object(l.a)(this,e),this._values=void 0,this._factory=void 0,this._values=new F,this._factory=t}return Object(d.a)(e,[{key:"setFactory",value:function(e){return this._factory=e,this}},{key:"put",value:function(e,t){this._values.put(e,t)}},{key:"remove",value:function(e){this._values.remove(e)}},{key:"invalidate",value:function(e){this.remove(e)}},{key:"clear",value:function(){this._values=new F}},{key:"peek",value:function(e){return this._values.get(e)}},{key:"get",value:function(e){if(this._values.contains(e))return this._values.get(e);var t=this._factory(e);return this._values.put(e,t),t}},{key:"precompute",value:function(e){if(!this._values.contains(e)){var t=this._factory(e);this._values.put(e,t)}}},{key:"contains",value:function(e){return this._values.contains(e)}},{key:"values",value:function(){return this._values.values()}},{key:"keys",value:function(){return this._values.keys()}},{key:"entries",value:function(){return this._values.entries()}},{key:"size",value:function(){return this._values.size()}},{key:"clone",value:function(t){var n=new e(t||this._factory);return n._values=this._values.clone(),n}}]),e}(),Oe=ae(function(e){Object(b.a)(n,e);var t=Object(O.a)(n);function n(e){var r;return Object(l.a)(this,n),(r=t.call(this,e)).container=void 0,r.state=void 0,r.container=new R.b,r.container.sortableChildren=!0,r.state={},r}return Object(d.a)(n,[{key:"renderSelf",value:function(e){}}]),n}(ie)),je=n(53),ye=n.n(je);!function(e){e.TAKEN="TAKEN",e.AVAILABLE="AVAILABLE",e.UNREACHABLE="UNREACHABLE",e.HIDDEN="HIDDEN"}(ve||(ve={})),function(e){e.true="true",e.false="false"}(fe||(fe={}));var ge,Se={true:{taken:!0},false:{taken:!1}},xe={true:{visible:!0},false:{visible:!1}},me={true:{reachable:!0},false:{reachable:!1}};!function(e){e.CLOSED="CLOSED",e.TICKING="TICKING",e.OPEN="OPEN"}(ge||(ge={}));var Ee=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{x:0,y:0,z:0},n=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0;Object(l.a)(this,e),this._x=void 0,this._y=void 0,this._z=void 0,"number"===typeof t?(this._x=t,this._y=n,this._z=r):(this._x=t.x,this._y=t.y,this._z=t.z)}return Object(d.a)(e,[{key:"x",get:function(){return this._x}},{key:"y",get:function(){return this._y}},{key:"z",get:function(){return this._z}},{key:"hash",value:function(){return this.toString()}},{key:"toString",value:function(){return"[".concat(this.x,", ").concat(this.y,", ").concat(this.z,"]")}},{key:"round",value:function(){return new e({x:Math.round(this.x),y:Math.round(this.y),z:Math.round(this.z)})}},{key:"moduloPositive",value:function(t){return new e({x:(this.x%t+t)%t,y:(this.y%t+t)%t,z:(this.z%t+t)%t})}},{key:"subtract",value:function(t){return new e({x:this.x-t.x,y:this.y-t.y,z:this.z-t.z})}},{key:"add",value:function(t,n,r){return new e("number"===typeof t?{x:this.x+t,y:this.y+n,z:this.z+r}:{x:this.x+t.x,y:this.y+t.y,z:this.z+t.z})}},{key:"addX",value:function(t){return new e({x:this.x+t,y:this.y,z:this.z})}},{key:"addY",value:function(t){return new e({x:this.x,y:this.y+t,z:this.z})}},{key:"addZ",value:function(t){return new e({x:this.x,y:this.y,z:this.z+t})}},{key:"subtractX",value:function(t){return new e({x:this.x-t,y:this.y,z:this.z})}},{key:"subtractY",value:function(t){return new e({x:this.x,y:this.y-t,z:this.z})}},{key:"subtractZ",value:function(t){return new e({x:this.x,y:this.y,z:this.z-t})}},{key:"scale",value:function(t,n){return new e({x:(this.x-t.x)*n.x+t.x,y:(this.y-t.y)*n.y+t.y,z:(this.z-t.z)*n.z+t.z})}},{key:"equals",value:function(e){return void 0!==e&&null!==e&&(Math.abs(this.x-e.x)<N&&Math.abs(this.y-e.y)<N&&Math.abs(this.z-e.z)<N)}},{key:"multiply",value:function(t){return new e("number"===typeof t?{x:this.x*t,y:this.y*t,z:this.z*t}:{x:this.x*t.x,y:this.y*t.y,z:this.z*t.z})}},{key:"divide",value:function(t){return new e("number"===typeof t?{x:this.x/t,y:this.y/t,z:this.z/t}:{x:this.x/t.x,y:this.y/t.y,z:this.z/t.z})}},{key:"toJSON",value:function(){return{__type:"Vector3",x:this.x,y:this.y,z:this.z}}},{key:"pairXY",value:function(){return new M({x:this.x,y:this.y})}},{key:"withX",value:function(t){return new e({x:t,y:this.y,z:this.z})}},{key:"withY",value:function(t){return new e({x:this.x,y:t,z:this.z})}},{key:"withZ",value:function(t){return new e({x:this.x,y:this.y,z:t})}}],[{key:"IsVector3",value:function(t){return t instanceof e}},{key:"FromVector2",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new e(t.x,t.y,n)}},{key:"Deserialize",value:function(t){return t&&t.hasOwnProperty("x")&&t.hasOwnProperty("y")&&t.hasOwnProperty("z")?new e({x:t.x,y:t.y,z:t.z}):(console.error("Failed deserializing vector3"),null)}},{key:"Serialize",value:function(e){return JSON.stringify(this.SerializeToObject(e))}},{key:"SerializeToObject",value:function(e){return{x:e.x,y:e.y,z:e.z}}}]),e}();Ee.Zero=new Ee(0,0,0),Ee.One=new Ee(1,1,1);var we,ke,Te,Ie,_e=n(15);function Ce(e){for(var t=e.randInt,n=e.weights,r=e.behaviors,i=t/_e.a,a=Object(_e.b)(t),o=i*Object.values(n).reduce((function(e,t){return e+t})),u=0,s=Object.entries(n);u<s.length;u++){var l=Object(c.a)(s[u],2),d=l[0],h=l[1];if(o<=h)return r[d](a);o-=h}throw Error()}function Ue(e){var t,n=e.randInt,r=e.weights,i=n/_e.a*Object.values(r).reduce((function(e,t){return e+t})),a=Object(y.a)(Object.entries(r));try{for(a.s();!(t=a.n()).done;){var o=Object(c.a)(t.value,2),u=o[0],s=o[1];if(i<=s)return u;i-=s}}catch(l){a.e(l)}finally{a.f()}throw Error()}function Re(e){var t=e.randInt,n=e.min,r=e.max,i=e.increment,a=void 0===i?1:i,o=e.inclusive,c=void 0===o||o,u=t/_e.a,s=Math.ceil((r-n)/a);return n+a*s===r&&!0===c&&(s+=1),n+Math.floor(u*s)*a}!function(e){e.RED0="RED0",e.RED1="RED1",e.RED2="RED2",e.DEL0="DEL0",e.DEL1="DEL1",e.DEL2="DEL2"}(Te||(Te={})),function(e){e.FLAT="FLAT",e.INCREASED="INCREASED"}(Ie||(Ie={}));var Ne,Me,De,Ae,Le,Ge={DECISION_0:{EMPTY:150,NO_SPEND:100,SPEND:0},DECISION_1:{SINGLE:500,DOUBLE:0},SINGLE_COLORS:(we={},Object(ee.a)(we,Te.RED0,100),Object(ee.a)(we,Te.RED1,100),Object(ee.a)(we,Te.RED2,100),Object(ee.a)(we,Te.DEL0,10),Object(ee.a)(we,Te.DEL1,10),Object(ee.a)(we,Te.DEL2,10),we),SINGLE_MODIFIERS:(ke={},Object(ee.a)(ke,Ie.FLAT,100),Object(ee.a)(ke,Ie.INCREASED,75),ke)},Pe=function(){function e(t){Object(l.a)(this,e),this.config=void 0,this.clusterCenterData=void 0,this.config=t,this.clusterCenterData=new z}return Object(d.a)(e,[{key:"createSingle",value:function(e){var t=Ue({randInt:e.randInt,weights:Ge.SINGLE_COLORS}),n=Ue({randInt:Object(_e.b)(e.randInt),weights:Ge.SINGLE_MODIFIERS}),r=0;return r=n===Ie.FLAT?function(e){for(var t=e.randInt,n=e.formula,r=e.plus,i=void 0===r?0:r,a=parseInt(n.split("d")[0]),o=parseInt(n.split("d")[1]),c=0,u=0;u<a;u++)c+=Re({randInt:Object(_e.b)(t+u),min:1,max:o,inclusive:!0});return c+i}({randInt:Object(_e.b)(e.randInt+1),formula:"2d6",plus:8}):Re({randInt:Object(_e.b)(e.randInt+2),min:4,max:7,increment:.5,inclusive:!0}),{attribute:Te[t],amount:r,modifier:Ie[n]}}},{key:"createNoSpend",value:function(e){var t=this;return Ce({randInt:e.randInt,weights:Ge.DECISION_1,behaviors:{SINGLE:function(e){return{lines:[t.createSingle({randInt:e})]}},DOUBLE:function(e){return{lines:[t.createSingle({randInt:e}),t.createSingle({randInt:Object(_e.b)(e)})]}}}})}},{key:"create",value:function(e){var t,n=this,r=e.seed,i=e.location;if(i.equals(Ee.Zero))return{lines:[]};var a,o=i.moduloPositive(3).pairXY();return(t=o.equals(new M(1,2))||o.equals(new M(2,1))?i:i.divide(3).round().multiply(3)).equals(Ee.Zero)?{lines:[]}:Ce({randInt:Object(_e.b)(r+(a=t,a.x+a.y+Object(_e.b)(a.x+a.z))),weights:Ge.DECISION_0,behaviors:{EMPTY:function(e){return{lines:[]}},NO_SPEND:function(e){return n.createNoSpend({randInt:e})},SPEND:function(e){var t,r=n.createNoSpend({randInt:e}),i=Ue({randInt:e,weights:(t={},Object(ee.a)(t,Te.RED0,100),Object(ee.a)(t,Te.RED1,100),Object(ee.a)(t,Te.RED2,100),Object(ee.a)(t,Te.DEL0,0),Object(ee.a)(t,Te.DEL1,0),Object(ee.a)(t,Te.DEL2,0),t)});return Object(D.a)(Object(D.a)({},r),{},{condition:{type:"SPEND",amount:12,attribute:Te[i]}})}}})}}]),e}();var ze=(Ne={},Object(ee.a)(Ne,Te.RED0,"\ud83d\udd34"),Object(ee.a)(Ne,Te.RED1,"\ud83d\udfe2"),Object(ee.a)(Ne,Te.RED2,"\ud83d\udd35"),Object(ee.a)(Ne,Te.DEL0,"\u2694\ufe0f"),Object(ee.a)(Ne,Te.DEL1,"\ud83d\udee1"),Object(ee.a)(Ne,Te.DEL2,"\u2728"),Ne),Fe=[Te.RED0,Te.RED1,Te.RED2,Te.DEL0,Te.DEL1,Te.DEL2],He=(Me={"":8947848},Object(ee.a)(Me,Te.RED0,16711680),Object(ee.a)(Me,Te.RED1,65280),Object(ee.a)(Me,Te.RED2,255),Object(ee.a)(Me,Te.DEL0,5934984),Object(ee.a)(Me,Te.DEL1,16761856),Object(ee.a)(Me,Te.DEL2,16777027),Me),qe=(De={},Object(ee.a)(De,Te.RED0,"Red"),Object(ee.a)(De,Te.RED1,"Green"),Object(ee.a)(De,Te.RED2,"Blue"),Object(ee.a)(De,Te.DEL0,"Offense"),Object(ee.a)(De,Te.DEL1,"Defense"),Object(ee.a)(De,Te.DEL2,"Magic"),De),We={Red:Te.RED0,Green:Te.RED1,Blue:Te.RED2,Offense:Te.DEL0,Defense:Te.DEL1,Magic:Te.DEL2},Ve=(Ae={},Object(ee.a)(Ae,Ie.FLAT,"+"),Object(ee.a)(Ae,Ie.INCREASED,"%"),Ae),Be=(Le={},Object(ee.a)(Le,Ie.FLAT,"flat"),Object(ee.a)(Le,Ie.INCREASED,"increased"),Le),Xe={flat:Ie.FLAT,increased:Ie.INCREASED};function Ze(e){var t=qe[e.attribute],n=ze[e.attribute];return e.modifier===Ie.FLAT?"+".concat(e.amount," ").concat(n," (").concat(t,")"):"".concat(e.amount,"% increased ").concat(n," (").concat(t,")")}var Je="small";function Ke(e){return{playerUI:{virtualGridLocation:e.playerUI.virtualGridLocation,cursoredNodeLocation:e.playerUI.cursoredNodeLocation,strategicSearch:e.playerUI.strategicSearch},playerSave:{allocationStatusMap:e.playerSave.allocationStatusMap},computed:{fogOfWarStatusMap:e.computed.fogOfWarStatusMap,reachableStatusMap:e.computed.reachableStatusMap,lockStatusMap:e.computed.lockStatusMap},worldGen:{nodeContentsMap:e.worldGen.nodeContentsMap,lockMap:e.worldGen.lockMap}}}var Ye=E(Ke),Qe=new M(22,19),$e=new M(48,24),et=ae(function(e){Object(b.a)(n,e);var t=Object(O.a)(n);function n(e){var r;Object(l.a)(this,n),(r=t.call(this,e)).container=void 0,r.state=void 0,r.graphics=void 0,r.hexGrid=new F,r.state=r.useState(Object(A.a)(r),{phases:{}}).state,r.updateSelf(e),r.container=new R.b,r.graphics=new R.g,r.graphics.texture=e.args.textures.circle,r.graphics.tint=L.borderBlack,r.graphics.visible=!1,r.container.addChild(r.graphics);for(var i=-$e.y;i<=$e.y;i++)for(var a=-$e.x+Math.floor(i/2);a<=$e.x+Math.floor(i/2);a++){var o=new R.g;o.texture=e.args.textures.circle,o.tint=L.nodePink,o.position=q(e.appSize.divide(2).add(new M(Qe.x*a-Qe.x/2*i,-Qe.y*i))),r.container.addChild(o),r.hexGrid.put(new M(a,i),{node:o,animation:null,cursor:null,cursorAnimation:null})}return r}return Object(d.a)(n,[{key:"updateSelf",value:function(e){var t=this;e.gameState.playerUI.strategicSearch!==this._staleProps.gameState.playerUI.strategicSearch&&this.stateUpdaters.phases.enqueueUpdate((function(e){for(var t=Object(D.a)({},e),n=0,r=Object.keys(t);n<r.length;n++){var i=r[n];t[parseInt(i)]=0}return t}));var n,r=Object(y.a)(this.hexGrid.values());try{var i=function(){var e=n.value,r=e.node,i=e.animation;if(i){var a=((t.state.phases[i.periodSecs]||i.phase||0)+1/at*1*1/i.periodSecs)%1,o=1-Math.abs(2*a-1),c=1-(o<.5?o*o*2:1-2*(1-o)*(1-o));r.tint=K({target:i.max,base:i.min,proportion:c}),i.phase=a,t.stateUpdaters.phases.enqueueUpdate((function(e){var t=Object(D.a)({},e);return t[i.periodSecs]=a,t}))}if(e.cursor&&e.cursorAnimation){var u=e.cursorAnimation,s=((u.phase||0)+1/at*1*1/u.periodSecs)%1,l=1-Math.abs(2*s-1),d=1-l*l;e.cursor.tint=K({target:u.max,base:u.min,proportion:d}),u.phase=s}};for(r.s();!(n=r.n()).done;)i()}catch(a){r.e(a)}finally{r.f()}}},{key:"renderSelf",value:function(e){var t=this,n=e.gameState;this.container.position=q(e.args.position),this.graphics.position=q(e.appSize.divide(2));var r,i=Object(y.a)(this.hexGrid.entries());try{var a=function(){var i,a,o,u,s=Object(c.a)(r.value,2),l=s[0],d=s[1],h=d.node,p=e.appSize.divide(2).add(new M(Qe.x*l.x-Qe.x/2*l.y,-Qe.y*l.y)),v=0,f=n.playerUI.virtualGridLocation.add(Ee.FromVector2(l)),b=(null===(i=n.computed.fogOfWarStatusMap)||void 0===i?void 0:i.get(f))||xe.false,O=n.playerSave.allocationStatusMap.get(f)||Se.false,j=(null===(a=n.computed.reachableStatusMap)||void 0===a?void 0:a.get(f))||me.false,g=n.worldGen.lockMap.get(f),S=null===(o=n.computed.lockStatusMap)||void 0===o?void 0:o.get(f),x=!0;O.taken?(h.visible=!0,v=L.borderBlack):j.reachable?g&&S!==ge.OPEN?(h.visible=!0,v=L.nodePink):(h.visible=!0,v=L.nodeLavender):b.visible?(h.visible=!0,v=L.nodePink):(h.visible=!0,x=!1,v=L.nodePink),h.visible?(h.interactive=!0,h.buttonMode=!0,h.removeAllListeners(),h.on("pointerdown",(function(){console.log("pointerdown in strategic hex grid pixi",{nodeLocation:f}),e.updaters.playerUI.cursoredNodeLocation.enqueueUpdate((function(e){return console.log("enqueue update in pointerdown in strategic hex grid",{prev:e,nodeLocation:f}),e&&e.equals(f)?null:f}))}))):(h.interactive=!1,h.buttonMode=!1),b.visible?g&&S!==ge.OPEN?(h.texture=e.args.textures.rect,h.position=q(p),h.position.x-=e.args.textures.rect.width/2,h.position.y-=e.args.textures.rect.height/2):(h.texture=e.args.textures.circle,h.position=q(p),h.position.x-=e.args.textures.circle.width/2,h.position.y-=e.args.textures.circle.height/2):(h.texture=e.args.textures.dot,h.position=q(p),h.position.x-=e.args.textures.dot.width/2,h.position.y-=e.args.textures.dot.height/2);var m=n.worldGen.nodeContentsMap.get(f);if(x&&("Yes"===n.playerUI.strategicSearch.colors.enabled||"Only unallocated"===n.playerUI.strategicSearch.colors.enabled&&!O.taken)){var E=ye()(function(e){if(0===e.lines.length)return He[""];var t=He[e.lines[0].attribute];return 1===e.lines.length?t:K({color:t,opacity:.5,background:He[e.lines[1].attribute]})}(m)).lch(),w=ye()(v).lch();v=ye.a.lch(w[0],.5*(w[1]+E[1]),E[2]).num()}if(function(e){var t=e.nodeContents,n=e.query;if(!n)return!1;var r=n.highlight1.value.split(" ").filter((function(e){return!!e})).map((function(e){return e.slice(1,e.length-1)}));if(0===r.length)return!1;var i,a=null,o=Object(y.a)(r);try{for(o.s();!(i=o.n()).done;){var c,u,s,l,d=i.value,h=We[d],p=Xe[d];if(h){if((null===(c=t.lines)||void 0===c||null===(u=c[0])||void 0===u?void 0:u.attribute)!==h&&(null===(s=t.lines)||void 0===s||null===(l=s[1])||void 0===l?void 0:l.attribute)!==h){a=h;break}}else if(p){var v,f,b,O;if((null===(v=t.lines)||void 0===v||null===(f=v[0])||void 0===f?void 0:f.modifier)!==p&&(null===(b=t.lines)||void 0===b||null===(O=b[1])||void 0===O?void 0:O.modifier)!==p){a=p;break}}else{if("*"!==d)return console.error("unparsed term: ",d),!1;var j,g,S,x;if(!(null===(j=t.lines)||void 0===j||null===(g=j[0])||void 0===g?void 0:g.attribute)&&!(null===(S=t.lines)||void 0===S||null===(x=S[1])||void 0===x?void 0:x.attribute)){a=d;break}}}}catch(m){o.e(m)}finally{o.f()}if(a)return!1;return!0}({nodeContents:m,query:n.playerUI.strategicSearch})&&x){var k={max:K({color:v,opacity:.75,background:L.white}),min:v,periodSecs:2,mode:"start-max ease-in-out",phase:d.animation?d.animation.phase:0};d.animation=k}else h.tint=v,d.animation=null;if(null===(u=e.gameState.playerUI.cursoredNodeLocation)||void 0===u?void 0:u.equals(f)){if(!d.cursor){var T=new R.g;T.texture=e.args.textures.verticalLine,T.tint=L.borderWhite,t.container.addChild(T),d.cursor=T,d.cursorAnimation={max:L.borderWhite,min:K({color:L.borderWhite,opacity:.25,background:L.backgroundBlue}),periodSecs:1,mode:"start-max ease-in",phase:0}}}else d.cursor&&t.container.removeChild(d.cursor),d.cursor=null;d.cursor&&(d.cursor.position=q(p),d.cursor.position.x-=Qe.x/2,d.cursor.position.x+=e.args.textures.verticalLine.width/3,d.cursor.position.y-=e.args.textures.verticalLine.height/2)};for(i.s();!(r=i.n()).done;)a()}catch(o){i.e(o)}finally{i.f()}}},{key:"shouldUpdate",value:function(e,t,n,r){var i,a=Object(y.a)(Object.keys(e));try{for(a.s();!(i=a.n()).done;){var o=i.value;if("delta"!==o&&"args"!==o&&"updaters"!==o)if("gameState"!==o){if(e[o]!==n[o])return console.log("hexgrid shouldUpdate differed in ".concat(o,", returning true")),!0}else for(var c=e[o],u=n[o],s=Ye(c),l=Ye(u),d=0;d<s.length;d++)if(l[d]!==s[d])return console.log("hexgrid substate differed in ".concat(d," : ").concat(m(Ke)[d].join("."),", returning true for shouldupdate")),!0}}catch(h){a.e(h)}finally{a.f()}return!1}}]),n}(ie));var tt=ae(function(e){Object(b.a)(n,e);var t=Object(O.a)(n);function n(e){var r;Object(l.a)(this,n),(r=t.call(this,e)).container=void 0,r.state=void 0,r.stateUpdaters=void 0,r.fireStateUpdaters=void 0,r.fixedCameraStage=void 0,r.actionStage=void 0,r.backdropStage=void 0,r.strategicHexGrid=void 0,r.backdrop=void 0,r.onWheel=function(e){},r.onScroll=function(e){},r.container=new R.b,r.container.sortableChildren=!0,r.state=r.useState(Object(A.a)(r),{pointNodeTexture:new pe((function(){return function(e){for(var t=[],n=0;n<=8;n++){var r=n/8,i=new R.c;i.beginFill(L.white),i.drawRoundedRect(-he.NODE_SIZE_PX/2,-he.NODE_SIZE_PX/2,he.NODE_SIZE_PX,he.NODE_SIZE_PX,he.NODE_ROUNDED_PX);var a=new R.c;a.beginFill(L.black),a.drawRect(-he.NODE_SIZE_PX/2,-he.NODE_SIZE_PX/2,he.NODE_SIZE_PX,he.NODE_SIZE_PX*r),i.mask=a;var o=e.generateTexture(i,R.f.LINEAR,1);t.push({cropFraction:r,texture:o})}return t}(e.args.renderer)})),simpleTexture:new pe((function(){return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Je,n=new R.c,r="small"===t?12:"medium"===t?16:24;n.beginFill(L.white),n.drawCircle(0,0,r/2);var i=new R.c,a="small"===t?14:"medium"===t?18:30,o="small"===t?4:"medium"===t?5:8;i.beginFill(L.white),i.drawRect(0,0,o,a);var c=new R.c,u="small"===t?2:"medium"===t?3:4,s="small"===t||"medium"===t?6:8;c.beginFill(L.white),c.drawRect(0,0,u,a),c.drawRect(0,0,s,u),c.drawRect(0,a-u,s,u);var l=new R.c;l.beginFill(L.white),l.drawRect(0,0,r,r);var d=new R.c;return d.beginFill(L.white),d.drawCircle(0,0,r/4),{circle:e.generateTexture(n,R.f.LINEAR,1),rect:e.generateTexture(i,R.f.LINEAR,1),square:e.generateTexture(l,R.f.LINEAR,1),verticalLine:e.generateTexture(c,R.f.LINEAR,1),dot:e.generateTexture(d,R.f.LINEAR,1)}}(e.args.renderer)})),tick:0,playerCurrentZ:0,tooltip:{visible:!1,position:void 0,text:""}}).state;var i=function(e,t){return{args:{renderer:e.args.renderer,markForceUpdate:r.markForceUpdate},delta:e.delta,gameState:e.gameState,appSize:e.appSize,tick:t.tick,tooltip:Object(D.a)({},t.tooltip)}};r.fixedCameraStage=new Oe(i(e,r.state)),r.addChild({childClass:Oe,instance:r.fixedCameraStage,propsFactory:i}),r.actionStage=new R.g,r.actionStage.zIndex=0,r.actionStage.sortableChildren=!0,r.container.addChild(r.actionStage);var a=function(e,t){var n=e.gameState;return{delta:e.delta,args:{position:M.Zero,textures:t.simpleTexture.get()},updaters:e.updaters,appSize:e.appSize,gameState:Ke(n)}};return r.strategicHexGrid=new et(a(e,r.state)),r.addChild({childClass:et,instance:r.strategicHexGrid,propsFactory:a}),r.backdropStage=new R.g,r.backdropStage.zIndex=-1,r.backdropStage.sortableChildren=!0,r.container.addChild(r.backdropStage),r.backdrop=new R.c,r.backdropStage.addChild(r.backdrop),r.backdrop.beginFill(L.backgroundBlue,1),r.backdrop.interactive=!0,r.backdrop.drawRect(0,0,e.appSize.x,e.appSize.y),r}return Object(d.a)(n,[{key:"updateSelf",value:function(e){this.stateUpdaters.tick.enqueueUpdate((function(e){return e+1}))}},{key:"renderSelf",value:function(e){this.backdrop.width=e.appSize.x,this.backdrop.height=e.appSize.y}},{key:"didMount",value:function(){var e=this._staleProps.args.canvasElement;e.addEventListener("wheel",this.onWheel),e.addEventListener("scroll",this.onScroll)}},{key:"didUpdate",value:function(){}},{key:"willUnmount",value:function(){var e=this._staleProps.args.canvasElement;e.removeEventListener("wheel",this.onWheel),e.removeEventListener("scroll",this.onScroll)}}]),n}(ie)),nt=function(){return{orientation:"original",innerWidth:window.innerWidth,innerHeight:window.innerHeight}};function rt(e){return new M({x:Math.min(2560,((null===e||void 0===e?void 0:e.x)||1/0)-24),y:Math.min(1440,((null===e||void 0===e?void 0:e.y)||1/0)-24)})}var it=new M(800,600),at=60,ot=function(){function e(t){var n;Object(l.a)(this,e),this.app=void 0,this.state=void 0,this.props=void 0,this.staleProps=void 0,this.rootComponent=null,this.onTick=void 0,null===t||void 0===t||null===(n=t.args)||void 0===n||n.isSecondConstructorCall;var r=it;this.state={appSize:r,originalAppSize:r},this.app=new R.a({width:this.state.appSize.x,height:this.state.appSize.y,antialias:!0,transparent:!0,resolution:window.devicePixelRatio||1,autoDensity:!0,powerPreference:"low-power",backgroundColor:L.white})}return Object(d.a)(e,[{key:"pause",value:function(){this.app.ticker.remove(this.onTick)}},{key:"destroy",value:function(){this.app.destroy(!0,{children:!0,texture:!0,baseTexture:!0})}},{key:"didMount",value:function(){var e=this;this.onTick=function(t){return e.baseGameLoop(t)},this.onTick=this.onTick.bind(this),this.app.ticker.add(this.onTick),this.state.appSize=rt(new M(this.props.gameState.windowState.innerWidth,this.props.gameState.windowState.innerHeight))}},{key:"register",value:function(e){e.appendChild(this.app.view)}},{key:"updateSelf",value:function(e,t){e!==t?(e.gameState.windowState.innerWidth===(null===t||void 0===t?void 0:t.gameState.windowState.innerWidth)&&e.gameState.windowState.innerHeight===(null===t||void 0===t?void 0:t.gameState.windowState.innerHeight)||(this.state.appSize=rt(new M(e.gameState.windowState.innerWidth,e.gameState.windowState.innerHeight))),e.updaters.tick.enqueueUpdate((function(e){return e+1}))):e.updaters.tick.enqueueUpdate((function(e){return e+1}))}},{key:"rerender",value:function(e){this.rootComponent&&this.props===e||(this.props=e,this.rootComponent||(this.rootComponent=new tt({args:{renderer:this.app.renderer,markForceUpdate:function(){},canvasElement:this.app.view},updaters:this.props.updaters,delta:0,gameState:this.props.gameState,appSize:this.state.appSize}),this.app.stage.addChild(this.rootComponent.container),this.renderSelf(this.props),this.didMount()))}},{key:"renderSelf",value:function(e){this.app.renderer.resize(this.state.appSize.x,this.state.appSize.y)}},{key:"baseGameLoop",value:function(e){var t;if(this.props.gameState.playerUI.isPixiHidden&&this.props.gameState.tick%60!==0)return this.props.updaters.tick.enqueueUpdate((function(e){return e+1})),void this.props.args.fireBatch();this.updateSelf(this.props,this.staleProps),null===(t=this.rootComponent)||void 0===t||t.update({args:{renderer:this.app.renderer,markForceUpdate:function(){},canvasElement:this.app.view},updaters:this.props.updaters,delta:e,gameState:this.props.gameState,appSize:this.state.appSize}),this.renderSelf(this.props),this.staleProps=this.props,this.props.args.fireBatch()}}]),e}(),ct=new pe((function(){return new ot}));function ut(e){var t=Object(r.useState)(ct.get()),n=Object(c.a)(t,1)[0],i=Object(r.useRef)(null),a=Object(r.useContext)(U),o=Object(c.a)(a,3),u=o[0],s=o[1],l=o[2];return Object(r.useEffect)((function(){for(var e=i.current.childNodes.length-1;e>=0;e--)i.current.removeChild(i.current.childNodes[e]);i.current.appendChild(n.app.view)}),[n]),Object(r.useEffect)((function(){n.rerender({args:{fireBatch:l,isSecondConstructorCall:!1},updaters:s,gameState:u})}),[n,l,s,u]),Object(p.jsx)(p.Fragment,{children:Object(p.jsx)("div",{ref:i,hidden:e.hidden,style:{}})})}var st,lt=function(e){Object(b.a)(n,e);var t=Object(O.a)(n);function n(e){var r;return Object(l.a)(this,n),(r=t.call(this,e)).handleWindowResize=function(e){var t={innerWidth:window.innerWidth,innerHeight:window.innerHeight};r.props.updaters.enqueueUpdate((function(e){return Object(D.a)(Object(D.a)({},e),t)}))},r.state={},r}return Object(d.a)(n,[{key:"componentDidMount",value:function(){window.addEventListener("resize",this.handleWindowResize),window.addEventListener("orientationchange",this.handleWindowResize)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.handleWindowResize),window.removeEventListener("orientationchange",this.handleWindowResize)}},{key:"render",value:function(){return Object(p.jsx)(p.Fragment,{children:" "})}}]),n}(i.a.Component),dt=function(){return{allocationStatusMap:new F([[Ee.Zero,Se.true]])}},ht=function(e){return JSON.stringify(function(e){return Object(D.a)(Object(D.a)({},e),{},{allocationStatusMap:F.SerializeToObject(e.allocationStatusMap,Ee.SerializeToObject)})}(e))},pt=function(e){return function(e){if(!e||!e.hasOwnProperty("allocationStatusMap"))return console.error("Failed deserializing PlayerSaveState: ",e),null;var t=F.Deserialize(e.allocationStatusMap,(function(e){var t=Ee.Deserialize(e);if(!t)throw new k("Failed deserializing vector3 ".concat(JSON.stringify(e)));return t}));return t?Object(D.a)(Object(D.a)({},e),{},{allocationStatusMap:t}):(console.error("Failed deserializing PlayerSaveState: ",e),null)}(JSON.parse(e))},vt="PlayerSaveState",ft=function(){var e=window.localStorage.getItem(vt);return e&&pt(e)||null},bt=dt,Ot=function(){var e=ft();return e||(console.log("Failed to load PlayerSaveState"),dt())},jt=function(e){var t=ht(e);window.localStorage.setItem(vt,t)},yt=function(){window.localStorage.setItem(vt,"")};function gt(e){var t={};return t.EAST=e.addX(1),t.WEST=e.addX(-1),t.NORTHWEST=e.addY(1),t.SOUTHEAST=e.addY(-1),t.NORTHEAST=e.add(1,1,0),t.SOUTHWEST=e.add(-1,-1,0),t}function St(e,t,n,r){var i=new P,a=new P;i.put(e);for(var o=[[e]],c=1;c<=t;c++){o.push([]);var u,s=Object(y.a)(o[c-1]);try{for(s.s();!(u=s.n()).done;)for(var l=u.value,d=Object.values(gt(l)),h=0,p=d;h<p.length;h++){var v=p[h];v&&(i.get(v)||((null===r||void 0===r?void 0:r.contains(v))?a.put(v):(i.put(v),o[c].push(v))))}}catch(O){s.e(O)}finally{s.f()}}for(var f=[],b=n||0;b<=t;b++)f=f.concat(o[b]);return f=f.concat(a.values())}!function(e){e.NORTHWEST="NORTHWEST",e.SOUTHWEST="SOUTHWEST",e.NORTHEAST="NORTHEAST",e.SOUTHEAST="SOUTHEAST",e.EAST="EAST",e.WEST="WEST",e.UP="UP",e.DOWN="DOWN"}(st||(st={}));var xt=function(){function e(t){Object(l.a)(this,e),this.config=void 0,this.config=t}return Object(d.a)(e,[{key:"create",value:function(e){var t=Object(_e.b)(e.seed+e.location.x+e.location.y+Object(_e.b)(e.seed+e.location.x+e.location.z))/_e.a,n={shortTextTarget:"\ud83d\udd12",shortTextTimer:"",lockStatus:ge.TICKING};if(!e.location.equals(Ee.Zero))return t<.47?n:void 0}}]),e}(),mt="WorldGenState",Et=function(){function e(t){Object(l.a)(this,e),this.config=void 0,this.config=t}return Object(d.a)(e,[{key:"create",value:function(e){var t=e.seed,n=new xt({}),r=new be((function(e){return n.create({seed:t,location:e})})),i=new Pe({}),a=new be((function(e){return i.create({seed:t,location:e})}));return{seed:t,lockMap:r,nodeContentsMap:a}}},{key:"tryLoad",value:function(e){var t=this.load();return t?this.create(t):this.create(e)}},{key:"store",value:function(e){var t=this.serialize(e);window.localStorage.setItem(mt,t)}},{key:"load",value:function(){var e=window.localStorage.getItem(mt);return e&&this.deserialize(e)||null}},{key:"deserialize",value:function(e){return this.deserializeFromObject(JSON.parse(e))}},{key:"deserializeFromObject",value:function(e){return e&&e.hasOwnProperty("seed")?Object(D.a)({},e):null}},{key:"serialize",value:function(e){return JSON.stringify(this.serializeToObject(e))}},{key:"serializeToObject",value:function(e){return{seed:e.seed}}},{key:"clear",value:function(){window.localStorage.setItem(mt,"")}}]),e}(),wt=function(){function e(t){Object(l.a)(this,e),this.updaters=void 0,this.updaters=t}return Object(d.a)(e,[{key:"enqueueAction",value:function(e){var t,n,r,i=e.nodeLocation,a=e.newStatus;this.updaters.playerSave.allocationStatusMap.enqueueUpdate((function(e){return e.put(i,a),e.clone()})),null===(t=this.updaters.computed.lockStatusMap)||void 0===t||t.enqueueUpdate((function(e,t){if(!e)return e;var n,r=Object(y.a)(t.worldGen.lockMap.entries());try{for(r.s();!(n=r.n()).done;){var i=Object(c.a)(n.value,2),a=i[0];if(i[1]){var o=ge.TICKING;e.put(a,o)}}}catch(u){r.e(u)}finally{r.f()}return e.clone()})),null===(n=this.updaters.computed.reachableStatusMap)||void 0===n||n.enqueueUpdate((function(e){return e?(St(i,1).forEach((function(t){e.put(t,me.true)})),e.clone()):e})),null===(r=this.updaters.computed.fogOfWarStatusMap)||void 0===r||r.enqueueUpdate((function(e,t){return e?(e.put(i,xe.true),St(i,1).forEach((function(t){e.put(t,xe.true)})),St(i,5,0,{contains:function(e){var n,r=null===(n=t.computed.lockStatusMap)||void 0===n?void 0:n.get(e);return!(!r||r===ge.OPEN)}}).forEach((function(n){var r;(null===(r=e.get(n))||void 0===r?void 0:r.visible)||(t.worldGen.lockMap.precompute(n),e.put(n,xe.true))})),e.clone()):e}))}}]),e}(),kt=(n(252),i.a.memo(Tt));function Tt(e){var t=e.hexGridPx,n=e.borderWidth,i=e.hexCenterRadius,a=e.appSize,o=e.COLORS;return Object(r.useEffect)((function(){document.documentElement.style.setProperty("--grid-width"," ".concat(t.x,"px")),document.documentElement.style.setProperty("--grid-height"," ".concat(t.y,"px")),document.documentElement.style.setProperty("--hex-center-radius"," ".concat(i,"px")),document.documentElement.style.setProperty("--border-width"," ".concat(n,"px"))}),[t,i,n]),Object(r.useEffect)((function(){document.documentElement.style.setProperty("--background-black",G(o.backgroundBlue)),document.documentElement.style.setProperty("--deemphasized-black",G(o.grayBlack)),document.documentElement.style.setProperty("--active-purple",G(o.nodePink)),document.documentElement.style.setProperty("--border-unimportant-black",G(o.borderBlack)),document.documentElement.style.setProperty("--border-important-white",G(o.borderWhite)),document.documentElement.style.setProperty("--text-readable-white",G(o.textWhite))}),[o]),Object(r.useEffect)((function(){document.documentElement.style.setProperty("--app-size-width"," ".concat(a.x,"px")),document.documentElement.style.setProperty("--app-size-height"," ".concat(a.y,"px"))}),[a]),Object(p.jsx)(p.Fragment,{children:e.children})}n(136),n(78);var It="The starting node.";function _t(e){var t=e.location,n=e.gameState.computed,r=n.fogOfWarStatusMap,i=n.reachableStatusMap,a=e.gameState.playerSave.allocationStatusMap,o=e.gameState.worldGen,c=o.lockMap,u=o.nodeContentsMap,s=null===r||void 0===r?void 0:r.get(t),l=null===i||void 0===i?void 0:i.get(t),d=a.get(t),h=(null===d||void 0===d?void 0:d.taken)?ve.TAKEN:(null===l||void 0===l?void 0:l.reachable)?ve.AVAILABLE:(null===s||void 0===s?void 0:s.visible)?ve.UNREACHABLE:ve.HIDDEN,v=t.hash(),f=c.get(t),b=u.get(t),O="";t.equals(Ee.Zero)?O="\ud83d\udea9":b.lines[0]?(O+=Ve[b.lines[0].modifier],O+=ze[b.lines[0].attribute]):O="",b.lines[1]&&b.lines[0].attribute!==b.lines[1].attribute&&(O+=ze[b.lines[1].attribute]);var j="";b.condition&&(j="-"+ze[b.condition.attribute]);var y=Object(p.jsxs)(p.Fragment,{children:[" ",h.toString()]});return f?h===ve.AVAILABLE?y=Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)("div",{children:"LOCKED"}),Object(p.jsx)("br",{}),Object(p.jsx)("div",{children:"Locks are currently WIP!"})]}):h===ve.UNREACHABLE&&(y=Object(p.jsxs)(p.Fragment,{children:[Object(p.jsxs)("div",{children:["LOCKED, ",h.toString()]}),Object(p.jsx)("br",{}),Object(p.jsx)("div",{children:"Locks are currently WIP!"})]})):h===ve.AVAILABLE?y=Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)("div",{children:h.toString()}),Object(p.jsx)("br",{}),Object(p.jsx)("div",{children:"Click to allocate."})]}):t.equals(Ee.Zero)&&(y=Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)("div",{children:h.toString()}),Object(p.jsx)("br",{}),Object(p.jsx)("div",{children:It})]})),{nodeLocation:t,shortText:j?Object(p.jsxs)(p.Fragment,{children:[O,Object(p.jsx)("br",{}),j]}):Object(p.jsx)(p.Fragment,{children:O}),toolTipText:Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)("div",{children:y}),b.lines[0]?Object(p.jsx)("br",{}):Object(p.jsx)(p.Fragment,{}),Ct(b)]}),nodeContents:b,fullText:Object(p.jsx)(p.Fragment,{children:" "}),status:h,lockData:f,id:v}}function Ct(e){return Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)("div",{children:e.lines[0]&&Ze(e.lines[0])}),Object(p.jsx)("div",{children:e.lines[1]&&Ze(e.lines[1])}),Object(p.jsx)("div",{children:e.condition&&(t=e.condition,"SPEND: ".concat(t.amount," ").concat(qe[t.attribute]))})]});var t}n(253);var Ut=i.a.memo(Rt);function Rt(e){var t=e.id,n=e.onUpdateStatus,i=e.nodeData,a=e.isCursored,o=e.onUpdateCursored,c=(e.debugIsCursored,i.nodeLocation),u=Object(r.useCallback)((function(e){e.stopPropagation(),e.preventDefault(),i.status===ve.AVAILABLE?n({nodeLocation:c,newStatus:ve.TAKEN}):o(a?null:c)}),[n,c,i,a,o]),s=Object(r.useCallback)((function(e){e.stopPropagation(),e.preventDefault(),o(a?null:c)}),[a,o,c]);return Object(p.jsx)(Nt,{id:t,onClickCenter:u,nodeData:i,onClickQuestionMark:s,isCursored:a},t)}var Nt=i.a.memo(Mt);function Mt(e){var t,n,i=e.id,a=e.onClickCenter,o=e.onClickQuestionMark,u=e.nodeData,l=e.isCursored,d=(e.debugIsCursored,u.status),h=!!u.lockData,v=Object(r.useState)(!1),f=Object(c.a)(v,2),b=f[0],O=f[1],j=function(e){console.log("got pointer enter on ".concat(i)),O(!0)},y=function(e){console.log("got pointer leave on ".concat(i)),O(!1)};return Object(p.jsxs)("div",{className:"hex-block hex-full-block",id:i,children:[Object(p.jsx)("div",{className:s()("hex-center",d===ve.TAKEN?"node-allocated":"node-unallocated",d===ve.TAKEN||d===ve.UNREACHABLE?"border-unimportant":"border-important",d===ve.AVAILABLE?"node-available":""),onClick:a,onDoubleClick:function(){console.log("double clicked")},onPointerEnter:j,onPointerLeave:y,hidden:d===ve.HIDDEN,children:Object(p.jsx)("div",{className:"hex-center-text-wrapper",children:Object(p.jsx)("div",{className:"tiny-text",children:u.shortText})})}),h?Object(p.jsxs)("div",{className:"hex-center-lock",hidden:d===ve.HIDDEN,onClick:a,onDoubleClick:function(){console.log("double clicked")},onPointerEnter:j,onPointerLeave:y,children:[Object(p.jsx)("div",{className:"hex-center-lock-left",children:Object(p.jsx)("div",{className:"tiny-text",children:null===(t=u.lockData)||void 0===t?void 0:t.shortTextTarget})}),Object(p.jsx)("div",{className:"hex-center-lock-right",children:Object(p.jsx)("div",{className:"tiny-text",children:null===(n=u.lockData)||void 0===n?void 0:n.shortTextTimer})})]}):null,Object(p.jsx)("div",{className:"empty-positioned node-tooltip-wrapper",children:Object(p.jsx)("div",{className:"absolute-positioned node-tooltip",hidden:!b,children:u.toolTipText})}),Object(p.jsx)("div",{className:"empty-positioned",children:Object(p.jsx)("div",{className:"hover-only-2 absolute-positioned",children:Object(p.jsx)("div",{className:"question",hidden:d===ve.HIDDEN,onClick:o,children:"?"})})}),Object(p.jsx)("div",{className:"empty-positioned selection-cursor-wrapper",children:Object(p.jsx)("div",{className:"absolute-positioned selection-cursor",hidden:!l})})]},i)}function Dt(e){return{playerUI:{cursoredNodeLocation:e.playerUI.cursoredNodeLocation},playerSave:{allocationStatusMap:e.playerSave.allocationStatusMap},worldGen:{nodeContentsMap:e.worldGen.nodeContentsMap,lockMap:e.worldGen.lockMap},computed:{fogOfWarStatusMap:e.computed.fogOfWarStatusMap,reachableStatusMap:e.computed.reachableStatusMap,lockStatusMap:e.computed.lockStatusMap}}}var At=E(Dt),Lt=i.a.memo(Gt);function Gt(e){var t,n=e.gameState,i=e.virtualGridDims,a=e.virtualCoordsToLocation,o=e.updateNodeStatusByLocationCb,c=e.cursoredVirtualNode,u=e.setCursoredLocation,s=e.debug,l=+new Date;null===s||void 0===s||s.rerenderGameAreaGrid();var d=(null===s||void 0===s||null===(t=s.isFlipCursored)||void 0===t?void 0:t.call(s))||!1,h=Object(r.useMemo)((function(){return new be((function(e){return _t({location:e,gameState:n})}))}),[n]),v=Object(p.jsx)(p.Fragment,{children:Array(i.y).fill(0).map((function(e,t){return Object(p.jsx)(Pt,{rowIdx:t,children:Array(i.x).fill(0).map((function(e,n){var r=new M(n,t),i=a(r),s=h.get(i),l=!!c&&c.equals(r),v=s.id||"loading".concat(n);return Object(p.jsx)(Ut,{id:v,nodeData:s,onUpdateStatus:o,isCursored:l,debugIsCursored:d?!l:l,onUpdateCursored:u},v)}))},a(new M(0,t)).y.toString())}))}),f=+new Date,b=f-l;return console.log("Game area grid elapsed ".concat(b,"ms at ").concat(f)),v}var Pt=i.a.memo(zt);function zt(e){var t=e.rowIdx,n=e.children,r=!!(t%2);return Object(p.jsxs)("div",{className:"hex-block-row",children:[r&&Object(p.jsx)("div",{className:"hex-block hex-half-block"}),n,!r&&Object(p.jsx)("div",{className:"hex-block hex-half-block"})]})}var Ft=i.a.memo(Ht);function Ht(e){var t=e.hexGridPx,n=e.virtualGridDims,i=e.appSize,a=e.updaters,o=e.triggerScrollRecenterCb,u=e.keyboardScrollDirection,l=e.debug,d=Object(r.useRef)(null),h=Object(r.useState)(new M(0,0)),v=Object(c.a)(h,2),f=v[0],b=v[1];Object(r.useEffect)((function(){if(d.current){o();var e=function(e){var t=e.virtualGridDims,n=e.hexGridPx,r=t.divide(2).floor(),i=(r.y+.5)*n.y,a=(r.x+.5)*n.x;return r.y%2===1&&(a+=.5*n.x),new M(a,i)}({virtualGridDims:n,hexGridPx:t});d.current.scrollTop=e.y-i.y/2,d.current.scrollLeft=e.x-i.x/2}}),[i,n,t,o]),Object(r.useEffect)((function(){if(f){var e=d.current;e&&e.scrollTo(e.scrollLeft-f.x*t.x,e.scrollTop-f.y*t.y)}}),[f,t]);var O=Object(r.useCallback)((function(e){var t=new M(e.direction.x,-1*e.direction.y);e.direction.x===e.direction.y&&(t=new M(0,-1*e.direction.y));var n=new M(t.x,0).add(new M(-.5,-1).multiply(t.y));a.playerUI.virtualGridLocation.enqueueUpdate((function(e){return e.add(Ee.FromVector2(t,0))})),b(n)}),[a]),j=l.getForceJumpOffset;Object(r.useEffect)((function(){var e=null===j||void 0===j?void 0:j();e&&a.playerUI.virtualGridLocation.enqueueUpdate((function(t){return t.addX(e.x).add(new Ee(-1,-2,0).multiply(e.y/2))}))}),[a,j]);var y=l.enableScrollJump,g=Object(r.useCallback)((function(e){if(y){var r={x:0,y:0},a=e.target,o=a.scrollTop,c=a.scrollLeft;a.scrollTop<.9*t.y&&(o+=2*t.y,r.y-=1),a.scrollTop>(n.y-.9)*t.y-i.y&&(o-=2*t.y,r.y+=1),a.scrollLeft<.9*t.x&&(c+=2*t.x,r.x-=1),a.scrollLeft>(n.x-.9)*t.x-i.x&&(c-=2*t.x,r.x+=1),a.scrollTop===o&&a.scrollLeft===c||O({direction:new M(r.x,r.y)})}}),[i,O,t,n,y]);return Object(r.useEffect)((function(){if(!u.equals(M.Zero)){var e=null,t=function(){var t=d.current;if(t){var n=M.Zero;if(null===e)n=u.multiply(8),e=+new Date;else{var r=+new Date-e;r>40&&console.log("WAS SLOW - "+r.toString()),n=u.multiply(r),e=+new Date}n=n.multiply(.75),t.scrollTo(t.scrollLeft+n.x,t.scrollTop-n.y)}},n=setInterval(t,8);return t(),function(){return clearInterval(n)}}}),[u]),Object(p.jsx)("div",{ref:d,className:s()({"game-area":!0,"hidden-scrollbars":!(null===l||void 0===l?void 0:l.debugShowScrollbars)}),hidden:e.hidden,onScroll:g,children:Object(p.jsx)("div",{className:"virtual-game-area",children:e.children})})}var qt=i.a.memo(Wt);function Wt(e){var t=e.gameState,n=e.hexGridPx,i=e.appSize,a=e.virtualGridDims,o=Object(r.useCallback)((function(e){return function(e){var t=e.virtualCoords,n=e.virtualGridLocation,r=e.virtualGridDims.divide(2).floor(),i=t.subtract(r),a=M.Zero;return a=(a=i.y%2===0?new M(-1,-2).multiply(i.y/2):r.y%2===0?new M(0,-1).add(new M(-1,-2).multiply((i.y-1)/2)):new M(-1,-1).add(new M(-1,-2).multiply((i.y-1)/2))).addX(i.x),n.add(Ee.FromVector2(a,0))}({virtualCoords:e,virtualGridDims:a,virtualGridLocation:t.playerUI.virtualGridLocation})}),[t.playerUI.virtualGridLocation,a]),c=Object(r.useCallback)((function(e){return function(e){var t=e.location,n=e.virtualGridLocation,r=e.virtualGridDims.divide(2).floor(),i=t.subtract(n),a=M.Zero;return 0!==i.z?null:(a=(a=i.y%2===0?new M(-1,-2).multiply(i.y/2):r.y%2===0?new M(-1,-1).add(new M(-1,-2).multiply((i.y-1)/2)):new M(0,-1).add(new M(-1,-2).multiply((i.y-1)/2))).addX(i.x),r.add(a))}({location:e,virtualGridDims:a,virtualGridLocation:t.playerUI.virtualGridLocation})}),[t.playerUI.virtualGridLocation,a]),u=Object(r.useCallback)((function(n){var r,i,a=n.nodeLocation,o=n.newStatus,c=(null===(r=t.computed.reachableStatusMap)||void 0===r?void 0:r.get(a))||me.false;if(o===ve.TAKEN){if(c!==me.true)return void console.log("cant do that, not reachable:",c);var u=t.worldGen.lockMap.get(a);if(u)return void console.log("is locked",u)}(null===(i=t.playerSave.allocationStatusMap.get(a))||void 0===i?void 0:i.taken)||e.actions.allocateNode.enqueueAction({nodeLocation:a,newStatus:Se.true})}),[e.actions,t.playerSave.allocationStatusMap,t.computed.reachableStatusMap,t.worldGen.lockMap]),s=Object(r.useCallback)((function(e){var t=e.virtualCoords,n=e.newStatus,r=o(t);u({nodeLocation:r,newStatus:n})}),[o,u]),l=Object(r.useCallback)((function(t){e.updaters.playerUI.cursoredNodeLocation.enqueueUpdate((function(e){return t})),t&&(e.updaters.playerUI.isSidebarOpen.enqueueUpdate((function(){return!0})),e.updaters.playerUI.isLeftSidebarOpen.enqueueUpdate((function(){return!0})),e.updaters.playerUI.isRightSidebarOpen.enqueueUpdate((function(){return!0})))}),[e.updaters]),d=Object(r.useMemo)((function(){return t.playerUI.cursoredNodeLocation?c(t.playerUI.cursoredNodeLocation):null}),[t.playerUI.cursoredNodeLocation,c]),h=Object(r.useCallback)((function(){e.updaters.playerUI.virtualGridLocation.enqueueUpdate((function(e,t){var n=t.playerUI.cursoredNodeLocation,r=e;return t.playerUI.isPixiHidden?n&&(Math.abs(n.y-r.y)>=2||Math.abs(n.x-n.y/2-(r.x-r.y/2))>=4)?n:e:n&&(Math.abs(n.y-r.y)>=16||Math.abs(n.x-n.y/2-(r.x-r.y/2))>=32)?n:e}))}),[e.updaters]);Object(r.useEffect)((function(){var t=o(a.divide(2).floor());e.gameState.intent.newIntent.MOVE_CURSOR_EAST&&(e.updaters.playerUI.cursoredNodeLocation.enqueueUpdate((function(e){return(null===e||void 0===e?void 0:e.addX(1))||t})),h()),e.gameState.intent.newIntent.MOVE_CURSOR_WEST&&(e.updaters.playerUI.cursoredNodeLocation.enqueueUpdate((function(e){return(null===e||void 0===e?void 0:e.addX(-1))||t})),h()),e.gameState.intent.newIntent.MOVE_CURSOR_NORTHEAST&&(e.updaters.playerUI.cursoredNodeLocation.enqueueUpdate((function(e){return(null===e||void 0===e?void 0:e.add({x:1,y:1,z:0}))||t})),h()),e.gameState.intent.newIntent.MOVE_CURSOR_NORTHWEST&&(e.updaters.playerUI.cursoredNodeLocation.enqueueUpdate((function(e){return(null===e||void 0===e?void 0:e.addY(1))||t})),h()),e.gameState.intent.newIntent.MOVE_CURSOR_SOUTHEAST&&(e.updaters.playerUI.cursoredNodeLocation.enqueueUpdate((function(e){return(null===e||void 0===e?void 0:e.addY(-1))||t})),h()),e.gameState.intent.newIntent.MOVE_CURSOR_SOUTHWEST&&(e.updaters.playerUI.cursoredNodeLocation.enqueueUpdate((function(e){return(null===e||void 0===e?void 0:e.add({x:-1,y:-1,z:0}))||t})),h()),e.gameState.intent.newIntent.MOVE_CURSOR_SOUTH&&(e.updaters.playerUI.cursoredNodeLocation.enqueueUpdate((function(e){return e&&e.y%2===0?null===e||void 0===e?void 0:e.add({x:0,y:-1,z:0}):e&&e.y%2!==0?null===e||void 0===e?void 0:e.add({x:-1,y:-1,z:0}):t})),h()),e.gameState.intent.newIntent.MOVE_CURSOR_NORTH&&(e.updaters.playerUI.cursoredNodeLocation.enqueueUpdate((function(e){return e&&e.y%2===0?null===e||void 0===e?void 0:e.add({x:1,y:1,z:0}):e&&e.y%2!==0?null===e||void 0===e?void 0:e.add({x:0,y:1,z:0}):t})),h()),e.gameState.intent.newIntent.MOVE_CURSOR_NORTHNORTH&&(e.updaters.playerUI.cursoredNodeLocation.enqueueUpdate((function(e){return(null===e||void 0===e?void 0:e.add({x:1,y:2,z:0}))||t})),h()),e.gameState.intent.newIntent.MOVE_CURSOR_SOUTHSOUTH&&(e.updaters.playerUI.cursoredNodeLocation.enqueueUpdate((function(e){return(null===e||void 0===e?void 0:e.add({x:-1,y:-2,z:0}))||t})),h()),e.gameState.intent.newIntent.INTERACT_WITH_NODE&&d&&s({virtualCoords:d,newStatus:ve.TAKEN})}),[e.gameState.intent.newIntent.INTERACT_WITH_NODE,e.gameState.intent.newIntent.MOVE_CURSOR_EAST,e.gameState.intent.newIntent.MOVE_CURSOR_NORTH,e.gameState.intent.newIntent.MOVE_CURSOR_NORTHNORTH,e.gameState.intent.newIntent.MOVE_CURSOR_NORTHEAST,e.gameState.intent.newIntent.MOVE_CURSOR_NORTHWEST,e.gameState.intent.newIntent.MOVE_CURSOR_SOUTH,e.gameState.intent.newIntent.MOVE_CURSOR_SOUTHSOUTH,e.gameState.intent.newIntent.MOVE_CURSOR_SOUTHEAST,e.gameState.intent.newIntent.MOVE_CURSOR_SOUTHWEST,e.gameState.intent.newIntent.MOVE_CURSOR_WEST,e.updaters,o,a,d,s,h]),Object(r.useEffect)((function(){if(e.gameState.intent.newIntent.ZOOM_RECENTER_AT_NODE){var n=t.playerUI.cursoredNodeLocation;n&&(e.updaters.playerUI.virtualGridLocation.enqueueUpdate((function(e){return n})),e.updaters.playerUI.triggerScrollRecenterCb.enqueueUpdate((function(){return function(){console.log("zoomed to location: ",{location:n})}})))}}),[e.gameState.intent.newIntent.ZOOM_RECENTER_AT_NODE,t.playerUI.cursoredNodeLocation,e.updaters]);var v=Object(r.useMemo)((function(){var t=M.Zero;return e.gameState.intent.activeIntent.PAN_EAST&&(t=t.addX(1)),e.gameState.intent.activeIntent.PAN_WEST&&(t=t.addX(-1)),e.gameState.intent.activeIntent.PAN_NORTH&&(t=t.addY(1)),e.gameState.intent.activeIntent.PAN_SOUTH&&(t=t.addY(-1)),t}),[e.gameState.intent.activeIntent.PAN_EAST,e.gameState.intent.activeIntent.PAN_WEST,e.gameState.intent.activeIntent.PAN_NORTH,e.gameState.intent.activeIntent.PAN_SOUTH]),f=Object(r.useMemo)((function(){return{debugShowScrollbars:t.debug.debugShowScrollbars,enableScrollJump:t.debug.enableScrollJump,getForceJumpOffset:t.debug.getForceJumpOffset}}),[t.debug.debugShowScrollbars,t.debug.enableScrollJump,t.debug.getForceJumpOffset]),b=Object(r.useMemo)((function(){return{rerenderGameAreaGrid:t.debug.rerenderGameAreaGrid,getOffsetX:t.debug.getOffsetX,isFlipCursored:t.debug.isFlipCursored}}),[t.debug.rerenderGameAreaGrid,t.debug.getOffsetX,t.debug.isFlipCursored]),O=Object(r.useMemo)((function(){return Dt(t)}),At(t));return Object(p.jsx)(p.Fragment,{children:Object(p.jsx)(Ft,{hidden:!t.playerUI.isPixiHidden,appSize:i,triggerScrollRecenterCb:t.playerUI.triggerScrollRecenterCb,updaters:e.updaters,hexGridPx:n,virtualGridDims:a,keyboardScrollDirection:v,debug:f,children:Object(p.jsx)(Lt,{gameState:O,virtualGridDims:a,virtualCoordsToLocation:o,updateNodeStatusByLocationCb:u,cursoredVirtualNode:d,setCursoredLocation:l,debug:b})})})}function Vt(e){return{playerUI:{virtualGridLocation:e.playerUI.virtualGridLocation,cursoredNodeLocation:e.playerUI.cursoredNodeLocation,isPixiHidden:e.playerUI.isPixiHidden,triggerScrollRecenterCb:e.playerUI.triggerScrollRecenterCb},playerSave:{allocationStatusMap:e.playerSave.allocationStatusMap},worldGen:{nodeContentsMap:e.worldGen.nodeContentsMap,lockMap:e.worldGen.lockMap},computed:{fogOfWarStatusMap:e.computed.fogOfWarStatusMap,reachableStatusMap:e.computed.reachableStatusMap,lockStatusMap:e.computed.lockStatusMap},intent:e.intent,debug:{debugShowScrollbars:e.debug.debugShowScrollbars,rerenderGameAreaGrid:e.debug.rerenderGameAreaGrid,enableScrollJump:e.debug.enableScrollJump,getForceJumpOffset:e.debug.getForceJumpOffset,getOffsetX:e.debug.getOffsetX,isFlipCursored:e.debug.isFlipCursored}}}var Bt=E(Vt);function Xt(e){var t=e.gameState,n=Object(r.useMemo)((function(){return rt(new M(t.windowState.innerWidth,t.windowState.innerHeight))}),[t.windowState.innerWidth,t.windowState.innerHeight]),i=Object(r.useMemo)((function(){return n.x>1920?"large":n.x>1080?"medium":"small"}),[n]),a=Object(r.useMemo)((function(){return"large"===i?new M(268,232):"medium"===i?new M(120,104):new M(75,65)}),[i]),o=Object(r.useMemo)((function(){return 4*Math.round(a.x/16-.025)}),[a]),c=Object(r.useMemo)((function(){return a.x>100?2:1}),[a]),u=t.debug.retriggerVirtualGridDims,s=Object(r.useMemo)((function(){u();var e=Math.floor(2*n.x/a.x-.5),t=Math.floor(2*n.y/a.y);return new M(e,t)}),[n,u,a]),l=Object(r.useMemo)((function(){return Vt(t)}),Bt(t)),d=Object(r.useMemo)((function(){return{allocateNode:new wt(e.updaters)}}),[e.updaters]);return Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)(kt,{appSize:n,hexCenterRadius:o,hexGridPx:a,borderWidth:c,COLORS:L}),Object(p.jsx)(qt,{appSize:n,virtualGridDims:s,hexGridPx:a,gameState:l,updaters:e.updaters,actions:d})]})}function Zt(e){var t=e.gameState,n=t.tick,i=Object(r.useState)(+new Date),a=Object(c.a)(i,2),o=a[0],u=a[1],s=Object(r.useState)([]),l=Object(c.a)(s,2),d=l[0],h=l[1],v=Object(r.useMemo)((function(){return rt(new M(t.windowState.innerWidth,t.windowState.innerHeight))}),[t.windowState.innerWidth,t.windowState.innerHeight]),f=Object(r.useMemo)((function(){return v.x>1920?new M(268,232):new M(194,168)}),[v]),b=Object(r.useMemo)((function(){var e=Math.floor(2*v.x/f.x-.5),t=Math.floor(2*v.y/f.y);return new M(e,t)}),[v,f]);Object(r.useEffect)((function(){var e=new Date,t=+e-o;if(t>30){var r="Tick ".concat(n," took ").concat(t,"ms at ").concat(e.toTimeString().split(" ")[0]);console.log(r),h((function(e){return[r].concat(Object(Q.a)(e))}))}u(+new Date)}),[n,o,u,h]);var O=Object(r.useCallback)((function(){console.log("tried triggered update from debug tab"),e.updaters.debug.retriggerVirtualGridDims.enqueueUpdate((function(e){return function(){console.log("force triggered update from debug tab")}}))}),[e.updaters]),j=Object(r.useCallback)((function(){var t;null===(t=e.updaters.debug.debugShowScrollbars)||void 0===t||t.enqueueUpdate((function(e){return!e}))}),[e.updaters]),y=Object(r.useCallback)((function(){e.updaters.debug.rerenderGameAreaGrid.enqueueUpdate((function(e){return function(){console.log("force triggered react rerender from debug tab")}}))}),[e.updaters]),g=Object(r.useCallback)((function(){e.updaters.debug.enableScrollJump.enqueueUpdate((function(){return!1}))}),[e.updaters]),S=Object(r.useCallback)((function(){e.updaters.debug.enableScrollJump.enqueueUpdate((function(){return!0}))}),[e.updaters]),x=Object(r.useCallback)((function(){e.updaters.debug.getForceJumpOffset.enqueueUpdate((function(e){return function(){return console.log("force triggered virtual jump only"),new M(1,2)}}))}),[e.updaters]),m=Object(r.useCallback)((function(){e.updaters.debug.getOffsetX.enqueueUpdate((function(e){var t=e()||0;return function(){return t+1}}))}),[e.updaters]),E=Object(r.useCallback)((function(){e.updaters.debug.isFlipCursored.enqueueUpdate((function(e){var t=e()||!1;return function(){return!t}}))}),[e.updaters]),w=Object(r.useCallback)((function(){e.updaters.playerUI.isTextBoxFocused.enqueueUpdate((function(e){var t=!e;return console.log({isTextBoxFocused:t}),t}))}),[e.updaters]),k=Object(r.useCallback)((function(){wn.store(e.gameState.playerUI)}),[e.gameState]),T=Object(r.useCallback)((function(){var t=wn.load();t&&e.updaters.playerUI.enqueueUpdate((function(){return t}))}),[e.updaters]),I=Object(r.useCallback)((function(){wn.clear(),new Et({}).clear(),yt(),e.updaters.justDisabledSave.enqueueUpdate(!0)}),[e.updaters]),_=Object(r.useCallback)((function(){yt(),e.updaters.playerSave.enqueueUpdate((function(e){return bt()})),e.updaters.justDisabledSave.enqueueUpdate(!0)}),[e.updaters]);return e.hidden?Object(p.jsx)(p.Fragment,{children:" "}):Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)("div",{children:" debug tab "}),Object(p.jsxs)("div",{className:"tab-content-body",children:[Object(p.jsx)("br",{}),Object(p.jsx)("div",{children:"Recent slow renders:"}),d.slice(0,5).map((function(e,t){return Object(p.jsx)("div",{children:e},t)})),Object(p.jsx)("br",{})]}),Object(p.jsx)("br",{}),Object(p.jsx)("div",{children:" virtual grid location "}),Object(p.jsxs)("div",{children:["( ",t.playerUI.virtualGridLocation.x," ,"," ",t.playerUI.virtualGridLocation.y," )"]}),Object(p.jsx)("br",{}),Object(p.jsx)("div",{children:" virtual grid dims "}),Object(p.jsxs)("div",{children:["( ",b.x," , ",b.y," )"]}),Object(p.jsx)("br",{}),Object(p.jsx)("div",{children:" buttons "}),Object(p.jsxs)("div",{className:"tab-content-body",children:[Object(p.jsx)("br",{}),Object(p.jsx)("div",{children:Object(p.jsx)("button",{onClick:j,children:"Toggle scrollbars"})}),Object(p.jsx)("div",{children:Object(p.jsx)("button",{onClick:O,children:"Trigger virtual grid dims rerender"})}),Object(p.jsx)("div",{children:Object(p.jsx)("button",{onClick:y,children:"Trigger only virtual game area grid react rerender"})}),Object(p.jsx)("div",{children:Object(p.jsx)("button",{onClick:g,children:"Disable scroll jump trigger"})}),Object(p.jsx)("div",{children:Object(p.jsx)("button",{onClick:S,children:"Reenable scroll jump trigger"})}),Object(p.jsx)("div",{children:Object(p.jsx)("button",{onClick:x,children:"Force virtual grid jump only"})}),Object(p.jsx)("div",{children:Object(p.jsx)("button",{onClick:m,children:"add weird x offset to grid"})}),Object(p.jsx)("div",{children:Object(p.jsx)("button",{onClick:E,children:"weird flip cursored state on all nodes"})}),Object(p.jsx)("div",{children:Object(p.jsx)("button",{onClick:w,children:"toggle text box focused"})}),Object(p.jsx)("div",{children:Object(p.jsx)("button",{onClick:k,children:"save state to local storage"})}),Object(p.jsx)("div",{children:Object(p.jsx)("button",{onClick:T,children:"load state from local storage"})}),Object(p.jsx)("div",{children:Object(p.jsx)("button",{onClick:I,children:"clear local storage and disable saving"})}),Object(p.jsx)("div",{children:Object(p.jsx)("button",{onClick:_,children:"clear save"})})]})]})}var Jt=i.a.memo(Kt);function Kt(e){var t=e.gameState,n=e.updaters,i=Object(r.useState)(!1),a=Object(c.a)(i,2),o=a[0],u=a[1],s=Object(r.useState)(""),l=Object(c.a)(s,2),d=l[0],h=l[1],v=Object(r.useCallback)((function(){n.playerUI.isTextBoxFocused.enqueueUpdate(!0)}),[n]),f=Object(r.useCallback)((function(){n.playerUI.isTextBoxFocused.enqueueUpdate(!1)}),[n]),b=Object(r.useCallback)((function(){n.playerUI.strategicSearch.highlight1.enqueueUpdate((function(){return{value:d}}))}),[n,d]),O=Object(r.useCallback)((function(){h(""),n.playerUI.strategicSearch.highlight1.enqueueUpdate((function(){return{value:""}}))}),[n]),j=Object(r.useCallback)((function(e,t){n.playerUI.strategicSearch.colors.enabled.enqueueUpdate((function(t){return e}))}),[n]);return t.playerUI.isPixiHidden?Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)("div",{children:"Strategic view is not open!"}),Object(p.jsx)("br",{}),Object(p.jsx)("div",{children:"Click (hotkey: b) to toggle strategic view."})]}):Object(p.jsxs)(p.Fragment,{children:[Object(p.jsxs)("div",{children:[o?"Custom":"Basic"," search"]}),Object(p.jsx)("br",{}),Object(p.jsxs)("div",{className:"tab-content-body",children:[Object(p.jsxs)("div",{children:["Colors enabled?",Object(p.jsx)($t,{labels:["Always","Only unallocated","No"],values:["Yes","Only unallocated","No"],defaultValue:t.playerUI.strategicSearch.colors.enabled,onChange:j})]}),Object(p.jsx)("br",{}),Object(p.jsxs)("div",{children:["Symbols: ",Object(p.jsx)(Yt,{updateTextInputValue:h,attribute:Te.RED0}),Object(p.jsx)(Yt,{updateTextInputValue:h,attribute:Te.RED1}),Object(p.jsx)(Yt,{updateTextInputValue:h,attribute:Te.RED2}),Object(p.jsx)(Yt,{updateTextInputValue:h,attribute:Te.DEL0}),Object(p.jsx)(Yt,{updateTextInputValue:h,attribute:Te.DEL1}),Object(p.jsx)(Yt,{updateTextInputValue:h,attribute:Te.DEL2}),Object(p.jsx)(Qt,{updateTextInputValue:h,icon:"*",insertedText:"[*] "}),Object(p.jsx)("br",{}),Object(p.jsx)(Qt,{updateTextInputValue:h,id:Ie.FLAT,icon:Ve[Ie.FLAT],insertedText:"["+Be[Ie.FLAT]+"] "}),Object(p.jsx)(Qt,{updateTextInputValue:h,id:Ie.INCREASED,icon:Ve[Ie.INCREASED],insertedText:"["+Be[Ie.INCREASED]+"] "})]}),Object(p.jsx)("br",{}),Object(p.jsxs)("div",{children:["Highlight:"," ",Object(p.jsx)("input",{type:"text",onFocus:v,onChange:function(e){h(e.target.value)},onBlur:f,value:d}),Object(p.jsx)("button",{onClick:b,children:"\ud83d\udd0e"}),Object(p.jsx)("button",{onClick:O,children:"\ud83d\udeab"})]}),o?Object(p.jsxs)(p.Fragment,{children:[Object(p.jsxs)("div",{children:["Highlight 2: ",Object(p.jsx)("input",{type:"text"}),Object(p.jsx)("button",{children:"Apply"}),Object(p.jsx)("button",{children:"Cancel"})]}),Object(p.jsx)("br",{}),Object(p.jsx)("div",{children:"Filter:"}),Object(p.jsx)("br",{}),Object(p.jsxs)("div",{children:["Show if: ",Object(p.jsx)("input",{type:"text"}),Object(p.jsx)("button",{children:"Apply"}),Object(p.jsx)("button",{children:"Cancel"})]}),Object(p.jsx)("br",{}),Object(p.jsx)("div",{children:"Color:"}),Object(p.jsx)("br",{}),Object(p.jsxs)("div",{children:["Grayscale by: ",Object(p.jsx)("input",{type:"text"}),Object(p.jsx)("button",{children:"Apply"}),Object(p.jsx)("button",{children:"Cancel"})]}),Object(p.jsxs)("div",{children:["Color by: ",Object(p.jsx)("input",{type:"text"}),Object(p.jsx)("button",{children:"Apply"}),Object(p.jsx)("button",{children:"Cancel"})]}),Object(p.jsx)("br",{}),Object(p.jsx)("div",{children:"Shape:"}),Object(p.jsx)("br",{}),Object(p.jsxs)("div",{children:["Shape = | if: ",Object(p.jsx)("input",{type:"text"}),Object(p.jsx)("button",{children:"Apply"}),Object(p.jsx)("button",{children:"Cancel"})]}),Object(p.jsx)("br",{}),Object(p.jsx)("br",{}),Object(p.jsxs)("div",{children:[Object(p.jsx)("input",{type:"text"}),Object(p.jsx)("button",{children:"Save config"})]}),Object(p.jsxs)("div",{children:[Object(p.jsx)("input",{type:"text"}),Object(p.jsx)("button",{children:"Load config"})]}),Object(p.jsx)("div",{children:Object(p.jsx)("button",{children:"Reset to defaults"})}),Object(p.jsx)("br",{}),Object(p.jsx)("div",{children:Object(p.jsx)("button",{onClick:function(){u(!1)},children:"Use basic search"})})]}):Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)("br",{}),Object(p.jsx)("div",{children:Object(p.jsx)("button",{onClick:function(){u(!0)},children:"Use custom search"})})]})]})]})}function Yt(e){return Object(p.jsx)(Qt,{updateTextInputValue:e.updateTextInputValue,insertedText:"["+qe[e.attribute]+"] ",icon:ze[e.attribute]})}function Qt(e){return Object(p.jsx)("button",{onMouseDown:function(e){e.preventDefault()},onPointerDown:function(e){e.preventDefault()},onClick:function(t){t.preventDefault(),e.updateTextInputValue((function(t){return t+e.insertedText}))},children:e.icon})}function $t(e){var t=e.labels,n=e.values,i=e.defaultValue,a=e.onChange,o=i?n.indexOf(i):-1,u=Object(r.useState)(o),s=Object(c.a)(u,2),l=s[0],d=s[1],h=Math.min(t.length,n.length),v=Array(h).fill(0).map((function(e,r){return Object(p.jsx)("button",{disabled:r===l,onClick:function(e){d(r),a(n[r],e)},children:t[r]},r)}));return Object(p.jsx)(p.Fragment,{children:v})}var en=i.a.memo(tn);function tn(e){var t,n,i,a,o,c,u,s,l=e.gameState,d=l.playerUI.cursoredNodeLocation,h=Object(r.useCallback)((function(t){t.preventDefault(),d&&e.actions.allocateNode.enqueueAction({nodeLocation:d,newStatus:Se.true})}),[e.actions.allocateNode,d]),v=Object(r.useCallback)((function(t){t.preventDefault(),d&&(e.updaters.playerUI.virtualGridLocation.enqueueUpdate((function(e){return d})),e.updaters.playerUI.triggerScrollRecenterCb.enqueueUpdate((function(){return function(){console.log("zoomed to location: ",{location:d})}})))}),[e.updaters,d]);if(null===d)return Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)("div",{children:"Nothing selected!"}),Object(p.jsx)("div",{children:Object(p.jsx)("br",{})}),Object(p.jsx)("div",{children:"Hover and click the"}),Object(p.jsx)("div",{children:" question mark tooltip to"}),Object(p.jsx)("div",{children:"select a node."})]});var f=new M(d.x-d.y/2,d.y*Math.sqrt(3)/2);f=new M(Math.round(100*f.x)/100,Math.round(100*f.y)/100);var b=(null===(t=l.playerSave.allocationStatusMap)||void 0===t||null===(n=t.get(d))||void 0===n?void 0:n.taken)||!1,O=(null===(i=l.computed.reachableStatusMap)||void 0===i||null===(a=i.get(d))||void 0===a?void 0:a.reachable)||!1,j=(null===(o=l.computed.fogOfWarStatusMap)||void 0===o||null===(c=o.get(d))||void 0===c?void 0:c.visible)||!1,y=j&&(null===(u=l.worldGen.lockMap)||void 0===u?void 0:u.get(d))||null,g=O&&!y&&!b,S="";S=d.equals(Ee.Zero)?It:j?void 0!==(null===(s=l.worldGen.lockMap)||void 0===s?void 0:s.get(d))?"A locked node.":"An allocatable node.":"Unknown.";var x=j&&l.worldGen.nodeContentsMap.get(d)||null,m=(null===x||void 0===x?void 0:x.lines[0])?Ct(x):"empty";return Object(p.jsx)(p.Fragment,{children:Object(p.jsxs)("div",{className:"tab-content-body",children:[Object(p.jsxs)("div",{children:["Location: ( ",f.x," , ",f.y," ) , z-layer = ",d.z]}),Object(p.jsx)("br",{}),Object(p.jsx)("div",{children:Object(p.jsxs)("button",{onClick:v,children:["Recenter on here (hotkey: r, ","\\",")"]})}),Object(p.jsx)("br",{}),Object(p.jsxs)("div",{children:["Description: ",S]}),Object(p.jsx)("br",{}),Object(p.jsxs)("div",{children:["Taken?: ",b.toString()]}),Object(p.jsxs)("div",{children:["Reachable?: ",O.toString()]}),Object(p.jsxs)("div",{children:["Visible?: ",j.toString()]}),j?Object(p.jsxs)(p.Fragment,{children:[Object(p.jsxs)("div",{children:["Locked?: ",(!!y).toString()]}),Object(p.jsxs)("div",{children:["Can be allocated?: ",g.toString()]}),Object(p.jsx)("br",{}),Object(p.jsxs)("div",{children:["Contents: ",m]}),Object(p.jsx)("br",{}),Object(p.jsx)("button",{disabled:!g,onClick:h,children:"Allocate (hotkey: spacebar)"})]}):Object(p.jsx)(p.Fragment,{children:" "})]})})}function nn(e){var t=Object(r.useMemo)((function(){return rn(e.gameState)}),an(e.gameState));return Object(p.jsx)(on,{gameState:t,updaters:e.updaters})}function rn(e){return{playerSave:{allocationStatusMap:e.playerSave.allocationStatusMap},worldGen:{nodeContentsMap:e.worldGen.nodeContentsMap}}}var an=E(rn),on=i.a.memo(cn);function cn(e){var t=e.gameState,n=Object(r.useState)(!1),i=Object(c.a)(n,2),a=i[0],o=i[1],u=function(e,t){var n=Object.entries(e).map((function(n){var r=Object(c.a)(n,2),i=r[0],a=r[1];return[i,t(a,i,e)]}));return Object.fromEntries(n)}(un({gameState:t}),(function(e,t){var n=e.modifiers,r=e.total,i=qe[t],o=ze[t];return Object(p.jsx)(p.Fragment,{children:Object(p.jsxs)("details",{className:"details",open:a,children:[Object(p.jsxs)("summary",{children:[" ",o," (",i,"):"]}),Object(p.jsxs)("div",{className:"details-body",children:[Object(p.jsxs)("div",{children:["+: ",n[Ie.FLAT]]}),Object(p.jsxs)("div",{children:["%: ",n[Ie.INCREASED]]}),Object(p.jsxs)("div",{className:"final-total",children:["Total: ",r]})]})]})})}));return Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)("div",{children:"Current stats"}),Object(p.jsx)("br",{}),Object(p.jsxs)("div",{children:[Object(p.jsx)("button",{onClick:function(){o(!0)},children:"Open all"})," ",Object(p.jsx)("button",{onClick:function(){o(!1)},children:"Close all"})]}),Object(p.jsx)("br",{}),Object(p.jsxs)("div",{className:"tab-content-body",children:[u[Te.RED0],u[Te.RED1],u[Te.RED2],u[Te.DEL0],u[Te.DEL1],u[Te.DEL2]]})]})}function un(e){var t=e.gameState;return x(Te,(function(e){var n=x(Ie,(function(n){var r=t.playerSave.allocationStatusMap.entries().map((function(r){var i,a,o,u,s=Object(c.a)(r,2),l=s[0];if(!s[1].taken)return 0;var d=t.worldGen.nodeContentsMap.get(l);return(null===(i=d.lines[0])||void 0===i?void 0:i.attribute)===e&&(null===(a=d.lines[0])||void 0===a?void 0:a.modifier)===n?d.lines[0].amount:(null===(o=d.lines[1])||void 0===o?void 0:o.attribute)===e&&(null===(u=d.lines[1])||void 0===u?void 0:u.modifier)===n?d.lines[1].amount:0})).reduce((function(e,t){return e+t}));return[n,r]})),r=Math.round(n[Ie.FLAT]*(1+.01*n[Ie.INCREASED]));return[e,{modifiers:n,total:r}]}))}function sn(){return Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)("div",{children:"How to play the game"}),Object(p.jsx)("br",{}),Object(p.jsxs)("div",{className:"tab-content-body",children:[Object(p.jsx)("div",{children:"CONTROLS"}),Object(p.jsx)("br",{}),Object(p.jsx)(ln,{children:"Use hotkey: t, y to open and close the tabs."}),Object(p.jsx)(ln,{children:"Use hotkey: b to toggle strategic view."}),Object(p.jsx)(ln,{children:'Move the tabs around using "send left/right" buttons.'}),Object(p.jsx)(ln,{children:"Open the Stats tab."}),Object(p.jsx)(ln,{children:"Open the Quests tab."}),Object(p.jsx)("br",{}),Object(p.jsx)("div",{children:"GAME"}),Object(p.jsx)("br",{}),Object(p.jsx)(ln,{children:"Hover over some nodes."}),Object(p.jsx)(ln,{children:"Left click on an available node to allocate it."}),Object(p.jsx)(ln,{children:"Left click on any other node to view detailed info."}),Object(p.jsx)(ln,{children:"Scroll around to see what other nodes are visible."}),Object(p.jsx)(ln,{children:"Use keyboard controls (hotkeys: ijklmun) to move around the map, and (hotkeys: wasd) to pan around."}),Object(p.jsx)(ln,{children:"Click (hotkey: r, \\) to recenter the view on your selected node."}),Object(p.jsx)(ln,{children:"Close the selected node tab."}),Object(p.jsx)("br",{}),Object(p.jsx)("div",{children:"STRATEGIC VIEW"}),Object(p.jsx)("br",{}),Object(p.jsx)(ln,{children:"Open the strategic view tab while strategic view is open."}),Object(p.jsx)(ln,{children:"Toggle colors."}),Object(p.jsx)(ln,{children:"Try adding an attribute to the search bar by clicking a symbol."}),Object(p.jsx)(ln,{children:"Click search to highlight those attributes."}),Object(p.jsx)(ln,{children:"Click cancel to reset the search."})]})]})}function ln(e){return Object(p.jsxs)("div",{children:[Object(p.jsx)("input",{type:"checkbox"})," ",e.children]})}function dn(e){var t=Object(r.useMemo)((function(){return rn(e.gameState)}),an(e.gameState));return Object(p.jsx)(pn,{gameState:t})}var hn,pn=i.a.memo(vn);function vn(e){var t,n,r,i,a=un({gameState:e.gameState});Fe.map((function(e){return{attribute:e,stats:a[e]}})).forEach((function(e){var r=e.attribute,i=e.stats.total;(void 0===n||i>n)&&(t=r,n=i)})),Fe.map((function(e){return{attribute:e,stats:a[e]}})).forEach((function(e){var n=e.attribute,a=e.stats.total;n!==t&&(void 0===i||a>i)&&(r=n,i=a)}));var o=n>=1e3&&i>=400;return Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)("div",{children:"Quests info"}),Object(p.jsx)("br",{}),Object(p.jsxs)("div",{className:"tab-content-body",children:[Object(p.jsx)("div",{children:"Ultimate goal:"}),Object(p.jsxs)("ol",{children:[Object(p.jsxs)("li",{children:[Object(p.jsx)("div",{children:"1000 of any attribute:"}),Object(p.jsx)("br",{}),Object(p.jsxs)("div",{children:["Progress: ",Object(p.jsx)("meter",{value:n,min:0,max:1e3})," ",n+" "+ze[t]+" / 1000"]}),Object(p.jsx)("br",{})]}),Object(p.jsxs)("li",{children:[Object(p.jsx)("div",{children:"400 of any other attribute:"}),Object(p.jsx)("br",{}),Object(p.jsxs)("div",{children:["Progress: ",Object(p.jsx)("meter",{value:i,min:0,max:400})," ",i+" "+ze[r]+" / 400"]}),Object(p.jsx)("br",{}),!!o&&Object(p.jsx)("div",{children:"YOU WIN!!!"})]})]}),Object(p.jsx)("div",{children:"Other goals: WIP"})]})]})}function fn(e){var t,n=e.tabName,r=(t={},Object(ee.a)(t,hn.EMPTY,Object(p.jsx)(On,{})),Object(ee.a)(t,hn.SELECTED_NODE,Object(p.jsx)(en,{gameState:e.gameState,updaters:e.updaters,actions:e.actions})),Object(ee.a)(t,hn.STATS,Object(p.jsx)(nn,{gameState:e.gameState,updaters:e.updaters})),Object(ee.a)(t,hn.QUESTS,Object(p.jsx)(dn,{gameState:e.gameState})),Object(ee.a)(t,hn.STRATEGIC_VIEW,Object(p.jsx)(Jt,{gameState:e.gameState,updaters:e.updaters})),Object(ee.a)(t,hn.DEBUG,Object(p.jsx)(Zt,{gameState:e.gameState,updaters:e.updaters,hidden:n!==hn.DEBUG})),Object(ee.a)(t,hn.HELP,Object(p.jsx)(sn,{})),t);return Object(p.jsx)(bn,{tabComponents:r,tabName:n})}function bn(e){var t=e.tabName,n=Object.keys(hn);return Object(p.jsx)(p.Fragment,{children:n.map((function(n){return Object(p.jsx)("div",{hidden:n!==t,children:e.tabComponents[n]},n)}))})}!function(e){e.EMPTY="EMPTY",e.SELECTED_NODE="SELECTED_NODE",e.STATS="STATS",e.QUESTS="QUESTS",e.DEBUG="DEBUG",e.HELP="HELP",e.STRATEGIC_VIEW="STRATEGIC_VIEW"}(hn||(hn={}));var On=i.a.memo(jn);function jn(e){return console.log("got here empty tab content"),Object(p.jsx)("div",{children:"Nothing here!"})}var yn={left:[hn.HELP],right:[hn.SELECTED_NODE,hn.STATS,hn.QUESTS,hn.DEBUG,hn.STRATEGIC_VIEW]},gn=function(){return{triggerScrollRecenterCb:function(){},tabs:{left:{tabs:yn.left,activeIndex:0},right:{tabs:yn.right,activeIndex:0}},strategicSearch:{colors:{enabled:"Only unallocated"},highlight1:{value:""}},isPixiHidden:!0,virtualGridLocation:Ee.Zero,cursoredNodeLocation:null,isSidebarOpen:!1,isLeftSidebarOpen:!0,isRightSidebarOpen:!1,isTextBoxFocused:!1}},Sn=function(e){return JSON.stringify(function(e){return Object(D.a)(Object(D.a)({},e),{},{triggerScrollRecenterCb:void 0,virtualGridLocation:Ee.SerializeToObject(e.virtualGridLocation)})}(e))},xn=function(e){return function(e){if(!e||!e.hasOwnProperty("isPixiHidden")||!e.hasOwnProperty("virtualGridLocation")||!e.hasOwnProperty("cursoredNodeLocation")||!e.hasOwnProperty("isSidebarOpen")||!e.hasOwnProperty("isLeftSidebarOpen")||!e.hasOwnProperty("isRightSidebarOpen")||!e.hasOwnProperty("isTextBoxFocused")||!e.hasOwnProperty("tabs")||!e.hasOwnProperty("strategicSearch"))return console.error("Failed deserializing PlayerUIState: ",e),null;var t=e.strategicSearch;if(!t||!t.hasOwnProperty("colors")||!t.hasOwnProperty("highlight1"))return console.error("Failed deserializing PlayerUIState: ",e),null;var n=Ee.Deserialize(e.virtualGridLocation);if(!n)return console.error("Failed deserializing PlayerUIState: ",e),null;var r=Ee.Deserialize(e.cursoredNodeLocation);return Object(D.a)(Object(D.a)({},e),{},{virtualGridLocation:n,cursoredNodeLocation:r,triggerScrollRecenterCb:function(){}})}(JSON.parse(e))},mn="PlayerUIState",En=function(){var e=window.localStorage.getItem(mn);return e&&xn(e)||null},wn={new:gn,serialize:Sn,deserialize:xn,tryLoad:function(){var e=En();return e||(console.log("Failed to load PlayerUIState"),gn())},load:En,store:function(e){var t=Sn(e);window.localStorage.setItem(mn,t)},clear:function(){window.localStorage.setItem(mn,"")}};function kn(e){var t=e.gameState,n=Object(r.useCallback)((function(){t.justDisabledSave?console.log("skipping save because it was just disabled!"):(wn.store(t.playerUI),jt(t.playerSave),new Et({}).store(t.worldGen))}),[t.playerUI,t.justDisabledSave,t.worldGen,t.playerSave]);return Object(r.useEffect)((function(){t.intent.newIntent.HARD_REFRESH_PAGE&&(wn.clear(),new Et({}).clear(),yt(),window.location.reload())}),[t.intent.newIntent.HARD_REFRESH_PAGE]),Object(r.useEffect)((function(){return window.onbeforeunload=n,function(){window.onbeforeunload=null}})),Object(p.jsx)(p.Fragment,{children:" "})}function Tn(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,t=e||In,n=new Et({}),r={tick:0,worldGen:n.tryLoad({seed:t}),playerSave:Ot(),playerUI:wn.tryLoad(),computed:{},intent:I(),windowState:nt(),debug:{retriggerVirtualGridDims:function(){},debugShowScrollbars:!1,rerenderGameAreaGrid:function(){},enableScrollJump:!0,getForceJumpOffset:function(){},getOffsetX:function(){},isFlipCursored:function(){}},justDisabledSave:!1};return Cn(r),r}var In=103043,_n=function(){function e(t){Object(l.a)(this,e),this.config=void 0,this.config=t}return Object(d.a)(e,[{key:"loadOrCreate",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;return Tn(e)}},{key:"create",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,t=e||In,n=new Et({}),r={tick:0,worldGen:n.create({seed:t}),playerSave:dt(),playerUI:wn.new(),computed:{},intent:I(),windowState:nt(),debug:{retriggerVirtualGridDims:function(){},debugShowScrollbars:!1,rerenderGameAreaGrid:function(){},enableScrollJump:!0,getForceJumpOffset:function(){},getOffsetX:function(){},isFlipCursored:function(){}},justDisabledSave:!1};return Cn(r),r}}]),e}();function Cn(e){e.computed.lockStatusMap=new z,e.computed.fogOfWarStatusMap=new z,e.computed.reachableStatusMap=new z,St(Ee.Zero,5).forEach((function(t){e.worldGen.lockMap.precompute(t)}));var t,n=e.computed.lockStatusMap,r=e,i=Object(y.a)(r.worldGen.lockMap.entries());try{for(i.s();!(t=i.n()).done;){var a=Object(c.a)(t.value,2),o=a[0];if(a[1]){var u=ge.TICKING;n.put(o,u)}}}catch(h){i.e(h)}finally{i.f()}var s=e.computed.fogOfWarStatusMap,l=e.computed.reachableStatusMap,d=e;return e.playerSave.allocationStatusMap.entries().filter((function(e){var t=Object(c.a)(e,2);t[0];return!0===t[1].taken})).map((function(e){return e[0]})).forEach((function(e){s.put(e,xe.true),St(e,1).forEach((function(e){s.put(e,xe.true),l.put(e,me.true)})),St(e,5,0,{contains:function(e){var t,n=null===(t=d.computed.lockStatusMap)||void 0===t?void 0:t.get(e);return!(!n||n===ge.OPEN)}}).forEach((function(e){var t;(null===(t=s.get(e))||void 0===t?void 0:t.visible)||(d.worldGen.lockMap.precompute(e),s.put(e,xe.true))}))})),e}n(254),n(255);function Un(e){var t=e.children,n=e.hidden,r=e.placement;return Object(p.jsx)("div",{className:"left"===r?"layout left-sidebar":"layout right-sidebar",hidden:n,children:Object(p.jsx)(p.Fragment,{children:t})})}n(256);var Rn=i.a.memo(Nn);function Nn(e){var t=e.value,n=e.labels,r=e.onChange;return Object(p.jsx)("div",{className:"tab-label-container",children:n.map((function(e,n){return Object(p.jsx)(Mn,{onClick:r,value:n,active:t===n,children:e},n)}))})}var Mn=i.a.memo(Dn);function Dn(e){var t=e.onClick,n=e.value,i=e.active,a=e.children,o=Object(r.useCallback)((function(){t(n)}),[t,n]);return Object(p.jsx)("div",{className:i?"tab-label active":"tab-label inactive",children:Object(p.jsx)("div",{onClick:o,children:a})})}var An=[hn.EMPTY];hn.SELECTED_NODE,hn.STATS,hn.QUESTS,hn.DEBUG,hn.HELP,hn.STRATEGIC_VIEW;function Ln(e){var t=e.gameState,n=e.updaters,i=Object(r.useCallback)((function(){n.playerUI.isSidebarOpen.enqueueUpdate((function(){return!1})),n.playerUI.isLeftSidebarOpen.enqueueUpdate((function(){return!1}))}),[n]),a=Object(r.useCallback)((function(){n.playerUI.isSidebarOpen.enqueueUpdate((function(){return!0})),n.playerUI.isLeftSidebarOpen.enqueueUpdate((function(){return!0}))}),[n]),o=Object(r.useCallback)((function(){n.playerUI.isSidebarOpen.enqueueUpdate((function(){return!1})),n.playerUI.isRightSidebarOpen.enqueueUpdate((function(){return!1}))}),[n]),c=Object(r.useCallback)((function(){n.playerUI.isSidebarOpen.enqueueUpdate((function(){return!0})),n.playerUI.isRightSidebarOpen.enqueueUpdate((function(){return!0}))}),[n]),u=t.playerUI.tabs,s=n.playerUI.tabs,l=u.left.tabs,d=u.right.tabs,h=u.left.activeIndex,v=u.right.activeIndex,f=s.left.tabs.enqueueUpdate,b=s.right.tabs.enqueueUpdate,O=s.left.activeIndex.enqueueUpdate,j=s.right.activeIndex.enqueueUpdate,y=Object(r.useCallback)((function(){if(0!==d.length){var e=d[v];if(void 0!==e){var t=d.slice(0,v).concat(d.slice(v+1));b(t),j(Math.max(0,Math.min(v,t.length-1)));var n=[].concat(Object(Q.a)(l),[e]);f(n),O(n.length-1),a()}}}),[l,f,d,b,O,v,j,a]),g=Object(r.useCallback)((function(){if(0!==l.length){var e=l[h];if(void 0!==e){var t=l.slice(0,h).concat(l.slice(h+1));f(t),O(Math.max(Math.min(h,t.length-1),0));var n=[].concat(Object(Q.a)(d),[e]);b(n),j(n.length-1),c()}}}),[l,f,d,b,h,O,j,c]),S=Object(r.useMemo)((function(){return 0===l.length?hn.EMPTY:l[h]}),[l,h]),x=Object(r.useMemo)((function(){return 0===d.length?hn.EMPTY:d[v]}),[d,v]),m=Object(r.useMemo)((function(){return{allocateNode:new wt(e.updaters)}}),[e.updaters]);return Object(p.jsxs)(p.Fragment,{children:[Object(p.jsxs)(Un,{hidden:!t.playerUI.isLeftSidebarOpen,placement:"left",children:[Object(p.jsxs)("div",{className:"sidebar-header",children:[Object(p.jsx)("div",{className:"sidebar-header-button",onClick:g,children:"\u27a1\ufe0f\ufe0f Send right"}),Object(p.jsx)("div",{className:"sidebar-header-gap"}),Object(p.jsx)("div",{className:"sidebar-header-button",onClick:function(){i()},children:"\u274e Close"})]}),Object(p.jsx)(Rn,{value:h||0,labels:l.length?l:An,onChange:O}),Object(p.jsx)(fn,{gameState:t,updaters:n,tabName:S,actions:m})]}),Object(p.jsxs)(Un,{hidden:!t.playerUI.isRightSidebarOpen,placement:"right",children:[Object(p.jsxs)("div",{className:"sidebar-header",children:[Object(p.jsx)("div",{className:"sidebar-header-button",onClick:y,children:"\u2b05\ufe0f Send left"}),Object(p.jsx)("div",{className:"sidebar-header-gap"}),Object(p.jsx)("div",{className:"sidebar-header-button",onClick:function(){o()},children:"\u274e Close"})]}),Object(p.jsx)(Rn,{value:v||0,labels:d.length?d:An,onChange:j}),Object(p.jsx)(fn,{gameState:t,updaters:n,tabName:x,actions:m})]})]})}var Gn=new pe((function(){return new _n({}).loadOrCreate(+new Date)}));var Pn=function(){var e=Object(r.useState)((function(){return Gn.get()})),t=Object(c.a)(e,2),n=t[0],i=t[1],a=Object(r.useMemo)((function(){return $(i)}),[i]),o=Object(c.a)(a,2),u=o[0],l=o[1],d=Object(r.useMemo)((function(){return ne(Gn.get(),u)}),[u]),h=Object(r.useMemo)((function(){return[n,d,l]}),[n,d,l]);return Object(r.useEffect)((function(){console.log("maybe toggling strategic view"),n.intent.newIntent.TOGGLE_STRATEGIC_VIEW&&d.playerUI.isPixiHidden.enqueueUpdate((function(e){return!e}))}),[n.intent.newIntent.TOGGLE_STRATEGIC_VIEW,d]),Object(r.useEffect)((function(){n.intent.newIntent.TOGGLE_SIDEBAR&&d.playerUI.isSidebarOpen.enqueueUpdate((function(e){return!e}))}),[n.intent.newIntent.TOGGLE_SIDEBAR,d]),Object(r.useEffect)((function(){n.intent.newIntent.TOGGLE_LEFT_SIDEBAR&&d.playerUI.isLeftSidebarOpen.enqueueUpdate((function(e){return!e}))}),[n.intent.newIntent.TOGGLE_LEFT_SIDEBAR,d]),Object(r.useEffect)((function(){n.intent.newIntent.TOGGLE_RIGHT_SIDEBAR&&d.playerUI.isRightSidebarOpen.enqueueUpdate((function(e){return!e}))}),[n.intent.newIntent.TOGGLE_RIGHT_SIDEBAR,d]),Object(r.useEffect)((function(){n.intent.newIntent.TURN_OFF_SIDEBAR&&(d.playerUI.isLeftSidebarOpen.enqueueUpdate((function(e){return!1})),d.playerUI.isRightSidebarOpen.enqueueUpdate((function(e){return!1})))}),[n.intent.newIntent.TURN_OFF_SIDEBAR,d]),Object(r.useEffect)((function(){n.intent.newIntent.EXIT&&(d.playerUI.isLeftSidebarOpen.enqueueUpdate((function(e){return!1})),d.playerUI.isRightSidebarOpen.enqueueUpdate((function(e){return!1})),d.playerUI.cursoredNodeLocation.enqueueUpdate((function(e){return null})))}),[n.intent.newIntent.EXIT,d]),Object(p.jsxs)("div",{className:s()({App:!0}),children:[Object(p.jsxs)("div",{className:"entire-area",children:[Object(p.jsx)(U.Provider,{value:h,children:Object(p.jsx)(ut,{hidden:n.playerUI.isPixiHidden})}),Object(p.jsx)(Xt,{gameState:n,updaters:d})]}),Object(p.jsx)("div",{className:"debug-overlay",children:Object(p.jsx)(v,{tick:n.tick,windowState:n.windowState})}),Object(p.jsxs)("div",{className:"button-zone",children:[Object(p.jsx)("button",{className:"button-pixi-toggle",style:{},onClick:function(){d.playerUI.isPixiHidden.enqueueUpdate((function(e){return!e}))},children:"Toggle big view (hotkey: b)"}),Object(p.jsx)("span",{children:" "}),Object(p.jsx)("button",{onClick:function(){d.playerUI.isSidebarOpen.enqueueUpdate((function(e){return!e})),d.playerUI.isLeftSidebarOpen.enqueueUpdate((function(e){return!e})),d.playerUI.isRightSidebarOpen.enqueueUpdate((function(e){return!e}))},children:"Toggle sidebars (hotkeys: t, y)"})]}),Object(p.jsx)(Ln,{gameState:n,updaters:d}),Object(p.jsx)(C,{isTextBoxFocused:n.playerUI.isTextBoxFocused,updaters:d.intent}),Object(p.jsx)(lt,{updaters:d.windowState}),Object(p.jsx)(kn,{gameState:n})]})};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(Object(p.jsx)(i.a.StrictMode,{children:Object(p.jsx)(Pn,{})}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},78:function(e,t,n){}},[[257,1,2]]]);
//# sourceMappingURL=main.49c6068f.chunk.js.map