(this["webpackJsonpprocgen-skill-tree"]=this["webpackJsonpprocgen-skill-tree"]||[]).push([[0],{121:function(e,t,n){},132:function(e,t,n){},133:function(e,t,n){},134:function(e,t,n){},138:function(e,t){},140:function(e,t){},151:function(e,t){},153:function(e,t){},179:function(e,t){},181:function(e,t){},182:function(e,t){},187:function(e,t){},189:function(e,t){},208:function(e,t){},220:function(e,t){},223:function(e,t){},226:function(e,t,n){},227:function(e,t,n){},233:function(e,t,n){},234:function(e,t,n){},235:function(e,t,n){"use strict";n.r(t);var i=n(0),r=n(1),a=n.n(r),o=n(124),c=n.n(o),u=(n(132),n(10)),s=(n(133),n(46)),d=n.n(s),l=(n(134),n(2)),h=n(3),f=function(){function e(){Object(l.a)(this,e),this.frameTimestampsInTicks=[],this.frameTimestampsInTime=[],this.frameTimestampsInTicks.push(0)}return Object(h.a)(e,[{key:"tick",value:function(e){var t=this.frameTimestampsInTicks[this.frameTimestampsInTicks.length-1];this.frameTimestampsInTicks.push(t+e),this.frameTimestampsInTicks.length>120&&(this.frameTimestampsInTicks=this.frameTimestampsInTicks.slice(60)),this.frameTimestampsInTime.push((new Date).getTime()),this.frameTimestampsInTime.length>120&&(this.frameTimestampsInTime=this.frameTimestampsInTime.slice(60))}},{key:"getUps",value:function(){var e=this.frameTimestampsInTicks[this.frameTimestampsInTicks.length-1]-this.frameTimestampsInTicks[0],t=(this.frameTimestampsInTicks.length-1)/e;return t?60*t:60}},{key:"getFps",value:function(){var e=this.frameTimestampsInTime[this.frameTimestampsInTime.length-1]-this.frameTimestampsInTime[0],t=(this.frameTimestampsInTime.length-1)/e;return t?1e3*t:60}},{key:"getFpsString",value:function(){return this.getFps().toFixed(1)}},{key:"getUpsString",value:function(){return this.getUps().toFixed(1)}}]),e}();function p(e){var t=Object(r.useRef)(new f);return Object(r.useEffect)((function(){t.current.tick(0)}),[e.tick]),Object(i.jsxs)("div",{className:"text",children:[Object(i.jsxs)("div",{children:[e.windowState.innerWidth,"x",e.windowState.innerHeight]}),Object(i.jsx)(v,{}),Object(i.jsxs)("div",{children:["UPS: ",t.current.getFpsString()]})]})}function v(){var e=Object(r.useState)(0),t=Object(u.a)(e,2),n=t[0],a=t[1],o=Object(r.useRef)(new f);Object(r.useEffect)((function(){var e=setTimeout((function(){a((function(e){return e+1})),o.current.tick(0)}),5);return function(){return clearTimeout(e)}}),[n]);var c=Object(r.useMemo)((function(){return o.current.getFpsString()}),[n]);return Object(i.jsxs)("div",{children:["RPS: ",c]})}var y=1e-7,O=n(8),b=function(){function e(){Object(l.a)(this,e)}return Object(h.a)(e,null,[{key:"MinBy",value:function(e,t){var n,i=null,r=null,a=Object(O.a)(e);try{for(a.s();!(n=a.n()).done;){var o=n.value,c=t(o);(null===r||c<r)&&(i=o,r=c)}}catch(u){a.e(u)}finally{a.f()}return i}},{key:"MinByAndValue",value:function(e,t){var n,i=null,r=null,a=Object(O.a)(e);try{for(a.s();!(n=a.n()).done;){var o=n.value,c=t(o);(null===r||c<r)&&(i=o,r=c)}}catch(u){a.e(u)}finally{a.f()}return null===i||null===r?null:{obj:i,value:r}}},{key:"MaxBy",value:function(e,t){var n,i=null,r=null,a=Object(O.a)(e);try{for(a.s();!(n=a.n()).done;){var o=n.value,c=t(o);(null===r||c>r)&&(i=o,r=c)}}catch(u){a.e(u)}finally{a.f()}return i}},{key:"RandRange",value:function(e,t){return Math.floor(Math.random()*(t-e)+e)}},{key:"SortByKey",value:function(e,t){return e.sort((function(e,n){return t(e)-t(n)}))}},{key:"ReplaceAll",value:function(e,t){var n=new RegExp(Object.keys(t).join("|"),"gi");return e.replace(n,(function(e){return t[e.toLowerCase()]}))}},{key:"Debounce",value:function(e){var t,n=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{isImmediate:!1},a=function(){for(var a=arguments.length,o=new Array(a),c=0;c<a;c++)o[c]=arguments[c];var u=function(){t=void 0,r.isImmediate||e.apply(n,o)},s=r.isImmediate&&void 0===t;void 0!==t&&clearTimeout(t),t=setTimeout(u,i),s&&e.apply(n,o)};return a}},{key:"FormatDate",value:function(e){var t=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][e.getMonth()];return"".concat(t," ").concat(e.getDate(),", ").concat(("00"+e.getHours()).substr(-2),":").concat(("00"+e.getMinutes()).substr(-2),":").concat(("00"+e.getSeconds()).substr(-2))}},{key:"FlattenByOne",value:function(e){var t,n=[],i=Object(O.a)(e);try{for(i.s();!(t=i.n()).done;){var r=t.value;n=n.concat(r)}}catch(a){i.e(a)}finally{i.f()}return n}},{key:"PadString",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:" ";return e+n+i.repeat(t-e.length)}}]),e}();function S(e,t){var n=[16711680&e,16711680&t],i=[255&e,255&t],r=[65280&e,65280&t],a=65536*Math.round(n[0]/65536*n[1]/16777215);return a+=256*Math.round(r[0]/256*r[1]/65280),a+=Math.round(i[0]*i[1]/255)}function m(e){return Object.keys(e)}var g=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{x:0,y:0},n=arguments.length>1?arguments[1]:void 0;Object(l.a)(this,e),this._x=void 0,this._y=void 0,"number"===typeof t?(this._x=t,this._y=n):(this._x=t.x,this._y=t.y)}return Object(h.a)(e,[{key:"x",get:function(){return this._x}},{key:"y",get:function(){return this._y}}]),Object(h.a)(e,[{key:"hash",value:function(){return this.toString()}},{key:"toString",value:function(){return"[".concat(this.x,", ").concat(this.y,"]")}},{key:"invert",value:function(){return new e({x:-this.x,y:-this.y})}},{key:"round",value:function(){return new e({x:Math.round(this.x),y:Math.round(this.y)})}},{key:"floor",value:function(){return new e({x:Math.floor(this.x),y:Math.floor(this.y)})}},{key:"taxicabDistance",value:function(e){return Math.abs(e.x-this.x)+Math.abs(e.y-this.y)}},{key:"diagonalDistance",value:function(e){return Math.max(Math.abs(e.x-this.x),Math.abs(e.y-this.y))}},{key:"distance",value:function(e){var t=Math.abs(e.x-this.x),n=Math.abs(e.y-this.y);return Math.sqrt(t*t+n*n)}},{key:"translate",value:function(t){return new e({x:this.x+t.x,y:this.y+t.y})}},{key:"subtract",value:function(t){return new e({x:this.x-t.x,y:this.y-t.y})}},{key:"add",value:function(t){return new e({x:this.x+t.x,y:this.y+t.y})}},{key:"addX",value:function(t){return new e({x:this.x+t,y:this.y})}},{key:"addY",value:function(t){return new e({x:this.x,y:this.y+t})}},{key:"subtractX",value:function(t){return new e({x:this.x-t,y:this.y})}},{key:"subtractY",value:function(t){return new e({x:this.x,y:this.y-t})}},{key:"clampX",value:function(t,n){var i=this.x;return i<t&&(i=t),i>n&&(i=n),new e({x:i,y:this.y})}},{key:"clampY",value:function(t,n){var i=this.y;return i<t&&(i=t),i>n&&(i=n),new e({x:this.x,y:i})}},{key:"scale",value:function(t,n){return new e({x:(this.x-t.x)*n.x+t.x,y:(this.y-t.y)*n.y+t.y})}},{key:"rotate",value:function(t,n){return n/=180/Math.PI,new e({x:Math.cos(n)*(this.x-t.x)-Math.sin(n)*(this.y-t.y)+t.x,y:Math.sin(n)*(this.x-t.x)+Math.cos(n)*(this.y-t.y)+t.y})}},{key:"equals",value:function(e){return void 0!==e&&(Math.abs(this.x-e.x)<y&&Math.abs(this.y-e.y)<y)}},{key:"multiply",value:function(t){return new e("number"===typeof t?{x:this.x*t,y:this.y*t}:{x:this.x*t.x,y:this.y*t.y})}},{key:"divide",value:function(t){return new e("number"===typeof t?{x:this.x/t,y:this.y/t}:{x:this.x/t.x,y:this.y/t.y})}},{key:"toJSON",value:function(){return{__type:"Vector2",x:this.x,y:this.y}}},{key:"transform",value:function(t,n){return new e({x:Math.floor((this.x-t.x)*n),y:Math.floor((this.y-t.y)*n)})}},{key:"normalize",value:function(){if(0===this.x&&0===this.y)return this;var t=Math.sqrt(this.x*this.x+this.y*this.y);return new e({x:this.x/t,y:this.y/t})}},{key:"withX",value:function(t){return new e({x:t,y:this.y})}},{key:"withY",value:function(t){return new e({x:this.x,y:t})}},{key:"invertX",value:function(){return new e({x:-this.x,y:this.y})}},{key:"lerp",value:function(e,t){return(t>1||t<0)&&console.error("Lerp t must be between 0 and 1."),0===t?this:1===t?e:this.scale({x:0,y:0},{x:1-t,y:1-t}).add(e.scale({x:0,y:0},{x:t,y:t}))}},{key:"lerp2D",value:function(e,t,n){return(t>1||t<0||n>1||n<0)&&console.error("Lerp t must be between 0 and 1."),this.scale({x:0,y:0},{x:1-t,y:1-n}).add(e.scale({x:0,y:0},{x:t,y:n}))}},{key:"coserp",value:function(e,t){return t=.5*(1+Math.cos(2*t*Math.PI)),this.lerp(e,t)}},{key:"half",get:function(){return new e({x:this.x/2,y:this.y/2})}}],[{key:"IsVector2",value:function(t){return t instanceof e}},{key:"Random",value:function(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return new e({x:b.RandRange(i,t),y:b.RandRange(r,n)})}},{key:"Deserialize",value:function(t){return t.hasOwnProperty("x")&&t.hasOwnProperty("y")||console.error("Failed deserializing point"),new e({x:t.x,y:t.y})}},{key:"Serialize",value:function(e){return JSON.stringify({x:e.x,y:e.y})}}]),e}();g.Zero=new g(0,0),g.One=new g(1,1);var k,j,x,w,E=function(){function e(t){Object(l.a)(this,e),this.z=void 0,this.chunkCoord=void 0,this.pointNodeCoord=void 0,this.pointNodeId=void 0,this.z=t.z,this.chunkCoord=t.chunkCoord,this.pointNodeCoord=t.pointNodeCoord,this.pointNodeId=t.pointNodeId}return Object(h.a)(e,[{key:"hash",value:function(){return this.pointNodeId.toString()+this.z.toString()+this.chunkCoord.toString()+this.pointNodeCoord.toString()}},{key:"toString",value:function(){return this.z+","+this.chunkCoord.toString()+","+this.pointNodeCoord.toString()}}]),e}(),N=function e(){Object(l.a)(this,e)};N.CHUNK_HALF_DIM=((N.CHUNK_DIM=9)-1)/2,N.DROP_NODES_CHANCE=0,function(e){e.Basic="Basic",e.Nothing="Nothing",e.EfficiencyGate="EfficiencyGate"}(k||(k={})),function(e){e.Mana0="Mana0",e.Mana1="Mana1",e.Mana2="Mana2"}(j||(j={})),function(e){e.Flat="Flat",e.Increased0="% increased",e.AfterIncreased0="added after % increased",e.Increased1="% increased multiplier",e.AfterIncreased1="added after % increased multiplier"}(x||(x={})),function(e){e.NOOP="NOOP",e.PAN_NORTH="PAN_NORTH",e.PAN_SOUTH="PAN_SOUTH",e.PAN_WEST="PAN_WEST",e.PAN_EAST="PAN_EAST",e.TRAVEL_UPSTAIRS="TRAVEL_UPSTAIRS",e.TRAVEL_DOWNSTAIRS="TRAVEL_DOWNSTAIRS",e.TOGGLE_STRATEGIC_VIEW="TOGGLE_STRATEGIC_VIEW",e.TOGGLE_SIDEBAR="TOGGLE_SIDEBAR",e.MOVE_CURSOR_WEST="MOVE_CURSOR_WEST",e.MOVE_CURSOR_EAST="MOVE_CURSOR_EAST",e.MOVE_CURSOR_NORTH="MOVE_CURSOR_NORTH",e.MOVE_CURSOR_SOUTH="MOVE_CURSOR_SOUTH",e.MOVE_CURSOR_NORTHWEST="MOVE_CURSOR_NORTHWEST",e.MOVE_CURSOR_NORTHEAST="MOVE_CURSOR_NORTHEAST",e.MOVE_CURSOR_SOUTHWEST="MOVE_CURSOR_SOUTHWEST",e.MOVE_CURSOR_SOUTHEAST="MOVE_CURSOR_SOUTHEAST",e.INTERACT_WITH_NODE="INTERACT_WITH_NODE"}(w||(w={}));var T=m(w).reduce((function(e,t){return e[t]=!1,e}),{});function _(e){return new g({x:Math.min(1920,((null===e||void 0===e?void 0:e.x)||1/0)-24),y:Math.min(1080,((null===e||void 0===e?void 0:e.y)||1/0)-24)})}var I=function(){function e(t){Object(l.a)(this,e),this.type=void 0,this.modifier=void 0,this.type=t.type,this.modifier=t.modifier}return Object(h.a)(e,[{key:"hash",value:function(){return this.type.toString()+","+this.modifier.toString()}}]),e}(),C=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{x:0,y:0,z:0},n=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0;Object(l.a)(this,e),this._x=void 0,this._y=void 0,this._z=void 0,"number"===typeof t?(this._x=t,this._y=n,this._z=i):(this._x=t.x,this._y=t.y,this._z=t.z)}return Object(h.a)(e,[{key:"x",get:function(){return this._x}},{key:"y",get:function(){return this._y}},{key:"z",get:function(){return this._z}}]),Object(h.a)(e,[{key:"hash",value:function(){return this.toString()}},{key:"toString",value:function(){return"[".concat(this.x,", ").concat(this.y,", ").concat(this.z,"]")}},{key:"subtract",value:function(t){return new e({x:this.x-t.x,y:this.y-t.y,z:this.z-t.z})}},{key:"add",value:function(t,n,i){return new e("number"===typeof t?{x:this.x+t,y:this.y+n,z:this.z+i}:{x:this.x+t.x,y:this.y+t.y,z:this.z+t.z})}},{key:"addX",value:function(t){return new e({x:this.x+t,y:this.y,z:this.z})}},{key:"addY",value:function(t){return new e({x:this.x,y:this.y+t,z:this.z})}},{key:"addZ",value:function(t){return new e({x:this.x,y:this.y,z:this.z+t})}},{key:"subtractX",value:function(t){return new e({x:this.x-t,y:this.y,z:this.z})}},{key:"subtractY",value:function(t){return new e({x:this.x,y:this.y-t,z:this.z})}},{key:"subtractZ",value:function(t){return new e({x:this.x,y:this.y,z:this.z-t})}},{key:"scale",value:function(t,n){return new e({x:(this.x-t.x)*n.x+t.x,y:(this.y-t.y)*n.y+t.y,z:(this.z-t.z)*n.z+t.z})}},{key:"equals",value:function(e){return void 0!==e&&(Math.abs(this.x-e.x)<y&&Math.abs(this.y-e.y)<y&&Math.abs(this.z-e.z)<y)}},{key:"multiply",value:function(t){return new e("number"===typeof t?{x:this.x*t,y:this.y*t,z:this.z*t}:{x:this.x*t.x,y:this.y*t.y,z:this.z*t.z})}},{key:"divide",value:function(t){return new e("number"===typeof t?{x:this.x/t,y:this.y/t,z:this.z/t}:{x:this.x/t.x,y:this.y/t.y,z:this.z/t.z})}},{key:"toJSON",value:function(){return{__type:"Vector3",x:this.x,y:this.y,z:this.z}}},{key:"pairXY",value:function(){return new g({x:this.x,y:this.y})}},{key:"withX",value:function(t){return new e({x:t,y:this.y,z:this.z})}},{key:"withY",value:function(t){return new e({x:this.x,y:t,z:this.z})}},{key:"withZ",value:function(t){return new e({x:this.x,y:this.y,z:t})}}],[{key:"IsVector3",value:function(t){return t instanceof e}},{key:"FromVector2",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new e(t.x,t.y,n)}},{key:"Deserialize",value:function(t){return t.hasOwnProperty("x")&&t.hasOwnProperty("y")&&t.hasOwnProperty("z")||console.error("Failed deserializing vector3"),new e({x:t.x,y:t.y,z:t.z})}},{key:"Serialize",value:function(e){return JSON.stringify({x:e.x,y:e.y})}}]),e}();C.Zero=new C(0,0,0),C.One=new C(1,1,1);var U,M,A=n(9),R=n(11),D=n(5);function z(e){for(var t=e.randInt,n=e.weights,i=e.behaviors,r=t/D.a,a=Object(D.b)(t),o=r*Object.values(n).reduce((function(e,t){return e+t})),c=0,s=Object.entries(n);c<s.length;c++){var d=Object(u.a)(s[c],2),l=d[0],h=d[1];if(o<=h)return i[l](a);o-=h}throw Error()}function H(e){var t,n=e.randInt,i=e.weights,r=n/D.a*Object.values(i).reduce((function(e,t){return e+t})),a=Object(O.a)(Object.entries(i));try{for(a.s();!(t=a.n()).done;){var o=Object(u.a)(t.value,2),c=o[0],s=o[1];if(r<=s)return c;r-=s}}catch(d){a.e(d)}finally{a.f()}throw Error()}function P(e){var t=e.randInt,n=e.min,i=e.max,r=e.increment,a=void 0===r?1:r,o=e.inclusive,c=void 0===o||o,u=t/D.a,s=Math.ceil((i-n)/a);return n+a*s===i&&!0===c&&(s+=1),n+Math.floor(u*s)*a}!function(e){e.RED0="RED0",e.RED1="RED1",e.RED2="RED2",e.DEL0="DEL0",e.DEL1="DEL1",e.DEL2="DEL2"}(U||(U={})),function(e){e.FLAT="FLAT",e.INCREASED="INCREASED"}(M||(M={}));var L,G,W,F={DECISION_0:{EMPTY:800,NO_SPEND:100,SPEND:10},DECISION_1:{SINGLE:500,DOUBLE:100}},q=function(){function e(t){Object(l.a)(this,e),this.config=void 0,this.config=t}return Object(h.a)(e,[{key:"createSingle",value:function(e){var t,n,i=H({randInt:e.randInt,weights:(t={},Object(A.a)(t,U.RED0,100),Object(A.a)(t,U.RED1,100),Object(A.a)(t,U.RED2,100),Object(A.a)(t,U.DEL0,10),Object(A.a)(t,U.DEL1,10),Object(A.a)(t,U.DEL2,10),t)}),r=H({randInt:Object(D.b)(e.randInt),weights:(n={},Object(A.a)(n,M.FLAT,100),Object(A.a)(n,M.INCREASED,75),n)}),a=0;return a=r===M.FLAT?function(e){for(var t=e.randInt,n=e.formula,i=e.plus,r=void 0===i?0:i,a=parseInt(n.split("d")[0]),o=parseInt(n.split("d")[1]),c=0,u=0;u<a;u++)c+=P({randInt:Object(D.b)(t+u),min:1,max:o,inclusive:!0});return c+r}({randInt:Object(D.b)(e.randInt+1),formula:"2d6",plus:8}):P({randInt:Object(D.b)(e.randInt+2),min:4,max:7,increment:.5,inclusive:!0}),{attribute:U[i],amount:a,modifier:M[r]}}},{key:"createNoSpend",value:function(e){var t=this;return z({randInt:e.randInt,weights:F.DECISION_1,behaviors:{SINGLE:function(e){return{lines:[t.createSingle({randInt:e})]}},DOUBLE:function(e){return{lines:[t.createSingle({randInt:e}),t.createSingle({randInt:Object(D.b)(e)})]}}}})}},{key:"create",value:function(e){var t=this,n=e.seed,i=e.location;return i.equals(C.Zero)?{lines:[]}:z({randInt:Object(D.b)(n+i.x+i.y+Object(D.b)(n+i.x+i.z)),weights:F.DECISION_0,behaviors:{EMPTY:function(e){return{lines:[]}},NO_SPEND:function(e){return t.createNoSpend({randInt:e})},SPEND:function(e){var n,i=t.createNoSpend({randInt:e}),r=H({randInt:e,weights:(n={},Object(A.a)(n,U.RED0,100),Object(A.a)(n,U.RED1,100),Object(A.a)(n,U.RED2,100),Object(A.a)(n,U.DEL0,0),Object(A.a)(n,U.DEL1,0),Object(A.a)(n,U.DEL2,0),n)});return Object(R.a)(Object(R.a)({},i),{},{condition:{type:"SPEND",amount:12,attribute:U[r]}})}}})}}]),e}(),V=(L={},Object(A.a)(L,U.RED0,"\ud83d\udd34"),Object(A.a)(L,U.RED1,"\ud83d\udfe2"),Object(A.a)(L,U.RED2,"\ud83d\udd35"),Object(A.a)(L,U.DEL0,"\u2694\ufe0f"),Object(A.a)(L,U.DEL1,"\ud83d\udee1"),Object(A.a)(L,U.DEL2,"\u2728"),L),B=(G={},Object(A.a)(G,U.RED0,"Red"),Object(A.a)(G,U.RED1,"Green"),Object(A.a)(G,U.RED2,"Blue"),Object(A.a)(G,U.DEL0,"Offense"),Object(A.a)(G,U.DEL1,"Defense"),Object(A.a)(G,U.DEL2,"Magic"),G);W={},Object(A.a)(W,M.FLAT,"flat"),Object(A.a)(W,M.INCREASED,"increased");function K(e){return e.modifier===M.FLAT?"+".concat(e.amount," ").concat(B[e.attribute]):"".concat(e.amount,"% increased ").concat(B[e.attribute])}var X=n(13),Z=n(12),Y=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];Object(l.a)(this,e),this._values=void 0,this._values=new J;var n,i=Object(O.a)(t);try{for(i.s();!(n=i.n()).done;){var r=n.value;this.put(r)}}catch(a){i.e(a)}finally{i.f()}}return Object(h.a)(e,[{key:"remove",value:function(e){this._values.remove(e)}},{key:"put",value:function(e){this._values.put(e,e)}},{key:"get",value:function(e){return void 0!==this._values.get(e)}},{key:"contains",value:function(e){return this._values.contains(e)}},{key:"values",value:function(){return this._values.values()}},{key:"clone",value:function(){var t=new e;return t._values=this._values.clone(),t}},{key:"size",value:function(){return this._values.size()}},{key:"equals",value:function(e){if(void 0===e||null===e)return!1;if(this.size()!==e.size())return!1;var t,n=Object(O.a)(this.values());try{for(n.s();!(t=n.n()).done;){var i=t.value;if(!e.contains(i))return!1}}catch(r){n.e(r)}finally{n.f()}return!0}}]),e}(),J=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];Object(l.a)(this,e),this._values={};var n,i=Object(O.a)(t);try{for(i.s();!(n=i.n()).done;){var r=Object(u.a)(n.value,2),a=r[0],o=r[1];this.put(a,o)}}catch(c){i.e(c)}finally{i.f()}}return Object(h.a)(e,[{key:"put",value:function(e,t){this._values[e.hash()]=t}},{key:"remove",value:function(e){delete this._values[e.hash()]}},{key:"get",value:function(e){return this._values[e.hash()]}},{key:"contains",value:function(e){return void 0!==this.get(e)&&e.hash()in this._values}},{key:"values",value:function(){return Object.values(this._values)}},{key:"size",value:function(){return Object.keys(this._values).length}},{key:"clone",value:function(){var t=new e;return t._values=Object(R.a)({},this._values),t}}]),e}(),Q=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];Object(l.a)(this,e),this._kvalues={};var n,i=Object(O.a)(t);try{for(i.s();!(n=i.n()).done;){var r=Object(u.a)(n.value,2),a=r[0],o=r[1];this.put(a,o)}}catch(c){i.e(c)}finally{i.f()}}return Object(h.a)(e,[{key:"put",value:function(e,t){this._kvalues[e.hash()]=[e,t]}},{key:"remove",value:function(e){delete this._kvalues[e.hash()]}},{key:"get",value:function(e){var t;return null===(t=this._kvalues[e.hash()])||void 0===t?void 0:t[1]}},{key:"contains",value:function(e){return void 0!==this.get(e)&&e.hash()in this._kvalues}},{key:"keys",value:function(){var e=this;return Object.keys(this._kvalues).map((function(t){return e._kvalues[t][0]}))}},{key:"entries",value:function(){var e=this;return Object.keys(this._kvalues).map((function(t){return e._kvalues[t]}))}},{key:"values",value:function(){var e=this;return Object.keys(this._kvalues).map((function(t){return e._kvalues[t][1]}))}},{key:"hashKeyset",value:function(){return Object.keys(this._kvalues).map((function(e){return $(e)})).reduce((function(e,t){return e+t})).toString()}},{key:"clone",value:function(){var t=new e;return t._kvalues=Object(R.a)({},this._kvalues),t}},{key:"size",value:function(){return Object.keys(this._kvalues).length}}]),e}();function $(e){for(var t=0,n=0;n<e.length;n++)t=Math.imul(31,t)+e.charCodeAt(n)|0;return t}n(226),n(121);var ee={backgroundBlue:2236962,nodePink:3351108,nodeLavender:7829367,nodeBlue:14540253,nodeAqua:16755370,gateTint:16777215,selectedTint:12303359,allocatedTint:4473924,nodeBorder:6710886,nullTint:16777215,tooltipBorderBlack:2236962,tooltipFillWhite:15658734,white:16777215,grayBlack:1907997,borderBlack:1118481,borderWhite:6710886,black:0};function te(e){return"#"+e.toString(16)}n(227);var ne=a.a.memo(ie);function ie(e){var t=e.idx,n=e.rowIdx,a=e.onUpdateStatus,o=e.nodeData,c=e.isCursored,u=e.onUpdateCursored,s=Object(r.useCallback)((function(e){e.stopPropagation(),e.preventDefault(),a({virtualDims:new g(t,n),newStatus:re.TAKEN})}),[a,o.status,t,n]),d=Object(r.useCallback)((function(e){e.stopPropagation(),e.preventDefault(),u(c?void 0:new g(t,n))}),[c,u]);return Object(i.jsx)(oe,{onClickCenter:s,nodeData:o,onClickQuestionMark:d,isCursored:c})}var re,ae,oe=a.a.memo(ce);function ce(e){var t,n,r=e.onClickCenter,a=e.onClickQuestionMark,o=e.nodeData,c=e.isCursored,u=o.status,s=!!o.lockData;return Object(i.jsxs)("div",{className:"hex-block hex-full-block",children:[Object(i.jsx)("div",{className:d()("hex-center",u===re.TAKEN?"node-allocated":"node-unallocated",u===re.TAKEN||u===re.UNREACHABLE?"border-unimportant":"border-important"),onClick:r,hidden:u===re.HIDDEN,children:Object(i.jsx)("div",{className:"hex-center-text-wrapper",children:Object(i.jsx)("div",{className:"tiny-text",children:o.shortText})})}),s?Object(i.jsxs)("div",{className:"hex-center-lock",hidden:u===re.HIDDEN,children:[Object(i.jsx)("div",{className:"hex-center-lock-left",children:Object(i.jsx)("div",{className:"tiny-text",children:null===(t=o.lockData)||void 0===t?void 0:t.shortTextTarget})}),Object(i.jsx)("div",{className:"hex-center-lock-right",children:Object(i.jsx)("div",{className:"tiny-text",children:null===(n=o.lockData)||void 0===n?void 0:n.shortTextTimer})})]}):null,Object(i.jsx)("div",{className:"empty-positioned",children:Object(i.jsx)("div",{className:"hover-only-2 absolute-positioned",children:Object(i.jsx)("div",{className:"question",hidden:u===re.HIDDEN,onClick:a,children:"?"})})}),Object(i.jsx)("div",{className:"empty-positioned node-tooltip-wrapper",children:Object(i.jsx)("div",{className:"hover-only absolute-positioned node-tooltip",children:o.toolTipText})}),Object(i.jsx)("div",{className:"empty-positioned selection-cursor-wrapper",children:Object(i.jsx)("div",{className:"absolute-positioned selection-cursor",hidden:!c})})]})}!function(e){e.TAKEN="TAKEN",e.VISIBLE="VISIBLE",e.HIDDEN="HIDDEN",e.AVAILABLE="AVAILABLE",e.UNREACHABLE="UNREACHABLE"}(re||(re={})),function(e){e.CLOSED="CLOSED",e.TICKING="TICKING",e.OPEN="OPEN"}(ae||(ae={}));var ue=a.a.memo(se);function se(e){var t=Object(r.useRef)(null),n=Object(r.useRef)(null),a=he.x,o=he.y;Object(r.useEffect)((function(){document.documentElement.style.setProperty("--grid-width"," ".concat(he.x,"px")),document.documentElement.style.setProperty("--grid-height"," ".concat(he.y,"px"))}),[he]),Object(r.useEffect)((function(){document.documentElement.style.setProperty("--hex-center-radius"," ".concat(fe,"px"))}),[fe]),Object(r.useEffect)((function(){document.documentElement.style.setProperty("--background-black",te(ee.backgroundBlue)),document.documentElement.style.setProperty("--deemphasized-black",te(ee.grayBlack)),document.documentElement.style.setProperty("--active-purple",te(ee.nodePink)),document.documentElement.style.setProperty("--border-unimportant-black",te(ee.borderBlack)),document.documentElement.style.setProperty("--border-important-white",te(ee.borderWhite))}),[ee]),Object(r.useEffect)((function(){document.documentElement.style.setProperty("--app-size-width"," ".concat(e.appSize.x,"px")),document.documentElement.style.setProperty("--app-size-height"," ".concat(e.appSize.y,"px"))}),[e.appSize]),Object(r.useEffect)((function(){var n=e.jumpOffset;if(n){var i=t.current;i&&i.scrollTo(i.scrollLeft-n.x*a,i.scrollTop-n.y*o)}}),[e.jumpOffset]);var c=Object(r.useCallback)((function(t){var n={x:0,y:0},i=t.target,r=i.scrollTop,c=i.scrollLeft;i.scrollTop<.4*o&&(r+=2*o,n.y-=1),i.scrollTop>(e.virtualGridDims.y-.4)*o-e.appSize.y&&(r-=2*o,n.y+=1),i.scrollLeft<.9*a&&(c+=2*a,n.x-=1),i.scrollLeft>(e.virtualGridDims.x-.9)*a-e.appSize.x&&(c-=2*a,n.x+=1),i.scrollTop===r&&i.scrollLeft===c||e.onJump({direction:new g(n.x,n.y)})}),[e.appSize.x,e.appSize.y]);return Object(r.useEffect)((function(){null!=t.current&&t.current!==n.current&&(t.current.scrollTop=(e.virtualGridDims.y*o-e.appSize.y)/2,t.current.scrollLeft=((e.virtualGridDims.x+.5)*a-e.appSize.x)/2),n.current=t.current}),[t.current,e.appSize]),Object(r.useEffect)((function(){if(!e.keyboardScrollDirection.equals(g.Zero)){var n=null,i=function(){var i=t.current;if(i){var r=g.Zero;if(null===n)r=e.keyboardScrollDirection.multiply(8),n=+new Date;else{var a=+new Date-n;a>40&&console.log("WAS SLOW - "+a.toString()),r=e.keyboardScrollDirection.multiply(a),n=+new Date}r=r.multiply(.75),i.scrollTo(i.scrollLeft+r.x,i.scrollTop-r.y)}},r=setInterval(i,8);return i(),function(){return clearInterval(r)}}}),[e.keyboardScrollDirection,t.current]),Object(i.jsx)("div",{ref:t,className:"game-area hidden-scrollbars",hidden:e.hidden,onScroll:c,children:Object(i.jsx)("div",{className:"virtual-game-area",children:Array(e.virtualGridDims.y).fill(0).map((function(t,n){return Object(i.jsx)(de,{rowIdx:n,children:Array(e.virtualGridDims.x).fill(0).map((function(t,r){var a,o=new g(r,n),c=e.virtualGridStatusMap.get(o);return Object(i.jsx)(ne,{nodeData:c,idx:r,rowIdx:n,onUpdateStatus:e.updateNodeStatusCb,isCursored:!!e.cursoredVirtualNode&&e.cursoredVirtualNode.equals(o),onUpdateCursored:e.setCursoredVirtualNode},null!==(a=null===c||void 0===c?void 0:c.id)&&void 0!==a?a:"loading".concat(r))}))},e.virtualDimsToLocation(new g(0,n)).y.toString())}))})})}var de=a.a.memo(le);function le(e){var t=e.rowIdx,n=e.children,r=!!(t%2);return Object(i.jsxs)("div",{className:"hex-block-row",children:[r&&Object(i.jsx)("div",{className:"hex-block hex-half-block"}),n,!r&&Object(i.jsx)("div",{className:"hex-block hex-half-block"})]})}var he=new g(268,232),fe=48,pe=a.a.memo(ve);function ve(e){var t=e.gameState,n=Object(r.useMemo)((function(){return _(new g(t.windowState.innerWidth,t.windowState.innerHeight))}),[t.windowState.innerWidth,t.windowState.innerHeight]),a=Object(r.useState)(new g(0,0)),o=Object(u.a)(a,2),c=o[0],s=o[1],d=Object(r.useMemo)((function(){return new g(Math.max(4,Math.floor(3*n.x/he.x-.5)),Math.max(5,Math.floor(3*n.y/he.y)))}),[n,3,he]),l=Object(r.useCallback)((function(e){return function(e){var t=e.virtualCoords,n=e.virtualGridLocation,i=e.virtualGridDims.divide(2).floor(),r=t.subtract(i),a=g.Zero;return a=(a=r.y%2===0?new g(-1,-2).multiply(r.y/2):i.y%2===0?new g(0,-1).add(new g(-1,-2).multiply((r.y-1)/2)):new g(-1,-1).add(new g(-1,-2).multiply((r.y-1)/2))).addX(r.x),n.add(C.FromVector2(a,0))}({virtualCoords:e,virtualGridDims:d,virtualGridLocation:t.playerUI.virtualGridLocation})}),[t.playerUI.virtualGridLocation,d]),h=Object(r.useCallback)((function(e){return function(e){var t=e.location,n=e.virtualGridLocation,i=e.virtualGridDims.divide(2).floor(),r=t.subtract(n),a=g.Zero;if(0===r.z)return a=(a=r.y%2===0?new g(-1,-2).multiply(r.y/2):i.y%2===0?new g(-1,-1).add(new g(-1,-2).multiply((r.y-1)/2)):new g(0,-1).add(new g(-1,-2).multiply((r.y-1)/2))).addX(r.x),i.add(a)}({location:e,virtualGridDims:d,virtualGridLocation:t.playerUI.virtualGridLocation})}),[t.playerUI.virtualGridLocation,d]),f=Object(r.useMemo)((function(){return function(e){for(var t,n=e.allocationStatusMap,r=e.nodeContentsMap,a=e.lockMap,o=e.fogOfWarStatusMap,c=e.virtualGridDims,u=e.virtualDimsToLocation,s=+new Date,d=new Q,l=0;l<c.x;l++)for(var h=0;h<c.y;h++){var f=new g(l,h),p=u(f),v=null===o||void 0===o?void 0:o.get(p),y=n.get(p)===re.TAKEN?re.TAKEN:v||re.HIDDEN,O=p.hash(),b=a.get(p),S=r.get(p),m="+";S.lines[0]?m+=V[S.lines[0].attribute]:m="",S.lines[1]&&S.lines[0].attribute!==S.lines[1].attribute&&(m+=V[S.lines[1].attribute]);var k="";S.condition&&(k="-"+V[S.condition.attribute]);var j={shortText:k?Object(i.jsxs)(i.Fragment,{children:[m,Object(i.jsx)("br",{}),k]}):Object(i.jsx)(i.Fragment,{children:m}),toolTipText:Object(i.jsxs)(i.Fragment,{children:[Object(i.jsx)("div",{children:y.toString()}),S.lines[0]?Object(i.jsx)("br",{}):Object(i.jsx)(i.Fragment,{}),Object(i.jsx)("div",{children:S.lines[0]&&K(S.lines[0])}),Object(i.jsx)("div",{children:S.lines[1]&&K(S.lines[1])}),Object(i.jsx)("div",{children:S.condition&&(t=S.condition,"SPEND: ".concat(t.amount," ").concat(B[t.attribute]))})]}),fullText:Object(i.jsx)(i.Fragment,{children:" "}),status:y,lockData:b,id:O};d.put(f,j)}var x=+new Date-s;return x>100&&window.alert("compute took "+x.toString()),d}({allocationStatusMap:t.playerSave.allocationStatusMap,nodeContentsMap:t.worldGen.nodeContentsMap,lockMap:t.worldGen.lockMap,fogOfWarStatusMap:t.computed.fogOfWarStatusMap,virtualGridDims:d,virtualDimsToLocation:l})}),[t.playerSave.allocationStatusMap,t.worldGen.nodeContentsMap,t.worldGen.lockMap,t.computed.fogOfWarStatusMap,d,l]),p=Object(r.useCallback)((function(t){var n=d.multiply(.35).floor(),i=(n=(n=n.withY(2*Math.floor(n.y/2))).clampX(1,d.x-1).clampY(2,2*Math.floor((d.y-1)/2))).multiply(t.direction);console.log({jumpOffset:i}),e.updaters.playerUI.virtualGridLocation.enqueueUpdate((function(e){return e.addX(i.x).add(new C(-1,-2,0).multiply(i.y/2))})),s(i.multiply(1))}),[d]),v=Object(r.useCallback)((function(n){var i,r=n.virtualDims,a=n.newStatus,o=l(r),c=(null===(i=t.computed.fogOfWarStatusMap)||void 0===i?void 0:i.get(o))||re.HIDDEN;if(a===re.TAKEN){if(c!==re.AVAILABLE)return void console.log("cant do that",c);var u=t.worldGen.lockMap.get(o);if(u)return void console.log("is locked",u)}t.playerSave.allocationStatusMap.get(o)!==re.TAKEN&&e.actions.allocateNode.enqueueAction({nodeLocation:o,newStatus:re.TAKEN})}),[e.updaters,l,t.playerSave.allocationStatusMap,t.computed.fogOfWarStatusMap,t.computed.lockStatusMap,t.worldGen.lockMap]),y=Object(r.useMemo)((function(){return t.playerUI.cursoredNodeLocation?(console.log({3:t.playerUI.cursoredNodeLocation,2:h(t.playerUI.cursoredNodeLocation)}),h(t.playerUI.cursoredNodeLocation)):void 0}),[t.playerUI.cursoredNodeLocation,h]),O=Object(r.useCallback)((function(t){e.updaters.playerUI.cursoredNodeLocation.enqueueUpdate((function(e){var n=t?l(t):void 0;return console.log({updated:n}),n})),t&&e.updaters.playerUI.isSidebarOpen.enqueueUpdate((function(){return!0}))}),[e.updaters,l]);Object(r.useEffect)((function(){var t=e.gameState.intent.newIntent,n=l(d.divide(2).floor());t[w.MOVE_CURSOR_EAST]&&e.updaters.playerUI.cursoredNodeLocation.enqueueUpdate((function(e){return(null===e||void 0===e?void 0:e.addX(1))||n})),t[w.MOVE_CURSOR_WEST]&&e.updaters.playerUI.cursoredNodeLocation.enqueueUpdate((function(e){return(null===e||void 0===e?void 0:e.addX(-1))||n})),t[w.MOVE_CURSOR_NORTHEAST]&&e.updaters.playerUI.cursoredNodeLocation.enqueueUpdate((function(e){return(null===e||void 0===e?void 0:e.add({x:1,y:1,z:0}))||n})),t[w.MOVE_CURSOR_NORTHWEST]&&e.updaters.playerUI.cursoredNodeLocation.enqueueUpdate((function(e){return(null===e||void 0===e?void 0:e.addY(1))||n})),t[w.MOVE_CURSOR_SOUTHEAST]&&e.updaters.playerUI.cursoredNodeLocation.enqueueUpdate((function(e){return(null===e||void 0===e?void 0:e.addY(-1))||n})),t[w.MOVE_CURSOR_SOUTHWEST]&&e.updaters.playerUI.cursoredNodeLocation.enqueueUpdate((function(e){return(null===e||void 0===e?void 0:e.add({x:-1,y:-1,z:0}))||n})),t[w.MOVE_CURSOR_SOUTH]&&e.updaters.playerUI.cursoredNodeLocation.enqueueUpdate((function(e){return e&&e.y%2===0?null===e||void 0===e?void 0:e.add({x:0,y:-1,z:0}):e&&e.y%2!==0?null===e||void 0===e?void 0:e.add({x:-1,y:-1,z:0}):n})),t[w.MOVE_CURSOR_NORTH]&&e.updaters.playerUI.cursoredNodeLocation.enqueueUpdate((function(e){return e&&e.y%2===0?null===e||void 0===e?void 0:e.add({x:1,y:1,z:0}):e&&e.y%2!==0?null===e||void 0===e?void 0:e.add({x:0,y:1,z:0}):n})),t[w.INTERACT_WITH_NODE]&&y&&v({virtualDims:y,newStatus:re.TAKEN})}),[e.gameState.intent.newIntent,e.updaters,y,v]);var b=Object(r.useMemo)((function(){var t=g.Zero;return e.gameState.intent.activeIntent.PAN_EAST&&(t=t.addX(1)),e.gameState.intent.activeIntent.PAN_WEST&&(t=t.addX(-1)),e.gameState.intent.activeIntent.PAN_NORTH&&(t=t.addY(1)),e.gameState.intent.activeIntent.PAN_SOUTH&&(t=t.addY(-1)),t}),[e.gameState.intent.activeIntent.PAN_EAST,e.gameState.intent.activeIntent.PAN_WEST,e.gameState.intent.activeIntent.PAN_NORTH,e.gameState.intent.activeIntent.PAN_SOUTH]);return Object(i.jsx)(i.Fragment,{children:Object(i.jsx)(ue,{hidden:!t.playerUI.isPixiHidden,appSize:n,virtualGridDims:d,jumpOffset:c,virtualGridStatusMap:f,virtualDimsToLocation:l,updateNodeStatusCb:v,onJump:p,cursoredVirtualNode:y,setCursoredVirtualNode:O,keyboardScrollDirection:b})})}var ye={ArrowUp:w.PAN_NORTH,ArrowLeft:w.PAN_WEST,ArrowDown:w.PAN_SOUTH,ArrowRight:w.PAN_EAST,k:w.PAN_NORTH,h:w.PAN_WEST,j:w.PAN_SOUTH,l:w.PAN_EAST,m:w.TOGGLE_STRATEGIC_VIEW,i:w.TOGGLE_SIDEBAR,q:w.MOVE_CURSOR_NORTHWEST,w:w.MOVE_CURSOR_NORTH,a:w.MOVE_CURSOR_WEST,s:w.MOVE_CURSOR_SOUTH,d:w.MOVE_CURSOR_EAST,e:w.MOVE_CURSOR_NORTHEAST,z:w.MOVE_CURSOR_SOUTHWEST,x:w.MOVE_CURSOR_SOUTHEAST,c:w.MOVE_CURSOR_SOUTHEAST," ":w.INTERACT_WITH_NODE,"<":w.TRAVEL_UPSTAIRS,">":w.TRAVEL_DOWNSTAIRS},Oe=function(e){Object(X.a)(n,e);var t=Object(Z.a)(n);function n(e){var i;return Object(l.a)(this,n),(i=t.call(this,e)).handleKeydown=function(e){var t=i.state.keyIntentConfig[e.key];t&&e.preventDefault(),!1===e.repeat&&void 0!==t&&t!==w.NOOP&&(i.props.updaters.newIntent[t].enqueueUpdate((function(){return i.props.updaters.newIntent[t].enqueueUpdate((function(){return!1})),!0})),i.props.updaters.activeIntent[t].enqueueUpdate((function(){return!0})))},i.handleKeyup=function(e){var t=i.state.keyIntentConfig[e.key];void 0!==t&&t!==w.NOOP&&(i.props.updaters.activeIntent[t].enqueueUpdate((function(){return!1})),i.props.updaters.endedIntent[t].enqueueUpdate((function(){return i.props.updaters.endedIntent[t].enqueueUpdate((function(){return!1})),!0})))},i.state={keyIntentConfig:ye},document.addEventListener("keydown",i.handleKeydown),document.addEventListener("keyup",i.handleKeyup),i}return Object(h.a)(n,[{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.handleKeydown),document.removeEventListener("keyup",this.handleKeyup)}},{key:"render",value:function(){return Object(i.jsx)(i.Fragment,{children:" "})}}]),n}(a.a.Component),be=a.a.createContext([]),Se=n(6),me=n(47);function ge(e){return new Se.d(e.x,e.y)}var ke=n(22);function je(e){var t=[];return[function(e){t.push(e)},function(){if(0!==t.length){var n=Object(ke.a)(t);t=[],e((function(e){var t,i=e,r=Object(O.a)(n);try{for(r.s();!(t=r.n()).done;){var a=t.value;i="function"===typeof a?a(i):a}}catch(o){r.e(o)}finally{r.f()}return i}))}}]}function xe(e,t){var n={getUpdater:function(){return t}};return n.enqueueUpdate=t,"object"!==typeof e||Object.keys(e).forEach((function(i){if("enqueueUpdate"===i||"getUpdater"===i||"update"===i)throw Error("Invalid key in updaterGenerator: ".concat(i," conflicts with reserved keywords enqueueUpdate, update, getUpdater."));n[i]=xe(e[i],(function(e){t("function"===typeof e?function(t,n){var r=e(t[i],n);return t[i]===r?t:Object(R.a)(Object(R.a)({},t),{},Object(A.a)({},i,r))}:function(t,n){return Object(R.a)(Object(R.a)({},t),{},Object(A.a)({},i,e))})}))})),n}function we(e,t){return xe(e,(function(e){t("function"===typeof e?function(t){return e(t,t)}:e)}))}var Ee=function(){function e(){Object(l.a)(this,e),this._values=[]}return Object(h.a)(e,[{key:"add",value:function(e){-1===this._values.indexOf(e)||e.instance&&this.contains(e.instance),this._values.push(e)}},{key:"remove",value:function(e){var t=this._values.splice(this._values.findIndex((function(t){return t.instance===e})),1);return 0===t.length?void 0:t[0]}},{key:"contains",value:function(e){return this._values.findIndex((function(t){return t.instance===e}))>-1}},{key:"get",value:function(e){return this._values.find((function(t){return t.instance===e}))}},{key:"clone",value:function(){var t=new e;return t._values=Object(ke.a)(this._values),t}},{key:"forEach",value:function(e){this._values.forEach(e)}}]),e}(),Ne=function(){function e(t){var n=this;Object(l.a)(this,e),this.container=void 0,this.state=void 0,this._staleProps=void 0,this._children=new Ee,this._childrenToConstruct=new Ee,this._childrenToDestruct=new Ee,this._forceUpdates=new Ee,this.markForceUpdate=function(e){var t,i;null===(t=n._staleProps.args)||void 0===t||null===(i=t.markForceUpdate)||void 0===i||i.call(t,n);var r=n._children.get(e);if(!r)throw new Error("Error, child ".concat(e," not found in ").concat(n));n._forceUpdates.add(r)},this._staleProps=t}return Object(h.a)(e,[{key:"addChild",value:function(e){this._children.add(e),this._childrenToConstruct.add(e)}},{key:"registerChild",value:function(e){this._children.add(e)}},{key:"removeChild",value:function(e){var t=this._children.remove(e);t&&this._childrenToDestruct.add(t)}},{key:"_didConstruct",value:function(e){var t,n=this;this._childrenToConstruct.forEach((function(t){t.instance||(t.instance=new t.childClass(t.propsFactory(e,n.state))),n.container.addChild(t.instance.container)})),this.renderSelf(e),null===(t=this.didMount)||void 0===t||t.call(this)}},{key:"useState",value:function(e,t){var n=function(t){e.state="function"===typeof t?t(e.state):t},i=je(n),r=Object(u.a)(i,2),a=r[0];return{state:t,setState:n,fireStateUpdaters:r[1],stateUpdaters:we(t,a)}}},{key:"update",value:function(e){this._update(e)}},{key:"_update",value:function(e){var t,n,i,r=this,a=Object(R.a)({},this.state);if(null===(t=this.fireStateUpdaters)||void 0===t||t.call(this),null===(n=this.updateSelf)||void 0===n||n.call(this,e),this.shouldUpdate&&!this.shouldUpdate(this._staleProps,a,e,this.state)){var o,c=this._forceUpdates.clone();return this._forceUpdates=new Ee,c.forEach((function(t){var n,i=t.instance,a=t.propsFactory;null===i||void 0===i||i._update(a(e,r.state)),i&&(null===(n=r.didForceUpdateChild)||void 0===n||n.call(r,i))})),void(null===(o=this.didForceUpdate)||void 0===o||o.call(this))}null===(i=this.updateChildren)||void 0===i||i.call(this,e),this._updateChildren(e),this.renderSelf(e),this._staleProps=e,new Promise((function(e){var t;return e(null===(t=r.didUpdate)||void 0===t?void 0:t.call(r))}))}},{key:"_updateChildren",value:function(e){var t=this;this._childrenToDestruct.forEach((function(e){var n,i;e.instance&&(null===(n=(i=e.instance).willUnmount)||void 0===n||n.call(i),t.container.removeChild(e.instance.container))})),this._childrenToDestruct=new Ee,this._children.forEach((function(n){var i=n.instance,r=n.propsFactory;null===i||void 0===i||i._update(r(e,t.state))})),this._childrenToConstruct.forEach((function(n){n.instance||(n.instance=new n.childClass(n.propsFactory(e,t.state))),t.container.addChild(n.instance.container)})),this._childrenToConstruct=new Ee}},{key:"willUnmount",value:function(){}},{key:"toString",value:function(){return"lifecyclehandler object"}}]),e}();function Te(e){return new Proxy(e,{construct:function(e,t){var n=new e(t[0]);return n._didConstruct(t[0]),n}})}var _e;new Proxy(Ne,{construct:function(e,t,n){var i=Reflect.construct(e,t,n);return i._didConstruct.apply(i,Object(ke.a)(t)),i}});function Ie(e){var t,n={},i=function(e){var t,n=new J,i=Object(O.a)(e.playerSave.allocatedPointNodeHistory);try{for(i.s();!(t=i.n()).done;){var r=t.value,a=e.worldGen.zLevels[r.z].chunks.get(r.chunkCoord).pointNodes.get(r.pointNodeCoord);if(a.nodeType!==k.Nothing){var o=new I({type:a.resourceType,modifier:a.resourceModifier});n.put(o,(n.get(o)||0)+a.resourceAmount)}}}catch(c){i.e(c)}finally{i.f()}return n}(e),r=Object(O.a)(m(j));try{for(r.s();!(t=r.n()).done;){var a=t.value,o=i.get(new I({type:a,modifier:x.Flat}))||0;o*=1+.01*(i.get(new I({type:a,modifier:x.Increased0}))||0),o=Math.floor(o),o+=i.get(new I({type:a,modifier:x.AfterIncreased0}))||0,o*=1+.01*(i.get(new I({type:a,modifier:x.Increased1}))||0),o=Math.floor(o),o+=i.get(new I({type:a,modifier:x.AfterIncreased1}))||0,n[a]=o}}catch(c){r.e(c)}finally{r.f()}return{playerResourceAmounts:n,playerResourceNodesAggregated:i}}function Ce(e,t){var n,i=function(e,t){var n={},i=t.zLevels[e.z],r=i.chunks.get(e.chunkCoord);if(e.pointNodeCoord.x===N.CHUNK_HALF_DIM){var a=e.chunkCoord.addX(1),o=i.chunks.get(a);if(o){var c=e.pointNodeCoord.withX(-N.CHUNK_HALF_DIM),u=o.pointNodes.get(c);u&&(n.EAST=new E({z:e.z,chunkCoord:a,pointNodeCoord:c,pointNodeId:u.id}))}}else{var s=e.pointNodeCoord.addX(1),d=r.pointNodes.get(s);d&&(n.EAST=new E({z:e.z,chunkCoord:e.chunkCoord,pointNodeCoord:s,pointNodeId:d.id}))}if(e.pointNodeCoord.x===-N.CHUNK_HALF_DIM){var l=e.chunkCoord.addX(-1),h=i.chunks.get(l);if(h){var f=e.pointNodeCoord.withX(N.CHUNK_HALF_DIM),p=h.pointNodes.get(f);p&&(n.WEST=new E({z:e.z,chunkCoord:l,pointNodeCoord:f,pointNodeId:p.id}))}}else{var v=e.pointNodeCoord.addX(-1),y=r.pointNodes.get(v);y&&(n.WEST=new E({z:e.z,chunkCoord:e.chunkCoord,pointNodeCoord:v,pointNodeId:y.id}))}if(e.pointNodeCoord.equals(g.Zero)){var O=t.zLevels[e.z+1];if(O){var b=e.chunkCoord,S=Math.round(b.x/N.CHUNK_DIM),m=b.x-N.CHUNK_DIM*S,k=Math.round(b.y/N.CHUNK_DIM),j=b.y-N.CHUNK_DIM*S,x=new g(S,k),w=O.chunks.get(x);if(w){var T=new g(m,j),_=w.pointNodes.get(T);_&&(n.UP=new E({z:e.z+1,chunkCoord:x,pointNodeCoord:T,pointNodeId:_.id}))}}}var I=t.zLevels[e.z-1];if(I){var C=e.chunkCoord.multiply(9).add(e.pointNodeCoord),U=I.chunks.get(C);if(U){var M=U.pointNodes.get(g.Zero);M&&(n.DOWN=new E({z:e.z-1,chunkCoord:C,pointNodeCoord:g.Zero,pointNodeId:M.id}))}}return n}(e,t),r=[],a=Object(O.a)(m(_e));try{for(a.s();!(n=a.n()).done;){var o=i[n.value];o&&r.push(o)}}catch(c){a.e(c)}finally{a.f()}return r}function Ue(e,t,n){if("yes"===function(e,t,n,i){if(n.contains(e))return"already allocated";var r,a=Ce(e,t),o=!1,c=Object(O.a)(a);try{for(c.s();!(r=c.n()).done;){var u=r.value;n.contains(u)&&(o=!0)}}catch(s){c.e(s)}finally{c.f()}return o?"yes":"not connected"}(n,t.worldGen,t.playerSave.allocatedPointNodeSet,t.playerSave.activeQuest)&&function(e,t){var n,i=null===(n=t.worldGen.zLevels[e.z].chunks.get(e.chunkCoord))||void 0===n?void 0:n.pointNodes.get(e.pointNodeCoord);if(i.nodeType!==k.EfficiencyGate)return!0;var r,a=i.efficiencyGateInfo.thresholdResourceType;return((null===(r=t.computed.playerResourceAmounts)||void 0===r?void 0:r[a])||0)>=i.efficiencyGateInfo.thresholdResourceAmount&&t.playerSave.allocatedPointNodeHistory.length<=i.efficiencyGateInfo.timeUntilLocked}(n,t)){var i=e.allocatedPointNodeSet.clone();i.put(n);var r=Object(ke.a)(e.allocatedPointNodeHistory);return r.push(n),[Object(R.a)(Object(R.a)({},e),{},{allocatedPointNodeHistory:r,allocatedPointNodeSet:i}),!0]}return[e,!1]}function Me(e,t){var n=!1,i=!1,r=!1;e.playerUI.selectedPointNode.enqueueUpdate((function(e,i){return(null===e||void 0===e?void 0:e.pointNodeId)===t.pointNodeId&&(n=!0),t})),e.playerSave.enqueueUpdate((function(e,a){if(n){n=!1;var o=Ue(e,a,t),c=Object(u.a)(o,2),s=c[0];return c[1]?(i=!0,s):(r=!0,e)}return e})),e.computed.enqueueUpdate((function(e,t){return i?Ie(t):e})),e.playerSave.enqueueUpdate((function(e,t){return i?(i=!1,function(e,t){var n=Object(R.a)({},e);if(void 0!==n.spSpentThisQuest&&(n.spSpentThisQuest+=1),n.activeQuest){var i,r=n.activeQuest.resourceType,a=(null===(i=t.computed.playerResourceAmounts)||void 0===i?void 0:i[r])||0;n.questProgressHistory=[].concat(Object(ke.a)(n.questProgressHistory),[a])}return n}(e,t)):e})),e.playerUI.activeTab.enqueueUpdate((function(e,t){return r?(r=!1,1):e}))}!function(e){e.NORTHWEST="NORTHWEST",e.SOUTHWEST="SOUTHWEST",e.NORTHEAST="NORTHEAST",e.SOUTHEAST="SOUTHEAST",e.EAST="EAST",e.WEST="WEST",e.UP="UP",e.DOWN="DOWN"}(_e||(_e={}));var Ae=Te(function(e){Object(X.a)(n,e);var t=Object(Z.a)(n);function n(e){var i,r,a;Object(l.a)(this,n),(a=t.call(this,e)).container=void 0,a.state=void 0,a.sprite=void 0,a.halfwayCenterSprite=void 0,a.centerSprite=void 0,a.topHalfSprite=void 0,a.hitArea=void 0,a.tooltippableArea=void 0,a.state={numClicks:0,descriptionText:""},a.updateSelf(e),a.container=new Se.b;var o=null===(i=e.args.pointNodeTexture.find((function(e){return e.cropFraction>=.99})))||void 0===i?void 0:i.texture;a.container.sortableChildren=!0,a.sprite=new Se.g(o),a.sprite.anchor.x=.5,a.sprite.anchor.y=.5,a.sprite.zIndex=-2,a.container.addChild(a.sprite),a.topHalfSprite=new Se.g(null===(r=e.args.pointNodeTexture.find((function(e){return e.cropFraction>=.499})))||void 0===r?void 0:r.texture),a.topHalfSprite.anchor.x=.5,a.topHalfSprite.anchor.y=.5,a.topHalfSprite.zIndex=-1,e.pointNodeGen.nodeType===k.EfficiencyGate&&a.container.addChild(a.topHalfSprite);var c=new Se.c;return c.beginFill(ee.black),c.drawRect(0,0,a.topHalfSprite.width,a.topHalfSprite.height/2),c.pivot.x=a.topHalfSprite.width/2,c.pivot.y=a.topHalfSprite.height/2,c.zIndex=30,a.centerSprite=new Se.g(o),a.centerSprite.anchor.x=.5,a.centerSprite.anchor.y=.5,a.centerSprite.scale=ge(new g(.5,.5)),a.centerSprite.zIndex=1,a.centerSprite.alpha=0,a.halfwayCenterSprite=new Se.g(o),a.halfwayCenterSprite.anchor.x=.5,a.halfwayCenterSprite.anchor.y=.5,a.halfwayCenterSprite.scale=ge(new g(.75,.75)),a.halfwayCenterSprite.zIndex=0,a.halfwayCenterSprite.alpha=0,a.container.interactive=!0,a.container.buttonMode=!0,a.hitArea=new Se.e(-Re.NODE_HITAREA_PX/2,-Re.NODE_HITAREA_PX/2,Re.NODE_HITAREA_PX,Re.NODE_HITAREA_PX),a.container.hitArea=a.hitArea,a}return Object(h.a)(n,[{key:"updateSelf",value:function(e){var t="Nothing (empty node)";e.pointNodeGen.nodeType===k.EfficiencyGate?t="Unlocks at 300 Mana0 in 14 or fewer allocations":e.pointNodeGen.nodeType!==k.Nothing&&(t="".concat(e.pointNodeGen.resourceAmount," ").concat(e.pointNodeGen.resourceModifier," ").concat(e.pointNodeGen.resourceType)),this.state.descriptionText=t}},{key:"renderSelf",value:function(e){var t,n,i;this.container.position=ge(e.args.position),e.isSelected?(n=ee.selectedTint,i=ee.selectedTint):(n=ee.nullTint,i=ee.nullTint),e.isAllocated&&(n=ee.allocatedTint);var r=0,a=0;e.pointNodeGen.nodeType===k.Nothing?r=ee.nodeBlue:e.pointNodeGen.nodeType===k.EfficiencyGate?(r=ee.nodeAqua,a=S(ee.nodeAqua,ee.gateTint)):e.pointNodeGen.resourceType===j.Mana0&&(e.pointNodeGen.resourceModifier===x.Flat?r=ee.nodePink:e.pointNodeGen.resourceModifier===x.Increased0&&(r=ee.nodeLavender)),this.sprite.tint=S(r,n),this.centerSprite.tint=S(r,i),this.topHalfSprite.tint=S(a,n);var o=Math.floor(9*Math.random())/8-.001;this.topHalfSprite.texture=null===(t=e.args.pointNodeTexture.find((function(e){return e.cropFraction>=o})))||void 0===t?void 0:t.texture,e.selfPointNodeRef.pointNodeCoord.equals(g.Zero)&&(this.container.scale=ge(new g(1.25,1.25)))}},{key:"shouldUpdate",value:function(e,t,n,i){var r,a=Object(O.a)(Object.keys(e));try{for(a.s();!(r=a.n()).done;){var o=r.value;if("delta"!==o&&"args"!==o&&"updaters"!==o){if(e[o]!==n[o])return console.log("node shouldUpdate differed in ".concat(o,", returning true")),!0;var c,u;if("selfPointNodeRef"!==o);else if((null===(c=e[o])||void 0===c?void 0:c.hash())!==(null===(u=n[o])||void 0===u?void 0:u.hash()))return console.log("node shouldUpdate differed in ".concat(o,", returning true")),!0}}}catch(s){a.e(s)}finally{a.f()}return!1}},{key:"didMount",value:function(){var e=this,t=this._staleProps.updaters;this.container.addListener("pointerdown",(function(n){e._staleProps.args.markForceUpdate(e),e.state.numClicks++,Me(t,e._staleProps.selfPointNodeRef)})),this.container.addListener("pointerover",(function(t){var n=t.data.getLocalPosition(e.container),i=new g(e.container.worldTransform.tx,e.container.worldTransform.ty);e._staleProps.tooltipUpdaters.enqueueUpdate((function(t){return Object(R.a)(Object(R.a)({},t),{},{visible:!0,text:e.state.descriptionText,position:i.add(n)})}))})),this.container.addListener("pointerout",(function(t){e._staleProps.tooltipUpdaters.enqueueUpdate((function(e){return Object(R.a)(Object(R.a)({},e),{},{visible:!1,text:""})}))})),this.container.addListener("pointermove",(function(t){var n=t.data.getLocalPosition(e.container),i=new g(e.container.worldTransform.tx,e.container.worldTransform.ty);e._staleProps.tooltipUpdaters.position.enqueueUpdate(i.add(n))}))}},{key:"toString",value:function(){return"PointNodeCompoent "+this._staleProps.selfPointNodeRef.toString()}}]),n}(Ne)),Re=function e(){Object(l.a)(this,e)};Re.SPACING_PX=36,Re.CHUNK_SPACING_PX=(N.CHUNK_DIM+0)*Re.SPACING_PX,Re.NODE_SIZE_PX=22,Re.NODE_HITAREA_PX=Re.NODE_SIZE_PX+4,Re.NODE_ROUNDED_PX=4;Te(function(e){Object(X.a)(n,e);var t=Object(Z.a)(n);function n(e){var i;return Object(l.a)(this,n),(i=t.call(this,e)).container=void 0,i.state=void 0,i.children=void 0,i.state={},i.container=new Se.b,i.children=new Q,i.resyncChildren(e),i}return Object(h.a)(n,[{key:"renderSelf",value:function(e){this.container.position=ge(e.position)}},{key:"shouldUpdate",value:function(e,t,n,i){var r,a=Object(O.a)(Object.keys(e));try{for(a.s();!(r=a.n()).done;){var o=r.value;if("delta"!==o&&"args"!==o&&"updaters"!==o){if("position"===o){if(e[o].equals(n[o]))continue;return console.log("chunk shouldUpdate differed in ".concat(o,", returning true")),!0}var c,u;if("selectedPointNode"!==o)if("selfChunkRef"!==o){if("allocatedPointNodeSubset"===o){if(e[o].equals(n[o]))continue;return console.log("chunk shouldUpdate differed in ".concat(o,", returning true")),!0}if(e[o]!==n[o])return console.log("chunk shouldUpdate differed in ".concat(o,", returning true")),!0}else{var s,d;if((null===(s=e[o])||void 0===s?void 0:s.hash())!==(null===(d=n[o])||void 0===d?void 0:d.hash()))return console.log("chunk shouldUpdate differed in ".concat(o,", returning true")),!0}else if((null===(c=e[o])||void 0===c?void 0:c.hash())!==(null===(u=n[o])||void 0===u?void 0:u.hash()))return console.log("chunk shouldUpdate differed in ".concat(o,", returning true")),!0}}}catch(l){a.e(l)}finally{a.f()}return!1}},{key:"resyncChildren",value:function(e){var t=this,n=this.children.clone();console.log("chunk component upsert children got here");var i,r=Object(O.a)(e.chunkGen.pointNodes.entries());try{var a=function(){var r=Object(u.a)(i.value,2),a=r[0],o=r[1],c=new E({z:e.selfChunkRef.z,chunkCoord:e.selfChunkRef.chunkCoord,pointNodeCoord:a,pointNodeId:o.id}),s=function(e,n){var i;return{delta:e.delta,args:{pointNodeTexture:e.args.pointNodeTexture,markForceUpdate:t.markForceUpdate,position:c.pointNodeCoord.multiply(Re.SPACING_PX)},selfPointNodeRef:c,updaters:e.updaters,tooltipUpdaters:e.tooltipUpdaters,pointNodeGen:o,isSelected:(null===(i=e.selectedPointNode)||void 0===i?void 0:i.pointNodeId)===c.pointNodeId,isAllocated:e.allocatedPointNodeSubset.contains(c)}},d=c,l=t.children.get(d);l?n.remove(d):(l=new Ae(s(e,t.state)),t.children.put(c,l),t.addChild({childClass:Ae,instance:l,propsFactory:s}))};for(r.s();!(i=r.n()).done;)a()}catch(h){r.e(h)}finally{r.f()}console.log("chunk component to delete has ".concat(n.size()," children"));var o,c=Object(O.a)(n.entries());try{for(c.s();!(o=c.n()).done;){var s=Object(u.a)(o.value,2),d=s[0],l=s[1];this.children.remove(d),this.removeChild(l)}}catch(h){c.e(h)}finally{c.f()}}},{key:"updateChildren",value:function(e){this.resyncChildren(e)}},{key:"didForceUpdateChild",value:function(e){this.container.removeChild(e.container),this.container.addChild(e.container)}}]),n}(Ne));var De=function(){function e(t){Object(l.a)(this,e),this._wasConstructed=!1,this._value=void 0,this._factory=void 0,this._factory=t}return Object(h.a)(e,[{key:"get",value:function(){return void 0!==this._value||!0===this._wasConstructed||(this._value=this._factory(),this._wasConstructed=!0),this._value}},{key:"wasConstructed",value:function(){return this._wasConstructed}}]),e}();var ze=function(){function e(t){Object(l.a)(this,e),this._values=void 0,this._factory=void 0,this._values=new Q,this._factory=t}return Object(h.a)(e,[{key:"put",value:function(e,t){this._values.put(e,t)}},{key:"peek",value:function(e){return this._values.get(e)}},{key:"get",value:function(e){if(this._values.contains(e))return this._values.get(e);var t=this._factory(e);return this._values.put(e,t),t}},{key:"precompute",value:function(e){if(!this._values.contains(e)){var t=this._factory(e);this._values.put(e,t)}}},{key:"contains",value:function(e){return this._values.contains(e)}},{key:"values",value:function(){return this._values.values()}},{key:"keys",value:function(){return this._values.keys()}},{key:"entries",value:function(){return this._values.entries()}},{key:"size",value:function(){return this._values.size()}},{key:"clone",value:function(){var t=new e(this._factory);return t._values=this._values.clone(),t}}]),e}(),He=Te(function(e){Object(X.a)(n,e);var t=Object(Z.a)(n);function n(e){var i;return Object(l.a)(this,n),(i=t.call(this,e)).container=void 0,i.state=void 0,i.container=new Se.b,i.container.sortableChildren=!0,i.state={},i}return Object(h.a)(n,[{key:"renderSelf",value:function(e){}}]),n}(Ne)),Pe=Te(function(e){Object(X.a)(n,e);var t=Object(Z.a)(n);function n(e){var i;Object(l.a)(this,n),(i=t.call(this,e)).container=void 0,i.state=void 0,i.graphics=void 0,i.hexGrid=new Q,i.state={numClicks:0,descriptionText:""},i.updateSelf(e),i.container=new Se.b,i.graphics=new Se.g,i.graphics.texture=e.args.textures.circle,i.graphics.tint=ee.borderBlack,i.graphics.visible=!1,i.container.addChild(i.graphics);for(var r=-20;r<=20;r++)for(var a=-35+Math.floor(r/2);a<=35+Math.floor(r/2);a++){var o=new Se.g;o.texture=e.args.textures.circle,o.tint=ee.nodePink,o.position=ge(e.appSize.divide(2).add(new g(30*a-15*r,-26*r))),i.container.addChild(o),i.hexGrid.put(new g(a,r),o)}return i}return Object(h.a)(n,[{key:"updateSelf",value:function(e){}},{key:"renderSelf",value:function(e){this.container.position=ge(e.args.position),this.graphics.position=ge(e.appSize.divide(2));var t,n=Object(O.a)(this.hexGrid.entries());try{for(n.s();!(t=n.n()).done;){var i=Object(u.a)(t.value,2),r=i[0],a=i[1];a.position=ge(e.appSize.divide(2).add(new g(30*r.x-15*r.y,-26*r.y)));var o=e.virtualGridLocation.add(C.FromVector2(r)),c=e.fogOfWarStatusMap.get(o)||re.HIDDEN,s=e.allocationStatusMap.get(o)||re.HIDDEN,d=e.lockMap.get(o);e.lockStatusMap.get(o);c===re.HIDDEN?a.visible=!1:s===re.TAKEN?(a.visible=!0,a.tint=ee.borderBlack):c!==re.AVAILABLE&&c!==re.UNREACHABLE||(a.visible=!0,a.tint=ee.nodePink),d?(a.texture=e.args.textures.rect,a.position.x-=e.args.textures.rect.width/2,a.position.y-=e.args.textures.rect.height/2):(a.texture=e.args.textures.circle,a.position.x-=e.args.textures.circle.width/2,a.position.y-=e.args.textures.circle.height/2)}}catch(l){n.e(l)}finally{n.f()}}},{key:"shouldUpdate",value:function(e,t,n,i){var r,a=Object(O.a)(Object.keys(e));try{for(a.s();!(r=a.n()).done;){var o=r.value;if("args"!==o&&e[o]!==n[o])return console.log("hexgrid shouldUpdate differed in ".concat(o,", returning true")),!0}}catch(c){a.e(c)}finally{a.f()}return!1}}]),n}(Ne));var Le=Te(function(e){Object(X.a)(n,e);var t=Object(Z.a)(n);function n(e){var i;Object(l.a)(this,n),(i=t.call(this,e)).container=void 0,i.state=void 0,i.stateUpdaters=void 0,i.fireStateUpdaters=void 0,i.fixedCameraStage=void 0,i.actionStage=void 0,i.backdropStage=void 0,i.strategicHexGrid=void 0,i.backdrop=void 0,i.container=new Se.b,i.container.sortableChildren=!0;var r=i.useState(Object(me.a)(i),{pointNodeTexture:new De((function(){return function(e){for(var t=[],n=0;n<=8;n++){var i=n/8,r=new Se.c;r.beginFill(ee.white),r.drawRoundedRect(-Re.NODE_SIZE_PX/2,-Re.NODE_SIZE_PX/2,Re.NODE_SIZE_PX,Re.NODE_SIZE_PX,Re.NODE_ROUNDED_PX);var a=new Se.c;a.beginFill(ee.black),a.drawRect(-Re.NODE_SIZE_PX/2,-Re.NODE_SIZE_PX/2,Re.NODE_SIZE_PX,Re.NODE_SIZE_PX*i),r.mask=a;var o=e.generateTexture(r,Se.f.LINEAR,1);t.push({cropFraction:i,texture:o})}return t}(e.args.renderer)})),simpleTexture:new De((function(){return function(e){var t=new Se.c;t.beginFill(ee.white),t.drawCircle(0,0,8);var n=new Se.c;n.beginFill(ee.white),n.drawRect(0,0,4,20);var i=new Se.c;return i.beginFill(ee.white),i.drawRect(0,0,16,16),{circle:e.generateTexture(t,Se.f.LINEAR,1),rect:e.generateTexture(n,Se.f.LINEAR,1),square:e.generateTexture(i,Se.f.LINEAR,1)}}(e.args.renderer)})),tick:0,playerCurrentZ:0,tooltip:{visible:!1,position:void 0,text:""}});i.state=r.state,i.stateUpdaters=r.stateUpdaters,i.fireStateUpdaters=r.fireStateUpdaters;var a=function(e,t){return{args:{renderer:e.args.renderer,markForceUpdate:i.markForceUpdate},delta:e.delta,gameState:e.gameState,appSize:e.appSize,tick:t.tick,tooltip:Object(R.a)({},t.tooltip)}};i.fixedCameraStage=new He(a(e,i.state)),i.addChild({childClass:He,instance:i.fixedCameraStage,propsFactory:a}),i.actionStage=new Se.g,i.actionStage.zIndex=0,i.actionStage.sortableChildren=!0,i.container.addChild(i.actionStage);var o=function(e,t){return{args:{position:g.Zero,textures:t.simpleTexture.get()},appSize:e.appSize,virtualGridLocation:e.gameState.playerUI.virtualGridLocation,allocationStatusMap:e.gameState.playerSave.allocationStatusMap,fogOfWarStatusMap:e.gameState.computed.fogOfWarStatusMap,lockStatusMap:e.gameState.computed.lockStatusMap,lockMap:e.gameState.worldGen.lockMap}};return i.strategicHexGrid=new Pe(o(e,i.state)),i.addChild({childClass:Pe,instance:i.strategicHexGrid,propsFactory:o}),i.backdropStage=new Se.g,i.backdropStage.zIndex=-1,i.backdropStage.sortableChildren=!0,i.container.addChild(i.backdropStage),i.backdrop=new Se.c,i.backdropStage.addChild(i.backdrop),i.backdrop.beginFill(ee.backgroundBlue,1),i.backdrop.interactive=!0,i.backdrop.drawRect(0,0,e.appSize.x,e.appSize.y),i}return Object(h.a)(n,[{key:"updateSelf",value:function(e){this.state.tick++}},{key:"renderSelf",value:function(e){this.backdrop.width=e.appSize.x,this.backdrop.height=e.appSize.y}},{key:"didMount",value:function(){this._staleProps.updaters}},{key:"didUpdate",value:function(){this._staleProps.updaters}}]),n}(Ne));function Ge(e){return new g({x:Math.min(1920,((null===e||void 0===e?void 0:e.x)||1/0)-24),y:Math.min(1080,((null===e||void 0===e?void 0:e.y)||1/0)-24)})}var We=function(){function e(t){var n;Object(l.a)(this,e),this.app=void 0,this.state=void 0,this.props=void 0,this.staleProps=void 0,this.rootComponent=void 0,this.onTick=void 0,null===t||void 0===t||null===(n=t.args)||void 0===n||n.isSecondConstructorCall;var i=new g(800,600);this.state={appSize:i,originalAppSize:i},this.app=new Se.a({width:this.state.appSize.x,height:this.state.appSize.y,antialias:!0,transparent:!0,resolution:window.devicePixelRatio||1,autoDensity:!0,powerPreference:"low-power",backgroundColor:ee.white})}return Object(h.a)(e,[{key:"pause",value:function(){this.app.ticker.remove(this.onTick)}},{key:"destroy",value:function(){this.app.destroy(!0,{children:!0,texture:!0,baseTexture:!0})}},{key:"didMount",value:function(){var e=this;this.onTick=function(t){return e.baseGameLoop(t)},this.onTick=this.onTick.bind(this),this.app.ticker.add(this.onTick),this.state.appSize=Ge(new g(this.props.gameState.windowState.innerWidth,this.props.gameState.windowState.innerHeight))}},{key:"register",value:function(e){e.appendChild(this.app.view)}},{key:"updateSelf",value:function(e,t){e!==t?(e.gameState.windowState.innerWidth===(null===t||void 0===t?void 0:t.gameState.windowState.innerWidth)&&e.gameState.windowState.innerHeight===(null===t||void 0===t?void 0:t.gameState.windowState.innerHeight)||(this.state.appSize=Ge(new g(e.gameState.windowState.innerWidth,e.gameState.windowState.innerHeight))),e.updaters.tick.enqueueUpdate((function(e){return e+1}))):e.updaters.tick.enqueueUpdate((function(e){return e+1}))}},{key:"rerender",value:function(e){this.rootComponent&&this.props===e||(this.props=e,this.rootComponent||(this.rootComponent=new Le({args:{renderer:this.app.renderer,markForceUpdate:function(){}},updaters:this.props.updaters,delta:0,gameState:this.props.gameState,appSize:this.state.appSize}),this.app.stage.addChild(this.rootComponent.container),this.renderSelf(this.props),this.didMount()))}},{key:"renderSelf",value:function(e){this.app.renderer.resize(this.state.appSize.x,this.state.appSize.y)}},{key:"baseGameLoop",value:function(e){var t;if(this.props.gameState.playerUI.isPixiHidden)return this.props.updaters.tick.enqueueUpdate((function(e){return e+1})),void this.props.args.fireBatch();this.updateSelf(this.props,this.staleProps),null===(t=this.rootComponent)||void 0===t||t.update({args:{renderer:this.app.renderer,markForceUpdate:function(){}},updaters:this.props.updaters,delta:e,gameState:this.props.gameState,appSize:this.state.appSize}),this.renderSelf(this.props),this.staleProps=this.props,this.props.args.fireBatch()}}]),e}(),Fe=new De((function(){return new We}));function qe(e){var t=Object(r.useState)(Fe.get()),n=Object(u.a)(t,2),a=n[0],o=(n[1],Object(r.useRef)(null)),c=Object(r.useContext)(be),s=Object(u.a)(c,3),d=s[0],l=s[1],h=s[2];return Object(r.useEffect)((function(){for(var e=o.current.childNodes.length-1;e>=0;e--)o.current.removeChild(o.current.childNodes[e]);o.current.appendChild(a.app.view)}),[a]),Object(r.useEffect)((function(){a.rerender({args:{fireBatch:h,isSecondConstructorCall:!1},updaters:l,gameState:d})}),[a,h,l,d]),Object(i.jsx)(i.Fragment,{children:Object(i.jsx)("div",{ref:o,hidden:e.hidden,style:{}})})}var Ve=n(126);"Mobile Safari"===(new(n.n(Ve).a)).getBrowser().name&&(window.innerWidth,window.innerHeight);var Be,Ke=function(e){Object(X.a)(n,e);var t=Object(Z.a)(n);function n(e){var i;return Object(l.a)(this,n),(i=t.call(this,e)).handleWindowResize=function(e){i.props.updaters.enqueueUpdate((function(e){return Object(R.a)(Object(R.a)({},e),{},{innerWidth:window.innerWidth,innerHeight:window.innerHeight})}))},i.state={},window.addEventListener("resize",i.handleWindowResize),i}return Object(h.a)(n,[{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.handleWindowResize)}},{key:"render",value:function(){return Object(i.jsx)(i.Fragment,{children:" "})}}]),n}(a.a.Component);!function(e){e.NORTHWEST="NORTHWEST",e.SOUTHWEST="SOUTHWEST",e.NORTHEAST="NORTHEAST",e.SOUTHEAST="SOUTHEAST",e.EAST="EAST",e.WEST="WEST",e.UP="UP",e.DOWN="DOWN"}(Be||(Be={}));function Xe(e){var t={};return t.EAST=e.addX(1),t.WEST=e.addX(-1),t.NORTHWEST=e.addY(1),t.SOUTHEAST=e.addY(-1),t.NORTHEAST=e.add(1,1,0),t.SOUTHWEST=e.add(-1,-1,0),t}function Ze(e,t,n,i){var r=new Y,a=new Y;r.put(e);for(var o=[[e]],c=1;c<=t;c++){o.push([]);var u,s=Object(O.a)(o[c-1]);try{for(s.s();!(u=s.n()).done;)for(var d=u.value,l=Object.values(Xe(d)),h=0,f=l;h<f.length;h++){var p=f[h];p&&(r.get(p)||((null===i||void 0===i?void 0:i.contains(p))?a.put(p):(r.put(p),o[c].push(p))))}}catch(b){s.e(b)}finally{s.f()}}for(var v=[],y=n||0;y<=t;y++)v=v.concat(o[y]);return v=v.concat(a.values())}var Ye=function(){function e(t){Object(l.a)(this,e),this.config=void 0,this.chunkGenFactory=void 0,this.config=t,this.chunkGenFactory=new Je({})}return Object(h.a)(e,[{key:"create",value:function(e){for(var t=Object(D.b)(e.seed+e.z),n=new Q,i=e.startingChunks||3,r=-i;r<=i;r++)for(var a=-i;a<=i;a++){var o=new g(r,a);n.put(o,this.chunkGenFactory.create({seed:t,location:o,z:e.z}))}return{id:t,chunks:n}}}]),e}(),Je=function(){function e(t){Object(l.a)(this,e),this.config=void 0,this.pointNodeGenFactory=void 0,this.config=t,this.pointNodeGenFactory=new Qe({})}return Object(h.a)(e,[{key:"create",value:function(e){for(var t=Object(D.b)(e.seed+Object(D.b)(e.seed+e.location.x)+e.location.y),n=new Q,i=new Y,r=-N.CHUNK_HALF_DIM;r<=N.CHUNK_HALF_DIM;r++)for(var a=-N.CHUNK_HALF_DIM;a<=N.CHUNK_HALF_DIM;a++)0===r&&0===a||Object(D.b)(t+r*N.CHUNK_DIM+a)/D.a<N.DROP_NODES_CHANCE/4&&(i.put(new g(r,a)),i.put(new g(a,-r)),i.put(new g(-r,-a)),i.put(new g(-a,r)));for(var o=-N.CHUNK_HALF_DIM;o<=N.CHUNK_HALF_DIM;o++)for(var c=-N.CHUNK_HALF_DIM;c<=N.CHUNK_HALF_DIM;c++){var u=new g(o,c);i.get(u)||n.put(u,this.pointNodeGenFactory.create({seed:t,location:u,chunk:e.location,z:e.z}))}return{id:t,pointNodes:n}}}]),e}(),Qe=function(){function e(t){Object(l.a)(this,e),this.config=void 0,this.config=t}return Object(h.a)(e,[{key:"create",value:function(e){var t,n=Object(D.b)(e.seed+Object(D.b)(e.seed+e.location.x)+e.location.y),i=Object(D.b)(n+1)/D.a,r=j.Mana2,a=k.Nothing;i<0?a=k.Nothing:i<.15?(a=k.Basic,r=j.Mana0):i<.35?(a=k.EfficiencyGate,r=j.Mana0):i<-.35?(a=k.Basic,r=j.Mana1):i<-.6?(a=k.Basic,r=j.Mana2):a=k.Nothing,e.location.equals(g.Zero)&&e.chunk.equals(g.Zero)&&0===e.z&&(a=k.Nothing);var o=0;if((t=(i=Object(D.b)(n+2)/D.a)<.55?x.Flat:i<-.7?x.AfterIncreased0:i<-.7?x.AfterIncreased1:i<1.95?x.Increased0:x.Increased1)===x.Flat||t===x.AfterIncreased0||t===x.AfterIncreased1?(i=Math.floor(Object(D.b)(n+3)/D.a*4),i+=Math.floor(Object(D.b)(n+4)/D.a*4),o=20*(i+=Math.floor(Object(D.b)(n+5)/D.a*4))+60):(i=Math.floor(Object(D.b)(n+3)/D.a*2),i+=Math.floor(Object(D.b)(n+4)/D.a*2),i+=Math.floor(Object(D.b)(n+5)/D.a*2),o=(i+=Math.floor(Object(D.b)(n+6)/D.a*3))+3),a===k.Nothing)return{id:n,nodeType:a};if(a===k.EfficiencyGate){return{id:n,resourceAmount:o,resourceModifier:t,resourceType:r,nodeType:a,efficiencyGateInfo:{thresholdResourceAmount:300,thresholdResourceType:j.Mana0,timeUntilLocked:14}}}return{id:n,resourceAmount:o,resourceModifier:t,resourceType:r,nodeType:a}}}]),e}(),$e=function(){function e(t){Object(l.a)(this,e),this.config=void 0,this.config=t}return Object(h.a)(e,[{key:"create",value:function(e){var t=Object(D.b)(e.seed+e.location.x+e.location.y+Object(D.b)(e.seed+e.location.x+e.location.z))/D.a,n={shortTextTarget:"\ud83d\udd12",shortTextTimer:"",lockStatus:ae.TICKING};if(!e.location.equals(C.Zero))return t<.47?n:void 0}}]),e}(),et=function(){function e(t){Object(l.a)(this,e),this.updaters=void 0,this.updaters=t}return Object(h.a)(e,[{key:"enqueueAction",value:function(e){var t,n,i=e.nodeLocation,r=e.newStatus;this.updaters.playerSave.allocationStatusMap.enqueueUpdate((function(e){return e.put(i,r),e.clone()})),null===(t=this.updaters.computed.lockStatusMap)||void 0===t||t.enqueueUpdate((function(e,t){if(!e)return e;var n,i=Object(O.a)(t.worldGen.lockMap.entries());try{for(i.s();!(n=i.n()).done;){var r=Object(u.a)(n.value,2),a=r[0];if(r[1]){var o=ae.TICKING;e.put(a,o)}}}catch(c){i.e(c)}finally{i.f()}return e.clone()})),null===(n=this.updaters.computed.fogOfWarStatusMap)||void 0===n||n.enqueueUpdate((function(e,t){return e?(e.put(i,re.VISIBLE),Ze(i,1).forEach((function(t){e.put(t,re.AVAILABLE)})),Ze(i,6,0,{contains:function(e){var n,i=null===(n=t.computed.lockStatusMap)||void 0===n?void 0:n.get(e);return!(!i||i===ae.OPEN)}}).forEach((function(n){(e.get(n)||re.HIDDEN)===re.HIDDEN&&(t.worldGen.lockMap.precompute(n),e.put(n,re.UNREACHABLE))})),e.clone()):e}))}}]),e}(),tt=function(){function e(t){Object(l.a)(this,e),this.config=void 0,this.config=t}return Object(h.a)(e,[{key:"create",value:function(){var e,t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,i=n||103043,r=new Ye({}).create({seed:i,z:0,startingChunks:0}),a=new g(0,0),o=null===(e=r.chunks.get(a))||void 0===e||null===(t=e.pointNodes.get(a))||void 0===t?void 0:t.id,c=new E({z:0,chunkCoord:a,pointNodeId:o,pointNodeCoord:a}),s={orientation:"original",innerWidth:window.innerWidth,innerHeight:window.innerHeight},d=new $e({}),l=new ze((function(e){return d.create({seed:i,location:e})})),h=new q({}),f=new ze((function(e){return h.create({seed:i,location:e})})),p={tick:0,worldGen:{seed:i,zLevels:{0:r},lockMap:l,nodeContentsMap:f},playerSave:{activeQuest:void 0,spSpentThisQuest:void 0,questProgressHistory:[],questInitialAmount:0,questsCompleted:[],allocatedPointNodeSet:new Y([c]),allocatedPointNodeHistory:[c],score:0,allocationStatusMap:new Q([[C.Zero,re.TAKEN]])},playerUI:{selectedPointNode:void 0,activeTab:0,isPixiHidden:!0,virtualGridLocation:C.Zero,cursoredNodeLocation:void 0,isSidebarOpen:!1},computed:{},intent:{activeIntent:T,newIntent:T,endedIntent:T},windowState:s};p.computed=Object(R.a)({},Ie(p)),p.computed.lockStatusMap=new J,p.computed.fogOfWarStatusMap=new J,Ze(C.Zero,6).forEach((function(e){p.worldGen.lockMap.precompute(e)}));var v,y=p.computed.lockStatusMap,b=(C.Zero,p),S=Object(O.a)(b.worldGen.lockMap.entries());try{for(S.s();!(v=S.n()).done;){var m=Object(u.a)(v.value,2),k=m[0],j=m[1];if(j){var x=ae.TICKING;y.put(k,x)}}}catch(U){S.e(U)}finally{S.f()}var w=p.computed.fogOfWarStatusMap,N=C.Zero,_=(re.TAKEN,p);w.put(N,re.VISIBLE),Ze(N,1).forEach((function(e){w.put(e,re.AVAILABLE)}));var I={contains:function(e){var t,n=null===(t=_.computed.lockStatusMap)||void 0===t?void 0:t.get(e);return!(!n||n===ae.OPEN)}};return Ze(N,6,0,I).forEach((function(e){(w.get(e)||re.HIDDEN)===re.HIDDEN&&(_.worldGen.lockMap.precompute(e),w.put(e,re.UNREACHABLE))})),p}}]),e}();n(233);function nt(e){var t=e.children,n=e.hidden,r=e.setSidebarHidden;return Object(i.jsxs)("div",{className:"layout",hidden:n,children:[Object(i.jsx)("div",{className:"close",onClick:function(){r()},children:"\u274e Close"}),Object(i.jsx)("br",{}),Object(i.jsx)(i.Fragment,{children:t})]})}n(234);function it(e){var t=e.value,n=e.labels,r=e.onChange;return Object(i.jsx)("div",{className:"tab-label-container",children:n.map((function(e,n){return Object(i.jsx)(rt,{onClick:r,value:n,active:t===n,children:e},n)}))})}function rt(e){var t=e.onClick,n=e.value,r=e.active,a=e.children;return Object(i.jsx)("div",{className:r?"tab-label active":"tab-label inactive",children:Object(i.jsx)("div",{onClick:function(){t(n)},children:a})})}var at=new De((function(){return new tt({}).create(+new Date)}));var ot=function(){var e=Object(r.useState)((function(){return at.get()})),t=Object(u.a)(e,2),n=t[0],a=t[1],o=Object(r.useMemo)((function(){return je(a)}),[a]),c=Object(u.a)(o,2),s=c[0],l=c[1],h=Object(r.useMemo)((function(){return we(at.get(),s)}),[s]),f=(Object(r.useMemo)((function(){return _(new g(n.windowState.innerWidth,n.windowState.innerHeight))}),[n.windowState.innerWidth,n.windowState.innerHeight]),Object(r.useMemo)((function(){return[n,h,l]}),[n,h,l]));return Object(r.useEffect)((function(){console.log("maybe toggling strategic view"),n.intent.newIntent.TOGGLE_STRATEGIC_VIEW&&h.playerUI.isPixiHidden.enqueueUpdate((function(e){return!e}))}),[n.intent.newIntent.TOGGLE_STRATEGIC_VIEW]),Object(r.useEffect)((function(){console.log("maybe toggling sidebar"),n.intent.newIntent.TOGGLE_SIDEBAR&&h.playerUI.isSidebarOpen.enqueueUpdate((function(e){return!e}))}),[n.intent.newIntent.TOGGLE_SIDEBAR]),Object(i.jsxs)("div",{className:d()({App:!0}),children:[Object(i.jsxs)("div",{className:"entire-area",children:[Object(i.jsx)(be.Provider,{value:f,children:Object(i.jsx)(qe,{hidden:n.playerUI.isPixiHidden})}),Object(i.jsx)(pe,{gameState:n,updaters:h,actions:{allocateNode:new et(h)}})]}),Object(i.jsx)("div",{className:"debug-overlay",children:Object(i.jsx)(p,{tick:n.tick,windowState:n.windowState})}),Object(i.jsxs)("div",{className:"button-zone",children:[Object(i.jsx)("button",{className:"button-pixi-toggle",style:{},onClick:function(){h.playerUI.isPixiHidden.enqueueUpdate((function(e){return!e}))},children:"Toggle strategic view (hotkey: m)"}),Object(i.jsx)("span",{children:" "}),Object(i.jsx)("button",{onClick:function(){h.playerUI.isSidebarOpen.enqueueUpdate((function(e){return!e}))},children:"Toggle sidebar (hotkey: i)"})]}),Object(i.jsxs)(nt,{hidden:!n.playerUI.isSidebarOpen,setSidebarHidden:function(){h.playerUI.isSidebarOpen.enqueueUpdate((function(){return!1}))},children:[Object(i.jsx)(it,{onClick:function(){},value:0,labels:["foo","bar"],onChange:function(e){},active:!0}),Object(i.jsx)("br",{}),"content"]}),Object(i.jsx)(Oe,{intent:n.intent,updaters:h.intent}),Object(i.jsx)(Ke,{updaters:h.windowState})]})};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(Object(i.jsx)(a.a.StrictMode,{children:Object(i.jsx)(ot,{})}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},5:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return r}));n(2),n(3),n(48);var i=Math.pow(2,32);function r(e){var t=(e+i)%i;return t=Math.imul(t,3039394381),t^=t>>>8,t+=1759714724,t^=t<<8,t=Math.imul(t,458671337),((t^=t>>>8)+i)%i}}).call(this,n(14).Buffer)}},[[235,1,2]]]);
//# sourceMappingURL=main.f6696c4c.chunk.js.map